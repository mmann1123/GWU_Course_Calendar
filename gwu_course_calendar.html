<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GWU Courses - Fall 2025</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f8f9fa; padding: 0; }
        .main-content { padding: 20px; }

        /* Read the Docs style navigation */
        .rtd-navbar { background-color: #2980b9; color: white; padding: 0 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.15); position: sticky; top: 0; z-index: 1000; }
        .rtd-navbar-content { display: flex; justify-content: space-between; align-items: center; max-width: 1400px; margin: 0 auto; height: 50px; }
        .rtd-navbar-left { display: flex; align-items: center; gap: 20px; }
        .rtd-navbar-title { font-size: 18px; font-weight: 600; color: white; text-decoration: none; display: flex; align-items: center; gap: 8px; }
        .rtd-navbar-right { display: flex; align-items: center; gap: 15px; }
        .rtd-nav-link { color: rgba(255,255,255,0.9); text-decoration: none; font-size: 14px; font-weight: 500; padding: 8px 14px; border-radius: 5px; transition: all 0.2s; display: flex; align-items: center; gap: 6px; }
        .rtd-nav-link:hover { background-color: rgba(255,255,255,0.15); color: white; }
        .github-icon { width: 20px; height: 20px; fill: currentColor; }

        /* Footer */
        .rtd-footer { background-color: #343131; color: #d9d9d9; padding: 30px 20px; margin-top: 40px; border-top: 4px solid #2980b9; }
        .rtd-footer-content { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px; }
        .rtd-footer-left { font-size: 13px; }
        .rtd-footer-links { display: flex; gap: 20px; }
        .rtd-footer-link { color: #2980b9; text-decoration: none; font-size: 14px; font-weight: 500; display: flex; align-items: center; gap: 6px; transition: all 0.2s; }
        .rtd-footer-link:hover { color: #5dade2; }
        .rtd-footer-attribution { margin-top: 15px; padding-top: 15px; border-top: 1px solid #4a4a4a; text-align: center; font-size: 12px; color: #999; }
        .header { background: linear-gradient(135deg, #1a73e8 0%, #4285f4 100%); color: white; padding: 30px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(26,115,232,0.3); }
        .header h1 { font-size: 30px; margin-bottom: 10px; font-weight: 700; letter-spacing: -0.5px; }
        .header p { font-size: 14px; opacity: 0.92; font-weight: 400; }
        .stats { background-color: white; padding: 24px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); display: flex; gap: 50px; }
        .stats-item { color: #5f6368; font-size: 14px; font-weight: 500; }
        .stats-number { font-size: 36px; font-weight: 700; background: linear-gradient(135deg, #1a73e8 0%, #4285f4 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; display: block; margin-bottom: 5px; }
        .calendar-container { background-color: white; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.1); overflow-x: auto; }
        .calendar-header { display: grid; grid-template-columns: 80px repeat(5, minmax(180px, 1fr)); border-bottom: 2px solid #e0e0e0; background-color: #f8f9fa; position: sticky; top: 0; z-index: 10; }
        .day-header { padding: 15px 10px; text-align: center; font-weight: 600; font-size: 14px; color: #3c4043; border-right: 1px solid #e0e0e0; cursor: pointer; transition: all 0.2s ease; }
        .day-header:hover { background-color: #e3f2fd; color: #1a73e8; }
        .day-header.active { background-color: #1a73e8; color: white; }
        .day-header:last-child { border-right: none; }
        .filter-controls { background-color: white; padding: 18px 24px; margin-bottom: 10px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); display: flex; align-items: center; gap: 15px; flex-wrap: wrap; }
        .filter-btn { padding: 9px 18px; border: 1px solid #1a73e8; background-color: white; color: #1a73e8; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: 600; transition: all 0.2s; box-shadow: 0 1px 3px rgba(0,0,0,0.08); }
        .filter-btn:hover { background-color: #1a73e8; color: white; transform: translateY(-1px); box-shadow: 0 3px 8px rgba(26,115,232,0.25); }
        .filter-btn:active { transform: translateY(0); }
        .filter-text { color: #5f6368; font-size: 14px; font-weight: 500; }
        .calendar-body { display: grid; grid-template-columns: 80px repeat(5, minmax(180px, 1fr)); position: relative; }
        .time-column { border-right: 2px solid #e0e0e0; background-color: #fafafa; }
        .time-slot { height: 60px; padding: 8px; font-size: 12px; font-weight: 500; color: #70757a; text-align: right; border-bottom: 1px solid #f0f0f0; }
        .day-column { border-right: 1px solid #e0e0e0; position: relative; min-height: 100%; }
        .day-column:last-child { border-right: none; }
        .hour-line { position: absolute; width: 100%; height: 1px; background-color: #f0f0f0; left: 0; }
        .course-block { position: absolute; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 5px; padding: 8px; cursor: pointer; transition: all 0.2s ease; box-shadow: 0 2px 4px rgba(0,0,0,0.15); overflow: visible; z-index: 1; border: 1px solid rgba(255,255,255,0.3); }
        .course-block:hover { transform: translateY(-2px) scale(1.02); box-shadow: 0 6px 16px rgba(0,0,0,0.25); z-index: 100; }
        .course-block:hover .tooltip { visibility: visible; opacity: 1; }
        .tooltip { visibility: hidden; opacity: 0; position: absolute; left: 105%; top: 0; background-color: #2d2d2d; color: white; padding: 12px 15px; border-radius: 8px; font-size: 12px; white-space: nowrap; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.3); transition: opacity 0.3s, visibility 0.3s; pointer-events: none; }
        .tooltip::before { content: ''; position: absolute; right: 100%; top: 15px; border: 6px solid transparent; border-right-color: #2d2d2d; }
        .tooltip-row { margin-bottom: 6px; }
        .tooltip-row:last-child { margin-bottom: 0; }
        .tooltip-label { font-weight: 600; color: #a0a0a0; display: inline-block; min-width: 80px; }
        .tooltip-value { color: white; }
        .course-number { font-weight: 700; color: white; font-size: 11px; margin-bottom: 3px; text-shadow: 0 1px 2px rgba(0,0,0,0.2); }
        .course-name { color: rgba(255,255,255,0.95); font-size: 10px; line-height: 1.3; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; }
        .course-time { color: rgba(255,255,255,0.85); font-size: 9px; margin-top: 4px; font-weight: 600; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); z-index: 1000; animation: fadeIn 0.2s; backdrop-filter: blur(2px); }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .modal-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: white; border-radius: 16px; padding: 32px; max-width: 580px; width: 90%; max-height: 85vh; overflow-y: auto; box-shadow: 0 12px 48px rgba(0,0,0,0.25), 0 4px 16px rgba(0,0,0,0.12); animation: slideIn 0.3s; }
        @keyframes slideIn { from { transform: translate(-50%, -55%); opacity: 0; } to { transform: translate(-50%, -50%); opacity: 1; } }
        .modal-content::-webkit-scrollbar { width: 8px; }
        .modal-content::-webkit-scrollbar-track { background: #f1f3f4; border-radius: 4px; }
        .modal-content::-webkit-scrollbar-thumb { background: #dadce0; border-radius: 4px; }
        .modal-content::-webkit-scrollbar-thumb:hover { background: #bdc1c6; }
        .modal-header { margin-bottom: 28px; padding-bottom: 24px; border-bottom: 2px solid #e8eaed; }
        .status-badge { display: inline-block; padding: 6px 14px; border-radius: 8px; font-size: 12px; font-weight: 700; margin-bottom: 14px; text-transform: uppercase; letter-spacing: 0.5px; }
        .status-open { background: linear-gradient(135deg, #34a853 0%, #0f9d58 100%); color: white; box-shadow: 0 2px 6px rgba(52,168,83,0.3); }
        .status-closed, .status-waitlist { background: linear-gradient(135deg, #ea4335 0%, #d33b2c 100%); color: white; box-shadow: 0 2px 6px rgba(234,67,53,0.3); }
        .modal-course-number { font-size: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 700; margin-bottom: 10px; letter-spacing: 0.3px; }
        .modal-course-name { font-size: 24px; font-weight: 700; color: #202124; line-height: 1.3; margin-bottom: 4px; }
        .modal-body { margin-bottom: 20px; }
        .detail-row { display: flex; margin-bottom: 18px; align-items: flex-start; padding: 10px 0; border-bottom: 1px solid #f1f3f4; }
        .detail-row:last-child { border-bottom: none; }
        .detail-label { font-weight: 600; color: #5f6368; min-width: 130px; font-size: 14px; }
        .detail-value { color: #202124; font-size: 14px; flex: 1; line-height: 1.5; font-weight: 500; }
        .close-btn { position: absolute; top: 24px; right: 24px; font-size: 28px; color: #5f6368; cursor: pointer; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s; }
        .close-btn:hover { background-color: #f1f3f4; transform: scale(1.1); color: #202124; }
        .legend { margin-top: 20px; padding: 20px; background-color: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .legend-title { font-weight: 700; margin-bottom: 12px; color: #202124; font-size: 16px; }
        .legend-item { display: block; margin-bottom: 8px; font-size: 13px; color: #5f6368; line-height: 1.6; }
        .legend-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px 20px; margin-top: 15px; }
        .legend-grid-item { display: flex; align-items: center; font-size: 13px; color: #202124; }
        .color-box { display: inline-block; width: 18px; height: 18px; border-radius: 4px; margin-right: 8px; vertical-align: middle; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); flex-shrink: 0; }

        /* Tabs */
        .tabs-container { background-color: white; padding: 12px 24px; margin-bottom: 10px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); display: flex; gap: 12px; }
        .tab-btn { padding: 12px 24px; border: none; background-color: #f1f3f4; color: #5f6368; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.2s; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .tab-btn:hover { background-color: #e8f0fe; color: #1a73e8; transform: translateY(-1px); box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
        .tab-btn:active { transform: translateY(0); }
        .tab-btn.active { background: linear-gradient(135deg, #1a73e8 0%, #4285f4 100%); color: white; box-shadow: 0 3px 8px rgba(26,115,232,0.3); }
        .tab-content { display: block; }

        /* Instructor Selector */
        .instructor-selector-wrapper { position: relative; }
        .instructor-dropdown { display: none; position: absolute; top: 100%; left: 0; background-color: white; border: 1px solid #dadce0; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.12), 0 2px 6px rgba(0,0,0,0.08); min-width: 320px; max-width: 420px; z-index: 100; margin-top: 8px; overflow: hidden; }
        .instructor-dropdown.show { display: block; animation: dropdownSlide 0.2s ease-out; }
        @keyframes dropdownSlide { from { opacity: 0; transform: translateY(-8px); } to { opacity: 1; transform: translateY(0); } }
        .instructor-dropdown-header { display: flex; justify-content: space-between; padding: 12px 16px; background: linear-gradient(135deg, #f8f9fa 0%, #e8eaed 100%); border-bottom: 1px solid #dadce0; gap: 10px; }
        .dropdown-action-btn { padding: 8px 16px; border: 1px solid #1a73e8; background-color: white; color: #1a73e8; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600; transition: all 0.2s; flex: 1; box-shadow: 0 1px 3px rgba(0,0,0,0.08); }
        .dropdown-action-btn:hover { background-color: #1a73e8; color: white; transform: translateY(-1px); box-shadow: 0 2px 6px rgba(26,115,232,0.3); }
        .dropdown-action-btn:active { transform: translateY(0); }
        .instructor-list { max-height: 340px; overflow-y: auto; padding: 8px; background-color: #fafafa; }
        .instructor-list::-webkit-scrollbar { width: 8px; }
        .instructor-list::-webkit-scrollbar-track { background: #f1f3f4; border-radius: 4px; }
        .instructor-list::-webkit-scrollbar-thumb { background: #dadce0; border-radius: 4px; }
        .instructor-list::-webkit-scrollbar-thumb:hover { background: #bdc1c6; }
        .instructor-checkbox-item { display: flex; align-items: center; padding: 10px 12px; margin-bottom: 4px; border-radius: 8px; cursor: pointer; transition: all 0.2s; background-color: white; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .instructor-checkbox-item:hover { background-color: #e8f0fe; transform: translateX(4px); box-shadow: 0 2px 6px rgba(26,115,232,0.15); }
        .instructor-checkbox-item input[type="checkbox"] { margin-right: 12px; cursor: pointer; width: 18px; height: 18px; accent-color: #1a73e8; }
        .instructor-checkbox-item label { cursor: pointer; font-size: 13px; color: #202124; flex: 1; display: flex; align-items: center; gap: 10px; font-weight: 500; }
        .instructor-color-indicator { display: inline-block; width: 14px; height: 14px; border-radius: 50%; border: 2px solid white; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }

        /* Class List */
        .planning-container, .conflicts-container { background-color: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .planning-container h2, .conflicts-container h2 { color: #202124; margin-bottom: 10px; font-size: 24px; }
        .tab-description { color: #5f6368; margin-bottom: 25px; font-size: 14px; }
        .instructor-schedule { margin-bottom: 30px; padding: 20px; background-color: #f8f9fa; border-radius: 8px; border-left: 4px solid #1a73e8; }
        .instructor-schedule-header { font-size: 18px; font-weight: 700; color: #202124; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
        .instructor-schedule-courses { display: grid; gap: 10px; }
        .schedule-course-item { padding: 12px 15px; background-color: white; border-radius: 6px; border-left: 3px solid #667eea; }
        .schedule-course-title { font-weight: 600; color: #202124; margin-bottom: 5px; }
        .schedule-course-details { font-size: 13px; color: #5f6368; }

        /* Room Conflicts */
        .conflict-group { margin-bottom: 25px; padding: 20px; background-color: #fff3cd; border-radius: 8px; border-left: 4px solid #ff6b6b; position: relative; }
        .conflict-header { font-size: 16px; font-weight: 700; color: #721c24; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }
        .conflict-severity { display: inline-block; padding: 3px 10px; background-color: #ff6b6b; color: white; border-radius: 12px; font-size: 11px; font-weight: 700; }
        .conflict-ignore-btn { position: absolute; top: 15px; right: 15px; padding: 6px 12px; background-color: #5f6368; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px; font-weight: 600; transition: all 0.2s; }
        .conflict-ignore-btn:hover { background-color: #3c4043; transform: scale(1.05); }
        .conflict-courses { display: grid; gap: 12px; margin-top: 15px; }
        .conflict-course-item { padding: 12px 15px; background-color: white; border-radius: 6px; border-left: 3px solid #ff6b6b; }
        .conflict-course-header { font-weight: 600; color: #202124; margin-bottom: 5px; }
        .conflict-course-details { font-size: 13px; color: #5f6368; }
        .no-conflicts { padding: 30px; text-align: center; color: #5f6368; font-size: 16px; }
        .conflict-indicator { border: 3px solid #ff6b6b !important; box-shadow: 0 0 0 3px rgba(255,107,107,0.2) !important; }
        .conflict-hidden { display: none; }

        /* Edit Mode Styles */
        .edit-container { background-color: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .edit-container h2 { color: #202124; margin-bottom: 10px; font-size: 24px; }

        .edit-toolbar-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 8px; }
        .edit-toolbar-bottom { display: flex; gap: 15px; justify-content: center; margin-top: 20px; padding: 20px; background-color: #f8f9fa; border-radius: 8px; }

        .edit-action-btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .edit-action-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .btn-primary { background: linear-gradient(135deg, #1a73e8 0%, #4285f4 100%); color: white; }
        .btn-secondary { background-color: #f1f3f4; color: #5f6368; }
        .btn-secondary:hover { background-color: #e8eaed; }
        .btn-danger { background: linear-gradient(135deg, #ea4335 0%, #d33b2c 100%); color: white; }
        .btn-info { background: linear-gradient(135deg, #fbbc04 0%, #f9ab00 100%); color: #202124; }
        .btn-export { background: linear-gradient(135deg, #34a853 0%, #0f9d58 100%); color: white; }
        .btn-import { background: linear-gradient(135deg, #4285f4 0%, #1a73e8 100%); color: white; }
        .btn-save { background: linear-gradient(135deg, #9334e6 0%, #7c3aed 100%); color: white; }

        .edit-status { font-size: 14px; color: #5f6368; }
        .edit-status #editCount { font-weight: 700; color: #ea4335; font-size: 18px; }

        .calendar-container.edit-mode { border: 3px solid #fbbc04; box-shadow: 0 4px 16px rgba(251,188,4,0.2); }
        .calendar-container.edit-mode .course-block { cursor: pointer; border: 2px solid rgba(255,255,255,0.5); }
        .calendar-container.edit-mode .course-block:hover { border: 2px solid white; transform: translateY(-3px) scale(1.03); }
        .calendar-container.edit-mode .course-block.edited { position: absolute; }
        .calendar-container.edit-mode .course-block.edited::after { content: '‚ö†Ô∏è'; position: absolute; top: 2px; right: 2px; font-size: 12px; }

        /* Edit Modal Styles */
        .edit-modal-content { max-width: 700px; max-height: 90vh; overflow-y: auto; }
        .edit-modal-content h2 { font-size: 22px; color: #1a73e8; margin-bottom: 20px; }

        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-weight: 600; color: #202124; margin-bottom: 8px; font-size: 14px; }
        .form-group input, .form-group select { width: 100%; padding: 10px 12px; border: 1px solid #dadce0; border-radius: 6px; font-size: 14px; transition: all 0.2s; }
        .form-group input:focus, .form-group select:focus { border-color: #1a73e8; outline: none; box-shadow: 0 0 0 3px rgba(26,115,232,0.1); }

        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }

        .required { color: #ea4335; font-weight: 700; }

        .day-checkboxes { display: flex; gap: 15px; margin-top: 10px; flex-wrap: wrap; }
        .day-checkboxes label { display: flex; align-items: center; gap: 6px; font-size: 13px; font-weight: 500; cursor: pointer; padding: 8px 12px; background-color: #f1f3f4; border-radius: 6px; transition: all 0.2s; }
        .day-checkboxes label:hover { background-color: #e8f0fe; }
        .day-checkboxes input[type="checkbox"]:checked + * { color: #1a73e8; }
        .day-checkboxes input[type="checkbox"] { accent-color: #1a73e8; width: 16px; height: 16px; }

        .error-message { color: #ea4335; font-size: 13px; margin-top: 5px; padding: 8px; background-color: #fce8e6; border-radius: 4px; }

        .modal-actions { display: flex; gap: 12px; justify-content: flex-end; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e8eaed; }
        .modal-actions button { padding: 10px 20px; }
    </style>
</head>
<body>
    <!-- Read the Docs style navigation -->
    <nav class="rtd-navbar">
        <div class="rtd-navbar-content">
            <div class="rtd-navbar-left">
                <span class="rtd-navbar-title">üéì GWU Course Calendar</span>
            </div>
            <div class="rtd-navbar-right">
                <a href="https://github.com/mmann1123/GWU_Course_Calendar" target="_blank" class="rtd-nav-link">
                    <svg class="github-icon" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                    </svg>
                    GitHub
                </a>
                <a href="https://github.com/mmann1123/GWU_Course_Calendar/issues" target="_blank" class="rtd-nav-link">
                    Report Issue
                </a>
            </div>
        </div>
    </nav>

    <div class="main-content">
        <div class="header">
            <h1>üóìÔ∏è GWU Courses - Fall 2025</h1>
            <p>Interactive Course Schedule | Scraped from GWU website on January 20, 2026</p>
        </div>

    <div class="stats">
        <div class="stats-item"><span class="stats-number" id="totalCourses">0</span><span>Total Courses</span></div>
        <div class="stats-item"><span class="stats-number" id="totalInstructors">0</span><span>Instructors</span></div>
    </div>

    <div class="tabs-container">
        <button class="tab-btn active" data-tab="all-courses" onclick="switchTab('all-courses')">üìÖ All Courses</button>
        <button class="tab-btn" data-tab="planning-mode" onclick="switchTab('planning-mode')">üìã Class List</button>
        <button class="tab-btn" data-tab="room-conflicts" onclick="switchTab('room-conflicts')">‚ö†Ô∏è Room Conflicts</button>
        <button class="tab-btn" data-tab="edit-schedule" onclick="switchTab('edit-schedule')">‚úèÔ∏è Edit Schedule</button>
    </div>

    <div class="filter-controls" id="mainCalendarFilters">
        <button class="filter-btn" onclick="showAllDays()">Show All Days</button>
        <div class="instructor-selector-wrapper">
            <button class="filter-btn" id="levelDropdownBtn" onclick="toggleLevelDropdown()">
                <span id="levelBtnText">All Levels</span> ‚ñº
            </button>
            <div class="instructor-dropdown" id="levelDropdown">
                <div class="instructor-list" style="max-height: 200px;">
                    <div class="instructor-checkbox-item" onclick="setLevelFilter('all')">
                        <label style="cursor: pointer;">All Levels</label>
                    </div>
                    <div class="instructor-checkbox-item" onclick="setLevelFilter('undergrad')">
                        <label style="cursor: pointer;">Undergrad (< 6000)</label>
                    </div>
                    <div class="instructor-checkbox-item" onclick="setLevelFilter('grad')">
                        <label style="cursor: pointer;">Grad (>= 6000)</label>
                    </div>
                </div>
            </div>
        </div>
        <div class="instructor-selector-wrapper">
            <button class="filter-btn" id="instructorDropdownBtn" onclick="toggleInstructorDropdown()">
                <span id="instructorBtnText">All Instructors</span> ‚ñº
            </button>
            <div class="instructor-dropdown" id="instructorDropdown">
                <div class="instructor-dropdown-header">
                    <button class="dropdown-action-btn" onclick="selectAllInstructors()">Select All</button>
                    <button class="dropdown-action-btn" onclick="clearAllInstructors()">Clear All</button>
                </div>
                <div class="instructor-list" id="instructorList"></div>
            </div>
        </div>
        <span class="filter-text" id="filterStatus">Showing all days, all instructors</span>
    </div>

    <div class="tab-content" id="all-courses-tab">
        <div class="calendar-container">
            <div class="calendar-header">
                <div class="day-header" style="background-color: white; cursor: default;"></div>
                <div class="day-header" data-day="monday" onclick="filterDay('monday')">Monday</div>
                <div class="day-header" data-day="tuesday" onclick="filterDay('tuesday')">Tuesday</div>
                <div class="day-header" data-day="wednesday" onclick="filterDay('wednesday')">Wednesday</div>
                <div class="day-header" data-day="thursday" onclick="filterDay('thursday')">Thursday</div>
                <div class="day-header" data-day="friday" onclick="filterDay('friday')">Friday</div>
            </div>

            <div class="calendar-body">
                <div class="time-column" id="timeColumn"></div>
                <div class="day-column" id="monday"></div>
                <div class="day-column" id="tuesday"></div>
                <div class="day-column" id="wednesday"></div>
                <div class="day-column" id="thursday"></div>
                <div class="day-column" id="friday"></div>
            </div>
        </div>

        <div class="legend" id="instructorLegend"></div>
    </div>

    <div class="tab-content" id="planning-mode-tab" style="display: none;">
        <div class="planning-container">
            <h2>Class List - Instructor Schedules</h2>
            <p class="tab-description">View individual instructor schedules and identify potential conflicts</p>
            <div id="planningModeContent"></div>
        </div>
    </div>

    <div class="tab-content" id="room-conflicts-tab" style="display: none;">
        <div class="conflicts-container">
            <h2>Room Conflicts Detection</h2>
            <p class="tab-description">Courses scheduled in the same room at overlapping times</p>
            <div id="conflictsContent"></div>
        </div>
    </div>

    <div class="tab-content" id="edit-schedule-tab" style="display: none;">
        <div class="edit-container">
            <h2>Edit Schedule</h2>
            <p class="tab-description">Add, remove, or modify courses. Changes are saved locally until exported.</p>

            <div class="edit-toolbar-top">
                <button class="edit-action-btn btn-primary" onclick="openAddCourseModal()">
                    ‚ûï Add New Course
                </button>
                <span class="edit-status" id="editStatus">
                    <span id="editCount">0</span> unsaved changes
                </span>
            </div>

            <!-- Edit Mode Filters -->
            <div class="filter-controls" style="margin: 20px 0;">
                <div class="instructor-selector-wrapper">
                    <button class="filter-btn" id="editRoomDropdownBtn" onclick="toggleEditRoomDropdown()">
                        <span id="editRoomBtnText">All Rooms</span> ‚ñº
                    </button>
                    <div class="instructor-dropdown" id="editRoomDropdown">
                        <div class="instructor-list" id="editRoomList" style="max-height: 300px;"></div>
                    </div>
                </div>
                <div class="instructor-selector-wrapper">
                    <button class="filter-btn" id="editLevelDropdownBtn" onclick="toggleEditLevelDropdown()">
                        <span id="editLevelBtnText">All Levels</span> ‚ñº
                    </button>
                    <div class="instructor-dropdown" id="editLevelDropdown">
                        <div class="instructor-list" style="max-height: 200px;">
                            <div class="instructor-checkbox-item" onclick="setEditLevelFilter('all')">
                                <label style="cursor: pointer;">All Levels</label>
                            </div>
                            <div class="instructor-checkbox-item" onclick="setEditLevelFilter('undergrad')">
                                <label style="cursor: pointer;">Undergrad (< 6000)</label>
                            </div>
                            <div class="instructor-checkbox-item" onclick="setEditLevelFilter('grad')">
                                <label style="cursor: pointer;">Grad (>= 6000)</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="instructor-selector-wrapper">
                    <button class="filter-btn" id="editInstructorDropdownBtn" onclick="toggleEditInstructorDropdown()">
                        <span id="editInstructorBtnText">All Instructors</span> ‚ñº
                    </button>
                    <div class="instructor-dropdown" id="editInstructorDropdown">
                        <div class="instructor-dropdown-header">
                            <button class="dropdown-action-btn" onclick="selectAllEditInstructors()">Select All</button>
                            <button class="dropdown-action-btn" onclick="clearAllEditInstructors()">Clear All</button>
                        </div>
                        <div id="editInstructorList" class="instructor-list"></div>
                    </div>
                </div>
                <div id="editFilterStatus" style="color: #5f6368; font-size: 14px; margin-left: 15px;">

                </div>
            </div>

            <div class="calendar-container edit-mode">
                <div class="calendar-header">
                    <div class="day-header" style="background-color: white; cursor: default;"></div>
                    <div class="day-header">Monday</div>
                    <div class="day-header">Tuesday</div>
                    <div class="day-header">Wednesday</div>
                    <div class="day-header">Thursday</div>
                    <div class="day-header">Friday</div>
                </div>

                <div class="calendar-body" id="editCalendarBody">
                    <div class="time-column" id="editTimeColumn"></div>
                    <div class="day-column" id="edit-monday"></div>
                    <div class="day-column" id="edit-tuesday"></div>
                    <div class="day-column" id="edit-wednesday"></div>
                    <div class="day-column" id="edit-thursday"></div>
                    <div class="day-column" id="edit-friday"></div>
                </div>
            </div>

            <div class="edit-toolbar-bottom">
                <button class="edit-action-btn btn-import" onclick="document.getElementById('csvFileInput').click()">
                    üì§ Import CSV
                </button>
                <input type="file" id="csvFileInput" accept=".csv" style="display: none;" onchange="handleCSVImport(event)">
                <button class="edit-action-btn btn-primary" onclick="exportSchedule()">
                    üì¶ Export Schedule
                </button>
            </div>

            <!-- Edit Mode Conflicts Section -->
            <div id="editConflictsContainer" style="margin-top: 30px;">
                <h3 style="margin: 0 0 15px 0; color: #202124;">‚ö†Ô∏è Schedule Conflicts</h3>
                <div id="editConflictsContent">
                    <div style="padding: 20px; text-align: center; color: #5f6368;">
                        Loading conflicts...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <div class="modal-header">
                <div id="statusBadge"></div>
                <div class="modal-course-number" id="modalCourseNumber"></div>
                <div class="modal-course-name" id="modalCourseName"></div>
            </div>
            <div class="modal-body">
                <div class="detail-row"><div class="detail-label">CRN:</div><div class="detail-value" id="modalCRN"></div></div>
                <div class="detail-row"><div class="detail-label">Instructor:</div><div class="detail-value" id="modalInstructor"></div></div>
                <div class="detail-row"><div class="detail-label">Meeting Time:</div><div class="detail-value" id="modalTime"></div></div>
                <div class="detail-row"><div class="detail-label">Days:</div><div class="detail-value" id="modalDays"></div></div>
                <div class="detail-row"><div class="detail-label">Building:</div><div class="detail-value" id="modalBuilding"></div></div>
                <div class="detail-row"><div class="detail-label">Room:</div><div class="detail-value" id="modalRoom"></div></div>
                <div class="detail-row"><div class="detail-label">Credits:</div><div class="detail-value" id="modalCredits"></div></div>
                <div class="detail-row"><div class="detail-label">Semester:</div><div class="detail-value" id="modalDates"></div></div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content edit-modal-content">
            <span class="close-btn" onclick="closeEditModal()">&times;</span>
            <div class="modal-header">
                <h2 id="editModalTitle">Edit Course</h2>
            </div>
            <div class="modal-body">
                <form id="editCourseForm" onsubmit="saveCourseEdit(event)">
                    <input type="hidden" id="editCRN">
                    <input type="hidden" id="originalCRN">

                    <div class="form-row">
                        <div class="form-group">
                            <label for="editSubject">Subject Code <span class="required">*</span></label>
                            <input type="text" id="editSubject" required maxlength="10" placeholder="GEOG">
                        </div>
                        <div class="form-group">
                            <label for="editCourseNum">Course Number <span class="required">*</span></label>
                            <input type="text" id="editCourseNum" required maxlength="10" placeholder="1001">
                        </div>
                        <div class="form-group">
                            <label for="editSection">Section <span class="required">*</span></label>
                            <input type="text" id="editSection" required maxlength="10" placeholder="10">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="editCRNInput">CRN <span class="required">*</span></label>
                            <input type="text" id="editCRNInput" required maxlength="10" placeholder="XXXXX">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="editTitle">Course Title <span class="required">*</span></label>
                        <input type="text" id="editTitle" required placeholder="Introduction to Geography">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="editCredits">Credits <span class="required">*</span></label>
                            <input type="number" id="editCredits" required step="0.01" min="0" max="20" placeholder="3.00">
                        </div>
                        <div class="form-group">
                            <label for="editInstructor">Instructor <span class="required">*</span></label>
                            <input type="text" id="editInstructor" required placeholder="Last, F" list="instructorList">
                            <datalist id="instructorList"></datalist>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Days <span class="required">*</span></label>
                        <div class="day-checkboxes">
                            <label><input type="checkbox" name="editDay" value="M"> Monday</label>
                            <label><input type="checkbox" name="editDay" value="T"> Tuesday</label>
                            <label><input type="checkbox" name="editDay" value="W"> Wednesday</label>
                            <label><input type="checkbox" name="editDay" value="R"> Thursday</label>
                            <label><input type="checkbox" name="editDay" value="F"> Friday</label>
                        </div>
                        <div id="daysError" class="error-message" style="display: none;">Please select at least one day</div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="editStartTime">Start Time <span class="required">*</span></label>
                            <select id="editStartTime" required></select>
                        </div>
                        <div class="form-group">
                            <label for="editEndTime">End Time <span class="required">*</span></label>
                            <select id="editEndTime" required></select>
                        </div>
                    </div>
                    <div id="timeError" class="error-message" style="display: none;">End time must be after start time</div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="editBuilding">Building</label>
                            <input type="text" id="editBuilding" placeholder="1957 E">
                        </div>
                        <div class="form-group">
                            <label for="editRoom">Room</label>
                            <input type="text" id="editRoom" placeholder="B12">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="editDates">Semester Dates</label>
                        <input type="text" id="editDates" placeholder="01/12/26 - 04/27/26">
                    </div>

                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" onclick="closeEditModal()">Cancel</button>
                        <button type="button" class="btn-danger" id="deleteCourseBtn" onclick="deleteCourse()">üóëÔ∏è Delete Course</button>
                        <button type="button" class="btn-info" id="duplicateCourseBtn" onclick="duplicateCourse()">üìã Duplicate</button>
                        <button type="submit" class="btn-primary">üíæ Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        const EXPORT_TEMPLATE_B64 = "PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCI+CiAgICA8dGl0bGU+R1dVIENvdXJzZXMgLSBGYWxsIDIwMjU8L3RpdGxlPgogICAgPHN0eWxlPgogICAgICAgICogeyBtYXJnaW46IDA7IHBhZGRpbmc6IDA7IGJveC1zaXppbmc6IGJvcmRlci1ib3g7IH0KICAgICAgICBib2R5IHsgZm9udC1mYW1pbHk6ICdTZWdvZSBVSScsIFRhaG9tYSwgR2VuZXZhLCBWZXJkYW5hLCBzYW5zLXNlcmlmOyBiYWNrZ3JvdW5kLWNvbG9yOiAjZjhmOWZhOyBwYWRkaW5nOiAwOyB9CiAgICAgICAgLm1haW4tY29udGVudCB7IHBhZGRpbmc6IDIwcHg7IH0KCiAgICAgICAgLyogUmVhZCB0aGUgRG9jcyBzdHlsZSBuYXZpZ2F0aW9uICovCiAgICAgICAgLnJ0ZC1uYXZiYXIgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjMjk4MGI5OyBjb2xvcjogd2hpdGU7IHBhZGRpbmc6IDAgMjBweDsgYm94LXNoYWRvdzogMCAycHggOHB4IHJnYmEoMCwwLDAsMC4xNSk7IHBvc2l0aW9uOiBzdGlja3k7IHRvcDogMDsgei1pbmRleDogMTAwMDsgfQogICAgICAgIC5ydGQtbmF2YmFyLWNvbnRlbnQgeyBkaXNwbGF5OiBmbGV4OyBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47IGFsaWduLWl0ZW1zOiBjZW50ZXI7IG1heC13aWR0aDogMTQwMHB4OyBtYXJnaW46IDAgYXV0bzsgaGVpZ2h0OiA1MHB4OyB9CiAgICAgICAgLnJ0ZC1uYXZiYXItbGVmdCB7IGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGdhcDogMjBweDsgfQogICAgICAgIC5ydGQtbmF2YmFyLXRpdGxlIHsgZm9udC1zaXplOiAxOHB4OyBmb250LXdlaWdodDogNjAwOyBjb2xvcjogd2hpdGU7IHRleHQtZGVjb3JhdGlvbjogbm9uZTsgZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsgZ2FwOiA4cHg7IH0KICAgICAgICAucnRkLW5hdmJhci1yaWdodCB7IGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGdhcDogMTVweDsgfQogICAgICAgIC5ydGQtbmF2LWxpbmsgeyBjb2xvcjogcmdiYSgyNTUsMjU1LDI1NSwwLjkpOyB0ZXh0LWRlY29yYXRpb246IG5vbmU7IGZvbnQtc2l6ZTogMTRweDsgZm9udC13ZWlnaHQ6IDUwMDsgcGFkZGluZzogOHB4IDE0cHg7IGJvcmRlci1yYWRpdXM6IDVweDsgdHJhbnNpdGlvbjogYWxsIDAuMnM7IGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGdhcDogNnB4OyB9CiAgICAgICAgLnJ0ZC1uYXYtbGluazpob3ZlciB7IGJhY2tncm91bmQtY29sb3I6IHJnYmEoMjU1LDI1NSwyNTUsMC4xNSk7IGNvbG9yOiB3aGl0ZTsgfQogICAgICAgIC5naXRodWItaWNvbiB7IHdpZHRoOiAyMHB4OyBoZWlnaHQ6IDIwcHg7IGZpbGw6IGN1cnJlbnRDb2xvcjsgfQoKICAgICAgICAvKiBGb290ZXIgKi8KICAgICAgICAucnRkLWZvb3RlciB7IGJhY2tncm91bmQtY29sb3I6ICMzNDMxMzE7IGNvbG9yOiAjZDlkOWQ5OyBwYWRkaW5nOiAzMHB4IDIwcHg7IG1hcmdpbi10b3A6IDQwcHg7IGJvcmRlci10b3A6IDRweCBzb2xpZCAjMjk4MGI5OyB9CiAgICAgICAgLnJ0ZC1mb290ZXItY29udGVudCB7IG1heC13aWR0aDogMTQwMHB4OyBtYXJnaW46IDAgYXV0bzsgZGlzcGxheTogZmxleDsganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOyBhbGlnbi1pdGVtczogY2VudGVyOyBmbGV4LXdyYXA6IHdyYXA7IGdhcDogMjBweDsgfQogICAgICAgIC5ydGQtZm9vdGVyLWxlZnQgeyBmb250LXNpemU6IDEzcHg7IH0KICAgICAgICAucnRkLWZvb3Rlci1saW5rcyB7IGRpc3BsYXk6IGZsZXg7IGdhcDogMjBweDsgfQogICAgICAgIC5ydGQtZm9vdGVyLWxpbmsgeyBjb2xvcjogIzI5ODBiOTsgdGV4dC1kZWNvcmF0aW9uOiBub25lOyBmb250LXNpemU6IDE0cHg7IGZvbnQtd2VpZ2h0OiA1MDA7IGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGdhcDogNnB4OyB0cmFuc2l0aW9uOiBhbGwgMC4yczsgfQogICAgICAgIC5ydGQtZm9vdGVyLWxpbms6aG92ZXIgeyBjb2xvcjogIzVkYWRlMjsgfQogICAgICAgIC5ydGQtZm9vdGVyLWF0dHJpYnV0aW9uIHsgbWFyZ2luLXRvcDogMTVweDsgcGFkZGluZy10b3A6IDE1cHg7IGJvcmRlci10b3A6IDFweCBzb2xpZCAjNGE0YTRhOyB0ZXh0LWFsaWduOiBjZW50ZXI7IGZvbnQtc2l6ZTogMTJweDsgY29sb3I6ICM5OTk7IH0KICAgICAgICAuaGVhZGVyIHsgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgIzFhNzNlOCAwJSwgIzQyODVmNCAxMDAlKTsgY29sb3I6IHdoaXRlOyBwYWRkaW5nOiAzMHB4OyBib3JkZXItcmFkaXVzOiAxMnB4OyBtYXJnaW4tYm90dG9tOiAyMHB4OyBib3gtc2hhZG93OiAwIDRweCAxMnB4IHJnYmEoMjYsMTE1LDIzMiwwLjMpOyB9CiAgICAgICAgLmhlYWRlciBoMSB7IGZvbnQtc2l6ZTogMzBweDsgbWFyZ2luLWJvdHRvbTogMTBweDsgZm9udC13ZWlnaHQ6IDcwMDsgbGV0dGVyLXNwYWNpbmc6IC0wLjVweDsgfQogICAgICAgIC5oZWFkZXIgcCB7IGZvbnQtc2l6ZTogMTRweDsgb3BhY2l0eTogMC45MjsgZm9udC13ZWlnaHQ6IDQwMDsgfQogICAgICAgIC5zdGF0cyB7IGJhY2tncm91bmQtY29sb3I6IHdoaXRlOyBwYWRkaW5nOiAyNHB4OyBib3JkZXItcmFkaXVzOiAxMnB4OyBtYXJnaW4tYm90dG9tOiAyMHB4OyBib3gtc2hhZG93OiAwIDJweCA4cHggcmdiYSgwLDAsMCwwLjA4KTsgZGlzcGxheTogZmxleDsgZ2FwOiA1MHB4OyB9CiAgICAgICAgLnN0YXRzLWl0ZW0geyBjb2xvcjogIzVmNjM2ODsgZm9udC1zaXplOiAxNHB4OyBmb250LXdlaWdodDogNTAwOyB9CiAgICAgICAgLnN0YXRzLW51bWJlciB7IGZvbnQtc2l6ZTogMzZweDsgZm9udC13ZWlnaHQ6IDcwMDsgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgIzFhNzNlOCAwJSwgIzQyODVmNCAxMDAlKTsgLXdlYmtpdC1iYWNrZ3JvdW5kLWNsaXA6IHRleHQ7IC13ZWJraXQtdGV4dC1maWxsLWNvbG9yOiB0cmFuc3BhcmVudDsgZGlzcGxheTogYmxvY2s7IG1hcmdpbi1ib3R0b206IDVweDsgfQogICAgICAgIC5jYWxlbmRhci1jb250YWluZXIgeyBiYWNrZ3JvdW5kLWNvbG9yOiB3aGl0ZTsgYm9yZGVyLXJhZGl1czogMTJweDsgYm94LXNoYWRvdzogMCAycHggMTJweCByZ2JhKDAsMCwwLDAuMSk7IG92ZXJmbG93LXg6IGF1dG87IH0KICAgICAgICAuY2FsZW5kYXItaGVhZGVyIHsgZGlzcGxheTogZ3JpZDsgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiA4MHB4IHJlcGVhdCg1LCBtaW5tYXgoMTgwcHgsIDFmcikpOyBib3JkZXItYm90dG9tOiAycHggc29saWQgI2UwZTBlMDsgYmFja2dyb3VuZC1jb2xvcjogI2Y4ZjlmYTsgcG9zaXRpb246IHN0aWNreTsgdG9wOiAwOyB6LWluZGV4OiAxMDsgfQogICAgICAgIC5kYXktaGVhZGVyIHsgcGFkZGluZzogMTVweCAxMHB4OyB0ZXh0LWFsaWduOiBjZW50ZXI7IGZvbnQtd2VpZ2h0OiA2MDA7IGZvbnQtc2l6ZTogMTRweDsgY29sb3I6ICMzYzQwNDM7IGJvcmRlci1yaWdodDogMXB4IHNvbGlkICNlMGUwZTA7IGN1cnNvcjogcG9pbnRlcjsgdHJhbnNpdGlvbjogYWxsIDAuMnMgZWFzZTsgfQogICAgICAgIC5kYXktaGVhZGVyOmhvdmVyIHsgYmFja2dyb3VuZC1jb2xvcjogI2UzZjJmZDsgY29sb3I6ICMxYTczZTg7IH0KICAgICAgICAuZGF5LWhlYWRlci5hY3RpdmUgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjMWE3M2U4OyBjb2xvcjogd2hpdGU7IH0KICAgICAgICAuZGF5LWhlYWRlcjpsYXN0LWNoaWxkIHsgYm9yZGVyLXJpZ2h0OiBub25lOyB9CiAgICAgICAgLmZpbHRlci1jb250cm9scyB7IGJhY2tncm91bmQtY29sb3I6IHdoaXRlOyBwYWRkaW5nOiAxOHB4IDI0cHg7IG1hcmdpbi1ib3R0b206IDEwcHg7IGJvcmRlci1yYWRpdXM6IDEycHg7IGJveC1zaGFkb3c6IDAgMnB4IDhweCByZ2JhKDAsMCwwLDAuMDgpOyBkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBnYXA6IDE1cHg7IGZsZXgtd3JhcDogd3JhcDsgfQogICAgICAgIC5maWx0ZXItYnRuIHsgcGFkZGluZzogOXB4IDE4cHg7IGJvcmRlcjogMXB4IHNvbGlkICMxYTczZTg7IGJhY2tncm91bmQtY29sb3I6IHdoaXRlOyBjb2xvcjogIzFhNzNlODsgYm9yZGVyLXJhZGl1czogOHB4OyBjdXJzb3I6IHBvaW50ZXI7IGZvbnQtc2l6ZTogMTNweDsgZm9udC13ZWlnaHQ6IDYwMDsgdHJhbnNpdGlvbjogYWxsIDAuMnM7IGJveC1zaGFkb3c6IDAgMXB4IDNweCByZ2JhKDAsMCwwLDAuMDgpOyB9CiAgICAgICAgLmZpbHRlci1idG46aG92ZXIgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjMWE3M2U4OyBjb2xvcjogd2hpdGU7IHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtMXB4KTsgYm94LXNoYWRvdzogMCAzcHggOHB4IHJnYmEoMjYsMTE1LDIzMiwwLjI1KTsgfQogICAgICAgIC5maWx0ZXItYnRuOmFjdGl2ZSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlWSgwKTsgfQogICAgICAgIC5maWx0ZXItdGV4dCB7IGNvbG9yOiAjNWY2MzY4OyBmb250LXNpemU6IDE0cHg7IGZvbnQtd2VpZ2h0OiA1MDA7IH0KICAgICAgICAuY2FsZW5kYXItYm9keSB7IGRpc3BsYXk6IGdyaWQ7IGdyaWQtdGVtcGxhdGUtY29sdW1uczogODBweCByZXBlYXQoNSwgbWlubWF4KDE4MHB4LCAxZnIpKTsgcG9zaXRpb246IHJlbGF0aXZlOyB9CiAgICAgICAgLnRpbWUtY29sdW1uIHsgYm9yZGVyLXJpZ2h0OiAycHggc29saWQgI2UwZTBlMDsgYmFja2dyb3VuZC1jb2xvcjogI2ZhZmFmYTsgfQogICAgICAgIC50aW1lLXNsb3QgeyBoZWlnaHQ6IDYwcHg7IHBhZGRpbmc6IDhweDsgZm9udC1zaXplOiAxMnB4OyBmb250LXdlaWdodDogNTAwOyBjb2xvcjogIzcwNzU3YTsgdGV4dC1hbGlnbjogcmlnaHQ7IGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZjBmMGYwOyB9CiAgICAgICAgLmRheS1jb2x1bW4geyBib3JkZXItcmlnaHQ6IDFweCBzb2xpZCAjZTBlMGUwOyBwb3NpdGlvbjogcmVsYXRpdmU7IG1pbi1oZWlnaHQ6IDEwMCU7IH0KICAgICAgICAuZGF5LWNvbHVtbjpsYXN0LWNoaWxkIHsgYm9yZGVyLXJpZ2h0OiBub25lOyB9CiAgICAgICAgLmhvdXItbGluZSB7IHBvc2l0aW9uOiBhYnNvbHV0ZTsgd2lkdGg6IDEwMCU7IGhlaWdodDogMXB4OyBiYWNrZ3JvdW5kLWNvbG9yOiAjZjBmMGYwOyBsZWZ0OiAwOyB9CiAgICAgICAgLmNvdXJzZS1ibG9jayB7IHBvc2l0aW9uOiBhYnNvbHV0ZTsgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgIzY2N2VlYSAwJSwgIzc2NGJhMiAxMDAlKTsgYm9yZGVyLXJhZGl1czogNXB4OyBwYWRkaW5nOiA4cHg7IGN1cnNvcjogcG9pbnRlcjsgdHJhbnNpdGlvbjogYWxsIDAuMnMgZWFzZTsgYm94LXNoYWRvdzogMCAycHggNHB4IHJnYmEoMCwwLDAsMC4xNSk7IG92ZXJmbG93OiB2aXNpYmxlOyB6LWluZGV4OiAxOyBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDI1NSwyNTUsMjU1LDAuMyk7IH0KICAgICAgICAuY291cnNlLWJsb2NrOmhvdmVyIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC0ycHgpIHNjYWxlKDEuMDIpOyBib3gtc2hhZG93OiAwIDZweCAxNnB4IHJnYmEoMCwwLDAsMC4yNSk7IHotaW5kZXg6IDEwMDsgfQogICAgICAgIC5jb3Vyc2UtYmxvY2s6aG92ZXIgLnRvb2x0aXAgeyB2aXNpYmlsaXR5OiB2aXNpYmxlOyBvcGFjaXR5OiAxOyB9CiAgICAgICAgLnRvb2x0aXAgeyB2aXNpYmlsaXR5OiBoaWRkZW47IG9wYWNpdHk6IDA7IHBvc2l0aW9uOiBhYnNvbHV0ZTsgbGVmdDogMTA1JTsgdG9wOiAwOyBiYWNrZ3JvdW5kLWNvbG9yOiAjMmQyZDJkOyBjb2xvcjogd2hpdGU7IHBhZGRpbmc6IDEycHggMTVweDsgYm9yZGVyLXJhZGl1czogOHB4OyBmb250LXNpemU6IDEycHg7IHdoaXRlLXNwYWNlOiBub3dyYXA7IHotaW5kZXg6IDEwMDA7IGJveC1zaGFkb3c6IDAgNHB4IDEycHggcmdiYSgwLDAsMCwwLjMpOyB0cmFuc2l0aW9uOiBvcGFjaXR5IDAuM3MsIHZpc2liaWxpdHkgMC4zczsgcG9pbnRlci1ldmVudHM6IG5vbmU7IH0KICAgICAgICAudG9vbHRpcDo6YmVmb3JlIHsgY29udGVudDogJyc7IHBvc2l0aW9uOiBhYnNvbHV0ZTsgcmlnaHQ6IDEwMCU7IHRvcDogMTVweDsgYm9yZGVyOiA2cHggc29saWQgdHJhbnNwYXJlbnQ7IGJvcmRlci1yaWdodC1jb2xvcjogIzJkMmQyZDsgfQogICAgICAgIC50b29sdGlwLXJvdyB7IG1hcmdpbi1ib3R0b206IDZweDsgfQogICAgICAgIC50b29sdGlwLXJvdzpsYXN0LWNoaWxkIHsgbWFyZ2luLWJvdHRvbTogMDsgfQogICAgICAgIC50b29sdGlwLWxhYmVsIHsgZm9udC13ZWlnaHQ6IDYwMDsgY29sb3I6ICNhMGEwYTA7IGRpc3BsYXk6IGlubGluZS1ibG9jazsgbWluLXdpZHRoOiA4MHB4OyB9CiAgICAgICAgLnRvb2x0aXAtdmFsdWUgeyBjb2xvcjogd2hpdGU7IH0KICAgICAgICAuY291cnNlLW51bWJlciB7IGZvbnQtd2VpZ2h0OiA3MDA7IGNvbG9yOiB3aGl0ZTsgZm9udC1zaXplOiAxMXB4OyBtYXJnaW4tYm90dG9tOiAzcHg7IHRleHQtc2hhZG93OiAwIDFweCAycHggcmdiYSgwLDAsMCwwLjIpOyB9CiAgICAgICAgLmNvdXJzZS1uYW1lIHsgY29sb3I6IHJnYmEoMjU1LDI1NSwyNTUsMC45NSk7IGZvbnQtc2l6ZTogMTBweDsgbGluZS1oZWlnaHQ6IDEuMzsgb3ZlcmZsb3c6IGhpZGRlbjsgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7IGRpc3BsYXk6IC13ZWJraXQtYm94OyAtd2Via2l0LWxpbmUtY2xhbXA6IDM7IC13ZWJraXQtYm94LW9yaWVudDogdmVydGljYWw7IH0KICAgICAgICAuY291cnNlLXRpbWUgeyBjb2xvcjogcmdiYSgyNTUsMjU1LDI1NSwwLjg1KTsgZm9udC1zaXplOiA5cHg7IG1hcmdpbi10b3A6IDRweDsgZm9udC13ZWlnaHQ6IDYwMDsgfQogICAgICAgIC5tb2RhbCB7IGRpc3BsYXk6IG5vbmU7IHBvc2l0aW9uOiBmaXhlZDsgdG9wOiAwOyBsZWZ0OiAwOyB3aWR0aDogMTAwJTsgaGVpZ2h0OiAxMDAlOyBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDAsMCwwLDAuNik7IHotaW5kZXg6IDEwMDA7IGFuaW1hdGlvbjogZmFkZUluIDAuMnM7IGJhY2tkcm9wLWZpbHRlcjogYmx1cigycHgpOyB9CiAgICAgICAgQGtleWZyYW1lcyBmYWRlSW4geyBmcm9tIHsgb3BhY2l0eTogMDsgfSB0byB7IG9wYWNpdHk6IDE7IH0gfQogICAgICAgIC5tb2RhbC1jb250ZW50IHsgcG9zaXRpb246IGFic29sdXRlOyB0b3A6IDUwJTsgbGVmdDogNTAlOyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKTsgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7IGJvcmRlci1yYWRpdXM6IDE2cHg7IHBhZGRpbmc6IDMycHg7IG1heC13aWR0aDogNTgwcHg7IHdpZHRoOiA5MCU7IG1heC1oZWlnaHQ6IDg1dmg7IG92ZXJmbG93LXk6IGF1dG87IGJveC1zaGFkb3c6IDAgMTJweCA0OHB4IHJnYmEoMCwwLDAsMC4yNSksIDAgNHB4IDE2cHggcmdiYSgwLDAsMCwwLjEyKTsgYW5pbWF0aW9uOiBzbGlkZUluIDAuM3M7IH0KICAgICAgICBAa2V5ZnJhbWVzIHNsaWRlSW4geyBmcm9tIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTU1JSk7IG9wYWNpdHk6IDA7IH0gdG8geyB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKTsgb3BhY2l0eTogMTsgfSB9CiAgICAgICAgLm1vZGFsLWNvbnRlbnQ6Oi13ZWJraXQtc2Nyb2xsYmFyIHsgd2lkdGg6IDhweDsgfQogICAgICAgIC5tb2RhbC1jb250ZW50Ojotd2Via2l0LXNjcm9sbGJhci10cmFjayB7IGJhY2tncm91bmQ6ICNmMWYzZjQ7IGJvcmRlci1yYWRpdXM6IDRweDsgfQogICAgICAgIC5tb2RhbC1jb250ZW50Ojotd2Via2l0LXNjcm9sbGJhci10aHVtYiB7IGJhY2tncm91bmQ6ICNkYWRjZTA7IGJvcmRlci1yYWRpdXM6IDRweDsgfQogICAgICAgIC5tb2RhbC1jb250ZW50Ojotd2Via2l0LXNjcm9sbGJhci10aHVtYjpob3ZlciB7IGJhY2tncm91bmQ6ICNiZGMxYzY7IH0KICAgICAgICAubW9kYWwtaGVhZGVyIHsgbWFyZ2luLWJvdHRvbTogMjhweDsgcGFkZGluZy1ib3R0b206IDI0cHg7IGJvcmRlci1ib3R0b206IDJweCBzb2xpZCAjZThlYWVkOyB9CiAgICAgICAgLnN0YXR1cy1iYWRnZSB7IGRpc3BsYXk6IGlubGluZS1ibG9jazsgcGFkZGluZzogNnB4IDE0cHg7IGJvcmRlci1yYWRpdXM6IDhweDsgZm9udC1zaXplOiAxMnB4OyBmb250LXdlaWdodDogNzAwOyBtYXJnaW4tYm90dG9tOiAxNHB4OyB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOyBsZXR0ZXItc3BhY2luZzogMC41cHg7IH0KICAgICAgICAuc3RhdHVzLW9wZW4geyBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCAjMzRhODUzIDAlLCAjMGY5ZDU4IDEwMCUpOyBjb2xvcjogd2hpdGU7IGJveC1zaGFkb3c6IDAgMnB4IDZweCByZ2JhKDUyLDE2OCw4MywwLjMpOyB9CiAgICAgICAgLnN0YXR1cy1jbG9zZWQsIC5zdGF0dXMtd2FpdGxpc3QgeyBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCAjZWE0MzM1IDAlLCAjZDMzYjJjIDEwMCUpOyBjb2xvcjogd2hpdGU7IGJveC1zaGFkb3c6IDAgMnB4IDZweCByZ2JhKDIzNCw2Nyw1MywwLjMpOyB9CiAgICAgICAgLm1vZGFsLWNvdXJzZS1udW1iZXIgeyBmb250LXNpemU6IDE1cHg7IGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsICM2NjdlZWEgMCUsICM3NjRiYTIgMTAwJSk7IC13ZWJraXQtYmFja2dyb3VuZC1jbGlwOiB0ZXh0OyAtd2Via2l0LXRleHQtZmlsbC1jb2xvcjogdHJhbnNwYXJlbnQ7IGZvbnQtd2VpZ2h0OiA3MDA7IG1hcmdpbi1ib3R0b206IDEwcHg7IGxldHRlci1zcGFjaW5nOiAwLjNweDsgfQogICAgICAgIC5tb2RhbC1jb3Vyc2UtbmFtZSB7IGZvbnQtc2l6ZTogMjRweDsgZm9udC13ZWlnaHQ6IDcwMDsgY29sb3I6ICMyMDIxMjQ7IGxpbmUtaGVpZ2h0OiAxLjM7IG1hcmdpbi1ib3R0b206IDRweDsgfQogICAgICAgIC5tb2RhbC1ib2R5IHsgbWFyZ2luLWJvdHRvbTogMjBweDsgfQogICAgICAgIC5kZXRhaWwtcm93IHsgZGlzcGxheTogZmxleDsgbWFyZ2luLWJvdHRvbTogMThweDsgYWxpZ24taXRlbXM6IGZsZXgtc3RhcnQ7IHBhZGRpbmc6IDEwcHggMDsgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNmMWYzZjQ7IH0KICAgICAgICAuZGV0YWlsLXJvdzpsYXN0LWNoaWxkIHsgYm9yZGVyLWJvdHRvbTogbm9uZTsgfQogICAgICAgIC5kZXRhaWwtbGFiZWwgeyBmb250LXdlaWdodDogNjAwOyBjb2xvcjogIzVmNjM2ODsgbWluLXdpZHRoOiAxMzBweDsgZm9udC1zaXplOiAxNHB4OyB9CiAgICAgICAgLmRldGFpbC12YWx1ZSB7IGNvbG9yOiAjMjAyMTI0OyBmb250LXNpemU6IDE0cHg7IGZsZXg6IDE7IGxpbmUtaGVpZ2h0OiAxLjU7IGZvbnQtd2VpZ2h0OiA1MDA7IH0KICAgICAgICAuY2xvc2UtYnRuIHsgcG9zaXRpb246IGFic29sdXRlOyB0b3A6IDI0cHg7IHJpZ2h0OiAyNHB4OyBmb250LXNpemU6IDI4cHg7IGNvbG9yOiAjNWY2MzY4OyBjdXJzb3I6IHBvaW50ZXI7IHdpZHRoOiA0MHB4OyBoZWlnaHQ6IDQwcHg7IGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGp1c3RpZnktY29udGVudDogY2VudGVyOyBib3JkZXItcmFkaXVzOiA1MCU7IHRyYW5zaXRpb246IGFsbCAwLjJzOyB9CiAgICAgICAgLmNsb3NlLWJ0bjpob3ZlciB7IGJhY2tncm91bmQtY29sb3I6ICNmMWYzZjQ7IHRyYW5zZm9ybTogc2NhbGUoMS4xKTsgY29sb3I6ICMyMDIxMjQ7IH0KICAgICAgICAubGVnZW5kIHsgbWFyZ2luLXRvcDogMjBweDsgcGFkZGluZzogMjBweDsgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7IGJvcmRlci1yYWRpdXM6IDhweDsgYm94LXNoYWRvdzogMCAycHggOHB4IHJnYmEoMCwwLDAsMC4xKTsgfQogICAgICAgIC5sZWdlbmQtdGl0bGUgeyBmb250LXdlaWdodDogNzAwOyBtYXJnaW4tYm90dG9tOiAxMnB4OyBjb2xvcjogIzIwMjEyNDsgZm9udC1zaXplOiAxNnB4OyB9CiAgICAgICAgLmxlZ2VuZC1pdGVtIHsgZGlzcGxheTogYmxvY2s7IG1hcmdpbi1ib3R0b206IDhweDsgZm9udC1zaXplOiAxM3B4OyBjb2xvcjogIzVmNjM2ODsgbGluZS1oZWlnaHQ6IDEuNjsgfQogICAgICAgIC5sZWdlbmQtZ3JpZCB7IGRpc3BsYXk6IGdyaWQ7IGdyaWQtdGVtcGxhdGUtY29sdW1uczogcmVwZWF0KDQsIDFmcik7IGdhcDogMTBweCAyMHB4OyBtYXJnaW4tdG9wOiAxNXB4OyB9CiAgICAgICAgLmxlZ2VuZC1ncmlkLWl0ZW0geyBkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBmb250LXNpemU6IDEzcHg7IGNvbG9yOiAjMjAyMTI0OyB9CiAgICAgICAgLmNvbG9yLWJveCB7IGRpc3BsYXk6IGlubGluZS1ibG9jazsgd2lkdGg6IDE4cHg7IGhlaWdodDogMThweDsgYm9yZGVyLXJhZGl1czogNHB4OyBtYXJnaW4tcmlnaHQ6IDhweDsgdmVydGljYWwtYWxpZ246IG1pZGRsZTsgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgIzY2N2VlYSAwJSwgIzc2NGJhMiAxMDAlKTsgZmxleC1zaHJpbms6IDA7IH0KCiAgICAgICAgLyogVGFicyAqLwogICAgICAgIC50YWJzLWNvbnRhaW5lciB7IGJhY2tncm91bmQtY29sb3I6IHdoaXRlOyBwYWRkaW5nOiAxMnB4IDI0cHg7IG1hcmdpbi1ib3R0b206IDEwcHg7IGJvcmRlci1yYWRpdXM6IDEycHg7IGJveC1zaGFkb3c6IDAgMnB4IDhweCByZ2JhKDAsMCwwLDAuMDgpOyBkaXNwbGF5OiBmbGV4OyBnYXA6IDEycHg7IH0KICAgICAgICAudGFiLWJ0biB7IHBhZGRpbmc6IDEycHggMjRweDsgYm9yZGVyOiBub25lOyBiYWNrZ3JvdW5kLWNvbG9yOiAjZjFmM2Y0OyBjb2xvcjogIzVmNjM2ODsgYm9yZGVyLXJhZGl1czogOHB4OyBjdXJzb3I6IHBvaW50ZXI7IGZvbnQtc2l6ZTogMTRweDsgZm9udC13ZWlnaHQ6IDYwMDsgdHJhbnNpdGlvbjogYWxsIDAuMnM7IGJveC1zaGFkb3c6IDAgMXB4IDNweCByZ2JhKDAsMCwwLDAuMDUpOyB9CiAgICAgICAgLnRhYi1idG46aG92ZXIgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjZThmMGZlOyBjb2xvcjogIzFhNzNlODsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC0xcHgpOyBib3gtc2hhZG93OiAwIDJweCA2cHggcmdiYSgwLDAsMCwwLjEpOyB9CiAgICAgICAgLnRhYi1idG46YWN0aXZlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDApOyB9CiAgICAgICAgLnRhYi1idG4uYWN0aXZlIHsgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgIzFhNzNlOCAwJSwgIzQyODVmNCAxMDAlKTsgY29sb3I6IHdoaXRlOyBib3gtc2hhZG93OiAwIDNweCA4cHggcmdiYSgyNiwxMTUsMjMyLDAuMyk7IH0KICAgICAgICAudGFiLWNvbnRlbnQgeyBkaXNwbGF5OiBibG9jazsgfQoKICAgICAgICAvKiBJbnN0cnVjdG9yIFNlbGVjdG9yICovCiAgICAgICAgLmluc3RydWN0b3Itc2VsZWN0b3Itd3JhcHBlciB7IHBvc2l0aW9uOiByZWxhdGl2ZTsgfQogICAgICAgIC5pbnN0cnVjdG9yLWRyb3Bkb3duIHsgZGlzcGxheTogbm9uZTsgcG9zaXRpb246IGFic29sdXRlOyB0b3A6IDEwMCU7IGxlZnQ6IDA7IGJhY2tncm91bmQtY29sb3I6IHdoaXRlOyBib3JkZXI6IDFweCBzb2xpZCAjZGFkY2UwOyBib3JkZXItcmFkaXVzOiAxMnB4OyBib3gtc2hhZG93OiAwIDhweCAyNHB4IHJnYmEoMCwwLDAsMC4xMiksIDAgMnB4IDZweCByZ2JhKDAsMCwwLDAuMDgpOyBtaW4td2lkdGg6IDMyMHB4OyBtYXgtd2lkdGg6IDQyMHB4OyB6LWluZGV4OiAxMDA7IG1hcmdpbi10b3A6IDhweDsgb3ZlcmZsb3c6IGhpZGRlbjsgfQogICAgICAgIC5pbnN0cnVjdG9yLWRyb3Bkb3duLnNob3cgeyBkaXNwbGF5OiBibG9jazsgYW5pbWF0aW9uOiBkcm9wZG93blNsaWRlIDAuMnMgZWFzZS1vdXQ7IH0KICAgICAgICBAa2V5ZnJhbWVzIGRyb3Bkb3duU2xpZGUgeyBmcm9tIHsgb3BhY2l0eTogMDsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC04cHgpOyB9IHRvIHsgb3BhY2l0eTogMTsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDApOyB9IH0KICAgICAgICAuaW5zdHJ1Y3Rvci1kcm9wZG93bi1oZWFkZXIgeyBkaXNwbGF5OiBmbGV4OyBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47IHBhZGRpbmc6IDEycHggMTZweDsgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgI2Y4ZjlmYSAwJSwgI2U4ZWFlZCAxMDAlKTsgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNkYWRjZTA7IGdhcDogMTBweDsgfQogICAgICAgIC5kcm9wZG93bi1hY3Rpb24tYnRuIHsgcGFkZGluZzogOHB4IDE2cHg7IGJvcmRlcjogMXB4IHNvbGlkICMxYTczZTg7IGJhY2tncm91bmQtY29sb3I6IHdoaXRlOyBjb2xvcjogIzFhNzNlODsgYm9yZGVyLXJhZGl1czogNnB4OyBjdXJzb3I6IHBvaW50ZXI7IGZvbnQtc2l6ZTogMTJweDsgZm9udC13ZWlnaHQ6IDYwMDsgdHJhbnNpdGlvbjogYWxsIDAuMnM7IGZsZXg6IDE7IGJveC1zaGFkb3c6IDAgMXB4IDNweCByZ2JhKDAsMCwwLDAuMDgpOyB9CiAgICAgICAgLmRyb3Bkb3duLWFjdGlvbi1idG46aG92ZXIgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjMWE3M2U4OyBjb2xvcjogd2hpdGU7IHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtMXB4KTsgYm94LXNoYWRvdzogMCAycHggNnB4IHJnYmEoMjYsMTE1LDIzMiwwLjMpOyB9CiAgICAgICAgLmRyb3Bkb3duLWFjdGlvbi1idG46YWN0aXZlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDApOyB9CiAgICAgICAgLmluc3RydWN0b3ItbGlzdCB7IG1heC1oZWlnaHQ6IDM0MHB4OyBvdmVyZmxvdy15OiBhdXRvOyBwYWRkaW5nOiA4cHg7IGJhY2tncm91bmQtY29sb3I6ICNmYWZhZmE7IH0KICAgICAgICAuaW5zdHJ1Y3Rvci1saXN0Ojotd2Via2l0LXNjcm9sbGJhciB7IHdpZHRoOiA4cHg7IH0KICAgICAgICAuaW5zdHJ1Y3Rvci1saXN0Ojotd2Via2l0LXNjcm9sbGJhci10cmFjayB7IGJhY2tncm91bmQ6ICNmMWYzZjQ7IGJvcmRlci1yYWRpdXM6IDRweDsgfQogICAgICAgIC5pbnN0cnVjdG9yLWxpc3Q6Oi13ZWJraXQtc2Nyb2xsYmFyLXRodW1iIHsgYmFja2dyb3VuZDogI2RhZGNlMDsgYm9yZGVyLXJhZGl1czogNHB4OyB9CiAgICAgICAgLmluc3RydWN0b3ItbGlzdDo6LXdlYmtpdC1zY3JvbGxiYXItdGh1bWI6aG92ZXIgeyBiYWNrZ3JvdW5kOiAjYmRjMWM2OyB9CiAgICAgICAgLmluc3RydWN0b3ItY2hlY2tib3gtaXRlbSB7IGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IHBhZGRpbmc6IDEwcHggMTJweDsgbWFyZ2luLWJvdHRvbTogNHB4OyBib3JkZXItcmFkaXVzOiA4cHg7IGN1cnNvcjogcG9pbnRlcjsgdHJhbnNpdGlvbjogYWxsIDAuMnM7IGJhY2tncm91bmQtY29sb3I6IHdoaXRlOyBib3gtc2hhZG93OiAwIDFweCAycHggcmdiYSgwLDAsMCwwLjA1KTsgfQogICAgICAgIC5pbnN0cnVjdG9yLWNoZWNrYm94LWl0ZW06aG92ZXIgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjZThmMGZlOyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoNHB4KTsgYm94LXNoYWRvdzogMCAycHggNnB4IHJnYmEoMjYsMTE1LDIzMiwwLjE1KTsgfQogICAgICAgIC5pbnN0cnVjdG9yLWNoZWNrYm94LWl0ZW0gaW5wdXRbdHlwZT0iY2hlY2tib3giXSB7IG1hcmdpbi1yaWdodDogMTJweDsgY3Vyc29yOiBwb2ludGVyOyB3aWR0aDogMThweDsgaGVpZ2h0OiAxOHB4OyBhY2NlbnQtY29sb3I6ICMxYTczZTg7IH0KICAgICAgICAuaW5zdHJ1Y3Rvci1jaGVja2JveC1pdGVtIGxhYmVsIHsgY3Vyc29yOiBwb2ludGVyOyBmb250LXNpemU6IDEzcHg7IGNvbG9yOiAjMjAyMTI0OyBmbGV4OiAxOyBkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBnYXA6IDEwcHg7IGZvbnQtd2VpZ2h0OiA1MDA7IH0KICAgICAgICAuaW5zdHJ1Y3Rvci1jb2xvci1pbmRpY2F0b3IgeyBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IHdpZHRoOiAxNHB4OyBoZWlnaHQ6IDE0cHg7IGJvcmRlci1yYWRpdXM6IDUwJTsgYm9yZGVyOiAycHggc29saWQgd2hpdGU7IGJveC1zaGFkb3c6IDAgMXB4IDNweCByZ2JhKDAsMCwwLDAuMik7IH0KCiAgICAgICAgLyogQ2xhc3MgTGlzdCAqLwogICAgICAgIC5wbGFubmluZy1jb250YWluZXIsIC5jb25mbGljdHMtY29udGFpbmVyIHsgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7IHBhZGRpbmc6IDMwcHg7IGJvcmRlci1yYWRpdXM6IDhweDsgYm94LXNoYWRvdzogMCAycHggOHB4IHJnYmEoMCwwLDAsMC4xKTsgfQogICAgICAgIC5wbGFubmluZy1jb250YWluZXIgaDIsIC5jb25mbGljdHMtY29udGFpbmVyIGgyIHsgY29sb3I6ICMyMDIxMjQ7IG1hcmdpbi1ib3R0b206IDEwcHg7IGZvbnQtc2l6ZTogMjRweDsgfQogICAgICAgIC50YWItZGVzY3JpcHRpb24geyBjb2xvcjogIzVmNjM2ODsgbWFyZ2luLWJvdHRvbTogMjVweDsgZm9udC1zaXplOiAxNHB4OyB9CiAgICAgICAgLmluc3RydWN0b3Itc2NoZWR1bGUgeyBtYXJnaW4tYm90dG9tOiAzMHB4OyBwYWRkaW5nOiAyMHB4OyBiYWNrZ3JvdW5kLWNvbG9yOiAjZjhmOWZhOyBib3JkZXItcmFkaXVzOiA4cHg7IGJvcmRlci1sZWZ0OiA0cHggc29saWQgIzFhNzNlODsgfQogICAgICAgIC5pbnN0cnVjdG9yLXNjaGVkdWxlLWhlYWRlciB7IGZvbnQtc2l6ZTogMThweDsgZm9udC13ZWlnaHQ6IDcwMDsgY29sb3I6ICMyMDIxMjQ7IG1hcmdpbi1ib3R0b206IDE1cHg7IGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGdhcDogMTBweDsgfQogICAgICAgIC5pbnN0cnVjdG9yLXNjaGVkdWxlLWNvdXJzZXMgeyBkaXNwbGF5OiBncmlkOyBnYXA6IDEwcHg7IH0KICAgICAgICAuc2NoZWR1bGUtY291cnNlLWl0ZW0geyBwYWRkaW5nOiAxMnB4IDE1cHg7IGJhY2tncm91bmQtY29sb3I6IHdoaXRlOyBib3JkZXItcmFkaXVzOiA2cHg7IGJvcmRlci1sZWZ0OiAzcHggc29saWQgIzY2N2VlYTsgfQogICAgICAgIC5zY2hlZHVsZS1jb3Vyc2UtdGl0bGUgeyBmb250LXdlaWdodDogNjAwOyBjb2xvcjogIzIwMjEyNDsgbWFyZ2luLWJvdHRvbTogNXB4OyB9CiAgICAgICAgLnNjaGVkdWxlLWNvdXJzZS1kZXRhaWxzIHsgZm9udC1zaXplOiAxM3B4OyBjb2xvcjogIzVmNjM2ODsgfQoKICAgICAgICAvKiBSb29tIENvbmZsaWN0cyAqLwogICAgICAgIC5jb25mbGljdC1ncm91cCB7IG1hcmdpbi1ib3R0b206IDI1cHg7IHBhZGRpbmc6IDIwcHg7IGJhY2tncm91bmQtY29sb3I6ICNmZmYzY2Q7IGJvcmRlci1yYWRpdXM6IDhweDsgYm9yZGVyLWxlZnQ6IDRweCBzb2xpZCAjZmY2YjZiOyBwb3NpdGlvbjogcmVsYXRpdmU7IH0KICAgICAgICAuY29uZmxpY3QtaGVhZGVyIHsgZm9udC1zaXplOiAxNnB4OyBmb250LXdlaWdodDogNzAwOyBjb2xvcjogIzcyMWMyNDsgbWFyZ2luLWJvdHRvbTogMTBweDsgZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsgZ2FwOiAxMHB4OyB9CiAgICAgICAgLmNvbmZsaWN0LXNldmVyaXR5IHsgZGlzcGxheTogaW5saW5lLWJsb2NrOyBwYWRkaW5nOiAzcHggMTBweDsgYmFja2dyb3VuZC1jb2xvcjogI2ZmNmI2YjsgY29sb3I6IHdoaXRlOyBib3JkZXItcmFkaXVzOiAxMnB4OyBmb250LXNpemU6IDExcHg7IGZvbnQtd2VpZ2h0OiA3MDA7IH0KICAgICAgICAuY29uZmxpY3QtaWdub3JlLWJ0biB7IHBvc2l0aW9uOiBhYnNvbHV0ZTsgdG9wOiAxNXB4OyByaWdodDogMTVweDsgcGFkZGluZzogNnB4IDEycHg7IGJhY2tncm91bmQtY29sb3I6ICM1ZjYzNjg7IGNvbG9yOiB3aGl0ZTsgYm9yZGVyOiBub25lOyBib3JkZXItcmFkaXVzOiA1cHg7IGN1cnNvcjogcG9pbnRlcjsgZm9udC1zaXplOiAxMnB4OyBmb250LXdlaWdodDogNjAwOyB0cmFuc2l0aW9uOiBhbGwgMC4yczsgfQogICAgICAgIC5jb25mbGljdC1pZ25vcmUtYnRuOmhvdmVyIHsgYmFja2dyb3VuZC1jb2xvcjogIzNjNDA0MzsgdHJhbnNmb3JtOiBzY2FsZSgxLjA1KTsgfQogICAgICAgIC5jb25mbGljdC1jb3Vyc2VzIHsgZGlzcGxheTogZ3JpZDsgZ2FwOiAxMnB4OyBtYXJnaW4tdG9wOiAxNXB4OyB9CiAgICAgICAgLmNvbmZsaWN0LWNvdXJzZS1pdGVtIHsgcGFkZGluZzogMTJweCAxNXB4OyBiYWNrZ3JvdW5kLWNvbG9yOiB3aGl0ZTsgYm9yZGVyLXJhZGl1czogNnB4OyBib3JkZXItbGVmdDogM3B4IHNvbGlkICNmZjZiNmI7IH0KICAgICAgICAuY29uZmxpY3QtY291cnNlLWhlYWRlciB7IGZvbnQtd2VpZ2h0OiA2MDA7IGNvbG9yOiAjMjAyMTI0OyBtYXJnaW4tYm90dG9tOiA1cHg7IH0KICAgICAgICAuY29uZmxpY3QtY291cnNlLWRldGFpbHMgeyBmb250LXNpemU6IDEzcHg7IGNvbG9yOiAjNWY2MzY4OyB9CiAgICAgICAgLm5vLWNvbmZsaWN0cyB7IHBhZGRpbmc6IDMwcHg7IHRleHQtYWxpZ246IGNlbnRlcjsgY29sb3I6ICM1ZjYzNjg7IGZvbnQtc2l6ZTogMTZweDsgfQogICAgICAgIC5jb25mbGljdC1pbmRpY2F0b3IgeyBib3JkZXI6IDNweCBzb2xpZCAjZmY2YjZiICFpbXBvcnRhbnQ7IGJveC1zaGFkb3c6IDAgMCAwIDNweCByZ2JhKDI1NSwxMDcsMTA3LDAuMikgIWltcG9ydGFudDsgfQogICAgICAgIC5jb25mbGljdC1oaWRkZW4geyBkaXNwbGF5OiBub25lOyB9CgogICAgICAgIC8qIEVkaXQgTW9kZSBTdHlsZXMgKi8KICAgICAgICAuZWRpdC1jb250YWluZXIgeyBiYWNrZ3JvdW5kLWNvbG9yOiB3aGl0ZTsgcGFkZGluZzogMzBweDsgYm9yZGVyLXJhZGl1czogOHB4OyBib3gtc2hhZG93OiAwIDJweCA4cHggcmdiYSgwLDAsMCwwLjEpOyB9CiAgICAgICAgLmVkaXQtY29udGFpbmVyIGgyIHsgY29sb3I6ICMyMDIxMjQ7IG1hcmdpbi1ib3R0b206IDEwcHg7IGZvbnQtc2l6ZTogMjRweDsgfQoKICAgICAgICAuZWRpdC10b29sYmFyLXRvcCB7IGRpc3BsYXk6IGZsZXg7IGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsgYWxpZ24taXRlbXM6IGNlbnRlcjsgbWFyZ2luLWJvdHRvbTogMjBweDsgcGFkZGluZzogMTVweDsgYmFja2dyb3VuZC1jb2xvcjogI2Y4ZjlmYTsgYm9yZGVyLXJhZGl1czogOHB4OyB9CiAgICAgICAgLmVkaXQtdG9vbGJhci1ib3R0b20geyBkaXNwbGF5OiBmbGV4OyBnYXA6IDE1cHg7IGp1c3RpZnktY29udGVudDogY2VudGVyOyBtYXJnaW4tdG9wOiAyMHB4OyBwYWRkaW5nOiAyMHB4OyBiYWNrZ3JvdW5kLWNvbG9yOiAjZjhmOWZhOyBib3JkZXItcmFkaXVzOiA4cHg7IH0KCiAgICAgICAgLmVkaXQtYWN0aW9uLWJ0biB7IHBhZGRpbmc6IDEycHggMjRweDsgYm9yZGVyOiBub25lOyBib3JkZXItcmFkaXVzOiA4cHg7IGN1cnNvcjogcG9pbnRlcjsgZm9udC1zaXplOiAxNHB4OyBmb250LXdlaWdodDogNjAwOyB0cmFuc2l0aW9uOiBhbGwgMC4yczsgYm94LXNoYWRvdzogMCAycHggNHB4IHJnYmEoMCwwLDAsMC4xKTsgfQogICAgICAgIC5lZGl0LWFjdGlvbi1idG46aG92ZXIgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTJweCk7IGJveC1zaGFkb3c6IDAgNHB4IDhweCByZ2JhKDAsMCwwLDAuMTUpOyB9CiAgICAgICAgLmJ0bi1wcmltYXJ5IHsgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgIzFhNzNlOCAwJSwgIzQyODVmNCAxMDAlKTsgY29sb3I6IHdoaXRlOyB9CiAgICAgICAgLmJ0bi1zZWNvbmRhcnkgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjZjFmM2Y0OyBjb2xvcjogIzVmNjM2ODsgfQogICAgICAgIC5idG4tc2Vjb25kYXJ5OmhvdmVyIHsgYmFja2dyb3VuZC1jb2xvcjogI2U4ZWFlZDsgfQogICAgICAgIC5idG4tZGFuZ2VyIHsgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgI2VhNDMzNSAwJSwgI2QzM2IyYyAxMDAlKTsgY29sb3I6IHdoaXRlOyB9CiAgICAgICAgLmJ0bi1pbmZvIHsgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgI2ZiYmMwNCAwJSwgI2Y5YWIwMCAxMDAlKTsgY29sb3I6ICMyMDIxMjQ7IH0KICAgICAgICAuYnRuLWV4cG9ydCB7IGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsICMzNGE4NTMgMCUsICMwZjlkNTggMTAwJSk7IGNvbG9yOiB3aGl0ZTsgfQogICAgICAgIC5idG4taW1wb3J0IHsgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgIzQyODVmNCAwJSwgIzFhNzNlOCAxMDAlKTsgY29sb3I6IHdoaXRlOyB9CiAgICAgICAgLmJ0bi1zYXZlIHsgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgIzkzMzRlNiAwJSwgIzdjM2FlZCAxMDAlKTsgY29sb3I6IHdoaXRlOyB9CgogICAgICAgIC5lZGl0LXN0YXR1cyB7IGZvbnQtc2l6ZTogMTRweDsgY29sb3I6ICM1ZjYzNjg7IH0KICAgICAgICAuZWRpdC1zdGF0dXMgI2VkaXRDb3VudCB7IGZvbnQtd2VpZ2h0OiA3MDA7IGNvbG9yOiAjZWE0MzM1OyBmb250LXNpemU6IDE4cHg7IH0KCiAgICAgICAgLmNhbGVuZGFyLWNvbnRhaW5lci5lZGl0LW1vZGUgeyBib3JkZXI6IDNweCBzb2xpZCAjZmJiYzA0OyBib3gtc2hhZG93OiAwIDRweCAxNnB4IHJnYmEoMjUxLDE4OCw0LDAuMik7IH0KICAgICAgICAuY2FsZW5kYXItY29udGFpbmVyLmVkaXQtbW9kZSAuY291cnNlLWJsb2NrIHsgY3Vyc29yOiBwb2ludGVyOyBib3JkZXI6IDJweCBzb2xpZCByZ2JhKDI1NSwyNTUsMjU1LDAuNSk7IH0KICAgICAgICAuY2FsZW5kYXItY29udGFpbmVyLmVkaXQtbW9kZSAuY291cnNlLWJsb2NrOmhvdmVyIHsgYm9yZGVyOiAycHggc29saWQgd2hpdGU7IHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtM3B4KSBzY2FsZSgxLjAzKTsgfQogICAgICAgIC5jYWxlbmRhci1jb250YWluZXIuZWRpdC1tb2RlIC5jb3Vyc2UtYmxvY2suZWRpdGVkIHsgcG9zaXRpb246IGFic29sdXRlOyB9CiAgICAgICAgLmNhbGVuZGFyLWNvbnRhaW5lci5lZGl0LW1vZGUgLmNvdXJzZS1ibG9jay5lZGl0ZWQ6OmFmdGVyIHsgY29udGVudDogJ+KaoO+4jyc7IHBvc2l0aW9uOiBhYnNvbHV0ZTsgdG9wOiAycHg7IHJpZ2h0OiAycHg7IGZvbnQtc2l6ZTogMTJweDsgfQoKICAgICAgICAvKiBFZGl0IE1vZGFsIFN0eWxlcyAqLwogICAgICAgIC5lZGl0LW1vZGFsLWNvbnRlbnQgeyBtYXgtd2lkdGg6IDcwMHB4OyBtYXgtaGVpZ2h0OiA5MHZoOyBvdmVyZmxvdy15OiBhdXRvOyB9CiAgICAgICAgLmVkaXQtbW9kYWwtY29udGVudCBoMiB7IGZvbnQtc2l6ZTogMjJweDsgY29sb3I6ICMxYTczZTg7IG1hcmdpbi1ib3R0b206IDIwcHg7IH0KCiAgICAgICAgLmZvcm0tZ3JvdXAgeyBtYXJnaW4tYm90dG9tOiAyMHB4OyB9CiAgICAgICAgLmZvcm0tZ3JvdXAgbGFiZWwgeyBkaXNwbGF5OiBibG9jazsgZm9udC13ZWlnaHQ6IDYwMDsgY29sb3I6ICMyMDIxMjQ7IG1hcmdpbi1ib3R0b206IDhweDsgZm9udC1zaXplOiAxNHB4OyB9CiAgICAgICAgLmZvcm0tZ3JvdXAgaW5wdXQsIC5mb3JtLWdyb3VwIHNlbGVjdCB7IHdpZHRoOiAxMDAlOyBwYWRkaW5nOiAxMHB4IDEycHg7IGJvcmRlcjogMXB4IHNvbGlkICNkYWRjZTA7IGJvcmRlci1yYWRpdXM6IDZweDsgZm9udC1zaXplOiAxNHB4OyB0cmFuc2l0aW9uOiBhbGwgMC4yczsgfQogICAgICAgIC5mb3JtLWdyb3VwIGlucHV0OmZvY3VzLCAuZm9ybS1ncm91cCBzZWxlY3Q6Zm9jdXMgeyBib3JkZXItY29sb3I6ICMxYTczZTg7IG91dGxpbmU6IG5vbmU7IGJveC1zaGFkb3c6IDAgMCAwIDNweCByZ2JhKDI2LDExNSwyMzIsMC4xKTsgfQoKICAgICAgICAuZm9ybS1yb3cgeyBkaXNwbGF5OiBncmlkOyBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IHJlcGVhdChhdXRvLWZpdCwgbWlubWF4KDE1MHB4LCAxZnIpKTsgZ2FwOiAxNXB4OyB9CgogICAgICAgIC5yZXF1aXJlZCB7IGNvbG9yOiAjZWE0MzM1OyBmb250LXdlaWdodDogNzAwOyB9CgogICAgICAgIC5kYXktY2hlY2tib3hlcyB7IGRpc3BsYXk6IGZsZXg7IGdhcDogMTVweDsgbWFyZ2luLXRvcDogMTBweDsgZmxleC13cmFwOiB3cmFwOyB9CiAgICAgICAgLmRheS1jaGVja2JveGVzIGxhYmVsIHsgZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IGNlbnRlcjsgZ2FwOiA2cHg7IGZvbnQtc2l6ZTogMTNweDsgZm9udC13ZWlnaHQ6IDUwMDsgY3Vyc29yOiBwb2ludGVyOyBwYWRkaW5nOiA4cHggMTJweDsgYmFja2dyb3VuZC1jb2xvcjogI2YxZjNmNDsgYm9yZGVyLXJhZGl1czogNnB4OyB0cmFuc2l0aW9uOiBhbGwgMC4yczsgfQogICAgICAgIC5kYXktY2hlY2tib3hlcyBsYWJlbDpob3ZlciB7IGJhY2tncm91bmQtY29sb3I6ICNlOGYwZmU7IH0KICAgICAgICAuZGF5LWNoZWNrYm94ZXMgaW5wdXRbdHlwZT0iY2hlY2tib3giXTpjaGVja2VkICsgKiB7IGNvbG9yOiAjMWE3M2U4OyB9CiAgICAgICAgLmRheS1jaGVja2JveGVzIGlucHV0W3R5cGU9ImNoZWNrYm94Il0geyBhY2NlbnQtY29sb3I6ICMxYTczZTg7IHdpZHRoOiAxNnB4OyBoZWlnaHQ6IDE2cHg7IH0KCiAgICAgICAgLmVycm9yLW1lc3NhZ2UgeyBjb2xvcjogI2VhNDMzNTsgZm9udC1zaXplOiAxM3B4OyBtYXJnaW4tdG9wOiA1cHg7IHBhZGRpbmc6IDhweDsgYmFja2dyb3VuZC1jb2xvcjogI2ZjZThlNjsgYm9yZGVyLXJhZGl1czogNHB4OyB9CgogICAgICAgIC5tb2RhbC1hY3Rpb25zIHsgZGlzcGxheTogZmxleDsgZ2FwOiAxMnB4OyBqdXN0aWZ5LWNvbnRlbnQ6IGZsZXgtZW5kOyBtYXJnaW4tdG9wOiAzMHB4OyBwYWRkaW5nLXRvcDogMjBweDsgYm9yZGVyLXRvcDogMXB4IHNvbGlkICNlOGVhZWQ7IH0KICAgICAgICAubW9kYWwtYWN0aW9ucyBidXR0b24geyBwYWRkaW5nOiAxMHB4IDIwcHg7IH0KICAgIDwvc3R5bGU+CjwvaGVhZD4KPGJvZHk+CiAgICA8IS0tIFJlYWQgdGhlIERvY3Mgc3R5bGUgbmF2aWdhdGlvbiAtLT4KICAgIDxuYXYgY2xhc3M9InJ0ZC1uYXZiYXIiPgogICAgICAgIDxkaXYgY2xhc3M9InJ0ZC1uYXZiYXItY29udGVudCI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InJ0ZC1uYXZiYXItbGVmdCI+CiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0icnRkLW5hdmJhci10aXRsZSI+8J+OkyBHV1UgQ291cnNlIENhbGVuZGFyPC9zcGFuPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0icnRkLW5hdmJhci1yaWdodCI+CiAgICAgICAgICAgICAgICA8YSBocmVmPSJodHRwczovL2dpdGh1Yi5jb20vbW1hbm4xMTIzL0dXVV9Db3Vyc2VfQ2FsZW5kYXIiIHRhcmdldD0iX2JsYW5rIiBjbGFzcz0icnRkLW5hdi1saW5rIj4KICAgICAgICAgICAgICAgICAgICA8c3ZnIGNsYXNzPSJnaXRodWItaWNvbiIgdmlld0JveD0iMCAwIDE2IDE2IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICAgICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNOCAwQzMuNTggMCAwIDMuNTggMCA4YzAgMy41NCAyLjI5IDYuNTMgNS40NyA3LjU5LjQuMDcuNTUtLjE3LjU1LS4zOCAwLS4xOS0uMDEtLjgyLS4wMS0xLjQ5LTIuMDEuMzctMi41My0uNDktMi42OS0uOTQtLjA5LS4yMy0uNDgtLjk0LS44Mi0xLjEzLS4yOC0uMTUtLjY4LS41Mi0uMDEtLjUzLjYzLS4wMSAxLjA4LjU4IDEuMjMuODIuNzIgMS4yMSAxLjg3Ljg3IDIuMzMuNjYuMDctLjUyLjI4LS44Ny41MS0xLjA3LTEuNzgtLjItMy42NC0uODktMy42NC0zLjk1IDAtLjg3LjMxLTEuNTkuODItMi4xNS0uMDgtLjItLjM2LTEuMDIuMDgtMi4xMiAwIDAgLjY3LS4yMSAyLjIuODIuNjQtLjE4IDEuMzItLjI3IDItLjI3LjY4IDAgMS4zNi4wOSAyIC4yNyAxLjUzLTEuMDQgMi4yLS44MiAyLjItLjgyLjQ0IDEuMS4xNiAxLjkyLjA4IDIuMTIuNTEuNTYuODIgMS4yNy44MiAyLjE1IDAgMy4wNy0xLjg3IDMuNzUtMy42NSAzLjk1LjI5LjI1LjU0LjczLjU0IDEuNDggMCAxLjA3LS4wMSAxLjkzLS4wMSAyLjIgMCAuMjEuMTUuNDYuNTUuMzhBOC4wMTMgOC4wMTMgMCAwMDE2IDhjMC00LjQyLTMuNTgtOC04LTh6Ii8+CiAgICAgICAgICAgICAgICAgICAgPC9zdmc+CiAgICAgICAgICAgICAgICAgICAgR2l0SHViCiAgICAgICAgICAgICAgICA8L2E+CiAgICAgICAgICAgICAgICA8YSBocmVmPSJodHRwczovL2dpdGh1Yi5jb20vbW1hbm4xMTIzL0dXVV9Db3Vyc2VfQ2FsZW5kYXIvaXNzdWVzIiB0YXJnZXQ9Il9ibGFuayIgY2xhc3M9InJ0ZC1uYXYtbGluayI+CiAgICAgICAgICAgICAgICAgICAgUmVwb3J0IElzc3VlCiAgICAgICAgICAgICAgICA8L2E+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgPC9uYXY+CgogICAgPGRpdiBjbGFzcz0ibWFpbi1jb250ZW50Ij4KICAgICAgICA8ZGl2IGNsYXNzPSJoZWFkZXIiPgogICAgICAgICAgICA8aDE+8J+Xk++4jyBHV1UgQ291cnNlcyAtIEZhbGwgMjAyNTwvaDE+CiAgICAgICAgICAgIDxwPkludGVyYWN0aXZlIENvdXJzZSBTY2hlZHVsZSB8IFNjcmFwZWQgZnJvbSBHV1Ugd2Vic2l0ZSBvbiBKYW51YXJ5IDIwLCAyMDI2PC9wPgogICAgICAgIDwvZGl2PgoKICAgIDxkaXYgY2xhc3M9InN0YXRzIj4KICAgICAgICA8ZGl2IGNsYXNzPSJzdGF0cy1pdGVtIj48c3BhbiBjbGFzcz0ic3RhdHMtbnVtYmVyIiBpZD0idG90YWxDb3Vyc2VzIj4wPC9zcGFuPjxzcGFuPlRvdGFsIENvdXJzZXM8L3NwYW4+PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0ic3RhdHMtaXRlbSI+PHNwYW4gY2xhc3M9InN0YXRzLW51bWJlciIgaWQ9InRvdGFsSW5zdHJ1Y3RvcnMiPjA8L3NwYW4+PHNwYW4+SW5zdHJ1Y3RvcnM8L3NwYW4+PC9kaXY+CiAgICA8L2Rpdj4KCiAgICA8ZGl2IGNsYXNzPSJ0YWJzLWNvbnRhaW5lciI+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0idGFiLWJ0biBhY3RpdmUiIGRhdGEtdGFiPSJhbGwtY291cnNlcyIgb25jbGljaz0ic3dpdGNoVGFiKCdhbGwtY291cnNlcycpIj7wn5OFIEFsbCBDb3Vyc2VzPC9idXR0b24+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0idGFiLWJ0biIgZGF0YS10YWI9InBsYW5uaW5nLW1vZGUiIG9uY2xpY2s9InN3aXRjaFRhYigncGxhbm5pbmctbW9kZScpIj7wn5OLIENsYXNzIExpc3Q8L2J1dHRvbj4KICAgICAgICA8YnV0dG9uIGNsYXNzPSJ0YWItYnRuIiBkYXRhLXRhYj0icm9vbS1jb25mbGljdHMiIG9uY2xpY2s9InN3aXRjaFRhYigncm9vbS1jb25mbGljdHMnKSI+4pqg77iPIFJvb20gQ29uZmxpY3RzPC9idXR0b24+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0idGFiLWJ0biIgZGF0YS10YWI9ImVkaXQtc2NoZWR1bGUiIG9uY2xpY2s9InN3aXRjaFRhYignZWRpdC1zY2hlZHVsZScpIj7inI/vuI8gRWRpdCBTY2hlZHVsZTwvYnV0dG9uPgogICAgPC9kaXY+CgogICAgPGRpdiBjbGFzcz0iZmlsdGVyLWNvbnRyb2xzIiBpZD0ibWFpbkNhbGVuZGFyRmlsdGVycyI+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0iZmlsdGVyLWJ0biIgb25jbGljaz0ic2hvd0FsbERheXMoKSI+U2hvdyBBbGwgRGF5czwvYnV0dG9uPgogICAgICAgIDxkaXYgY2xhc3M9Imluc3RydWN0b3Itc2VsZWN0b3Itd3JhcHBlciI+CiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImZpbHRlci1idG4iIGlkPSJsZXZlbERyb3Bkb3duQnRuIiBvbmNsaWNrPSJ0b2dnbGVMZXZlbERyb3Bkb3duKCkiPgogICAgICAgICAgICAgICAgPHNwYW4gaWQ9ImxldmVsQnRuVGV4dCI+QWxsIExldmVsczwvc3Bhbj4g4pa8CiAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJpbnN0cnVjdG9yLWRyb3Bkb3duIiBpZD0ibGV2ZWxEcm9wZG93biI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJpbnN0cnVjdG9yLWxpc3QiIHN0eWxlPSJtYXgtaGVpZ2h0OiAyMDBweDsiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Imluc3RydWN0b3ItY2hlY2tib3gtaXRlbSIgb25jbGljaz0ic2V0TGV2ZWxGaWx0ZXIoJ2FsbCcpIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIHN0eWxlPSJjdXJzb3I6IHBvaW50ZXI7Ij5BbGwgTGV2ZWxzPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJpbnN0cnVjdG9yLWNoZWNrYm94LWl0ZW0iIG9uY2xpY2s9InNldExldmVsRmlsdGVyKCd1bmRlcmdyYWQnKSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBzdHlsZT0iY3Vyc29yOiBwb2ludGVyOyI+VW5kZXJncmFkICg8IDYwMDApPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJpbnN0cnVjdG9yLWNoZWNrYm94LWl0ZW0iIG9uY2xpY2s9InNldExldmVsRmlsdGVyKCdncmFkJykiPgogICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgc3R5bGU9ImN1cnNvcjogcG9pbnRlcjsiPkdyYWQgKD49IDYwMDApPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJpbnN0cnVjdG9yLXNlbGVjdG9yLXdyYXBwZXIiPgogICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJmaWx0ZXItYnRuIiBpZD0iaW5zdHJ1Y3RvckRyb3Bkb3duQnRuIiBvbmNsaWNrPSJ0b2dnbGVJbnN0cnVjdG9yRHJvcGRvd24oKSI+CiAgICAgICAgICAgICAgICA8c3BhbiBpZD0iaW5zdHJ1Y3RvckJ0blRleHQiPkFsbCBJbnN0cnVjdG9yczwvc3Bhbj4g4pa8CiAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJpbnN0cnVjdG9yLWRyb3Bkb3duIiBpZD0iaW5zdHJ1Y3RvckRyb3Bkb3duIj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Imluc3RydWN0b3ItZHJvcGRvd24taGVhZGVyIj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJkcm9wZG93bi1hY3Rpb24tYnRuIiBvbmNsaWNrPSJzZWxlY3RBbGxJbnN0cnVjdG9ycygpIj5TZWxlY3QgQWxsPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iZHJvcGRvd24tYWN0aW9uLWJ0biIgb25jbGljaz0iY2xlYXJBbGxJbnN0cnVjdG9ycygpIj5DbGVhciBBbGw8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaW5zdHJ1Y3Rvci1saXN0IiBpZD0iaW5zdHJ1Y3Rvckxpc3QiPjwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8c3BhbiBjbGFzcz0iZmlsdGVyLXRleHQiIGlkPSJmaWx0ZXJTdGF0dXMiPlNob3dpbmcgYWxsIGRheXMsIGFsbCBpbnN0cnVjdG9yczwvc3Bhbj4KICAgIDwvZGl2PgoKICAgIDxkaXYgY2xhc3M9InRhYi1jb250ZW50IiBpZD0iYWxsLWNvdXJzZXMtdGFiIj4KICAgICAgICA8ZGl2IGNsYXNzPSJjYWxlbmRhci1jb250YWluZXIiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYWxlbmRhci1oZWFkZXIiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZGF5LWhlYWRlciIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6IHdoaXRlOyBjdXJzb3I6IGRlZmF1bHQ7Ij48L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImRheS1oZWFkZXIiIGRhdGEtZGF5PSJtb25kYXkiIG9uY2xpY2s9ImZpbHRlckRheSgnbW9uZGF5JykiPk1vbmRheTwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZGF5LWhlYWRlciIgZGF0YS1kYXk9InR1ZXNkYXkiIG9uY2xpY2s9ImZpbHRlckRheSgndHVlc2RheScpIj5UdWVzZGF5PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJkYXktaGVhZGVyIiBkYXRhLWRheT0id2VkbmVzZGF5IiBvbmNsaWNrPSJmaWx0ZXJEYXkoJ3dlZG5lc2RheScpIj5XZWRuZXNkYXk8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImRheS1oZWFkZXIiIGRhdGEtZGF5PSJ0aHVyc2RheSIgb25jbGljaz0iZmlsdGVyRGF5KCd0aHVyc2RheScpIj5UaHVyc2RheTwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZGF5LWhlYWRlciIgZGF0YS1kYXk9ImZyaWRheSIgb25jbGljaz0iZmlsdGVyRGF5KCdmcmlkYXknKSI+RnJpZGF5PC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPGRpdiBjbGFzcz0iY2FsZW5kYXItYm9keSI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0aW1lLWNvbHVtbiIgaWQ9InRpbWVDb2x1bW4iPjwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZGF5LWNvbHVtbiIgaWQ9Im1vbmRheSI+PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJkYXktY29sdW1uIiBpZD0idHVlc2RheSI+PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJkYXktY29sdW1uIiBpZD0id2VkbmVzZGF5Ij48L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImRheS1jb2x1bW4iIGlkPSJ0aHVyc2RheSI+PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJkYXktY29sdW1uIiBpZD0iZnJpZGF5Ij48L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CgogICAgICAgIDxkaXYgY2xhc3M9ImxlZ2VuZCIgaWQ9Imluc3RydWN0b3JMZWdlbmQiPjwvZGl2PgogICAgPC9kaXY+CgogICAgPGRpdiBjbGFzcz0idGFiLWNvbnRlbnQiIGlkPSJwbGFubmluZy1tb2RlLXRhYiIgc3R5bGU9ImRpc3BsYXk6IG5vbmU7Ij4KICAgICAgICA8ZGl2IGNsYXNzPSJwbGFubmluZy1jb250YWluZXIiPgogICAgICAgICAgICA8aDI+Q2xhc3MgTGlzdCAtIEluc3RydWN0b3IgU2NoZWR1bGVzPC9oMj4KICAgICAgICAgICAgPHAgY2xhc3M9InRhYi1kZXNjcmlwdGlvbiI+VmlldyBpbmRpdmlkdWFsIGluc3RydWN0b3Igc2NoZWR1bGVzIGFuZCBpZGVudGlmeSBwb3RlbnRpYWwgY29uZmxpY3RzPC9wPgogICAgICAgICAgICA8ZGl2IGlkPSJwbGFubmluZ01vZGVDb250ZW50Ij48L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIDwvZGl2PgoKICAgIDxkaXYgY2xhc3M9InRhYi1jb250ZW50IiBpZD0icm9vbS1jb25mbGljdHMtdGFiIiBzdHlsZT0iZGlzcGxheTogbm9uZTsiPgogICAgICAgIDxkaXYgY2xhc3M9ImNvbmZsaWN0cy1jb250YWluZXIiPgogICAgICAgICAgICA8aDI+Um9vbSBDb25mbGljdHMgRGV0ZWN0aW9uPC9oMj4KICAgICAgICAgICAgPHAgY2xhc3M9InRhYi1kZXNjcmlwdGlvbiI+Q291cnNlcyBzY2hlZHVsZWQgaW4gdGhlIHNhbWUgcm9vbSBhdCBvdmVybGFwcGluZyB0aW1lczwvcD4KICAgICAgICAgICAgPGRpdiBpZD0iY29uZmxpY3RzQ29udGVudCI+PC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KCiAgICA8ZGl2IGNsYXNzPSJ0YWItY29udGVudCIgaWQ9ImVkaXQtc2NoZWR1bGUtdGFiIiBzdHlsZT0iZGlzcGxheTogbm9uZTsiPgogICAgICAgIDxkaXYgY2xhc3M9ImVkaXQtY29udGFpbmVyIj4KICAgICAgICAgICAgPGgyPkVkaXQgU2NoZWR1bGU8L2gyPgogICAgICAgICAgICA8cCBjbGFzcz0idGFiLWRlc2NyaXB0aW9uIj5BZGQsIHJlbW92ZSwgb3IgbW9kaWZ5IGNvdXJzZXMuIENoYW5nZXMgYXJlIHNhdmVkIGxvY2FsbHkgdW50aWwgZXhwb3J0ZWQuPC9wPgoKICAgICAgICAgICAgPGRpdiBjbGFzcz0iZWRpdC10b29sYmFyLXRvcCI+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJlZGl0LWFjdGlvbi1idG4gYnRuLXByaW1hcnkiIG9uY2xpY2s9Im9wZW5BZGRDb3Vyc2VNb2RhbCgpIj4KICAgICAgICAgICAgICAgICAgICDinpUgQWRkIE5ldyBDb3Vyc2UKICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImVkaXQtc3RhdHVzIiBpZD0iZWRpdFN0YXR1cyI+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gaWQ9ImVkaXRDb3VudCI+MDwvc3Bhbj4gdW5zYXZlZCBjaGFuZ2VzCiAgICAgICAgICAgICAgICA8L3NwYW4+CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPCEtLSBFZGl0IE1vZGUgRmlsdGVycyAtLT4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmlsdGVyLWNvbnRyb2xzIiBzdHlsZT0ibWFyZ2luOiAyMHB4IDA7Ij4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Imluc3RydWN0b3Itc2VsZWN0b3Itd3JhcHBlciI+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iZmlsdGVyLWJ0biIgaWQ9ImVkaXRSb29tRHJvcGRvd25CdG4iIG9uY2xpY2s9InRvZ2dsZUVkaXRSb29tRHJvcGRvd24oKSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGlkPSJlZGl0Um9vbUJ0blRleHQiPkFsbCBSb29tczwvc3Bhbj4g4pa8CiAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaW5zdHJ1Y3Rvci1kcm9wZG93biIgaWQ9ImVkaXRSb29tRHJvcGRvd24iPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJpbnN0cnVjdG9yLWxpc3QiIGlkPSJlZGl0Um9vbUxpc3QiIHN0eWxlPSJtYXgtaGVpZ2h0OiAzMDBweDsiPjwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJpbnN0cnVjdG9yLXNlbGVjdG9yLXdyYXBwZXIiPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImZpbHRlci1idG4iIGlkPSJlZGl0TGV2ZWxEcm9wZG93bkJ0biIgb25jbGljaz0idG9nZ2xlRWRpdExldmVsRHJvcGRvd24oKSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGlkPSJlZGl0TGV2ZWxCdG5UZXh0Ij5BbGwgTGV2ZWxzPC9zcGFuPiDilrwKICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJpbnN0cnVjdG9yLWRyb3Bkb3duIiBpZD0iZWRpdExldmVsRHJvcGRvd24iPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJpbnN0cnVjdG9yLWxpc3QiIHN0eWxlPSJtYXgtaGVpZ2h0OiAyMDBweDsiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaW5zdHJ1Y3Rvci1jaGVja2JveC1pdGVtIiBvbmNsaWNrPSJzZXRFZGl0TGV2ZWxGaWx0ZXIoJ2FsbCcpIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgc3R5bGU9ImN1cnNvcjogcG9pbnRlcjsiPkFsbCBMZXZlbHM8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJpbnN0cnVjdG9yLWNoZWNrYm94LWl0ZW0iIG9uY2xpY2s9InNldEVkaXRMZXZlbEZpbHRlcigndW5kZXJncmFkJykiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBzdHlsZT0iY3Vyc29yOiBwb2ludGVyOyI+VW5kZXJncmFkICg8IDYwMDApPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaW5zdHJ1Y3Rvci1jaGVja2JveC1pdGVtIiBvbmNsaWNrPSJzZXRFZGl0TGV2ZWxGaWx0ZXIoJ2dyYWQnKSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIHN0eWxlPSJjdXJzb3I6IHBvaW50ZXI7Ij5HcmFkICg+PSA2MDAwKTwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Imluc3RydWN0b3Itc2VsZWN0b3Itd3JhcHBlciI+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iZmlsdGVyLWJ0biIgaWQ9ImVkaXRJbnN0cnVjdG9yRHJvcGRvd25CdG4iIG9uY2xpY2s9InRvZ2dsZUVkaXRJbnN0cnVjdG9yRHJvcGRvd24oKSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGlkPSJlZGl0SW5zdHJ1Y3RvckJ0blRleHQiPkFsbCBJbnN0cnVjdG9yczwvc3Bhbj4g4pa8CiAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaW5zdHJ1Y3Rvci1kcm9wZG93biIgaWQ9ImVkaXRJbnN0cnVjdG9yRHJvcGRvd24iPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJpbnN0cnVjdG9yLWRyb3Bkb3duLWhlYWRlciI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJkcm9wZG93bi1hY3Rpb24tYnRuIiBvbmNsaWNrPSJzZWxlY3RBbGxFZGl0SW5zdHJ1Y3RvcnMoKSI+U2VsZWN0IEFsbDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iZHJvcGRvd24tYWN0aW9uLWJ0biIgb25jbGljaz0iY2xlYXJBbGxFZGl0SW5zdHJ1Y3RvcnMoKSI+Q2xlYXIgQWxsPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSJlZGl0SW5zdHJ1Y3Rvckxpc3QiIGNsYXNzPSJpbnN0cnVjdG9yLWxpc3QiPjwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGlkPSJlZGl0RmlsdGVyU3RhdHVzIiBzdHlsZT0iY29sb3I6ICM1ZjYzNjg7IGZvbnQtc2l6ZTogMTRweDsgbWFyZ2luLWxlZnQ6IDE1cHg7Ij4KCiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYWxlbmRhci1jb250YWluZXIgZWRpdC1tb2RlIj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNhbGVuZGFyLWhlYWRlciI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZGF5LWhlYWRlciIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6IHdoaXRlOyBjdXJzb3I6IGRlZmF1bHQ7Ij48L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJkYXktaGVhZGVyIj5Nb25kYXk8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJkYXktaGVhZGVyIj5UdWVzZGF5PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZGF5LWhlYWRlciI+V2VkbmVzZGF5PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZGF5LWhlYWRlciI+VGh1cnNkYXk8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJkYXktaGVhZGVyIj5GcmlkYXk8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNhbGVuZGFyLWJvZHkiIGlkPSJlZGl0Q2FsZW5kYXJCb2R5Ij4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0aW1lLWNvbHVtbiIgaWQ9ImVkaXRUaW1lQ29sdW1uIj48L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJkYXktY29sdW1uIiBpZD0iZWRpdC1tb25kYXkiPjwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImRheS1jb2x1bW4iIGlkPSJlZGl0LXR1ZXNkYXkiPjwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImRheS1jb2x1bW4iIGlkPSJlZGl0LXdlZG5lc2RheSI+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZGF5LWNvbHVtbiIgaWQ9ImVkaXQtdGh1cnNkYXkiPjwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImRheS1jb2x1bW4iIGlkPSJlZGl0LWZyaWRheSI+PC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJlZGl0LXRvb2xiYXItYm90dG9tIj4KICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImVkaXQtYWN0aW9uLWJ0biBidG4taW1wb3J0IiBvbmNsaWNrPSJkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3N2RmlsZUlucHV0JykuY2xpY2soKSI+CiAgICAgICAgICAgICAgICAgICAg8J+TpCBJbXBvcnQgQ1NWCiAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJmaWxlIiBpZD0iY3N2RmlsZUlucHV0IiBhY2NlcHQ9Ii5jc3YiIHN0eWxlPSJkaXNwbGF5OiBub25lOyIgb25jaGFuZ2U9ImhhbmRsZUNTVkltcG9ydChldmVudCkiPgogICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iZWRpdC1hY3Rpb24tYnRuIGJ0bi1wcmltYXJ5IiBvbmNsaWNrPSJleHBvcnRTY2hlZHVsZSgpIj4KICAgICAgICAgICAgICAgICAgICDwn5OmIEV4cG9ydCBTY2hlZHVsZQogICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPCEtLSBFZGl0IE1vZGUgQ29uZmxpY3RzIFNlY3Rpb24gLS0+CiAgICAgICAgICAgIDxkaXYgaWQ9ImVkaXRDb25mbGljdHNDb250YWluZXIiIHN0eWxlPSJtYXJnaW4tdG9wOiAzMHB4OyI+CiAgICAgICAgICAgICAgICA8aDMgc3R5bGU9Im1hcmdpbjogMCAwIDE1cHggMDsgY29sb3I6ICMyMDIxMjQ7Ij7imqDvuI8gU2NoZWR1bGUgQ29uZmxpY3RzPC9oMz4KICAgICAgICAgICAgICAgIDxkaXYgaWQ9ImVkaXRDb25mbGljdHNDb250ZW50Ij4KICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJwYWRkaW5nOiAyMHB4OyB0ZXh0LWFsaWduOiBjZW50ZXI7IGNvbG9yOiAjNWY2MzY4OyI+CiAgICAgICAgICAgICAgICAgICAgICAgIExvYWRpbmcgY29uZmxpY3RzLi4uCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KCiAgICA8ZGl2IGlkPSJtb2RhbCIgY2xhc3M9Im1vZGFsIj4KICAgICAgICA8ZGl2IGNsYXNzPSJtb2RhbC1jb250ZW50Ij4KICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImNsb3NlLWJ0biIgb25jbGljaz0iY2xvc2VNb2RhbCgpIj4mdGltZXM7PC9zcGFuPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJtb2RhbC1oZWFkZXIiPgogICAgICAgICAgICAgICAgPGRpdiBpZD0ic3RhdHVzQmFkZ2UiPjwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibW9kYWwtY291cnNlLW51bWJlciIgaWQ9Im1vZGFsQ291cnNlTnVtYmVyIj48L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1vZGFsLWNvdXJzZS1uYW1lIiBpZD0ibW9kYWxDb3Vyc2VOYW1lIj48L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1vZGFsLWJvZHkiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZGV0YWlsLXJvdyI+PGRpdiBjbGFzcz0iZGV0YWlsLWxhYmVsIj5DUk46PC9kaXY+PGRpdiBjbGFzcz0iZGV0YWlsLXZhbHVlIiBpZD0ibW9kYWxDUk4iPjwvZGl2PjwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZGV0YWlsLXJvdyI+PGRpdiBjbGFzcz0iZGV0YWlsLWxhYmVsIj5JbnN0cnVjdG9yOjwvZGl2PjxkaXYgY2xhc3M9ImRldGFpbC12YWx1ZSIgaWQ9Im1vZGFsSW5zdHJ1Y3RvciI+PC9kaXY+PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJkZXRhaWwtcm93Ij48ZGl2IGNsYXNzPSJkZXRhaWwtbGFiZWwiPk1lZXRpbmcgVGltZTo8L2Rpdj48ZGl2IGNsYXNzPSJkZXRhaWwtdmFsdWUiIGlkPSJtb2RhbFRpbWUiPjwvZGl2PjwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZGV0YWlsLXJvdyI+PGRpdiBjbGFzcz0iZGV0YWlsLWxhYmVsIj5EYXlzOjwvZGl2PjxkaXYgY2xhc3M9ImRldGFpbC12YWx1ZSIgaWQ9Im1vZGFsRGF5cyI+PC9kaXY+PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJkZXRhaWwtcm93Ij48ZGl2IGNsYXNzPSJkZXRhaWwtbGFiZWwiPkJ1aWxkaW5nOjwvZGl2PjxkaXYgY2xhc3M9ImRldGFpbC12YWx1ZSIgaWQ9Im1vZGFsQnVpbGRpbmciPjwvZGl2PjwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZGV0YWlsLXJvdyI+PGRpdiBjbGFzcz0iZGV0YWlsLWxhYmVsIj5Sb29tOjwvZGl2PjxkaXYgY2xhc3M9ImRldGFpbC12YWx1ZSIgaWQ9Im1vZGFsUm9vbSI+PC9kaXY+PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJkZXRhaWwtcm93Ij48ZGl2IGNsYXNzPSJkZXRhaWwtbGFiZWwiPkNyZWRpdHM6PC9kaXY+PGRpdiBjbGFzcz0iZGV0YWlsLXZhbHVlIiBpZD0ibW9kYWxDcmVkaXRzIj48L2Rpdj48L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImRldGFpbC1yb3ciPjxkaXYgY2xhc3M9ImRldGFpbC1sYWJlbCI+U2VtZXN0ZXI6PC9kaXY+PGRpdiBjbGFzcz0iZGV0YWlsLXZhbHVlIiBpZD0ibW9kYWxEYXRlcyI+PC9kaXY+PC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgPC9kaXY+CgogICAgPCEtLSBFZGl0IE1vZGFsIC0tPgogICAgPGRpdiBpZD0iZWRpdE1vZGFsIiBjbGFzcz0ibW9kYWwiPgogICAgICAgIDxkaXYgY2xhc3M9Im1vZGFsLWNvbnRlbnQgZWRpdC1tb2RhbC1jb250ZW50Ij4KICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImNsb3NlLWJ0biIgb25jbGljaz0iY2xvc2VFZGl0TW9kYWwoKSI+JnRpbWVzOzwvc3Bhbj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ibW9kYWwtaGVhZGVyIj4KICAgICAgICAgICAgICAgIDxoMiBpZD0iZWRpdE1vZGFsVGl0bGUiPkVkaXQgQ291cnNlPC9oMj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1vZGFsLWJvZHkiPgogICAgICAgICAgICAgICAgPGZvcm0gaWQ9ImVkaXRDb3Vyc2VGb3JtIiBvbnN1Ym1pdD0ic2F2ZUNvdXJzZUVkaXQoZXZlbnQpIj4KICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBpZD0iZWRpdENSTiI+CiAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgaWQ9Im9yaWdpbmFsQ1JOIj4KCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1yb3ciPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9ImVkaXRTdWJqZWN0Ij5TdWJqZWN0IENvZGUgPHNwYW4gY2xhc3M9InJlcXVpcmVkIj4qPC9zcGFuPjwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0idGV4dCIgaWQ9ImVkaXRTdWJqZWN0IiByZXF1aXJlZCBtYXhsZW5ndGg9IjEwIiBwbGFjZWhvbGRlcj0iR0VPRyI+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9ImVkaXRDb3Vyc2VOdW0iPkNvdXJzZSBOdW1iZXIgPHNwYW4gY2xhc3M9InJlcXVpcmVkIj4qPC9zcGFuPjwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0idGV4dCIgaWQ9ImVkaXRDb3Vyc2VOdW0iIHJlcXVpcmVkIG1heGxlbmd0aD0iMTAiIHBsYWNlaG9sZGVyPSIxMDAxIj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0iZWRpdFNlY3Rpb24iPlNlY3Rpb24gPHNwYW4gY2xhc3M9InJlcXVpcmVkIj4qPC9zcGFuPjwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0idGV4dCIgaWQ9ImVkaXRTZWN0aW9uIiByZXF1aXJlZCBtYXhsZW5ndGg9IjEwIiBwbGFjZWhvbGRlcj0iMTAiPgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1yb3ciPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9ImVkaXRDUk5JbnB1dCI+Q1JOIDxzcGFuIGNsYXNzPSJyZXF1aXJlZCI+Kjwvc3Bhbj48L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIGlkPSJlZGl0Q1JOSW5wdXQiIHJlcXVpcmVkIG1heGxlbmd0aD0iMTAiIHBsYWNlaG9sZGVyPSJYWFhYWCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0iZWRpdFRpdGxlIj5Db3Vyc2UgVGl0bGUgPHNwYW4gY2xhc3M9InJlcXVpcmVkIj4qPC9zcGFuPjwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBpZD0iZWRpdFRpdGxlIiByZXF1aXJlZCBwbGFjZWhvbGRlcj0iSW50cm9kdWN0aW9uIHRvIEdlb2dyYXBoeSI+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tcm93Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJlZGl0Q3JlZGl0cyI+Q3JlZGl0cyA8c3BhbiBjbGFzcz0icmVxdWlyZWQiPio8L3NwYW4+PC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJudW1iZXIiIGlkPSJlZGl0Q3JlZGl0cyIgcmVxdWlyZWQgc3RlcD0iMC4wMSIgbWluPSIwIiBtYXg9IjIwIiBwbGFjZWhvbGRlcj0iMy4wMCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9ImVkaXRJbnN0cnVjdG9yIj5JbnN0cnVjdG9yIDxzcGFuIGNsYXNzPSJyZXF1aXJlZCI+Kjwvc3Bhbj48L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIGlkPSJlZGl0SW5zdHJ1Y3RvciIgcmVxdWlyZWQgcGxhY2Vob2xkZXI9Ikxhc3QsIEYiIGxpc3Q9Imluc3RydWN0b3JMaXN0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkYXRhbGlzdCBpZD0iaW5zdHJ1Y3Rvckxpc3QiPjwvZGF0YWxpc3Q+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsPkRheXMgPHNwYW4gY2xhc3M9InJlcXVpcmVkIj4qPC9zcGFuPjwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImRheS1jaGVja2JveGVzIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbD48aW5wdXQgdHlwZT0iY2hlY2tib3giIG5hbWU9ImVkaXREYXkiIHZhbHVlPSJNIj4gTW9uZGF5PC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbD48aW5wdXQgdHlwZT0iY2hlY2tib3giIG5hbWU9ImVkaXREYXkiIHZhbHVlPSJUIj4gVHVlc2RheTwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWw+PGlucHV0IHR5cGU9ImNoZWNrYm94IiBuYW1lPSJlZGl0RGF5IiB2YWx1ZT0iVyI+IFdlZG5lc2RheTwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWw+PGlucHV0IHR5cGU9ImNoZWNrYm94IiBuYW1lPSJlZGl0RGF5IiB2YWx1ZT0iUiI+IFRodXJzZGF5PC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbD48aW5wdXQgdHlwZT0iY2hlY2tib3giIG5hbWU9ImVkaXREYXkiIHZhbHVlPSJGIj4gRnJpZGF5PC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9ImRheXNFcnJvciIgY2xhc3M9ImVycm9yLW1lc3NhZ2UiIHN0eWxlPSJkaXNwbGF5OiBub25lOyI+UGxlYXNlIHNlbGVjdCBhdCBsZWFzdCBvbmUgZGF5PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tcm93Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJlZGl0U3RhcnRUaW1lIj5TdGFydCBUaW1lIDxzcGFuIGNsYXNzPSJyZXF1aXJlZCI+Kjwvc3Bhbj48L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNlbGVjdCBpZD0iZWRpdFN0YXJ0VGltZSIgcmVxdWlyZWQ+PC9zZWxlY3Q+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9ImVkaXRFbmRUaW1lIj5FbmQgVGltZSA8c3BhbiBjbGFzcz0icmVxdWlyZWQiPio8L3NwYW4+PC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzZWxlY3QgaWQ9ImVkaXRFbmRUaW1lIiByZXF1aXJlZD48L3NlbGVjdD4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0idGltZUVycm9yIiBjbGFzcz0iZXJyb3ItbWVzc2FnZSIgc3R5bGU9ImRpc3BsYXk6IG5vbmU7Ij5FbmQgdGltZSBtdXN0IGJlIGFmdGVyIHN0YXJ0IHRpbWU8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1yb3ciPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9ImVkaXRCdWlsZGluZyI+QnVpbGRpbmc8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIGlkPSJlZGl0QnVpbGRpbmciIHBsYWNlaG9sZGVyPSIxOTU3IEUiPgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJlZGl0Um9vbSI+Um9vbTwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0idGV4dCIgaWQ9ImVkaXRSb29tIiBwbGFjZWhvbGRlcj0iQjEyIj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPgogICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJlZGl0RGF0ZXMiPlNlbWVzdGVyIERhdGVzPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIGlkPSJlZGl0RGF0ZXMiIHBsYWNlaG9sZGVyPSIwMS8xMi8yNiAtIDA0LzI3LzI2Ij4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibW9kYWwtYWN0aW9ucyI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iYnRuLXNlY29uZGFyeSIgb25jbGljaz0iY2xvc2VFZGl0TW9kYWwoKSI+Q2FuY2VsPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iYnRuLWRhbmdlciIgaWQ9ImRlbGV0ZUNvdXJzZUJ0biIgb25jbGljaz0iZGVsZXRlQ291cnNlKCkiPvCfl5HvuI8gRGVsZXRlIENvdXJzZTwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9ImJ0bi1pbmZvIiBpZD0iZHVwbGljYXRlQ291cnNlQnRuIiBvbmNsaWNrPSJkdXBsaWNhdGVDb3Vyc2UoKSI+8J+TiyBEdXBsaWNhdGU8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiIGNsYXNzPSJidG4tcHJpbWFyeSI+8J+SviBTYXZlIENoYW5nZXM8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZm9ybT4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KCiAgICA8c2NyaXB0PgogICAgICAgIGNvbnN0IGNvdXJzZXMgPSBfX0NPVVJTRVNfREFUQV9QTEFDRUhPTERFUl9fOwogICAgICAgIGNvbnN0IGRheU1hcCA9IHsgJ00nOiAnbW9uZGF5JywgJ1QnOiAndHVlc2RheScsICdXJzogJ3dlZG5lc2RheScsICdSJzogJ3RodXJzZGF5JywgJ0YnOiAnZnJpZGF5JyB9OwogICAgICAgIGxldCBpbnN0cnVjdG9yQ29sb3JzID0ge307CiAgICAgICAgbGV0IHNlbGVjdGVkSW5zdHJ1Y3RvcnMgPSBuZXcgU2V0KCk7CiAgICAgICAgbGV0IGFjdGl2ZVRhYiA9ICdhbGwtY291cnNlcyc7CiAgICAgICAgbGV0IHNlbGVjdGVkRGF5ID0gbnVsbDsKICAgICAgICBsZXQgcm9vbUNvbmZsaWN0cyA9IFtdOwogICAgICAgIGxldCBsZXZlbEZpbHRlciA9ICdhbGwnOwoKICAgICAgICAvLyBFZGl0IG1vZGUgdmFyaWFibGVzCiAgICAgICAgbGV0IGVkaXRlZENvdXJzZXMgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGNvdXJzZXMpKTsgLy8gRGVlcCBjb3B5IGZvciBlZGl0aW5nCiAgICAgICAgbGV0IGVkaXRDb3VudCA9IDA7CiAgICAgICAgbGV0IGVkaXRlZENSTnMgPSBuZXcgU2V0KCk7CiAgICAgICAgbGV0IGlnbm9yZWRDb25mbGljdHMgPSBuZXcgU2V0KEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2lnbm9yZWRDb25mbGljdHMnKSB8fCAnW10nKSk7CiAgICAgICAgbGV0IGVkaXRJZ25vcmVkQ29uZmxpY3RzID0gbmV3IFNldChKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdlZGl0SWdub3JlZENvbmZsaWN0cycpIHx8ICdbXScpKTsKICAgICAgICBsZXQgY3VycmVudEVkaXRDUk4gPSBudWxsOwogICAgICAgIGxldCBlZGl0U2VsZWN0ZWRJbnN0cnVjdG9ycyA9IG5ldyBTZXQoKTsKICAgICAgICBsZXQgZWRpdFJvb21GaWx0ZXIgPSAnYWxsJzsKICAgICAgICBsZXQgZWRpdExldmVsRmlsdGVyID0gJ2FsbCc7CiAgICAgICAgbGV0IGlzSW1wb3J0aW5nID0gZmFsc2U7IC8vIEZsYWcgdG8gcHJldmVudCBtdWx0aXBsZSByZW5kZXJzIGR1cmluZyBpbXBvcnQKCiAgICAgICAgLy8gR2VuZXJhdGUgdW5pcXVlIGNvbG9yIGZvciBlYWNoIGluc3RydWN0b3IgdXNpbmcgSFNMCiAgICAgICAgZnVuY3Rpb24gZ2VuZXJhdGVJbnN0cnVjdG9yQ29sb3JzKCkgewogICAgICAgICAgICBjb25zdCBpbnN0cnVjdG9ycyA9IFsuLi5uZXcgU2V0KGNvdXJzZXMubWFwKGMgPT4gYy5pbnN0cnVjdG9yKSldLnNvcnQoKTsKICAgICAgICAgICAgY29uc3QgaHVlU3RlcCA9IDM2MCAvIGluc3RydWN0b3JzLmxlbmd0aDsKICAgICAgICAgICAgaW5zdHJ1Y3RvcnMuZm9yRWFjaCgoaW5zdHJ1Y3RvciwgaW5kZXgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGh1ZSA9IE1hdGguZmxvb3IoaW5kZXggKiBodWVTdGVwKTsKICAgICAgICAgICAgICAgIGNvbnN0IHNhdHVyYXRpb24gPSA2NSArIChpbmRleCAlIDMpICogMTA7IC8vIDY1JSwgNzUlLCBvciA4NSUKICAgICAgICAgICAgICAgIGNvbnN0IGxpZ2h0bmVzcyA9IDUwICsgKGluZGV4ICUgMikgKiAxMDsgIC8vIDUwJSBvciA2MCUKICAgICAgICAgICAgICAgIGluc3RydWN0b3JDb2xvcnNbaW5zdHJ1Y3Rvcl0gPSBgaHNsKCR7aHVlfSwgJHtzYXR1cmF0aW9ufSUsICR7bGlnaHRuZXNzfSUpYDsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBnZXRJbnN0cnVjdG9yQ29sb3IoaW5zdHJ1Y3RvcikgewogICAgICAgICAgICByZXR1cm4gaW5zdHJ1Y3RvckNvbG9yc1tpbnN0cnVjdG9yXSB8fCAnIzY2N2VlYSc7CiAgICAgICAgfQoKICAgICAgICAvLyBUYWIgc3dpdGNoaW5nCiAgICAgICAgZnVuY3Rpb24gc3dpdGNoVGFiKHRhYk5hbWUpIHsKICAgICAgICAgICAgYWN0aXZlVGFiID0gdGFiTmFtZTsKCiAgICAgICAgICAgIC8vIFVwZGF0ZSB0YWIgYnV0dG9ucwogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudGFiLWJ0bicpLmZvckVhY2goYnRuID0+IHsKICAgICAgICAgICAgICAgIGlmIChidG4uZ2V0QXR0cmlidXRlKCdkYXRhLXRhYicpID09PSB0YWJOYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgYnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBidG4uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gVXBkYXRlIHRhYiBjb250ZW50IHZpc2liaWxpdHkKICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnRhYi1jb250ZW50JykuZm9yRWFjaChjb250ZW50ID0+IHsKICAgICAgICAgICAgICAgIGNvbnRlbnQuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhYk5hbWUgKyAnLXRhYicpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwoKICAgICAgICAgICAgLy8gU2hvdy9oaWRlIG1haW4gY2FsZW5kYXIgZmlsdGVycyAoaGlkZSBpbiBlZGl0IG1vZGUsIHNob3cgb3RoZXJ3aXNlKQogICAgICAgICAgICBjb25zdCBtYWluRmlsdGVycyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluQ2FsZW5kYXJGaWx0ZXJzJyk7CiAgICAgICAgICAgIGlmIChtYWluRmlsdGVycykgewogICAgICAgICAgICAgICAgbWFpbkZpbHRlcnMuc3R5bGUuZGlzcGxheSA9IHRhYk5hbWUgPT09ICdlZGl0LXNjaGVkdWxlJyA/ICdub25lJyA6ICdmbGV4JzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gTG9hZCB0YWItc3BlY2lmaWMgY29udGVudAogICAgICAgICAgICBpZiAodGFiTmFtZSA9PT0gJ3BsYW5uaW5nLW1vZGUnKSB7CiAgICAgICAgICAgICAgICBnZW5lcmF0ZVBsYW5uaW5nTW9kZSgpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHRhYk5hbWUgPT09ICdyb29tLWNvbmZsaWN0cycpIHsKICAgICAgICAgICAgICAgIGRldGVjdEFuZERpc3BsYXlSb29tQ29uZmxpY3RzKCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGFiTmFtZSA9PT0gJ2VkaXQtc2NoZWR1bGUnKSB7CiAgICAgICAgICAgICAgICBpbml0aWFsaXplRWRpdE1vZGUoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gdGltZVRvTWludXRlcyh0aW1lU3RyKSB7CiAgICAgICAgICAgIGNvbnN0IG1hdGNoID0gdGltZVN0ci5tYXRjaCgvKFxkezEsMn0pOihcZHsyfSkoW0FQXU0pLyk7CiAgICAgICAgICAgIGlmICghbWF0Y2gpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ3RpbWVUb01pbnV0ZXM6IEZhaWxlZCB0byBwYXJzZSB0aW1lIHN0cmluZzonLCB0aW1lU3RyKTsKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxldCBob3VycyA9IHBhcnNlSW50KG1hdGNoWzFdKTsKICAgICAgICAgICAgY29uc3QgbWludXRlcyA9IHBhcnNlSW50KG1hdGNoWzJdKTsKICAgICAgICAgICAgY29uc3QgcGVyaW9kID0gbWF0Y2hbM107CiAgICAgICAgICAgIGlmIChwZXJpb2QgPT09ICdQTScgJiYgaG91cnMgIT09IDEyKSBob3VycyArPSAxMjsKICAgICAgICAgICAgaWYgKHBlcmlvZCA9PT0gJ0FNJyAmJiBob3VycyA9PT0gMTIpIGhvdXJzID0gMDsKICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gaG91cnMgKiA2MCArIG1pbnV0ZXM7CgogICAgICAgICAgICAvLyBEZWJ1ZyBsb2cgZm9yIGFueSBpbXBvcnRlZCBjb3Vyc2UgdGltZXMKICAgICAgICAgICAgaWYgKHRpbWVTdHIgPT09ICcxMTowMEFNJyB8fCB0aW1lU3RyID09PSAnMTI6NTBQTScgfHwgdGltZVN0ciA9PT0gJzA5OjAwQU0nIHx8IHRpbWVTdHIgPT09ICcxMDo1MEFNJykgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYHRpbWVUb01pbnV0ZXMoJyR7dGltZVN0cn0nKSA9ICR7cmVzdWx0fSAoaG91cnM9JHtob3Vyc30sIG1pbnV0ZXM9JHttaW51dGVzfSwgcGVyaW9kPSR7cGVyaW9kfSlgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CgogICAgICAgIC8vIEhlbHBlciBmdW5jdGlvbiB0byBleHRyYWN0IGNvdXJzZSBsZXZlbCBhbmQgZGV0ZXJtaW5lIGlmIGdyYWQvdW5kZXJncmFkCiAgICAgICAgZnVuY3Rpb24gZ2V0Q291cnNlTGV2ZWwoY291cnNlTnVtYmVyKSB7CiAgICAgICAgICAgIC8vIEV4dHJhY3QgdGhlIG51bWVyaWMgcGFydCBmcm9tIGNvdXJzZV9udW1iZXIgKGUuZy4sICJHRU9HIDEwMDEiIC0+IDEwMDEpCiAgICAgICAgICAgIGNvbnN0IG1hdGNoID0gY291cnNlTnVtYmVyLm1hdGNoKC9cZCsvKTsKICAgICAgICAgICAgaWYgKCFtYXRjaCkgcmV0dXJuIDA7CiAgICAgICAgICAgIGNvbnN0IGxldmVsID0gcGFyc2VJbnQobWF0Y2hbMF0pOwogICAgICAgICAgICByZXR1cm4gbGV2ZWw7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBpc0dyYWR1YXRlQ291cnNlKGNvdXJzZU51bWJlcikgewogICAgICAgICAgICBjb25zdCBsZXZlbCA9IGdldENvdXJzZUxldmVsKGNvdXJzZU51bWJlcik7CiAgICAgICAgICAgIHJldHVybiBsZXZlbCA+PSA2MDAwOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gY3JlYXRlVGltZVNsb3RzKCkgewogICAgICAgICAgICBjb25zdCB0aW1lQ29sdW1uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RpbWVDb2x1bW4nKTsKICAgICAgICAgICAgY29uc3Qgc3RhcnRIb3VyID0gOTsKICAgICAgICAgICAgY29uc3QgZW5kSG91ciA9IDIxOwogICAgICAgICAgICBmb3IgKGxldCBob3VyID0gc3RhcnRIb3VyOyBob3VyIDw9IGVuZEhvdXI7IGhvdXIrKykgewogICAgICAgICAgICAgICAgY29uc3QgdGltZVNsb3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgICAgIHRpbWVTbG90LmNsYXNzTmFtZSA9ICd0aW1lLXNsb3QnOwogICAgICAgICAgICAgICAgY29uc3QgZGlzcGxheUhvdXIgPSBob3VyID4gMTIgPyBob3VyIC0gMTIgOiAoaG91ciA9PT0gMCA/IDEyIDogaG91cik7CiAgICAgICAgICAgICAgICBjb25zdCBwZXJpb2QgPSBob3VyID49IDEyID8gJ1BNJyA6ICdBTSc7CiAgICAgICAgICAgICAgICB0aW1lU2xvdC50ZXh0Q29udGVudCA9IGAke2Rpc3BsYXlIb3VyfTowMCAke3BlcmlvZH1gOwogICAgICAgICAgICAgICAgdGltZUNvbHVtbi5hcHBlbmRDaGlsZCh0aW1lU2xvdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgWydtb25kYXknLCAndHVlc2RheScsICd3ZWRuZXNkYXknLCAndGh1cnNkYXknLCAnZnJpZGF5J10uZm9yRWFjaChkYXkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgZGF5Q29sdW1uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZGF5KTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IGVuZEhvdXIgLSBzdGFydEhvdXI7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGxpbmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgICAgICAgICBsaW5lLmNsYXNzTmFtZSA9ICdob3VyLWxpbmUnOwogICAgICAgICAgICAgICAgICAgIGxpbmUuc3R5bGUudG9wID0gYCR7aSAqIDYwfXB4YDsKICAgICAgICAgICAgICAgICAgICBkYXlDb2x1bW4uYXBwZW5kQ2hpbGQobGluZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gcmVuZGVyQ291cnNlcygpIHsKICAgICAgICAgICAgY29uc3Qgc3RhcnRIb3VyID0gOTsKICAgICAgICAgICAgY29uc3QgcGl4ZWxzUGVyTWludXRlID0gMTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvdGFsQ291cnNlcycpLnRleHRDb250ZW50ID0gY291cnNlcy5sZW5ndGg7CiAgICAgICAgICAgIGNvbnN0IGluc3RydWN0b3JzID0gbmV3IFNldChjb3Vyc2VzLm1hcChjID0+IGMuaW5zdHJ1Y3RvcikpOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG90YWxJbnN0cnVjdG9ycycpLnRleHRDb250ZW50ID0gaW5zdHJ1Y3RvcnMuc2l6ZTsKICAgICAgICAgICAgY29uc3QgY291cnNlc0J5RGF5ID0geyBtb25kYXk6IFtdLCB0dWVzZGF5OiBbXSwgd2VkbmVzZGF5OiBbXSwgdGh1cnNkYXk6IFtdLCBmcmlkYXk6IFtdIH07CiAgICAgICAgICAgIGNvdXJzZXMuZm9yRWFjaChjb3Vyc2UgPT4gewogICAgICAgICAgICAgICAgY291cnNlLmRheXMuc3BsaXQoJycpLmZvckVhY2goZGF5ID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXlJZCA9IGRheU1hcFtkYXldOwogICAgICAgICAgICAgICAgICAgIGlmIChkYXlJZCkgY291cnNlc0J5RGF5W2RheUlkXS5wdXNoKGNvdXJzZSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIE9iamVjdC5rZXlzKGNvdXJzZXNCeURheSkuZm9yRWFjaChkYXlJZCA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBkYXlDb2x1bW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChkYXlJZCk7CiAgICAgICAgICAgICAgICBjb25zdCBjb3Vyc2VzRm9yRGF5ID0gY291cnNlc0J5RGF5W2RheUlkXTsKICAgICAgICAgICAgICAgIGNvdXJzZXNGb3JEYXkuc29ydCgoYSwgYikgPT4gdGltZVRvTWludXRlcyhhLnRpbWUuc3RhcnQpIC0gdGltZVRvTWludXRlcyhiLnRpbWUuc3RhcnQpKTsKICAgICAgICAgICAgICAgIGNvbnN0IHByb2Nlc3NlZCA9IG5ldyBTZXQoKTsKICAgICAgICAgICAgICAgIGNvdXJzZXNGb3JEYXkuZm9yRWFjaCgoY291cnNlLCBpbmRleCkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChwcm9jZXNzZWQuaGFzKGluZGV4KSkgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0TWludXRlcyA9IHRpbWVUb01pbnV0ZXMoY291cnNlLnRpbWUuc3RhcnQpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGVuZE1pbnV0ZXMgPSB0aW1lVG9NaW51dGVzKGNvdXJzZS50aW1lLmVuZCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZHVyYXRpb24gPSBlbmRNaW51dGVzIC0gc3RhcnRNaW51dGVzOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRvcFBvc2l0aW9uID0gKHN0YXJ0TWludXRlcyAtIChzdGFydEhvdXIgKiA2MCkpICogcGl4ZWxzUGVyTWludXRlOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGhlaWdodCA9IGR1cmF0aW9uICogcGl4ZWxzUGVyTWludXRlOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IG92ZXJsYXBwaW5nID0gW107CiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IGluZGV4ICsgMTsgaSA8IGNvdXJzZXNGb3JEYXkubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByb2Nlc3NlZC5oYXMoaSkpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvdGhlciA9IGNvdXJzZXNGb3JEYXlbaV07CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG90aGVyU3RhcnQgPSB0aW1lVG9NaW51dGVzKG90aGVyLnRpbWUuc3RhcnQpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvdGhlckVuZCA9IHRpbWVUb01pbnV0ZXMob3RoZXIudGltZS5lbmQpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhcnRNaW51dGVzIDwgb3RoZXJFbmQgJiYgZW5kTWludXRlcyA+IG90aGVyU3RhcnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG92ZXJsYXBwaW5nLnB1c2goe2NvdXJzZTogb3RoZXIsIGluZGV4OiBpfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdG90YWxPdmVybGFwcGluZyA9IG92ZXJsYXBwaW5nLmxlbmd0aCArIDE7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgd2lkdGhQZXJjZW50ID0gMTAwIC8gdG90YWxPdmVybGFwcGluZzsKICAgICAgICAgICAgICAgICAgICByZW5kZXJDb3Vyc2VCbG9jayhjb3Vyc2UsIGRheUNvbHVtbiwgdG9wUG9zaXRpb24sIGhlaWdodCwgMCwgd2lkdGhQZXJjZW50KTsKICAgICAgICAgICAgICAgICAgICBwcm9jZXNzZWQuYWRkKGluZGV4KTsKICAgICAgICAgICAgICAgICAgICBvdmVybGFwcGluZy5mb3JFYWNoKChpdGVtLCBpKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG90aGVyU3RhcnRNaW51dGVzID0gdGltZVRvTWludXRlcyhpdGVtLmNvdXJzZS50aW1lLnN0YXJ0KTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3RoZXJFbmRNaW51dGVzID0gdGltZVRvTWludXRlcyhpdGVtLmNvdXJzZS50aW1lLmVuZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG90aGVyRHVyYXRpb24gPSBvdGhlckVuZE1pbnV0ZXMgLSBvdGhlclN0YXJ0TWludXRlczsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3RoZXJUb3BQb3NpdGlvbiA9IChvdGhlclN0YXJ0TWludXRlcyAtIChzdGFydEhvdXIgKiA2MCkpICogcGl4ZWxzUGVyTWludXRlOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvdGhlckhlaWdodCA9IG90aGVyRHVyYXRpb24gKiBwaXhlbHNQZXJNaW51dGU7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlbmRlckNvdXJzZUJsb2NrKGl0ZW0uY291cnNlLCBkYXlDb2x1bW4sIG90aGVyVG9wUG9zaXRpb24sIG90aGVySGVpZ2h0LCBpICsgMSwgd2lkdGhQZXJjZW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc2VkLmFkZChpdGVtLmluZGV4KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHJlbmRlckNvdXJzZUJsb2NrKGNvdXJzZSwgZGF5Q29sdW1uLCB0b3BQb3NpdGlvbiwgaGVpZ2h0LCBjb2x1bW4sIHdpZHRoUGVyY2VudCkgewogICAgICAgICAgICBjb25zdCBjb3Vyc2VCbG9jayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgICBjb3Vyc2VCbG9jay5jbGFzc05hbWUgPSAnY291cnNlLWJsb2NrJzsKICAgICAgICAgICAgY291cnNlQmxvY2suc3R5bGUudG9wID0gYCR7dG9wUG9zaXRpb259cHhgOwogICAgICAgICAgICBjb3Vyc2VCbG9jay5zdHlsZS5oZWlnaHQgPSBgJHtoZWlnaHR9cHhgOwogICAgICAgICAgICBjb3Vyc2VCbG9jay5zdHlsZS5sZWZ0ID0gYCR7Y29sdW1uICogd2lkdGhQZXJjZW50fSVgOwogICAgICAgICAgICBjb3Vyc2VCbG9jay5zdHlsZS53aWR0aCA9IGBjYWxjKCR7d2lkdGhQZXJjZW50fSUgLSA0cHgpYDsKCiAgICAgICAgICAgIC8vIFVzZSBpbnN0cnVjdG9yLXNwZWNpZmljIGNvbG9yCiAgICAgICAgICAgIGNvbnN0IGluc3RydWN0b3JDb2xvciA9IGdldEluc3RydWN0b3JDb2xvcihjb3Vyc2UuaW5zdHJ1Y3Rvcik7CiAgICAgICAgICAgIGNvdXJzZUJsb2NrLnN0eWxlLmJhY2tncm91bmQgPSBpbnN0cnVjdG9yQ29sb3I7CgogICAgICAgICAgICAvLyBDaGVjayBpZiB0aGlzIGNvdXJzZSBoYXMgYSByb29tIGNvbmZsaWN0IChhbmQgaXQncyBub3QgaWdub3JlZCkKICAgICAgICAgICAgY29uc3QgY291cnNlQ29uZmxpY3QgPSByb29tQ29uZmxpY3RzLmZpbmQoY29uZmxpY3QgPT4KICAgICAgICAgICAgICAgIGNvbmZsaWN0LmNvdXJzZXMuc29tZShjID0+IGMuY3JuID09PSBjb3Vyc2UuY3JuKQogICAgICAgICAgICApOwogICAgICAgICAgICBpZiAoY291cnNlQ29uZmxpY3QpIHsKICAgICAgICAgICAgICAgIC8vIEdlbmVyYXRlIHRoZSBjb25mbGljdCBzaWduYXR1cmUgdG8gY2hlY2sgaWYgaXQncyBpZ25vcmVkCiAgICAgICAgICAgICAgICBjb25zdCBjcm5zID0gY291cnNlQ29uZmxpY3QuY291cnNlcy5tYXAoYyA9PiBjLmNybikuc29ydCgpLmpvaW4oJy0nKTsKICAgICAgICAgICAgICAgIGNvbnN0IGNvbmZsaWN0U2lnID0gYCR7Y291cnNlQ29uZmxpY3Qucm9vbX1fJHtjb3Vyc2VDb25mbGljdC5jb3Vyc2VzWzBdLmRheXN9XyR7Y291cnNlQ29uZmxpY3QuY291cnNlc1swXS50aW1lLnN0YXJ0fV8ke2NybnN9YDsKICAgICAgICAgICAgICAgIGlmICghaWdub3JlZENvbmZsaWN0cy5oYXMoY29uZmxpY3RTaWcpKSB7CiAgICAgICAgICAgICAgICAgICAgY291cnNlQmxvY2suY2xhc3NMaXN0LmFkZCgnY29uZmxpY3QtaW5kaWNhdG9yJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvdXJzZUJsb2NrLmlubmVySFRNTCA9IGAKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvdXJzZS1udW1iZXIiPiR7Y291cnNlLmNvdXJzZV9udW1iZXJ9PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb3Vyc2UtbmFtZSI+JHtjb3Vyc2UudGl0bGV9PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb3Vyc2UtdGltZSI+JHtjb3Vyc2UudGltZS5zdGFydH08L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRvb2x0aXAiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRvb2x0aXAtcm93Ij48c3BhbiBjbGFzcz0idG9vbHRpcC1sYWJlbCI+Q291cnNlOjwvc3Bhbj48c3BhbiBjbGFzcz0idG9vbHRpcC12YWx1ZSI+JHtjb3Vyc2UuY291cnNlX251bWJlcn08L3NwYW4+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idG9vbHRpcC1yb3ciPjxzcGFuIGNsYXNzPSJ0b29sdGlwLWxhYmVsIj5JbnN0cnVjdG9yOjwvc3Bhbj48c3BhbiBjbGFzcz0idG9vbHRpcC12YWx1ZSI+JHtjb3Vyc2UuaW5zdHJ1Y3Rvcn08L3NwYW4+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idG9vbHRpcC1yb3ciPjxzcGFuIGNsYXNzPSJ0b29sdGlwLWxhYmVsIj5UaW1lOjwvc3Bhbj48c3BhbiBjbGFzcz0idG9vbHRpcC12YWx1ZSI+JHtjb3Vyc2UudGltZS5yYXd9PC9zcGFuPjwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRvb2x0aXAtcm93Ij48c3BhbiBjbGFzcz0idG9vbHRpcC1sYWJlbCI+TG9jYXRpb246PC9zcGFuPjxzcGFuIGNsYXNzPSJ0b29sdGlwLXZhbHVlIj4ke2NvdXJzZS5idWlsZGluZ30gJHtjb3Vyc2Uucm9vbX08L3NwYW4+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idG9vbHRpcC1yb3ciPjxzcGFuIGNsYXNzPSJ0b29sdGlwLWxhYmVsIj5DUk46PC9zcGFuPjxzcGFuIGNsYXNzPSJ0b29sdGlwLXZhbHVlIj4ke2NvdXJzZS5jcm59PC9zcGFuPjwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIGA7CiAgICAgICAgICAgIGNvdXJzZUJsb2NrLm9uY2xpY2sgPSAoKSA9PiBzaG93TW9kYWwoY291cnNlKTsKICAgICAgICAgICAgZGF5Q29sdW1uLmFwcGVuZENoaWxkKGNvdXJzZUJsb2NrKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHNob3dNb2RhbChjb3Vyc2UpIHsKICAgICAgICAgICAgY29uc3Qgc3RhdHVzQmFkZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RhdHVzQmFkZ2UnKTsKICAgICAgICAgICAgY29uc3Qgc3RhdHVzQ2xhc3MgPSBjb3Vyc2Uuc3RhdHVzID09PSAnT1BFTicgPyAnc3RhdHVzLW9wZW4nIDogJ3N0YXR1cy1jbG9zZWQnOwogICAgICAgICAgICBzdGF0dXNCYWRnZS5jbGFzc05hbWUgPSAnc3RhdHVzLWJhZGdlICcgKyBzdGF0dXNDbGFzczsKICAgICAgICAgICAgc3RhdHVzQmFkZ2UudGV4dENvbnRlbnQgPSBjb3Vyc2Uuc3RhdHVzOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kYWxDb3Vyc2VOdW1iZXInKS50ZXh0Q29udGVudCA9IGNvdXJzZS5jb3Vyc2VfbnVtYmVyOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kYWxDb3Vyc2VOYW1lJykudGV4dENvbnRlbnQgPSBjb3Vyc2UudGl0bGU7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbENSTicpLnRleHRDb250ZW50ID0gY291cnNlLmNybjsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGFsSW5zdHJ1Y3RvcicpLnRleHRDb250ZW50ID0gY291cnNlLmluc3RydWN0b3I7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbFRpbWUnKS50ZXh0Q29udGVudCA9IGNvdXJzZS50aW1lLnJhdzsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGFsRGF5cycpLnRleHRDb250ZW50ID0gZXhwYW5kRGF5cyhjb3Vyc2UuZGF5cyk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbEJ1aWxkaW5nJykudGV4dENvbnRlbnQgPSBjb3Vyc2UuYnVpbGRpbmc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbFJvb20nKS50ZXh0Q29udGVudCA9IGNvdXJzZS5yb29tOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kYWxDcmVkaXRzJykudGV4dENvbnRlbnQgPSBjb3Vyc2UuY3JlZGl0czsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGFsRGF0ZXMnKS50ZXh0Q29udGVudCA9IGNvdXJzZS5kYXRlczsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGFsJykuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBjbG9zZU1vZGFsKCkgewogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kYWwnKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZXhwYW5kRGF5cyhkYXlzKSB7CiAgICAgICAgICAgIGNvbnN0IGRheU5hbWVzID0geyAnTSc6ICdNb25kYXknLCAnVCc6ICdUdWVzZGF5JywgJ1cnOiAnV2VkbmVzZGF5JywgJ1InOiAnVGh1cnNkYXknLCAnRic6ICdGcmlkYXknIH07CiAgICAgICAgICAgIHJldHVybiBkYXlzLnNwbGl0KCcnKS5tYXAoZCA9PiBkYXlOYW1lc1tkXSkuam9pbignLCAnKTsKICAgICAgICB9CgogICAgICAgIC8vIEluc3RydWN0b3IgZHJvcGRvd24gZnVuY3Rpb25zCiAgICAgICAgZnVuY3Rpb24gcG9wdWxhdGVJbnN0cnVjdG9yTGlzdCgpIHsKICAgICAgICAgICAgY29uc3QgaW5zdHJ1Y3RvcnMgPSBbLi4ubmV3IFNldChjb3Vyc2VzLm1hcChjID0+IGMuaW5zdHJ1Y3RvcikpXS5zb3J0KCk7CiAgICAgICAgICAgIGNvbnN0IGluc3RydWN0b3JMaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2luc3RydWN0b3JMaXN0Jyk7CiAgICAgICAgICAgIGluc3RydWN0b3JMaXN0LmlubmVySFRNTCA9ICcnOwoKICAgICAgICAgICAgaW5zdHJ1Y3RvcnMuZm9yRWFjaChpbnN0cnVjdG9yID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgICAgIGl0ZW0uY2xhc3NOYW1lID0gJ2luc3RydWN0b3ItY2hlY2tib3gtaXRlbSc7CiAgICAgICAgICAgICAgICBjb25zdCBjaGVja2JveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7CiAgICAgICAgICAgICAgICBjaGVja2JveC50eXBlID0gJ2NoZWNrYm94JzsKICAgICAgICAgICAgICAgIGNoZWNrYm94LmlkID0gYGluc3RydWN0b3ItJHtpbnN0cnVjdG9yLnJlcGxhY2UoL1xzKy9nLCAnLScpfWA7CiAgICAgICAgICAgICAgICBjaGVja2JveC52YWx1ZSA9IGluc3RydWN0b3I7CiAgICAgICAgICAgICAgICBjaGVja2JveC5jaGVja2VkID0gc2VsZWN0ZWRJbnN0cnVjdG9ycy5zaXplID09PSAwIHx8IHNlbGVjdGVkSW5zdHJ1Y3RvcnMuaGFzKGluc3RydWN0b3IpOwogICAgICAgICAgICAgICAgY2hlY2tib3gub25jaGFuZ2UgPSAoKSA9PiB0b2dnbGVJbnN0cnVjdG9yU2VsZWN0aW9uKGluc3RydWN0b3IpOwoKICAgICAgICAgICAgICAgIGNvbnN0IGxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKTsKICAgICAgICAgICAgICAgIGxhYmVsLnNldEF0dHJpYnV0ZSgnZm9yJywgY2hlY2tib3guaWQpOwogICAgICAgICAgICAgICAgY29uc3QgY29sb3JJbmRpY2F0b3IgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CiAgICAgICAgICAgICAgICBjb2xvckluZGljYXRvci5jbGFzc05hbWUgPSAnaW5zdHJ1Y3Rvci1jb2xvci1pbmRpY2F0b3InOwogICAgICAgICAgICAgICAgY29sb3JJbmRpY2F0b3Iuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gZ2V0SW5zdHJ1Y3RvckNvbG9yKGluc3RydWN0b3IpOwogICAgICAgICAgICAgICAgbGFiZWwuYXBwZW5kQ2hpbGQoY29sb3JJbmRpY2F0b3IpOwogICAgICAgICAgICAgICAgbGFiZWwuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoaW5zdHJ1Y3RvcikpOwoKICAgICAgICAgICAgICAgIGl0ZW0uYXBwZW5kQ2hpbGQoY2hlY2tib3gpOwogICAgICAgICAgICAgICAgaXRlbS5hcHBlbmRDaGlsZChsYWJlbCk7CiAgICAgICAgICAgICAgICBpbnN0cnVjdG9yTGlzdC5hcHBlbmRDaGlsZChpdGVtKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiB0b2dnbGVJbnN0cnVjdG9yRHJvcGRvd24oKSB7CiAgICAgICAgICAgIGNvbnN0IGRyb3Bkb3duID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2luc3RydWN0b3JEcm9wZG93bicpOwogICAgICAgICAgICBkcm9wZG93bi5jbGFzc0xpc3QudG9nZ2xlKCdzaG93Jyk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiB0b2dnbGVJbnN0cnVjdG9yU2VsZWN0aW9uKGluc3RydWN0b3IpIHsKICAgICAgICAgICAgaWYgKHNlbGVjdGVkSW5zdHJ1Y3RvcnMuaGFzKGluc3RydWN0b3IpKSB7CiAgICAgICAgICAgICAgICBzZWxlY3RlZEluc3RydWN0b3JzLmRlbGV0ZShpbnN0cnVjdG9yKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHNlbGVjdGVkSW5zdHJ1Y3RvcnMuYWRkKGluc3RydWN0b3IpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHVwZGF0ZUluc3RydWN0b3JCdXR0b25UZXh0KCk7CiAgICAgICAgICAgIGFwcGx5RmlsdGVycygpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc2VsZWN0QWxsSW5zdHJ1Y3RvcnMoKSB7CiAgICAgICAgICAgIHNlbGVjdGVkSW5zdHJ1Y3RvcnMuY2xlYXIoKTsKICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnI2luc3RydWN0b3JMaXN0IGlucHV0W3R5cGU9ImNoZWNrYm94Il0nKS5mb3JFYWNoKGNiID0+IHsKICAgICAgICAgICAgICAgIGNiLmNoZWNrZWQgPSB0cnVlOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdXBkYXRlSW5zdHJ1Y3RvckJ1dHRvblRleHQoKTsKICAgICAgICAgICAgYXBwbHlGaWx0ZXJzKCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBjbGVhckFsbEluc3RydWN0b3JzKCkgewogICAgICAgICAgICBzZWxlY3RlZEluc3RydWN0b3JzLmNsZWFyKCk7CiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJyNpbnN0cnVjdG9yTGlzdCBpbnB1dFt0eXBlPSJjaGVja2JveCJdJykuZm9yRWFjaChjYiA9PiB7CiAgICAgICAgICAgICAgICBjYi5jaGVja2VkID0gZmFsc2U7CiAgICAgICAgICAgICAgICBzZWxlY3RlZEluc3RydWN0b3JzLmFkZChjYi52YWx1ZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAvLyBTdGFydCB3aXRoIG9uZSBpbnN0cnVjdG9yIHNlbGVjdGVkCiAgICAgICAgICAgIGNvbnN0IGZpcnN0Q2hlY2tib3ggPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjaW5zdHJ1Y3Rvckxpc3QgaW5wdXRbdHlwZT0iY2hlY2tib3giXScpOwogICAgICAgICAgICBpZiAoZmlyc3RDaGVja2JveCkgewogICAgICAgICAgICAgICAgZmlyc3RDaGVja2JveC5jaGVja2VkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHNlbGVjdGVkSW5zdHJ1Y3RvcnMuY2xlYXIoKTsKICAgICAgICAgICAgICAgIHNlbGVjdGVkSW5zdHJ1Y3RvcnMuYWRkKGZpcnN0Q2hlY2tib3gudmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHVwZGF0ZUluc3RydWN0b3JCdXR0b25UZXh0KCk7CiAgICAgICAgICAgIGFwcGx5RmlsdGVycygpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gdXBkYXRlSW5zdHJ1Y3RvckJ1dHRvblRleHQoKSB7CiAgICAgICAgICAgIGNvbnN0IGJ0blRleHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5zdHJ1Y3RvckJ0blRleHQnKTsKICAgICAgICAgICAgaWYgKHNlbGVjdGVkSW5zdHJ1Y3RvcnMuc2l6ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgYnRuVGV4dC50ZXh0Q29udGVudCA9ICdBbGwgSW5zdHJ1Y3RvcnMnOwogICAgICAgICAgICB9IGVsc2UgaWYgKHNlbGVjdGVkSW5zdHJ1Y3RvcnMuc2l6ZSA9PT0gMSkgewogICAgICAgICAgICAgICAgYnRuVGV4dC50ZXh0Q29udGVudCA9IEFycmF5LmZyb20oc2VsZWN0ZWRJbnN0cnVjdG9ycylbMF07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBidG5UZXh0LnRleHRDb250ZW50ID0gYCR7c2VsZWN0ZWRJbnN0cnVjdG9ycy5zaXplfSBJbnN0cnVjdG9yc2A7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIExldmVsIGZpbHRlciBkcm9wZG93biBmdW5jdGlvbnMKICAgICAgICBmdW5jdGlvbiB0b2dnbGVMZXZlbERyb3Bkb3duKCkgewogICAgICAgICAgICBjb25zdCBkcm9wZG93biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZXZlbERyb3Bkb3duJyk7CiAgICAgICAgICAgIGRyb3Bkb3duLmNsYXNzTGlzdC50b2dnbGUoJ3Nob3cnKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHNldExldmVsRmlsdGVyKGxldmVsKSB7CiAgICAgICAgICAgIGxldmVsRmlsdGVyID0gbGV2ZWw7CiAgICAgICAgICAgIGNvbnN0IGJ0blRleHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGV2ZWxCdG5UZXh0Jyk7CiAgICAgICAgICAgIGlmIChsZXZlbCA9PT0gJ2FsbCcpIHsKICAgICAgICAgICAgICAgIGJ0blRleHQudGV4dENvbnRlbnQgPSAnQWxsIExldmVscyc7CiAgICAgICAgICAgIH0gZWxzZSBpZiAobGV2ZWwgPT09ICd1bmRlcmdyYWQnKSB7CiAgICAgICAgICAgICAgICBidG5UZXh0LnRleHRDb250ZW50ID0gJ1VuZGVyZ3JhZCc7CiAgICAgICAgICAgIH0gZWxzZSBpZiAobGV2ZWwgPT09ICdncmFkJykgewogICAgICAgICAgICAgICAgYnRuVGV4dC50ZXh0Q29udGVudCA9ICdHcmFkJzsKICAgICAgICAgICAgfQogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGV2ZWxEcm9wZG93bicpLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTsKICAgICAgICAgICAgYXBwbHlGaWx0ZXJzKCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhcHBseUZpbHRlcnMoKSB7CiAgICAgICAgICAgIGNsZWFyQ2FsZW5kYXIoKTsKICAgICAgICAgICAgY29uc3QgZmlsdGVyZWRDb3Vyc2VzID0gY291cnNlcy5maWx0ZXIoY291cnNlID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGluc3RydWN0b3JNYXRjaCA9IHNlbGVjdGVkSW5zdHJ1Y3RvcnMuc2l6ZSA9PT0gMCB8fCBzZWxlY3RlZEluc3RydWN0b3JzLmhhcyhjb3Vyc2UuaW5zdHJ1Y3Rvcik7CgogICAgICAgICAgICAgICAgLy8gQXBwbHkgbGV2ZWwgZmlsdGVyCiAgICAgICAgICAgICAgICBsZXQgbGV2ZWxNYXRjaCA9IHRydWU7CiAgICAgICAgICAgICAgICBpZiAobGV2ZWxGaWx0ZXIgPT09ICd1bmRlcmdyYWQnKSB7CiAgICAgICAgICAgICAgICAgICAgbGV2ZWxNYXRjaCA9ICFpc0dyYWR1YXRlQ291cnNlKGNvdXJzZS5jb3Vyc2VfbnVtYmVyKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobGV2ZWxGaWx0ZXIgPT09ICdncmFkJykgewogICAgICAgICAgICAgICAgICAgIGxldmVsTWF0Y2ggPSBpc0dyYWR1YXRlQ291cnNlKGNvdXJzZS5jb3Vyc2VfbnVtYmVyKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gaW5zdHJ1Y3Rvck1hdGNoICYmIGxldmVsTWF0Y2g7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZW5kZXJDb3Vyc2VzRmlsdGVyZWQoZmlsdGVyZWRDb3Vyc2VzKTsKICAgICAgICAgICAgdXBkYXRlRmlsdGVyU3RhdHVzKCk7CiAgICAgICAgICAgIHVwZGF0ZUluc3RydWN0b3JMZWdlbmQoKTsKCiAgICAgICAgICAgIC8vIElmIGNsYXNzIGxpc3QgaXMgYWN0aXZlLCByZWdlbmVyYXRlIGl0IHdpdGggdGhlIGZpbHRlcmVkIGluc3RydWN0b3JzCiAgICAgICAgICAgIGlmIChhY3RpdmVUYWIgPT09ICdwbGFubmluZy1tb2RlJykgewogICAgICAgICAgICAgICAgZ2VuZXJhdGVQbGFubmluZ01vZGUoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gY2xlYXJDYWxlbmRhcigpIHsKICAgICAgICAgICAgWydtb25kYXknLCAndHVlc2RheScsICd3ZWRuZXNkYXknLCAndGh1cnNkYXknLCAnZnJpZGF5J10uZm9yRWFjaChkYXkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgZGF5Q29sdW1uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZGF5KTsKICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBvbmx5IGNvdXJzZSBibG9ja3MsIGtlZXAgaG91ciBsaW5lcwogICAgICAgICAgICAgICAgZGF5Q29sdW1uLnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb3Vyc2UtYmxvY2snKS5mb3JFYWNoKGJsb2NrID0+IGJsb2NrLnJlbW92ZSgpKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiByZW5kZXJDb3Vyc2VzRmlsdGVyZWQoY291cnNlc1RvUmVuZGVyKSB7CiAgICAgICAgICAgIGNvbnN0IHN0YXJ0SG91ciA9IDk7CiAgICAgICAgICAgIGNvbnN0IHBpeGVsc1Blck1pbnV0ZSA9IDE7CiAgICAgICAgICAgIGNvbnN0IGNvdXJzZXNCeURheSA9IHsgbW9uZGF5OiBbXSwgdHVlc2RheTogW10sIHdlZG5lc2RheTogW10sIHRodXJzZGF5OiBbXSwgZnJpZGF5OiBbXSB9OwoKICAgICAgICAgICAgY291cnNlc1RvUmVuZGVyLmZvckVhY2goY291cnNlID0+IHsKICAgICAgICAgICAgICAgIGNvdXJzZS5kYXlzLnNwbGl0KCcnKS5mb3JFYWNoKGRheSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF5SWQgPSBkYXlNYXBbZGF5XTsKICAgICAgICAgICAgICAgICAgICBpZiAoZGF5SWQpIGNvdXJzZXNCeURheVtkYXlJZF0ucHVzaChjb3Vyc2UpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgT2JqZWN0LmtleXMoY291cnNlc0J5RGF5KS5mb3JFYWNoKGRheUlkID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGRheUNvbHVtbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGRheUlkKTsKICAgICAgICAgICAgICAgIGNvbnN0IGNvdXJzZXNGb3JEYXkgPSBjb3Vyc2VzQnlEYXlbZGF5SWRdOwogICAgICAgICAgICAgICAgY291cnNlc0ZvckRheS5zb3J0KChhLCBiKSA9PiB0aW1lVG9NaW51dGVzKGEudGltZS5zdGFydCkgLSB0aW1lVG9NaW51dGVzKGIudGltZS5zdGFydCkpOwogICAgICAgICAgICAgICAgY29uc3QgcHJvY2Vzc2VkID0gbmV3IFNldCgpOwoKICAgICAgICAgICAgICAgIGNvdXJzZXNGb3JEYXkuZm9yRWFjaCgoY291cnNlLCBpbmRleCkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChwcm9jZXNzZWQuaGFzKGluZGV4KSkgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0TWludXRlcyA9IHRpbWVUb01pbnV0ZXMoY291cnNlLnRpbWUuc3RhcnQpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGVuZE1pbnV0ZXMgPSB0aW1lVG9NaW51dGVzKGNvdXJzZS50aW1lLmVuZCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZHVyYXRpb24gPSBlbmRNaW51dGVzIC0gc3RhcnRNaW51dGVzOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRvcFBvc2l0aW9uID0gKHN0YXJ0TWludXRlcyAtIChzdGFydEhvdXIgKiA2MCkpICogcGl4ZWxzUGVyTWludXRlOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGhlaWdodCA9IGR1cmF0aW9uICogcGl4ZWxzUGVyTWludXRlOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IG92ZXJsYXBwaW5nID0gW107CgogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSBpbmRleCArIDE7IGkgPCBjb3Vyc2VzRm9yRGF5Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9jZXNzZWQuaGFzKGkpKSBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3RoZXIgPSBjb3Vyc2VzRm9yRGF5W2ldOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvdGhlclN0YXJ0ID0gdGltZVRvTWludXRlcyhvdGhlci50aW1lLnN0YXJ0KTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3RoZXJFbmQgPSB0aW1lVG9NaW51dGVzKG90aGVyLnRpbWUuZW5kKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXJ0TWludXRlcyA8IG90aGVyRW5kICYmIGVuZE1pbnV0ZXMgPiBvdGhlclN0YXJ0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdmVybGFwcGluZy5wdXNoKHtjb3Vyc2U6IG90aGVyLCBpbmRleDogaX0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBjb25zdCB0b3RhbE92ZXJsYXBwaW5nID0gb3ZlcmxhcHBpbmcubGVuZ3RoICsgMTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB3aWR0aFBlcmNlbnQgPSAxMDAgLyB0b3RhbE92ZXJsYXBwaW5nOwogICAgICAgICAgICAgICAgICAgIHJlbmRlckNvdXJzZUJsb2NrKGNvdXJzZSwgZGF5Q29sdW1uLCB0b3BQb3NpdGlvbiwgaGVpZ2h0LCAwLCB3aWR0aFBlcmNlbnQpOwogICAgICAgICAgICAgICAgICAgIHByb2Nlc3NlZC5hZGQoaW5kZXgpOwoKICAgICAgICAgICAgICAgICAgICBvdmVybGFwcGluZy5mb3JFYWNoKChpdGVtLCBpKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG90aGVyU3RhcnRNaW51dGVzID0gdGltZVRvTWludXRlcyhpdGVtLmNvdXJzZS50aW1lLnN0YXJ0KTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3RoZXJFbmRNaW51dGVzID0gdGltZVRvTWludXRlcyhpdGVtLmNvdXJzZS50aW1lLmVuZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG90aGVyRHVyYXRpb24gPSBvdGhlckVuZE1pbnV0ZXMgLSBvdGhlclN0YXJ0TWludXRlczsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3RoZXJUb3BQb3NpdGlvbiA9IChvdGhlclN0YXJ0TWludXRlcyAtIChzdGFydEhvdXIgKiA2MCkpICogcGl4ZWxzUGVyTWludXRlOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvdGhlckhlaWdodCA9IG90aGVyRHVyYXRpb24gKiBwaXhlbHNQZXJNaW51dGU7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlbmRlckNvdXJzZUJsb2NrKGl0ZW0uY291cnNlLCBkYXlDb2x1bW4sIG90aGVyVG9wUG9zaXRpb24sIG90aGVySGVpZ2h0LCBpICsgMSwgd2lkdGhQZXJjZW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc2VkLmFkZChpdGVtLmluZGV4KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUZpbHRlclN0YXR1cygpIHsKICAgICAgICAgICAgY29uc3QgZmlsdGVyU3RhdHVzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbHRlclN0YXR1cycpOwogICAgICAgICAgICBsZXQgc3RhdHVzUGFydHMgPSBbXTsKCiAgICAgICAgICAgIGlmIChzZWxlY3RlZERheSkgewogICAgICAgICAgICAgICAgY29uc3QgZGF5TmFtZXMgPSB7CiAgICAgICAgICAgICAgICAgICAgJ21vbmRheSc6ICdNb25kYXknLAogICAgICAgICAgICAgICAgICAgICd0dWVzZGF5JzogJ1R1ZXNkYXknLAogICAgICAgICAgICAgICAgICAgICd3ZWRuZXNkYXknOiAnV2VkbmVzZGF5JywKICAgICAgICAgICAgICAgICAgICAndGh1cnNkYXknOiAnVGh1cnNkYXknLAogICAgICAgICAgICAgICAgICAgICdmcmlkYXknOiAnRnJpZGF5JwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHN0YXR1c1BhcnRzLnB1c2goYCR7ZGF5TmFtZXNbc2VsZWN0ZWREYXldfSBvbmx5YCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzdGF0dXNQYXJ0cy5wdXNoKCdhbGwgZGF5cycpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBBZGQgbGV2ZWwgZmlsdGVyIHN0YXR1cwogICAgICAgICAgICBpZiAobGV2ZWxGaWx0ZXIgPT09ICd1bmRlcmdyYWQnKSB7CiAgICAgICAgICAgICAgICBzdGF0dXNQYXJ0cy5wdXNoKCd1bmRlcmdyYWQgb25seScpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGxldmVsRmlsdGVyID09PSAnZ3JhZCcpIHsKICAgICAgICAgICAgICAgIHN0YXR1c1BhcnRzLnB1c2goJ2dyYWQgb25seScpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc3RhdHVzUGFydHMucHVzaCgnYWxsIGxldmVscycpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoc2VsZWN0ZWRJbnN0cnVjdG9ycy5zaXplID09PSAwKSB7CiAgICAgICAgICAgICAgICBzdGF0dXNQYXJ0cy5wdXNoKCdhbGwgaW5zdHJ1Y3RvcnMnKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChzZWxlY3RlZEluc3RydWN0b3JzLnNpemUgPT09IDEpIHsKICAgICAgICAgICAgICAgIHN0YXR1c1BhcnRzLnB1c2goQXJyYXkuZnJvbShzZWxlY3RlZEluc3RydWN0b3JzKVswXSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzdGF0dXNQYXJ0cy5wdXNoKGAke3NlbGVjdGVkSW5zdHJ1Y3RvcnMuc2l6ZX0gaW5zdHJ1Y3RvcnNgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZmlsdGVyU3RhdHVzLnRleHRDb250ZW50ID0gYFNob3dpbmc6ICR7c3RhdHVzUGFydHMuam9pbignIHwgJyl9YDsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUluc3RydWN0b3JMZWdlbmQoKSB7CiAgICAgICAgICAgIGNvbnN0IGxlZ2VuZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnN0cnVjdG9yTGVnZW5kJyk7CiAgICAgICAgICAgIGlmICghbGVnZW5kKSByZXR1cm47CgogICAgICAgICAgICBjb25zdCBpbnN0cnVjdG9yc1RvU2hvdyA9IHNlbGVjdGVkSW5zdHJ1Y3RvcnMuc2l6ZSA9PT0gMAogICAgICAgICAgICAgICAgPyBbLi4ubmV3IFNldChjb3Vyc2VzLm1hcChjID0+IGMuaW5zdHJ1Y3RvcikpXS5zb3J0KCkKICAgICAgICAgICAgICAgIDogQXJyYXkuZnJvbShzZWxlY3RlZEluc3RydWN0b3JzKS5zb3J0KCk7CgogICAgICAgICAgICBsZXQgaHRtbCA9ICc8ZGl2IGNsYXNzPSJsZWdlbmQtdGl0bGUiPvCfkaUgSW5zdHJ1Y3RvciBDb2xvciBLZXk8L2Rpdj48ZGl2IGNsYXNzPSJsZWdlbmQtZ3JpZCI+JzsKICAgICAgICAgICAgaW5zdHJ1Y3RvcnNUb1Nob3cuZm9yRWFjaChpbnN0cnVjdG9yID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gZ2V0SW5zdHJ1Y3RvckNvbG9yKGluc3RydWN0b3IpOwogICAgICAgICAgICAgICAgaHRtbCArPSBgPGRpdiBjbGFzcz0ibGVnZW5kLWdyaWQtaXRlbSI+PHNwYW4gY2xhc3M9ImNvbG9yLWJveCIgc3R5bGU9ImJhY2tncm91bmQ6ICR7Y29sb3J9Ij48L3NwYW4+PHNwYW4+JHtpbnN0cnVjdG9yfTwvc3Bhbj48L2Rpdj5gOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaHRtbCArPSAnPC9kaXY+JzsKICAgICAgICAgICAgbGVnZW5kLmlubmVySFRNTCA9IGh0bWw7CiAgICAgICAgfQoKICAgICAgICAvLyBDbG9zZSBkcm9wZG93biB3aGVuIGNsaWNraW5nIG91dHNpZGUKICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgIC8vIENsb3NlIGluc3RydWN0b3IgZHJvcGRvd24KICAgICAgICAgICAgY29uc3QgZHJvcGRvd24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5zdHJ1Y3RvckRyb3Bkb3duJyk7CiAgICAgICAgICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnN0cnVjdG9yRHJvcGRvd25CdG4nKTsKICAgICAgICAgICAgaWYgKGRyb3Bkb3duICYmIGJ0biAmJiAhZHJvcGRvd24uY29udGFpbnMoZXZlbnQudGFyZ2V0KSAmJiAhYnRuLmNvbnRhaW5zKGV2ZW50LnRhcmdldCkpIHsKICAgICAgICAgICAgICAgIGRyb3Bkb3duLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQ2xvc2UgbGV2ZWwgZHJvcGRvd24KICAgICAgICAgICAgY29uc3QgbGV2ZWxEcm9wZG93biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZXZlbERyb3Bkb3duJyk7CiAgICAgICAgICAgIGNvbnN0IGxldmVsQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xldmVsRHJvcGRvd25CdG4nKTsKICAgICAgICAgICAgaWYgKGxldmVsRHJvcGRvd24gJiYgbGV2ZWxCdG4gJiYgIWxldmVsRHJvcGRvd24uY29udGFpbnMoZXZlbnQudGFyZ2V0KSAmJiAhbGV2ZWxCdG4uY29udGFpbnMoZXZlbnQudGFyZ2V0KSkgewogICAgICAgICAgICAgICAgbGV2ZWxEcm9wZG93bi5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgZnVuY3Rpb24gZmlsdGVyRGF5KGRheSkgewogICAgICAgICAgICBzZWxlY3RlZERheSA9IGRheTsKCiAgICAgICAgICAgIC8vIEhpZGUgYWxsIGRheSBjb2x1bW5zCiAgICAgICAgICAgIFsnbW9uZGF5JywgJ3R1ZXNkYXknLCAnd2VkbmVzZGF5JywgJ3RodXJzZGF5JywgJ2ZyaWRheSddLmZvckVhY2goZCA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBjb2wgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChkKTsKICAgICAgICAgICAgICAgIGlmIChkID09PSBkYXkpIHsKICAgICAgICAgICAgICAgICAgICBjb2wuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIFVwZGF0ZSBhY3RpdmUgc3RhdGUgb24gaGVhZGVycwogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZGF5LWhlYWRlcltkYXRhLWRheV0nKS5mb3JFYWNoKGhlYWRlciA9PiB7CiAgICAgICAgICAgICAgICBpZiAoaGVhZGVyLmdldEF0dHJpYnV0ZSgnZGF0YS1kYXknKSA9PT0gZGF5KSB7CiAgICAgICAgICAgICAgICAgICAgaGVhZGVyLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBoZWFkZXIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gQWRqdXN0IGNhbGVuZGFyIGxheW91dCBmb3Igc2luZ2xlIGRheSB2aWV3CiAgICAgICAgICAgIGNvbnN0IGNhbGVuZGFyQm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jYWxlbmRhci1ib2R5Jyk7CiAgICAgICAgICAgIGNvbnN0IGNhbGVuZGFySGVhZGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNhbGVuZGFyLWhlYWRlcicpOwogICAgICAgICAgICBjYWxlbmRhckJvZHkuc3R5bGUuZ3JpZFRlbXBsYXRlQ29sdW1ucyA9ICc4MHB4IDFmcic7CiAgICAgICAgICAgIGNhbGVuZGFySGVhZGVyLnN0eWxlLmdyaWRUZW1wbGF0ZUNvbHVtbnMgPSAnODBweCAxZnInOwoKICAgICAgICAgICAgdXBkYXRlRmlsdGVyU3RhdHVzKCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzaG93QWxsRGF5cygpIHsKICAgICAgICAgICAgc2VsZWN0ZWREYXkgPSBudWxsOwoKICAgICAgICAgICAgLy8gU2hvdyBhbGwgZGF5IGNvbHVtbnMKICAgICAgICAgICAgWydtb25kYXknLCAndHVlc2RheScsICd3ZWRuZXNkYXknLCAndGh1cnNkYXknLCAnZnJpZGF5J10uZm9yRWFjaChkID0+IHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGQpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIFJlbW92ZSBhY3RpdmUgc3RhdGUgZnJvbSBhbGwgaGVhZGVycwogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZGF5LWhlYWRlcltkYXRhLWRheV0nKS5mb3JFYWNoKGhlYWRlciA9PiB7CiAgICAgICAgICAgICAgICBoZWFkZXIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gUmVzdG9yZSBjYWxlbmRhciBsYXlvdXQKICAgICAgICAgICAgY29uc3QgY2FsZW5kYXJCb2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNhbGVuZGFyLWJvZHknKTsKICAgICAgICAgICAgY29uc3QgY2FsZW5kYXJIZWFkZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2FsZW5kYXItaGVhZGVyJyk7CiAgICAgICAgICAgIGNhbGVuZGFyQm9keS5zdHlsZS5ncmlkVGVtcGxhdGVDb2x1bW5zID0gJzgwcHggcmVwZWF0KDUsIG1pbm1heCgxODBweCwgMWZyKSknOwogICAgICAgICAgICBjYWxlbmRhckhlYWRlci5zdHlsZS5ncmlkVGVtcGxhdGVDb2x1bW5zID0gJzgwcHggcmVwZWF0KDUsIG1pbm1heCgxODBweCwgMWZyKSknOwoKICAgICAgICAgICAgdXBkYXRlRmlsdGVyU3RhdHVzKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBSb29tIGNvbmZsaWN0IGRldGVjdGlvbgogICAgICAgIGZ1bmN0aW9uIGRldGVjdFJvb21Db25mbGljdHMoKSB7CiAgICAgICAgICAgIHJvb21Db25mbGljdHMgPSBbXTsKICAgICAgICAgICAgY29uc3Qgcm9vbUdyb3VwcyA9IHt9OwoKICAgICAgICAgICAgLy8gTm9ybWFsaXplIHJvb20ga2V5IGZvciBjb25zaXN0ZW50IG1hdGNoaW5nCiAgICAgICAgICAgIGZ1bmN0aW9uIG5vcm1hbGl6ZVJvb21LZXkoYnVpbGRpbmcsIHJvb20pIHsKICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBleHRyYSBzcGFjZXMsIGNvbnZlcnQgdG8gdXBwZXJjYXNlIGZvciBjb25zaXN0ZW5jeQogICAgICAgICAgICAgICAgY29uc3Qgbm9ybUJ1aWxkaW5nID0gYnVpbGRpbmcucmVwbGFjZSgvXHMrL2csICcgJykudHJpbSgpLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICAgICAgICBjb25zdCBub3JtUm9vbSA9IHJvb20ucmVwbGFjZSgvXHMrL2csICcgJykudHJpbSgpLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gYCR7bm9ybUJ1aWxkaW5nfXwke25vcm1Sb29tfWA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEdyb3VwIGNvdXJzZXMgYnkgcm9vbQogICAgICAgICAgICBjb3Vyc2VzLmZvckVhY2goY291cnNlID0+IHsKICAgICAgICAgICAgICAgIGlmIChjb3Vyc2UuYnVpbGRpbmcgPT09ICdOb3Qgc3BlY2lmaWVkJyB8fCBjb3Vyc2Uucm9vbSA9PT0gJ05vdCBzcGVjaWZpZWQnKSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCByb29tS2V5ID0gbm9ybWFsaXplUm9vbUtleShjb3Vyc2UuYnVpbGRpbmcsIGNvdXJzZS5yb29tKTsKICAgICAgICAgICAgICAgIGlmICghcm9vbUdyb3Vwc1tyb29tS2V5XSkgewogICAgICAgICAgICAgICAgICAgIHJvb21Hcm91cHNbcm9vbUtleV0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiBgJHtjb3Vyc2UuYnVpbGRpbmd9ICR7Y291cnNlLnJvb219YCwKICAgICAgICAgICAgICAgICAgICAgICAgY291cnNlczogW10KICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcm9vbUdyb3Vwc1tyb29tS2V5XS5jb3Vyc2VzLnB1c2goY291cnNlKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBDaGVjayBmb3Igb3ZlcmxhcHMgd2l0aGluIGVhY2ggcm9vbQogICAgICAgICAgICBjb25zb2xlLmxvZyhg8J+TiyBDaGVja2luZyAke09iamVjdC5rZXlzKHJvb21Hcm91cHMpLmxlbmd0aH0gcm9vbXMgZm9yIGNvbmZsaWN0cy4uLmApOwogICAgICAgICAgICBPYmplY3Qua2V5cyhyb29tR3JvdXBzKS5mb3JFYWNoKHJvb21LZXkgPT4gewogICAgICAgICAgICAgICAgY29uc3Qgcm9vbURhdGEgPSByb29tR3JvdXBzW3Jvb21LZXldOwogICAgICAgICAgICAgICAgY29uc3Qgcm9vbUNvdXJzZXMgPSByb29tRGF0YS5jb3Vyc2VzOwoKICAgICAgICAgICAgICAgIC8vIExvZyByb29tcyB3aXRoIG11bHRpcGxlIGNvdXJzZXMKICAgICAgICAgICAgICAgIGlmIChyb29tQ291cnNlcy5sZW5ndGggPj0gMikgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGAgIFJvb206ICR7cm9vbURhdGEuZGlzcGxheU5hbWV9IGhhcyAke3Jvb21Db3Vyc2VzLmxlbmd0aH0gY291cnNlc2ApOwogICAgICAgICAgICAgICAgICAgIHJvb21Db3Vyc2VzLmZvckVhY2goYyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGAgICAgLSAke2MuY291cnNlX251bWJlcn0gKCR7Yy5pbnN0cnVjdG9yfSkgJHtjLmRheXN9ICR7Yy50aW1lLnJhd31gKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAocm9vbUNvdXJzZXMubGVuZ3RoIDwgMikgcmV0dXJuOwoKICAgICAgICAgICAgICAgIGNvbnN0IGNvbmZsaWN0cyA9IFtdOwogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByb29tQ291cnNlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSBpICsgMTsgaiA8IHJvb21Db3Vyc2VzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvdXJzZTEgPSByb29tQ291cnNlc1tpXTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY291cnNlMiA9IHJvb21Db3Vyc2VzW2pdOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhleSBzaGFyZSBhbnkgZGF5cwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXlzMSA9IGNvdXJzZTEuZGF5cy5zcGxpdCgnJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRheXMyID0gY291cnNlMi5kYXlzLnNwbGl0KCcnKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2hhcmVkRGF5cyA9IGRheXMxLmZpbHRlcihkID0+IGRheXMyLmluY2x1ZGVzKGQpKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzaGFyZWREYXlzLmxlbmd0aCA9PT0gMCkgY29udGludWU7CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBTa2lwIGNyb3NzLWxpc3RlZCBjb3Vyc2VzIChzYW1lIHRpdGxlLCB0aW1lLCBpbnN0cnVjdG9yLCBkYXlzKQogICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGVzZSBhcmUgaW50ZW50aW9uYWxseSBzY2hlZHVsZWQgdG9nZXRoZXIKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvdXJzZTEudGl0bGUgPT09IGNvdXJzZTIudGl0bGUgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZTEudGltZS5zdGFydCA9PT0gY291cnNlMi50aW1lLnN0YXJ0ICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3Vyc2UxLnRpbWUuZW5kID09PSBjb3Vyc2UyLnRpbWUuZW5kICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3Vyc2UxLmluc3RydWN0b3IgPT09IGNvdXJzZTIuaW5zdHJ1Y3RvciAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY291cnNlMS5kYXlzID09PSBjb3Vyc2UyLmRheXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiB0aW1lcyBvdmVybGFwCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0MSA9IHRpbWVUb01pbnV0ZXMoY291cnNlMS50aW1lLnN0YXJ0KTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZW5kMSA9IHRpbWVUb01pbnV0ZXMoY291cnNlMS50aW1lLmVuZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0MiA9IHRpbWVUb01pbnV0ZXMoY291cnNlMi50aW1lLnN0YXJ0KTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZW5kMiA9IHRpbWVUb01pbnV0ZXMoY291cnNlMi50aW1lLmVuZCk7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhcnQxIDwgZW5kMiAmJiBlbmQxID4gc3RhcnQyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBoYXZlIGEgY29uZmxpY3QKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nQ29uZmxpY3QgPSBjb25mbGljdHMuZmluZChjID0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYy5jb3Vyc2VzLnNvbWUoY28gPT4gY28uY3JuID09PSBjb3Vyc2UxLmNybiB8fCBjby5jcm4gPT09IGNvdXJzZTIuY3JuKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXhpc3RpbmdDb25mbGljdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZXhpc3RpbmdDb25mbGljdC5jb3Vyc2VzLnNvbWUoYyA9PiBjLmNybiA9PT0gY291cnNlMS5jcm4pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4aXN0aW5nQ29uZmxpY3QuY291cnNlcy5wdXNoKGNvdXJzZTEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWV4aXN0aW5nQ29uZmxpY3QuY291cnNlcy5zb21lKGMgPT4gYy5jcm4gPT09IGNvdXJzZTIuY3JuKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGlzdGluZ0NvbmZsaWN0LmNvdXJzZXMucHVzaChjb3Vyc2UyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZsaWN0cy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm9vbTogcm9vbURhdGEuZGlzcGxheU5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZXM6IFtjb3Vyc2UxLCBjb3Vyc2UyXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hhcmVkRGF5czogc2hhcmVkRGF5cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJvb21Db25mbGljdHMucHVzaCguLi5jb25mbGljdHMpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIExvZyBkZXRlY3RlZCBjb25mbGljdHMgZm9yIGRlYnVnZ2luZwogICAgICAgICAgICBjb25zb2xlLmxvZyhg8J+UjSBSb29tIENvbmZsaWN0IERldGVjdGlvbjogRm91bmQgJHtyb29tQ29uZmxpY3RzLmxlbmd0aH0gY29uZmxpY3QgZ3JvdXAocylgKTsKICAgICAgICAgICAgcm9vbUNvbmZsaWN0cy5mb3JFYWNoKChjb25mbGljdCwgaW5kZXgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGAgIENvbmZsaWN0ICR7aW5kZXggKyAxfTogJHtjb25mbGljdC5yb29tfSAtICR7Y29uZmxpY3QuY291cnNlcy5sZW5ndGh9IGNvdXJzZXNgKTsKICAgICAgICAgICAgICAgIGNvbmZsaWN0LmNvdXJzZXMuZm9yRWFjaChjID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgICAgIC0gJHtjLmNvdXJzZV9udW1iZXJ9ICgke2MuaW5zdHJ1Y3Rvcn0pICR7Yy5kYXlzfSAke2MudGltZS5yYXd9YCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICByZXR1cm4gcm9vbUNvbmZsaWN0czsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGRldGVjdEFuZERpc3BsYXlSb29tQ29uZmxpY3RzKCkgewogICAgICAgICAgICBjb25zdCBjb25mbGljdHMgPSBkZXRlY3RSb29tQ29uZmxpY3RzKCk7CiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25mbGljdHNDb250ZW50Jyk7CgogICAgICAgICAgICAvLyBGaW5kIGNvdXJzZXMgd2l0aCB1bnNwZWNpZmllZCByb29tcwogICAgICAgICAgICBjb25zdCB1bnNwZWNpZmllZFJvb21zID0gY291cnNlcy5maWx0ZXIoYyA9PgogICAgICAgICAgICAgICAgYy5yb29tLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ25vdCBzcGVjaWZpZWQnKSB8fAogICAgICAgICAgICAgICAgYy5yb29tLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ3RiZCcpIHx8CiAgICAgICAgICAgICAgICBjLnJvb20udG9Mb3dlckNhc2UoKS5pbmNsdWRlcygndGJhJykgfHwKICAgICAgICAgICAgICAgIGMucm9vbS50cmltKCkgPT09ICcnCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBsZXQgaHRtbCA9ICcnOwoKICAgICAgICAgICAgLy8gRGlzcGxheSB1bnNwZWNpZmllZCByb29tcyBzZWN0aW9uCiAgICAgICAgICAgIGlmICh1bnNwZWNpZmllZFJvb21zLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIGh0bWwgKz0gYDxkaXYgc3R5bGU9Im1hcmdpbi1ib3R0b206IDI1cHg7IHBhZGRpbmc6IDE4cHg7IGJhY2tncm91bmQtY29sb3I6ICNlM2YyZmQ7IGJvcmRlci1sZWZ0OiA0cHggc29saWQgIzI5ODBiOTsgYm9yZGVyLXJhZGl1czogOHB4OyI+CiAgICAgICAgICAgICAgICAgICAgPHN0cm9uZz7wn5OLIEZvdW5kICR7dW5zcGVjaWZpZWRSb29tcy5sZW5ndGh9IGNvdXJzZSR7dW5zcGVjaWZpZWRSb29tcy5sZW5ndGggPiAxID8gJ3MnIDogJyd9IHdpdGggdW5zcGVjaWZpZWQgcm9vbXM8L3N0cm9uZz4KICAgICAgICAgICAgICAgICAgICA8cCBzdHlsZT0ibWFyZ2luLXRvcDogOHB4OyBjb2xvcjogIzVmNjM2ODsgZm9udC1zaXplOiAxNHB4OyI+VGhlIGZvbGxvd2luZyBjb3Vyc2VzIGRvIG5vdCBoYXZlIHJvb20gYXNzaWdubWVudHM6PC9wPgogICAgICAgICAgICAgICAgPC9kaXY+YDsKCiAgICAgICAgICAgICAgICBodG1sICs9IGA8ZGl2IHN0eWxlPSJtYXJnaW4tYm90dG9tOiAzMHB4OyBwYWRkaW5nOiAyMHB4OyBiYWNrZ3JvdW5kLWNvbG9yOiAjZjhmOWZhOyBib3JkZXItcmFkaXVzOiA4cHg7IGJvcmRlci1sZWZ0OiA0cHggc29saWQgIzI5ODBiOTsiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTogMTZweDsgZm9udC13ZWlnaHQ6IDcwMDsgY29sb3I6ICMyMDIxMjQ7IG1hcmdpbi1ib3R0b206IDE1cHg7IGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGdhcDogMTBweDsiPgogICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj7wn5ONIFVuc3BlY2lmaWVkIFJvb21zPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBzdHlsZT0iZGlzcGxheTogaW5saW5lLWJsb2NrOyBwYWRkaW5nOiAzcHggMTBweDsgYmFja2dyb3VuZC1jb2xvcjogIzI5ODBiOTsgY29sb3I6IHdoaXRlOyBib3JkZXItcmFkaXVzOiAxMnB4OyBmb250LXNpemU6IDExcHg7IGZvbnQtd2VpZ2h0OiA3MDA7Ij4ke3Vuc3BlY2lmaWVkUm9vbXMubGVuZ3RofSBDT1VSU0VTPC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6IGdyaWQ7IGdhcDogMTJweDsiPmA7CgogICAgICAgICAgICAgICAgdW5zcGVjaWZpZWRSb29tcy5mb3JFYWNoKGNvdXJzZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF5c0V4cGFuZGVkID0gZXhwYW5kRGF5cyhjb3Vyc2UuZGF5cyk7CiAgICAgICAgICAgICAgICAgICAgaHRtbCArPSBgPGRpdiBzdHlsZT0icGFkZGluZzogMTJweCAxNXB4OyBiYWNrZ3JvdW5kLWNvbG9yOiB3aGl0ZTsgYm9yZGVyLXJhZGl1czogNnB4OyBib3JkZXItbGVmdDogM3B4IHNvbGlkICMyOTgwYjk7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZm9udC13ZWlnaHQ6IDYwMDsgY29sb3I6ICMyMDIxMjQ7IG1hcmdpbi1ib3R0b206IDVweDsiPiR7Y291cnNlLmNvdXJzZV9udW1iZXJ9IC0gJHtjb3Vyc2UudGl0bGV9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTogMTNweDsgY29sb3I6ICM1ZjYzNjg7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzdHJvbmc+Q1JOOjwvc3Ryb25nPiAke2NvdXJzZS5jcm59IHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzdHJvbmc+SW5zdHJ1Y3Rvcjo8L3N0cm9uZz4gJHtjb3Vyc2UuaW5zdHJ1Y3Rvcn08YnI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Ryb25nPlRpbWU6PC9zdHJvbmc+ICR7Y291cnNlLnRpbWUucmF3fSB8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Ryb25nPkRheXM6PC9zdHJvbmc+ICR7ZGF5c0V4cGFuZGVkfSB8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Ryb25nPlJvb206PC9zdHJvbmc+ICR7Y291cnNlLnJvb219CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBodG1sICs9IGA8L2Rpdj48L2Rpdj5gOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBEaXNwbGF5IHJvb20gY29uZmxpY3RzCiAgICAgICAgICAgIGlmIChjb25mbGljdHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICBpZiAodW5zcGVjaWZpZWRSb29tcy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgICAgICBodG1sID0gJzxkaXYgY2xhc3M9Im5vLWNvbmZsaWN0cyI+4pyFIE5vIHJvb20gY29uZmxpY3RzIGRldGVjdGVkISBBbGwgY291cnNlcyBhcmUgc2NoZWR1bGVkIHdpdGhvdXQgb3ZlcmxhcC48L2Rpdj4nOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBodG1sICs9ICc8ZGl2IGNsYXNzPSJuby1jb25mbGljdHMiPuKchSBObyByb29tIGNvbmZsaWN0cyBkZXRlY3RlZCBmb3IgYXNzaWduZWQgcm9vbXMuPC9kaXY+JzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSBodG1sOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBodG1sICs9IGA8ZGl2IHN0eWxlPSJtYXJnaW4tYm90dG9tOiAyMHB4OyBwYWRkaW5nOiAxNXB4OyBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmM2NkOyBib3JkZXItbGVmdDogNHB4IHNvbGlkICNmZjZiNmI7IGJvcmRlci1yYWRpdXM6IDZweDsiPgogICAgICAgICAgICAgICAgPHN0cm9uZz7imqDvuI8gRm91bmQgJHtjb25mbGljdHMubGVuZ3RofSByb29tIGNvbmZsaWN0JHtjb25mbGljdHMubGVuZ3RoID4gMSA/ICdzJyA6ICcnfTwvc3Ryb25nPgogICAgICAgICAgICAgICAgPHAgc3R5bGU9Im1hcmdpbi10b3A6IDhweDsgY29sb3I6ICM1ZjYzNjg7IGZvbnQtc2l6ZTogMTRweDsiPlRoZSBmb2xsb3dpbmcgcm9vbXMgaGF2ZSBtdWx0aXBsZSBjb3Vyc2VzIHNjaGVkdWxlZCBhdCBvdmVybGFwcGluZyB0aW1lczo8L3A+CiAgICAgICAgICAgIDwvZGl2PmA7CgogICAgICAgICAgICBjb25mbGljdHMuZm9yRWFjaCgoY29uZmxpY3QsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICAvLyBHZW5lcmF0ZSBjb25mbGljdCBzaWduYXR1cmUgZm9yIHBlcnNpc3RlbmNlCiAgICAgICAgICAgICAgICBjb25zdCBjcm5zID0gY29uZmxpY3QuY291cnNlcy5tYXAoYyA9PiBjLmNybikuc29ydCgpLmpvaW4oJy0nKTsKICAgICAgICAgICAgICAgIGNvbnN0IGNvbmZsaWN0U2lnID0gYCR7Y29uZmxpY3Qucm9vbX1fJHtjb25mbGljdC5jb3Vyc2VzWzBdLmRheXN9XyR7Y29uZmxpY3QuY291cnNlc1swXS50aW1lLnN0YXJ0fV8ke2NybnN9YDsKICAgICAgICAgICAgICAgIGNvbnN0IGlzSWdub3JlZCA9IGlnbm9yZWRDb25mbGljdHMuaGFzKGNvbmZsaWN0U2lnKTsKCiAgICAgICAgICAgICAgICBodG1sICs9IGA8ZGl2IGNsYXNzPSJjb25mbGljdC1ncm91cCR7aXNJZ25vcmVkID8gJyBjb25mbGljdC1oaWRkZW4nIDogJyd9IiBpZD0iY29uZmxpY3QtJHtpbmRleH0iIGRhdGEtc2lnbmF0dXJlPSIke2NvbmZsaWN0U2lnfSI+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iY29uZmxpY3QtaWdub3JlLWJ0biIgb25jbGljaz0idG9nZ2xlSWdub3JlQ29uZmxpY3QoJyR7Y29uZmxpY3RTaWd9JywgJHtpbmRleH0pIj4KICAgICAgICAgICAgICAgICAgICAgICAgJHtpc0lnbm9yZWQgPyAn4oa2IFNob3cnIDogJ+KclSBJZ25vcmUnfQogICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbmZsaWN0LWhlYWRlciI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPvCfk40gJHtjb25mbGljdC5yb29tfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImNvbmZsaWN0LXNldmVyaXR5Ij4ke2NvbmZsaWN0LmNvdXJzZXMubGVuZ3RofSBDT1VSU0VTPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAke2lzSWdub3JlZCA/ICc8c3BhbiBzdHlsZT0ibWFyZ2luLWxlZnQ6IDEwcHg7IGZvbnQtc2l6ZTogMTJweDsgY29sb3I6ICM2NjY7Ij4oUHJldmlvdXNseSBJZ25vcmVkKTwvc3Bhbj4nIDogJyd9CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPHAgc3R5bGU9ImNvbG9yOiAjNzIxYzI0OyBmb250LXNpemU6IDEzcHg7IG1hcmdpbjogMTBweCAwOyI+VGhlc2UgY291cnNlcyBhcmUgc2NoZWR1bGVkIGluIHRoZSBzYW1lIHJvb20gYXQgb3ZlcmxhcHBpbmcgdGltZXM6PC9wPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbmZsaWN0LWNvdXJzZXMiPmA7CgogICAgICAgICAgICAgICAgY29uZmxpY3QuY291cnNlcy5mb3JFYWNoKGNvdXJzZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF5c0V4cGFuZGVkID0gZXhwYW5kRGF5cyhjb3Vyc2UuZGF5cyk7CiAgICAgICAgICAgICAgICAgICAgaHRtbCArPSBgPGRpdiBjbGFzcz0iY29uZmxpY3QtY291cnNlLWl0ZW0iPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb25mbGljdC1jb3Vyc2UtaGVhZGVyIj4ke2NvdXJzZS5jb3Vyc2VfbnVtYmVyfSAtICR7Y291cnNlLnRpdGxlfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb25mbGljdC1jb3Vyc2UtZGV0YWlscyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Ryb25nPkNSTjo8L3N0cm9uZz4gJHtjb3Vyc2UuY3JufSB8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Ryb25nPkluc3RydWN0b3I6PC9zdHJvbmc+ICR7Y291cnNlLmluc3RydWN0b3J9PGJyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN0cm9uZz5UaW1lOjwvc3Ryb25nPiAke2NvdXJzZS50aW1lLnJhd30gfAogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN0cm9uZz5EYXlzOjwvc3Ryb25nPiAke2RheXNFeHBhbmRlZH0KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGh0bWwgKz0gYDwvZGl2PjwvZGl2PmA7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gQWRkIHJlc2V0IGJ1dHRvbiBpZiB0aGVyZSBhcmUgaWdub3JlZCBjb25mbGljdHMKICAgICAgICAgICAgaWYgKGlnbm9yZWRDb25mbGljdHMuc2l6ZSA+IDApIHsKICAgICAgICAgICAgICAgIGh0bWwgKz0gYDxkaXYgc3R5bGU9Im1hcmdpbi10b3A6IDIwcHg7IHRleHQtYWxpZ246IGNlbnRlcjsiPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImVkaXQtYWN0aW9uLWJ0biBidG4tc2Vjb25kYXJ5IiBvbmNsaWNrPSJyZXNldElnbm9yZWRDb25mbGljdHMoKSI+CiAgICAgICAgICAgICAgICAgICAgICAgIOKGtiBSZXNldCBBbGwgSWdub3JlZCBDb25mbGljdHMgKCR7aWdub3JlZENvbmZsaWN0cy5zaXplfSkKICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSBodG1sOwogICAgICAgIH0KCiAgICAgICAgLy8gVG9nZ2xlIGlnbm9yZSBjb25mbGljdCAod2l0aCBsb2NhbFN0b3JhZ2UgcGVyc2lzdGVuY2UpCiAgICAgICAgZnVuY3Rpb24gdG9nZ2xlSWdub3JlQ29uZmxpY3Qoc2lnbmF0dXJlLCBpbmRleCkgewogICAgICAgICAgICBjb25zdCBjb25mbGljdEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgY29uZmxpY3QtJHtpbmRleH1gKTsKICAgICAgICAgICAgaWYgKCFjb25mbGljdEVsZW1lbnQpIHJldHVybjsKCiAgICAgICAgICAgIGlmIChpZ25vcmVkQ29uZmxpY3RzLmhhcyhzaWduYXR1cmUpKSB7CiAgICAgICAgICAgICAgICAvLyBVbi1pZ25vcmUKICAgICAgICAgICAgICAgIGlnbm9yZWRDb25mbGljdHMuZGVsZXRlKHNpZ25hdHVyZSk7CiAgICAgICAgICAgICAgICBjb25mbGljdEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnY29uZmxpY3QtaGlkZGVuJyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBJZ25vcmUKICAgICAgICAgICAgICAgIGlnbm9yZWRDb25mbGljdHMuYWRkKHNpZ25hdHVyZSk7CiAgICAgICAgICAgICAgICBjb25mbGljdEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnY29uZmxpY3QtaGlkZGVuJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFBlcnNpc3QgdG8gbG9jYWxTdG9yYWdlCiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdpZ25vcmVkQ29uZmxpY3RzJywgSlNPTi5zdHJpbmdpZnkoWy4uLmlnbm9yZWRDb25mbGljdHNdKSk7CgogICAgICAgICAgICAvLyBSZWZyZXNoIHRoZSBkaXNwbGF5IHRvIHVwZGF0ZSBidXR0b24gYW5kIGNvdW50ZXIKICAgICAgICAgICAgZGV0ZWN0QW5kRGlzcGxheVJvb21Db25mbGljdHMoKTsKCiAgICAgICAgICAgIC8vIFJlLXJlbmRlciB0aGUgbWFpbiBjYWxlbmRhciB0byB1cGRhdGUgY29uZmxpY3QgaW5kaWNhdG9ycwogICAgICAgICAgICByZW5kZXJDb3Vyc2VzKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBSZXNldCBhbGwgaWdub3JlZCBjb25mbGljdHMKICAgICAgICBmdW5jdGlvbiByZXNldElnbm9yZWRDb25mbGljdHMoKSB7CiAgICAgICAgICAgIGlmICghY29uZmlybSgnQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIHJlc2V0IGFsbCBpZ25vcmVkIGNvbmZsaWN0cz8gVGhpcyB3aWxsIHNob3cgYWxsIGNvbmZsaWN0cyBhZ2Fpbi4nKSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZ25vcmVkQ29uZmxpY3RzLmNsZWFyKCk7CiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdpZ25vcmVkQ29uZmxpY3RzJyk7CiAgICAgICAgICAgIGRldGVjdEFuZERpc3BsYXlSb29tQ29uZmxpY3RzKCk7CiAgICAgICAgICAgIHJlbmRlckNvdXJzZXMoKTsKICAgICAgICAgICAgc2hvd1RvYXN0KCfihrYgQWxsIGlnbm9yZWQgY29uZmxpY3RzIGhhdmUgYmVlbiByZXNldCcsICdpbmZvJyk7CiAgICAgICAgfQoKICAgICAgICAvLyBDbGFzcyBsaXN0IC0gc2hvdyBpbnN0cnVjdG9yIHNjaGVkdWxlcwogICAgICAgIGZ1bmN0aW9uIGdlbmVyYXRlUGxhbm5pbmdNb2RlKCkgewogICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGxhbm5pbmdNb2RlQ29udGVudCcpOwoKICAgICAgICAgICAgLy8gUmVzcGVjdCBpbnN0cnVjdG9yIGZpbHRlcmluZwogICAgICAgICAgICBjb25zdCBhbGxJbnN0cnVjdG9ycyA9IFsuLi5uZXcgU2V0KGNvdXJzZXMubWFwKGMgPT4gYy5pbnN0cnVjdG9yKSldLnNvcnQoKTsKICAgICAgICAgICAgY29uc3QgaW5zdHJ1Y3RvcnMgPSBzZWxlY3RlZEluc3RydWN0b3JzLnNpemUgPT09IDAKICAgICAgICAgICAgICAgID8gYWxsSW5zdHJ1Y3RvcnMKICAgICAgICAgICAgICAgIDogYWxsSW5zdHJ1Y3RvcnMuZmlsdGVyKGluc3QgPT4gc2VsZWN0ZWRJbnN0cnVjdG9ycy5oYXMoaW5zdCkpOwoKICAgICAgICAgICAgbGV0IGh0bWwgPSAnJzsKCiAgICAgICAgICAgIGlmIChpbnN0cnVjdG9ycy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgIGh0bWwgPSAnPGRpdiBjbGFzcz0ibm8tY29uZmxpY3RzIj7wn5OLIE5vIGluc3RydWN0b3JzIHNlbGVjdGVkLiBVc2UgdGhlIGluc3RydWN0b3IgZmlsdGVyIGFib3ZlIHRvIHNlbGVjdCBpbnN0cnVjdG9ycyB0byB2aWV3IHRoZWlyIHNjaGVkdWxlcy48L2Rpdj4nOwogICAgICAgICAgICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9IGh0bWw7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGluc3RydWN0b3JzLmZvckVhY2goaW5zdHJ1Y3RvciA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0cnVjdG9yQ291cnNlcyA9IGNvdXJzZXMuZmlsdGVyKGMgPT4gYy5pbnN0cnVjdG9yID09PSBpbnN0cnVjdG9yKTsKICAgICAgICAgICAgICAgIGNvbnN0IGluc3RydWN0b3JDb2xvciA9IGdldEluc3RydWN0b3JDb2xvcihpbnN0cnVjdG9yKTsKCiAgICAgICAgICAgICAgICBodG1sICs9IGA8ZGl2IGNsYXNzPSJpbnN0cnVjdG9yLXNjaGVkdWxlIj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJpbnN0cnVjdG9yLXNjaGVkdWxlLWhlYWRlciI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJpbnN0cnVjdG9yLWNvbG9yLWluZGljYXRvciIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICR7aW5zdHJ1Y3RvckNvbG9yfTsgd2lkdGg6IDIwcHg7IGhlaWdodDogMjBweDsiPjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4+JHtpbnN0cnVjdG9yfSAoJHtpbnN0cnVjdG9yQ291cnNlcy5sZW5ndGh9IGNvdXJzZSR7aW5zdHJ1Y3RvckNvdXJzZXMubGVuZ3RoID4gMSA/ICdzJyA6ICcnfSk8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaW5zdHJ1Y3Rvci1zY2hlZHVsZS1jb3Vyc2VzIj5gOwoKICAgICAgICAgICAgICAgIGluc3RydWN0b3JDb3Vyc2VzLmZvckVhY2goY291cnNlID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXlzRXhwYW5kZWQgPSBleHBhbmREYXlzKGNvdXJzZS5kYXlzKTsKICAgICAgICAgICAgICAgICAgICBodG1sICs9IGA8ZGl2IGNsYXNzPSJzY2hlZHVsZS1jb3Vyc2UtaXRlbSIgc3R5bGU9ImJvcmRlci1sZWZ0LWNvbG9yOiAke2luc3RydWN0b3JDb2xvcn07Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2NoZWR1bGUtY291cnNlLXRpdGxlIj4ke2NvdXJzZS5jb3Vyc2VfbnVtYmVyfSAtICR7Y291cnNlLnRpdGxlfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzY2hlZHVsZS1jb3Vyc2UtZGV0YWlscyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Ryb25nPkNSTjo8L3N0cm9uZz4gJHtjb3Vyc2UuY3JufSB8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Ryb25nPlRpbWU6PC9zdHJvbmc+ICR7Y291cnNlLnRpbWUucmF3fSB8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Ryb25nPkRheXM6PC9zdHJvbmc+ICR7ZGF5c0V4cGFuZGVkfTxicj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzdHJvbmc+TG9jYXRpb246PC9zdHJvbmc+ICR7Y291cnNlLmJ1aWxkaW5nfSAke2NvdXJzZS5yb29tfSB8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Ryb25nPkNyZWRpdHM6PC9zdHJvbmc+ICR7Y291cnNlLmNyZWRpdHN9CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBodG1sICs9IGA8L2Rpdj48L2Rpdj5gOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSBodG1sOwogICAgICAgIH0KCiAgICAgICAgd2luZG93Lm9uY2xpY2sgPSBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgICBpZiAoZXZlbnQudGFyZ2V0ID09PSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kYWwnKSkgY2xvc2VNb2RhbCgpOwogICAgICAgICAgICBpZiAoZXZlbnQudGFyZ2V0ID09PSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdE1vZGFsJykpIGNsb3NlRWRpdE1vZGFsKCk7CiAgICAgICAgfQoKICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gJ0VzY2FwZScpIHsKICAgICAgICAgICAgICAgIGNsb3NlTW9kYWwoKTsKICAgICAgICAgICAgICAgIGNsb3NlRWRpdE1vZGFsKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgICAgIC8vIEVESVQgTU9ERSBGVU5DVElPTlMKICAgICAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgogICAgICAgIC8vIEluaXRpYWxpemUgZWRpdCBtb2RlCiAgICAgICAgZnVuY3Rpb24gaW5pdGlhbGl6ZUVkaXRNb2RlKCkgewogICAgICAgICAgICBwb3B1bGF0ZVRpbWVQaWNrZXJzKCk7CiAgICAgICAgICAgIHBvcHVsYXRlSW5zdHJ1Y3RvckRhdGFsaXN0KCk7CiAgICAgICAgICAgIHBvcHVsYXRlRWRpdEluc3RydWN0b3JGaWx0ZXIoKTsKICAgICAgICAgICAgcG9wdWxhdGVFZGl0Um9vbURyb3Bkb3duKCk7CiAgICAgICAgICAgIHJlbmRlckVkaXRDYWxlbmRhcigpOwogICAgICAgICAgICBkaXNwbGF5RWRpdE1vZGVDb25mbGljdHMoKTsKICAgICAgICAgICAgdXBkYXRlRWRpdENvdW50KCk7CiAgICAgICAgfQoKICAgICAgICAvLyBQb3B1bGF0ZSBpbnN0cnVjdG9yIGNoZWNrYm94ZXMgaW4gZWRpdCBtb2RlCiAgICAgICAgZnVuY3Rpb24gcG9wdWxhdGVFZGl0SW5zdHJ1Y3RvckZpbHRlcigpIHsKICAgICAgICAgICAgY29uc3QgaW5zdHJ1Y3Rvckxpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdEluc3RydWN0b3JMaXN0Jyk7CiAgICAgICAgICAgIGluc3RydWN0b3JMaXN0LmlubmVySFRNTCA9ICcnOyAvLyBDbGVhciBleGlzdGluZwogICAgICAgICAgICBjb25zdCBpbnN0cnVjdG9ycyA9IFsuLi5uZXcgU2V0KGVkaXRlZENvdXJzZXMubWFwKGMgPT4gYy5pbnN0cnVjdG9yKSldLnNvcnQoKTsKCiAgICAgICAgICAgIC8vIEVuc3VyZSBhbGwgaW5zdHJ1Y3RvcnMgaGF2ZSBjb2xvcnMKICAgICAgICAgICAgaW5zdHJ1Y3RvcnMuZm9yRWFjaChpbnN0cnVjdG9yID0+IHsKICAgICAgICAgICAgICAgIGlmICghaW5zdHJ1Y3RvckNvbG9yc1tpbnN0cnVjdG9yXSkgewogICAgICAgICAgICAgICAgICAgIC8vIEdlbmVyYXRlIGEgY29sb3IgaWYgbWlzc2luZwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGh1ZSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDM2MCk7CiAgICAgICAgICAgICAgICAgICAgaW5zdHJ1Y3RvckNvbG9yc1tpbnN0cnVjdG9yXSA9IGBoc2woJHtodWV9LCA3MCUsIDYwJSlgOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGluc3RydWN0b3JzLmZvckVhY2goaW5zdHJ1Y3RvciA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBpdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgICAgICBpdGVtLmNsYXNzTmFtZSA9ICdpbnN0cnVjdG9yLWNoZWNrYm94LWl0ZW0nOwoKICAgICAgICAgICAgICAgIGNvbnN0IGNoZWNrYm94ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKICAgICAgICAgICAgICAgIGNoZWNrYm94LnR5cGUgPSAnY2hlY2tib3gnOwogICAgICAgICAgICAgICAgY2hlY2tib3guaWQgPSBgZWRpdC1pbnN0cnVjdG9yLSR7aW5zdHJ1Y3Rvci5yZXBsYWNlKC9ccysvZywgJy0nKX1gOwogICAgICAgICAgICAgICAgY2hlY2tib3gudmFsdWUgPSBpbnN0cnVjdG9yOwogICAgICAgICAgICAgICAgY2hlY2tib3guY2hlY2tlZCA9IGVkaXRTZWxlY3RlZEluc3RydWN0b3JzLnNpemUgPT09IDAgfHwgZWRpdFNlbGVjdGVkSW5zdHJ1Y3RvcnMuaGFzKGluc3RydWN0b3IpOwogICAgICAgICAgICAgICAgY2hlY2tib3gub25jaGFuZ2UgPSAoKSA9PiB0b2dnbGVFZGl0SW5zdHJ1Y3RvclNlbGVjdGlvbihpbnN0cnVjdG9yKTsKCiAgICAgICAgICAgICAgICBjb25zdCBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJyk7CiAgICAgICAgICAgICAgICBsYWJlbC5zZXRBdHRyaWJ1dGUoJ2ZvcicsIGNoZWNrYm94LmlkKTsKCiAgICAgICAgICAgICAgICBjb25zdCBjb2xvckluZGljYXRvciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsKICAgICAgICAgICAgICAgIGNvbG9ySW5kaWNhdG9yLmNsYXNzTmFtZSA9ICdpbnN0cnVjdG9yLWNvbG9yLWluZGljYXRvcic7CiAgICAgICAgICAgICAgICBjb2xvckluZGljYXRvci5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBnZXRJbnN0cnVjdG9yQ29sb3IoaW5zdHJ1Y3Rvcik7CgogICAgICAgICAgICAgICAgbGFiZWwuYXBwZW5kQ2hpbGQoY29sb3JJbmRpY2F0b3IpOwogICAgICAgICAgICAgICAgbGFiZWwuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoaW5zdHJ1Y3RvcikpOwoKICAgICAgICAgICAgICAgIGl0ZW0uYXBwZW5kQ2hpbGQoY2hlY2tib3gpOwogICAgICAgICAgICAgICAgaXRlbS5hcHBlbmRDaGlsZChsYWJlbCk7CiAgICAgICAgICAgICAgICBpbnN0cnVjdG9yTGlzdC5hcHBlbmRDaGlsZChpdGVtKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICAvLyBQb3B1bGF0ZSByb29tIGZpbHRlciBkcm9wZG93biBpbiBlZGl0IG1vZGUKICAgICAgICAvLyBUb2dnbGUgaW5zdHJ1Y3RvciBkcm9wZG93biBpbiBlZGl0IG1vZGUKICAgICAgICBmdW5jdGlvbiB0b2dnbGVFZGl0SW5zdHJ1Y3RvckRyb3Bkb3duKCkgewogICAgICAgICAgICBjb25zdCBkcm9wZG93biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0SW5zdHJ1Y3RvckRyb3Bkb3duJyk7CiAgICAgICAgICAgIGRyb3Bkb3duLnN0eWxlLmRpc3BsYXkgPSBkcm9wZG93bi5zdHlsZS5kaXNwbGF5ID09PSAnYmxvY2snID8gJ25vbmUnIDogJ2Jsb2NrJzsKICAgICAgICB9CgogICAgICAgIC8vIFRvZ2dsZSBzaW5nbGUgaW5zdHJ1Y3RvciBzZWxlY3Rpb24gaW4gZWRpdCBtb2RlCiAgICAgICAgZnVuY3Rpb24gdG9nZ2xlRWRpdEluc3RydWN0b3JTZWxlY3Rpb24oaW5zdHJ1Y3RvcikgewogICAgICAgICAgICBpZiAoZWRpdFNlbGVjdGVkSW5zdHJ1Y3RvcnMuaGFzKGluc3RydWN0b3IpKSB7CiAgICAgICAgICAgICAgICBlZGl0U2VsZWN0ZWRJbnN0cnVjdG9ycy5kZWxldGUoaW5zdHJ1Y3Rvcik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBlZGl0U2VsZWN0ZWRJbnN0cnVjdG9ycy5hZGQoaW5zdHJ1Y3Rvcik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdXBkYXRlRWRpdEluc3RydWN0b3JCdXR0b25UZXh0KCk7CiAgICAgICAgICAgIGFwcGx5RWRpdEZpbHRlcnMoKTsKICAgICAgICB9CgogICAgICAgIC8vIFNlbGVjdCBhbGwgaW5zdHJ1Y3RvcnMgaW4gZWRpdCBtb2RlCiAgICAgICAgZnVuY3Rpb24gc2VsZWN0QWxsRWRpdEluc3RydWN0b3JzKCkgewogICAgICAgICAgICBlZGl0U2VsZWN0ZWRJbnN0cnVjdG9ycy5jbGVhcigpOwogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcjZWRpdEluc3RydWN0b3JMaXN0IGlucHV0W3R5cGU9ImNoZWNrYm94Il0nKS5mb3JFYWNoKGNiID0+IHsKICAgICAgICAgICAgICAgIGNiLmNoZWNrZWQgPSB0cnVlOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdXBkYXRlRWRpdEluc3RydWN0b3JCdXR0b25UZXh0KCk7CiAgICAgICAgICAgIGFwcGx5RWRpdEZpbHRlcnMoKTsKICAgICAgICB9CgogICAgICAgIC8vIENsZWFyIGFsbCBpbnN0cnVjdG9ycyBpbiBlZGl0IG1vZGUKICAgICAgICBmdW5jdGlvbiBjbGVhckFsbEVkaXRJbnN0cnVjdG9ycygpIHsKICAgICAgICAgICAgZWRpdFNlbGVjdGVkSW5zdHJ1Y3RvcnMuY2xlYXIoKTsKICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnI2VkaXRJbnN0cnVjdG9yTGlzdCBpbnB1dFt0eXBlPSJjaGVja2JveCJdJykuZm9yRWFjaChjYiA9PiB7CiAgICAgICAgICAgICAgICBjYi5jaGVja2VkID0gZmFsc2U7CiAgICAgICAgICAgICAgICBlZGl0U2VsZWN0ZWRJbnN0cnVjdG9ycy5hZGQoY2IudmFsdWUpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgLy8gU3RhcnQgd2l0aCBvbmUgaW5zdHJ1Y3RvciBzZWxlY3RlZAogICAgICAgICAgICBjb25zdCBmaXJzdENoZWNrYm94ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2VkaXRJbnN0cnVjdG9yTGlzdCBpbnB1dFt0eXBlPSJjaGVja2JveCJdJyk7CiAgICAgICAgICAgIGlmIChmaXJzdENoZWNrYm94KSB7CiAgICAgICAgICAgICAgICBmaXJzdENoZWNrYm94LmNoZWNrZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgZWRpdFNlbGVjdGVkSW5zdHJ1Y3RvcnMuY2xlYXIoKTsKICAgICAgICAgICAgICAgIGVkaXRTZWxlY3RlZEluc3RydWN0b3JzLmFkZChmaXJzdENoZWNrYm94LnZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB1cGRhdGVFZGl0SW5zdHJ1Y3RvckJ1dHRvblRleHQoKTsKICAgICAgICAgICAgYXBwbHlFZGl0RmlsdGVycygpOwogICAgICAgIH0KCiAgICAgICAgLy8gVXBkYXRlIGluc3RydWN0b3IgYnV0dG9uIHRleHQgaW4gZWRpdCBtb2RlCiAgICAgICAgZnVuY3Rpb24gdXBkYXRlRWRpdEluc3RydWN0b3JCdXR0b25UZXh0KCkgewogICAgICAgICAgICBjb25zdCBidG5UZXh0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRJbnN0cnVjdG9yQnRuVGV4dCcpOwogICAgICAgICAgICBpZiAoZWRpdFNlbGVjdGVkSW5zdHJ1Y3RvcnMuc2l6ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgYnRuVGV4dC50ZXh0Q29udGVudCA9ICdBbGwgSW5zdHJ1Y3RvcnMnOwogICAgICAgICAgICB9IGVsc2UgaWYgKGVkaXRTZWxlY3RlZEluc3RydWN0b3JzLnNpemUgPT09IDEpIHsKICAgICAgICAgICAgICAgIGJ0blRleHQudGV4dENvbnRlbnQgPSBBcnJheS5mcm9tKGVkaXRTZWxlY3RlZEluc3RydWN0b3JzKVswXTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGJ0blRleHQudGV4dENvbnRlbnQgPSBgJHtlZGl0U2VsZWN0ZWRJbnN0cnVjdG9ycy5zaXplfSBJbnN0cnVjdG9yc2A7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIEVkaXQgbW9kZSByb29tIGZpbHRlciBkcm9wZG93bgogICAgICAgIGZ1bmN0aW9uIHRvZ2dsZUVkaXRSb29tRHJvcGRvd24oKSB7CiAgICAgICAgICAgIGNvbnN0IGRyb3Bkb3duID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRSb29tRHJvcGRvd24nKTsKICAgICAgICAgICAgZHJvcGRvd24uc3R5bGUuZGlzcGxheSA9IGRyb3Bkb3duLnN0eWxlLmRpc3BsYXkgPT09ICdibG9jaycgPyAnbm9uZScgOiAnYmxvY2snOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc2V0RWRpdFJvb21GaWx0ZXIocm9vbSkgewogICAgICAgICAgICBlZGl0Um9vbUZpbHRlciA9IHJvb207CiAgICAgICAgICAgIGNvbnN0IGJ0blRleHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdFJvb21CdG5UZXh0Jyk7CiAgICAgICAgICAgIGJ0blRleHQudGV4dENvbnRlbnQgPSByb29tID09PSAnYWxsJyA/ICdBbGwgUm9vbXMnIDogcm9vbTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRSb29tRHJvcGRvd24nKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICBhcHBseUVkaXRGaWx0ZXJzKCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBwb3B1bGF0ZUVkaXRSb29tRHJvcGRvd24oKSB7CiAgICAgICAgICAgIGNvbnN0IHJvb21TZXQgPSBuZXcgU2V0KCk7CiAgICAgICAgICAgIGVkaXRlZENvdXJzZXMuZm9yRWFjaChjb3Vyc2UgPT4gewogICAgICAgICAgICAgICAgaWYgKGNvdXJzZS5idWlsZGluZyAhPT0gJ05vdCBzcGVjaWZpZWQnICYmIGNvdXJzZS5yb29tICE9PSAnTm90IHNwZWNpZmllZCcpIHsKICAgICAgICAgICAgICAgICAgICByb29tU2V0LmFkZChgJHtjb3Vyc2UuYnVpbGRpbmd9ICR7Y291cnNlLnJvb219YCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBjb25zdCByb29tcyA9IFsnYWxsJywgLi4uQXJyYXkuZnJvbShyb29tU2V0KS5zb3J0KCldOwogICAgICAgICAgICBjb25zdCBkcm9wZG93biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0Um9vbUxpc3QnKTsKICAgICAgICAgICAgZHJvcGRvd24uaW5uZXJIVE1MID0gJyc7CiAgICAgICAgICAgIHJvb21zLmZvckVhY2gocm9vbSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBpdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgICAgICBpdGVtLmNsYXNzTmFtZSA9ICdpbnN0cnVjdG9yLWNoZWNrYm94LWl0ZW0nOwogICAgICAgICAgICAgICAgaXRlbS5vbmNsaWNrID0gKCkgPT4gc2V0RWRpdFJvb21GaWx0ZXIocm9vbSk7CiAgICAgICAgICAgICAgICBjb25zdCBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJyk7CiAgICAgICAgICAgICAgICBsYWJlbC5zdHlsZS5jdXJzb3IgPSAncG9pbnRlcic7CiAgICAgICAgICAgICAgICBsYWJlbC50ZXh0Q29udGVudCA9IHJvb20gPT09ICdhbGwnID8gJ0FsbCBSb29tcycgOiByb29tOwogICAgICAgICAgICAgICAgaXRlbS5hcHBlbmRDaGlsZChsYWJlbCk7CiAgICAgICAgICAgICAgICBkcm9wZG93bi5hcHBlbmRDaGlsZChpdGVtKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICAvLyBFZGl0IG1vZGUgbGV2ZWwgZmlsdGVyIGRyb3Bkb3duCiAgICAgICAgZnVuY3Rpb24gdG9nZ2xlRWRpdExldmVsRHJvcGRvd24oKSB7CiAgICAgICAgICAgIGNvbnN0IGRyb3Bkb3duID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRMZXZlbERyb3Bkb3duJyk7CiAgICAgICAgICAgIGRyb3Bkb3duLnN0eWxlLmRpc3BsYXkgPSBkcm9wZG93bi5zdHlsZS5kaXNwbGF5ID09PSAnYmxvY2snID8gJ25vbmUnIDogJ2Jsb2NrJzsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHNldEVkaXRMZXZlbEZpbHRlcihsZXZlbCkgewogICAgICAgICAgICBlZGl0TGV2ZWxGaWx0ZXIgPSBsZXZlbDsKICAgICAgICAgICAgY29uc3QgYnRuVGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0TGV2ZWxCdG5UZXh0Jyk7CiAgICAgICAgICAgIGlmIChsZXZlbCA9PT0gJ2FsbCcpIHsKICAgICAgICAgICAgICAgIGJ0blRleHQudGV4dENvbnRlbnQgPSAnQWxsIExldmVscyc7CiAgICAgICAgICAgIH0gZWxzZSBpZiAobGV2ZWwgPT09ICd1bmRlcmdyYWQnKSB7CiAgICAgICAgICAgICAgICBidG5UZXh0LnRleHRDb250ZW50ID0gJ1VuZGVyZ3JhZCc7CiAgICAgICAgICAgIH0gZWxzZSBpZiAobGV2ZWwgPT09ICdncmFkJykgewogICAgICAgICAgICAgICAgYnRuVGV4dC50ZXh0Q29udGVudCA9ICdHcmFkJzsKICAgICAgICAgICAgfQogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdExldmVsRHJvcGRvd24nKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICBhcHBseUVkaXRGaWx0ZXJzKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBBcHBseSBlZGl0IG1vZGUgZmlsdGVycwogICAgICAgIGZ1bmN0aW9uIGFwcGx5RWRpdEZpbHRlcnMoKSB7CiAgICAgICAgICAgIC8vIFNraXAgcmVuZGVyaW5nIGlmIHdlJ3JlIGN1cnJlbnRseSBpbXBvcnRpbmcgZGF0YQogICAgICAgICAgICBpZiAoaXNJbXBvcnRpbmcpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdhcHBseUVkaXRGaWx0ZXJzOiBTa2lwcGluZyByZW5kZXIgZHVyaW5nIGltcG9ydCcpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBVcGRhdGUgc3RhdHVzIHRleHQKICAgICAgICAgICAgbGV0IHN0YXR1c1BhcnRzID0gW107CgogICAgICAgICAgICBpZiAoZWRpdFJvb21GaWx0ZXIgIT09ICdhbGwnKSB7CiAgICAgICAgICAgICAgICBzdGF0dXNQYXJ0cy5wdXNoKGBSb29tOiA8c3Ryb25nPiR7ZWRpdFJvb21GaWx0ZXJ9PC9zdHJvbmc+YCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEFkZCBsZXZlbCBmaWx0ZXIgc3RhdHVzCiAgICAgICAgICAgIGlmIChlZGl0TGV2ZWxGaWx0ZXIgPT09ICd1bmRlcmdyYWQnKSB7CiAgICAgICAgICAgICAgICBzdGF0dXNQYXJ0cy5wdXNoKCc8c3Ryb25nPnVuZGVyZ3JhZCBvbmx5PC9zdHJvbmc+Jyk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZWRpdExldmVsRmlsdGVyID09PSAnZ3JhZCcpIHsKICAgICAgICAgICAgICAgIHN0YXR1c1BhcnRzLnB1c2goJzxzdHJvbmc+Z3JhZCBvbmx5PC9zdHJvbmc+Jyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzdGF0dXNQYXJ0cy5wdXNoKCc8c3Ryb25nPmFsbCBsZXZlbHM8L3N0cm9uZz4nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGVkaXRTZWxlY3RlZEluc3RydWN0b3JzLnNpemUgPT09IDApIHsKICAgICAgICAgICAgICAgIHN0YXR1c1BhcnRzLnB1c2goJzxzdHJvbmc+YWxsIGluc3RydWN0b3JzPC9zdHJvbmc+Jyk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZWRpdFNlbGVjdGVkSW5zdHJ1Y3RvcnMuc2l6ZSA9PT0gMSkgewogICAgICAgICAgICAgICAgc3RhdHVzUGFydHMucHVzaChBcnJheS5mcm9tKGVkaXRTZWxlY3RlZEluc3RydWN0b3JzKVswXSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzdGF0dXNQYXJ0cy5wdXNoKGA8c3Ryb25nPiR7ZWRpdFNlbGVjdGVkSW5zdHJ1Y3RvcnMuc2l6ZX0gaW5zdHJ1Y3RvcnM8L3N0cm9uZz5gKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRGaWx0ZXJTdGF0dXMnKS5pbm5lckhUTUwgPSBzdGF0dXNQYXJ0cy5qb2luKCcgfCAnKTsKCiAgICAgICAgICAgIC8vIFJlLXJlbmRlciBjYWxlbmRhciB3aXRoIGZpbHRlcnMKICAgICAgICAgICAgcmVuZGVyRWRpdENhbGVuZGFyKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBDbG9zZSBkcm9wZG93bnMgd2hlbiBjbGlja2luZyBvdXRzaWRlCiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgICAvLyBDbG9zZSBpbnN0cnVjdG9yIGRyb3Bkb3duCiAgICAgICAgICAgIGNvbnN0IGVkaXREcm9wZG93biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0SW5zdHJ1Y3RvckRyb3Bkb3duJyk7CiAgICAgICAgICAgIGNvbnN0IGVkaXREcm9wZG93bkJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0SW5zdHJ1Y3RvckRyb3Bkb3duQnRuJyk7CiAgICAgICAgICAgIGlmIChlZGl0RHJvcGRvd24gJiYgIWVkaXREcm9wZG93bkJ0bi5jb250YWlucyhldmVudC50YXJnZXQpICYmICFlZGl0RHJvcGRvd24uY29udGFpbnMoZXZlbnQudGFyZ2V0KSkgewogICAgICAgICAgICAgICAgZWRpdERyb3Bkb3duLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIENsb3NlIHJvb20gZHJvcGRvd24KICAgICAgICAgICAgY29uc3Qgcm9vbURyb3Bkb3duID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRSb29tRHJvcGRvd24nKTsKICAgICAgICAgICAgY29uc3Qgcm9vbUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0Um9vbURyb3Bkb3duQnRuJyk7CiAgICAgICAgICAgIGlmIChyb29tRHJvcGRvd24gJiYgcm9vbUJ0biAmJiAhcm9vbURyb3Bkb3duLmNvbnRhaW5zKGV2ZW50LnRhcmdldCkgJiYgIXJvb21CdG4uY29udGFpbnMoZXZlbnQudGFyZ2V0KSkgewogICAgICAgICAgICAgICAgcm9vbURyb3Bkb3duLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIENsb3NlIGxldmVsIGRyb3Bkb3duCiAgICAgICAgICAgIGNvbnN0IGxldmVsRHJvcGRvd24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdExldmVsRHJvcGRvd24nKTsKICAgICAgICAgICAgY29uc3QgbGV2ZWxCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdExldmVsRHJvcGRvd25CdG4nKTsKICAgICAgICAgICAgaWYgKGxldmVsRHJvcGRvd24gJiYgbGV2ZWxCdG4gJiYgIWxldmVsRHJvcGRvd24uY29udGFpbnMoZXZlbnQudGFyZ2V0KSAmJiAhbGV2ZWxCdG4uY29udGFpbnMoZXZlbnQudGFyZ2V0KSkgewogICAgICAgICAgICAgICAgbGV2ZWxEcm9wZG93bi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIC8vIFBvcHVsYXRlIHRpbWUgcGlja2VyIGRyb3Bkb3ducyB3aXRoIDUtbWludXRlIGludGVydmFscwogICAgICAgIGZ1bmN0aW9uIHBvcHVsYXRlVGltZVBpY2tlcnMoKSB7CiAgICAgICAgICAgIGNvbnN0IHN0YXJ0U2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRTdGFydFRpbWUnKTsKICAgICAgICAgICAgY29uc3QgZW5kU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRFbmRUaW1lJyk7CgogICAgICAgICAgICBpZiAoc3RhcnRTZWxlY3Qub3B0aW9ucy5sZW5ndGggPiAwKSByZXR1cm47IC8vIEFscmVhZHkgcG9wdWxhdGVkCgogICAgICAgICAgICBjb25zdCB0aW1lcyA9IFtdOwogICAgICAgICAgICBmb3IgKGxldCBob3VyID0gOTsgaG91ciA8PSAyMTsgaG91cisrKSB7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBtaW4gPSAwOyBtaW4gPCA2MDsgbWluICs9IDUpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwZXJpb2QgPSBob3VyID49IDEyID8gJ1BNJyA6ICdBTSc7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlzcGxheUhvdXIgPSBob3VyID4gMTIgPyBob3VyIC0gMTIgOiAoaG91ciA9PT0gMCA/IDEyIDogaG91cik7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGltZVN0ciA9IGAke2Rpc3BsYXlIb3VyLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKX06JHttaW4udG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfSR7cGVyaW9kfWA7CiAgICAgICAgICAgICAgICAgICAgdGltZXMucHVzaCh0aW1lU3RyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGltZXMuZm9yRWFjaCh0aW1lID0+IHsKICAgICAgICAgICAgICAgIHN0YXJ0U2VsZWN0LmFkZChuZXcgT3B0aW9uKHRpbWUsIHRpbWUpKTsKICAgICAgICAgICAgICAgIGVuZFNlbGVjdC5hZGQobmV3IE9wdGlvbih0aW1lLCB0aW1lKSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgLy8gUG9wdWxhdGUgaW5zdHJ1Y3RvciBkYXRhbGlzdAogICAgICAgIGZ1bmN0aW9uIHBvcHVsYXRlSW5zdHJ1Y3RvckRhdGFsaXN0KCkgewogICAgICAgICAgICBjb25zdCBkYXRhbGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnN0cnVjdG9yTGlzdCcpOwogICAgICAgICAgICBjb25zdCBpbnN0cnVjdG9ycyA9IFsuLi5uZXcgU2V0KGVkaXRlZENvdXJzZXMubWFwKGMgPT4gYy5pbnN0cnVjdG9yKSldLnNvcnQoKTsKICAgICAgICAgICAgZGF0YWxpc3QuaW5uZXJIVE1MID0gJyc7CiAgICAgICAgICAgIGluc3RydWN0b3JzLmZvckVhY2goaW5zdHJ1Y3RvciA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTsKICAgICAgICAgICAgICAgIG9wdGlvbi52YWx1ZSA9IGluc3RydWN0b3I7CiAgICAgICAgICAgICAgICBkYXRhbGlzdC5hcHBlbmRDaGlsZChvcHRpb24pOwogICAgICAgICAgICB9KTsKICAgICAgICB9CgoKICAgICAgICAvLyBSZW5kZXIgZWRpdCBjYWxlbmRhciB3aXRoIG92ZXJsYXAgZGV0ZWN0aW9uCiAgICAgICAgZnVuY3Rpb24gcmVuZGVyRWRpdENhbGVuZGFyKCkgewogICAgICAgICAgICBjb25zdCBlZGl0VGltZUNvbHVtbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0VGltZUNvbHVtbicpOwogICAgICAgICAgICBjb25zdCBzdGFydEhvdXIgPSA5OwogICAgICAgICAgICBjb25zdCBwaXhlbHNQZXJNaW51dGUgPSAxOwoKICAgICAgICAgICAgLy8gQ3JlYXRlIHRpbWUgc2xvdHMKICAgICAgICAgICAgZWRpdFRpbWVDb2x1bW4uaW5uZXJIVE1MID0gJyc7CiAgICAgICAgICAgIGZvciAobGV0IGhvdXIgPSA5OyBob3VyIDw9IDIxOyBob3VyKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVTbG90ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgICAgICB0aW1lU2xvdC5jbGFzc05hbWUgPSAndGltZS1zbG90JzsKICAgICAgICAgICAgICAgIGNvbnN0IHBlcmlvZCA9IGhvdXIgPj0gMTIgPyAnUE0nIDogJ0FNJzsKICAgICAgICAgICAgICAgIGNvbnN0IGRpc3BsYXlIb3VyID0gaG91ciA+IDEyID8gaG91ciAtIDEyIDogaG91cjsKICAgICAgICAgICAgICAgIHRpbWVTbG90LnRleHRDb250ZW50ID0gYCR7ZGlzcGxheUhvdXJ9OjAwICR7cGVyaW9kfWA7CiAgICAgICAgICAgICAgICBlZGl0VGltZUNvbHVtbi5hcHBlbmRDaGlsZCh0aW1lU2xvdCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIENsZWFyIGRheSBjb2x1bW5zCiAgICAgICAgICAgIFsnbW9uZGF5JywgJ3R1ZXNkYXknLCAnd2VkbmVzZGF5JywgJ3RodXJzZGF5JywgJ2ZyaWRheSddLmZvckVhY2goZGF5ID0+IHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBlZGl0LSR7ZGF5fWApLmlubmVySFRNTCA9ICcnOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIEdyb3VwIGNvdXJzZXMgYnkgZGF5IHdpdGggZmlsdGVycyBhcHBsaWVkCiAgICAgICAgICAgIGNvbnN0IGNvdXJzZXNCeURheSA9IHsgbW9uZGF5OiBbXSwgdHVlc2RheTogW10sIHdlZG5lc2RheTogW10sIHRodXJzZGF5OiBbXSwgZnJpZGF5OiBbXSB9OwogICAgICAgICAgICBlZGl0ZWRDb3Vyc2VzLmZvckVhY2goY291cnNlID0+IHsKICAgICAgICAgICAgICAgIGlmICghY291cnNlLmRheXMgfHwgIWNvdXJzZS50aW1lKSByZXR1cm47CgogICAgICAgICAgICAgICAgLy8gQXBwbHkgaW5zdHJ1Y3RvciBmaWx0ZXIKICAgICAgICAgICAgICAgIGNvbnN0IGluc3RydWN0b3JNYXRjaCA9IGVkaXRTZWxlY3RlZEluc3RydWN0b3JzLnNpemUgPT09IDAgfHwgZWRpdFNlbGVjdGVkSW5zdHJ1Y3RvcnMuaGFzKGNvdXJzZS5pbnN0cnVjdG9yKTsKICAgICAgICAgICAgICAgIGlmICghaW5zdHJ1Y3Rvck1hdGNoKSByZXR1cm47CgogICAgICAgICAgICAgICAgLy8gQXBwbHkgcm9vbSBmaWx0ZXIKICAgICAgICAgICAgICAgIGNvbnN0IGNvdXJzZVJvb20gPSBgJHtjb3Vyc2UuYnVpbGRpbmd9ICR7Y291cnNlLnJvb219YDsKICAgICAgICAgICAgICAgIGlmIChlZGl0Um9vbUZpbHRlciAhPT0gJ2FsbCcgJiYgY291cnNlUm9vbSAhPT0gZWRpdFJvb21GaWx0ZXIpIHJldHVybjsKCiAgICAgICAgICAgICAgICAvLyBBcHBseSBsZXZlbCBmaWx0ZXIKICAgICAgICAgICAgICAgIGlmIChlZGl0TGV2ZWxGaWx0ZXIgPT09ICd1bmRlcmdyYWQnICYmIGlzR3JhZHVhdGVDb3Vyc2UoY291cnNlLmNvdXJzZV9udW1iZXIpKSByZXR1cm47CiAgICAgICAgICAgICAgICBpZiAoZWRpdExldmVsRmlsdGVyID09PSAnZ3JhZCcgJiYgIWlzR3JhZHVhdGVDb3Vyc2UoY291cnNlLmNvdXJzZV9udW1iZXIpKSByZXR1cm47CgogICAgICAgICAgICAgICAgY291cnNlLmRheXMuc3BsaXQoJycpLmZvckVhY2goZGF5TGV0dGVyID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXlOYW1lID0gZGF5TWFwW2RheUxldHRlcl07CiAgICAgICAgICAgICAgICAgICAgaWYgKGRheU5hbWUpIGNvdXJzZXNCeURheVtkYXlOYW1lXS5wdXNoKGNvdXJzZSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBSZW5kZXIgY291cnNlcyB3aXRoIG92ZXJsYXAgZGV0ZWN0aW9uCiAgICAgICAgICAgIE9iamVjdC5rZXlzKGNvdXJzZXNCeURheSkuZm9yRWFjaChkYXlOYW1lID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGRheUNvbHVtbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBlZGl0LSR7ZGF5TmFtZX1gKTsKICAgICAgICAgICAgICAgIGNvbnN0IGNvdXJzZXNGb3JEYXkgPSBjb3Vyc2VzQnlEYXlbZGF5TmFtZV07CgogICAgICAgICAgICAgICAgLy8gRGVidWc6IExvZyBhbGwgY291cnNlcyBmb3IgVHVlc2RheSB0byBzZWUgd2hhdCdzIGJlaW5nIGdyb3VwZWQKICAgICAgICAgICAgICAgIGlmIChkYXlOYW1lID09PSAndHVlc2RheScpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnPT09IERFQlVHIFRVRVNEQVkgQ09VUlNFUyAoQkVGT1JFIFNPUlQpID09PScpOwogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdUb3RhbCBjb3Vyc2VzIG9uIFR1ZXNkYXk6JywgY291cnNlc0ZvckRheS5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgIGNvdXJzZXNGb3JEYXkuZm9yRWFjaCgoYywgaWR4KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1pbnMgPSB0aW1lVG9NaW51dGVzKGMudGltZS5zdGFydCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbJHtpZHh9XSBDUk4gJHtjLmNybn06ICR7Yy50aW1lLnN0YXJ0fSAtICR7Yy50aW1lLmVuZH0gKHN0YXJ0PSR7bWluc30gbWlucykgfCAke2MuY291cnNlX251bWJlcn0gJHtjLnRpdGxlfWApOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIFNvcnQgYnkgc3RhcnQgdGltZQogICAgICAgICAgICAgICAgY291cnNlc0ZvckRheS5zb3J0KChhLCBiKSA9PiB0aW1lVG9NaW51dGVzKGEudGltZS5zdGFydCkgLSB0aW1lVG9NaW51dGVzKGIudGltZS5zdGFydCkpOwoKICAgICAgICAgICAgICAgIC8vIERlYnVnOiBMb2cgYWZ0ZXIgc29ydGluZwogICAgICAgICAgICAgICAgaWYgKGRheU5hbWUgPT09ICd0dWVzZGF5JykgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCc9PT0gREVCVUcgVFVFU0RBWSBDT1VSU0VTIChBRlRFUiBTT1JUKSA9PT0nKTsKICAgICAgICAgICAgICAgICAgICBjb3Vyc2VzRm9yRGF5LmZvckVhY2goKGMsIGlkeCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtaW5zID0gdGltZVRvTWludXRlcyhjLnRpbWUuc3RhcnQpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgWyR7aWR4fV0gQ1JOICR7Yy5jcm59OiAke2MudGltZS5zdGFydH0gLSAke2MudGltZS5lbmR9IChzdGFydD0ke21pbnN9IG1pbnMpIHwgJHtjLmNvdXJzZV9udW1iZXJ9ICR7Yy50aXRsZX1gKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb25zdCBwcm9jZXNzZWQgPSBuZXcgU2V0KCk7CgogICAgICAgICAgICAgICAgY291cnNlc0ZvckRheS5mb3JFYWNoKChjb3Vyc2UsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHByb2Nlc3NlZC5oYXMoaW5kZXgpKSByZXR1cm47CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0TWludXRlcyA9IHRpbWVUb01pbnV0ZXMoY291cnNlLnRpbWUuc3RhcnQpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGVuZE1pbnV0ZXMgPSB0aW1lVG9NaW51dGVzKGNvdXJzZS50aW1lLmVuZCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZHVyYXRpb24gPSBlbmRNaW51dGVzIC0gc3RhcnRNaW51dGVzOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRvcFBvc2l0aW9uID0gKHN0YXJ0TWludXRlcyAtIChzdGFydEhvdXIgKiA2MCkpICogcGl4ZWxzUGVyTWludXRlOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGhlaWdodCA9IGR1cmF0aW9uICogcGl4ZWxzUGVyTWludXRlOwoKICAgICAgICAgICAgICAgICAgICAvLyBEZWJ1ZyBsb2cgZm9yIEFMTCBjb3Vyc2VzIG9uIFR1ZXNkYXkgdG8gc2VlIHBvc2l0aW9uaW5nCiAgICAgICAgICAgICAgICAgICAgaWYgKGRheU5hbWUgPT09ICd0dWVzZGF5JykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgPT09IFJFTkRFUiBDUk4gJHtjb3Vyc2UuY3JufSA9PT1gKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJyAgdGltZS5zdGFydDonLCBjb3Vyc2UudGltZS5zdGFydCwgJ+KGkicsIHN0YXJ0TWludXRlcywgJ21pbnV0ZXMnKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJyAgdGltZS5lbmQ6JywgY291cnNlLnRpbWUuZW5kLCAn4oaSJywgZW5kTWludXRlcywgJ21pbnV0ZXMnKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJyAgZHVyYXRpb246JywgZHVyYXRpb24sICdtaW51dGVzJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCcgIHRvcFBvc2l0aW9uOicsIHRvcFBvc2l0aW9uLCAncHgnKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJyAgaGVpZ2h0OicsIGhlaWdodCwgJ3B4Jyk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBGaW5kIG92ZXJsYXBwaW5nIGNvdXJzZXMKICAgICAgICAgICAgICAgICAgICBjb25zdCBvdmVybGFwcGluZyA9IFtdOwogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSBpbmRleCArIDE7IGkgPCBjb3Vyc2VzRm9yRGF5Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9jZXNzZWQuaGFzKGkpKSBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3RoZXIgPSBjb3Vyc2VzRm9yRGF5W2ldOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvdGhlclN0YXJ0ID0gdGltZVRvTWludXRlcyhvdGhlci50aW1lLnN0YXJ0KTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3RoZXJFbmQgPSB0aW1lVG9NaW51dGVzKG90aGVyLnRpbWUuZW5kKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXJ0TWludXRlcyA8IG90aGVyRW5kICYmIGVuZE1pbnV0ZXMgPiBvdGhlclN0YXJ0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdmVybGFwcGluZy5wdXNoKHtjb3Vyc2U6IG90aGVyLCBpbmRleDogaX0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBDYWxjdWxhdGUgd2lkdGhzIGFuZCBwb3NpdGlvbnMKICAgICAgICAgICAgICAgICAgICBjb25zdCB0b3RhbE92ZXJsYXBwaW5nID0gb3ZlcmxhcHBpbmcubGVuZ3RoICsgMTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB3aWR0aFBlcmNlbnQgPSAxMDAgLyB0b3RhbE92ZXJsYXBwaW5nOwoKICAgICAgICAgICAgICAgICAgICAvLyBSZW5kZXIgbWFpbiBjb3Vyc2UKICAgICAgICAgICAgICAgICAgICByZW5kZXJFZGl0Q291cnNlQmxvY2soY291cnNlLCBkYXlDb2x1bW4sIHRvcFBvc2l0aW9uLCBoZWlnaHQsIDAsIHdpZHRoUGVyY2VudCk7CiAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc2VkLmFkZChpbmRleCk7CgogICAgICAgICAgICAgICAgICAgIC8vIFJlbmRlciBvdmVybGFwcGluZyBjb3Vyc2VzCiAgICAgICAgICAgICAgICAgICAgb3ZlcmxhcHBpbmcuZm9yRWFjaCgoaXRlbSwgaSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvdGhlclN0YXJ0TWludXRlcyA9IHRpbWVUb01pbnV0ZXMoaXRlbS5jb3Vyc2UudGltZS5zdGFydCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG90aGVyRW5kTWludXRlcyA9IHRpbWVUb01pbnV0ZXMoaXRlbS5jb3Vyc2UudGltZS5lbmQpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvdGhlckR1cmF0aW9uID0gb3RoZXJFbmRNaW51dGVzIC0gb3RoZXJTdGFydE1pbnV0ZXM7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG90aGVyVG9wUG9zaXRpb24gPSAob3RoZXJTdGFydE1pbnV0ZXMgLSAoc3RhcnRIb3VyICogNjApKSAqIHBpeGVsc1Blck1pbnV0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3RoZXJIZWlnaHQgPSBvdGhlckR1cmF0aW9uICogcGl4ZWxzUGVyTWludXRlOwogICAgICAgICAgICAgICAgICAgICAgICByZW5kZXJFZGl0Q291cnNlQmxvY2soaXRlbS5jb3Vyc2UsIGRheUNvbHVtbiwgb3RoZXJUb3BQb3NpdGlvbiwgb3RoZXJIZWlnaHQsIGkgKyAxLCB3aWR0aFBlcmNlbnQpOwogICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzZWQuYWRkKGl0ZW0uaW5kZXgpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgLy8gUmVuZGVyIGVkaXRhYmxlIGNvdXJzZSBibG9jayB3aXRoIG92ZXJsYXAgc3VwcG9ydAogICAgICAgIGZ1bmN0aW9uIHJlbmRlckVkaXRDb3Vyc2VCbG9jayhjb3Vyc2UsIGRheUNvbHVtbiwgdG9wUG9zaXRpb24sIGhlaWdodCwgY29sdW1uLCB3aWR0aFBlcmNlbnQpIHsKICAgICAgICAgICAgY29uc3QgYmxvY2sgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgYmxvY2suY2xhc3NOYW1lID0gJ2NvdXJzZS1ibG9jayc7CgogICAgICAgICAgICAvLyBEZWJ1ZyBUdWVzZGF5IHJlbmRlcnMKICAgICAgICAgICAgaWYgKGRheUNvbHVtbi5pZCA9PT0gJ2VkaXQtdHVlc2RheScgJiYgY291cnNlLnRpbWUuc3RhcnQgPT09ICcxMTowMEFNJykgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYCAg4oaSIHJlbmRlckVkaXRDb3Vyc2VCbG9jayBDUk4gJHtjb3Vyc2UuY3JufTogdG9wPSR7dG9wUG9zaXRpb259cHgsIGxlZnQ9JHsoY29sdW1uICogd2lkdGhQZXJjZW50KS50b0ZpeGVkKDEpfSUsIHdpZHRoPSR7d2lkdGhQZXJjZW50LnRvRml4ZWQoMSl9JSwgY29sdW1uPSR7Y29sdW1ufWApOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBNYXJrIGVkaXRlZCBjb3Vyc2VzCiAgICAgICAgICAgIGlmIChlZGl0ZWRDUk5zLmhhcyhjb3Vyc2UuY3JuKSkgewogICAgICAgICAgICAgICAgYmxvY2suY2xhc3NMaXN0LmFkZCgnZWRpdGVkJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFBvc2l0aW9uIGFuZCBzaXplCiAgICAgICAgICAgIGJsb2NrLnN0eWxlLnRvcCA9IGAke3RvcFBvc2l0aW9ufXB4YDsKICAgICAgICAgICAgYmxvY2suc3R5bGUuaGVpZ2h0ID0gYCR7aGVpZ2h0fXB4YDsKICAgICAgICAgICAgYmxvY2suc3R5bGUubGVmdCA9IGAke2NvbHVtbiAqIHdpZHRoUGVyY2VudH0lYDsKICAgICAgICAgICAgYmxvY2suc3R5bGUud2lkdGggPSBgY2FsYygke3dpZHRoUGVyY2VudH0lIC0gNHB4KWA7CgogICAgICAgICAgICAvLyBVc2UgaW5zdHJ1Y3Rvci1zcGVjaWZpYyBjb2xvcgogICAgICAgICAgICBibG9jay5zdHlsZS5iYWNrZ3JvdW5kID0gZ2V0SW5zdHJ1Y3RvckNvbG9yKGNvdXJzZS5pbnN0cnVjdG9yKTsKCiAgICAgICAgICAgIGJsb2NrLmlubmVySFRNTCA9IGAKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvdXJzZS1udW1iZXIiPiR7Y291cnNlLmNvdXJzZV9udW1iZXJ9PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb3Vyc2UtbmFtZSI+JHtjb3Vyc2UudGl0bGV9PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb3Vyc2UtdGltZSI+JHtjb3Vyc2UudGltZS5zdGFydH08L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRvb2x0aXAiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRvb2x0aXAtcm93Ij48c3BhbiBjbGFzcz0idG9vbHRpcC1sYWJlbCI+Q291cnNlOjwvc3Bhbj48c3BhbiBjbGFzcz0idG9vbHRpcC12YWx1ZSI+JHtjb3Vyc2UuY291cnNlX251bWJlcn08L3NwYW4+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idG9vbHRpcC1yb3ciPjxzcGFuIGNsYXNzPSJ0b29sdGlwLWxhYmVsIj5UaXRsZTo8L3NwYW4+PHNwYW4gY2xhc3M9InRvb2x0aXAtdmFsdWUiPiR7Y291cnNlLnRpdGxlfTwvc3Bhbj48L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0b29sdGlwLXJvdyI+PHNwYW4gY2xhc3M9InRvb2x0aXAtbGFiZWwiPkluc3RydWN0b3I6PC9zcGFuPjxzcGFuIGNsYXNzPSJ0b29sdGlwLXZhbHVlIj4ke2NvdXJzZS5pbnN0cnVjdG9yfTwvc3Bhbj48L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0b29sdGlwLXJvdyI+PHNwYW4gY2xhc3M9InRvb2x0aXAtbGFiZWwiPlRpbWU6PC9zcGFuPjxzcGFuIGNsYXNzPSJ0b29sdGlwLXZhbHVlIj4ke2NvdXJzZS50aW1lLnJhd308L3NwYW4+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idG9vbHRpcC1yb3ciPjxzcGFuIGNsYXNzPSJ0b29sdGlwLWxhYmVsIj5Sb29tOjwvc3Bhbj48c3BhbiBjbGFzcz0idG9vbHRpcC12YWx1ZSI+JHtjb3Vyc2UuYnVpbGRpbmd9ICR7Y291cnNlLnJvb219PC9zcGFuPjwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRvb2x0aXAtcm93Ij48c3BhbiBjbGFzcz0idG9vbHRpcC1sYWJlbCI+Q1JOOjwvc3Bhbj48c3BhbiBjbGFzcz0idG9vbHRpcC12YWx1ZSI+JHtjb3Vyc2UuY3JufTwvc3Bhbj48L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0b29sdGlwLXJvdyI+PHNwYW4gY2xhc3M9InRvb2x0aXAtbGFiZWwiPkNyZWRpdHM6PC9zcGFuPjxzcGFuIGNsYXNzPSJ0b29sdGlwLXZhbHVlIj4ke2NvdXJzZS5jcmVkaXRzfTwvc3Bhbj48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAke2VkaXRlZENSTnMuaGFzKGNvdXJzZS5jcm4pID8gJzxkaXYgY2xhc3M9InRvb2x0aXAtcm93IiBzdHlsZT0iY29sb3I6ICNmYmJjMDQ7IGZvbnQtd2VpZ2h0OiA3MDA7Ij7imqDvuI8gTW9kaWZpZWQ8L2Rpdj4nIDogJyd9CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idG9vbHRpcC1yb3ciIHN0eWxlPSJtYXJnaW4tdG9wOiA4cHg7IHBhZGRpbmctdG9wOiA4cHg7IGJvcmRlci10b3A6IDFweCBzb2xpZCAjNTU1OyBmb250LXN0eWxlOiBpdGFsaWM7IGNvbG9yOiAjYWFhOyI+Q2xpY2sgdG8gZWRpdDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIGA7CgogICAgICAgICAgICBibG9jay5vbmNsaWNrID0gKCkgPT4gb3BlbkVkaXRDb3Vyc2VNb2RhbChjb3Vyc2UpOwoKICAgICAgICAgICAgZGF5Q29sdW1uLmFwcGVuZENoaWxkKGJsb2NrKTsKICAgICAgICB9CgogICAgICAgIC8vIERldGVjdCBjb25mbGljdHMgaW4gZWRpdGVkIGNvdXJzZXMgKHNlcGFyYXRlIGNvbmZsaWN0cyBieSBzcGVjaWZpYyB0aW1lL2RheSkKICAgICAgICBmdW5jdGlvbiBkZXRlY3RFZGl0TW9kZUNvbmZsaWN0cygpIHsKICAgICAgICAgICAgY29uc3QgY29uZmxpY3RzID0gW107CiAgICAgICAgICAgIGNvbnN0IHJvb21Hcm91cHMgPSB7fTsKCiAgICAgICAgICAgIC8vIE5vcm1hbGl6ZSByb29tIGtleSBmb3IgY29uc2lzdGVudCBtYXRjaGluZwogICAgICAgICAgICBmdW5jdGlvbiBub3JtYWxpemVSb29tS2V5KGJ1aWxkaW5nLCByb29tKSB7CiAgICAgICAgICAgICAgICBjb25zdCBub3JtQnVpbGRpbmcgPSBidWlsZGluZy5yZXBsYWNlKC9ccysvZywgJyAnKS50cmltKCkudG9VcHBlckNhc2UoKTsKICAgICAgICAgICAgICAgIGNvbnN0IG5vcm1Sb29tID0gcm9vbS5yZXBsYWNlKC9ccysvZywgJyAnKS50cmltKCkudG9VcHBlckNhc2UoKTsKICAgICAgICAgICAgICAgIHJldHVybiBgJHtub3JtQnVpbGRpbmd9fCR7bm9ybVJvb219YDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gR3JvdXAgZWRpdGVkIGNvdXJzZXMgYnkgcm9vbQogICAgICAgICAgICBlZGl0ZWRDb3Vyc2VzLmZvckVhY2goY291cnNlID0+IHsKICAgICAgICAgICAgICAgIGlmIChjb3Vyc2UuYnVpbGRpbmcgPT09ICdOb3Qgc3BlY2lmaWVkJyB8fCBjb3Vyc2Uucm9vbSA9PT0gJ05vdCBzcGVjaWZpZWQnKSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCByb29tS2V5ID0gbm9ybWFsaXplUm9vbUtleShjb3Vyc2UuYnVpbGRpbmcsIGNvdXJzZS5yb29tKTsKICAgICAgICAgICAgICAgIGlmICghcm9vbUdyb3Vwc1tyb29tS2V5XSkgewogICAgICAgICAgICAgICAgICAgIHJvb21Hcm91cHNbcm9vbUtleV0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiBgJHtjb3Vyc2UuYnVpbGRpbmd9ICR7Y291cnNlLnJvb219YCwKICAgICAgICAgICAgICAgICAgICAgICAgY291cnNlczogW10KICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcm9vbUdyb3Vwc1tyb29tS2V5XS5jb3Vyc2VzLnB1c2goY291cnNlKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBDaGVjayBmb3Igb3ZlcmxhcHMgd2l0aGluIGVhY2ggcm9vbSBhbmQgZ3JvdXAgYnkgZGF5L3RpbWUgd2luZG93CiAgICAgICAgICAgIE9iamVjdC5rZXlzKHJvb21Hcm91cHMpLmZvckVhY2gocm9vbUtleSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCByb29tRGF0YSA9IHJvb21Hcm91cHNbcm9vbUtleV07CiAgICAgICAgICAgICAgICBjb25zdCByb29tQ291cnNlcyA9IHJvb21EYXRhLmNvdXJzZXM7CgogICAgICAgICAgICAgICAgaWYgKHJvb21Db3Vyc2VzLmxlbmd0aCA8IDIpIHJldHVybjsKCiAgICAgICAgICAgICAgICBjb25zdCBjb25mbGljdEdyb3VwcyA9IHt9OwoKICAgICAgICAgICAgICAgIC8vIEZpbmQgYWxsIHBhaXJzIHdpdGggb3ZlcmxhcHMKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcm9vbUNvdXJzZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gaSArIDE7IGogPCByb29tQ291cnNlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb3Vyc2UxID0gcm9vbUNvdXJzZXNbaV07CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvdXJzZTIgPSByb29tQ291cnNlc1tqXTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZXkgc2hhcmUgYW55IGRheXMKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF5czEgPSBjb3Vyc2UxLmRheXMuc3BsaXQoJycpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXlzMiA9IGNvdXJzZTIuZGF5cy5zcGxpdCgnJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNoYXJlZERheXMgPSBkYXlzMS5maWx0ZXIoZCA9PiBkYXlzMi5pbmNsdWRlcyhkKSk7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2hhcmVkRGF5cy5sZW5ndGggPT09IDApIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2tpcCBjcm9zcy1saXN0ZWQgY291cnNlcyAoc2FtZSB0aXRsZSwgdGltZSwgaW5zdHJ1Y3RvciwgZGF5cykKICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlc2UgYXJlIGludGVudGlvbmFsbHkgc2NoZWR1bGVkIHRvZ2V0aGVyCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb3Vyc2UxLnRpdGxlID09PSBjb3Vyc2UyLnRpdGxlICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3Vyc2UxLnRpbWUuc3RhcnQgPT09IGNvdXJzZTIudGltZS5zdGFydCAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY291cnNlMS50aW1lLmVuZCA9PT0gY291cnNlMi50aW1lLmVuZCAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY291cnNlMS5pbnN0cnVjdG9yID09PSBjb3Vyc2UyLmluc3RydWN0b3IgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZTEuZGF5cyA9PT0gY291cnNlMi5kYXlzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGltZXMgb3ZlcmxhcAogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGFydDEgPSB0aW1lVG9NaW51dGVzKGNvdXJzZTEudGltZS5zdGFydCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGVuZDEgPSB0aW1lVG9NaW51dGVzKGNvdXJzZTEudGltZS5lbmQpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGFydDIgPSB0aW1lVG9NaW51dGVzKGNvdXJzZTIudGltZS5zdGFydCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGVuZDIgPSB0aW1lVG9NaW51dGVzKGNvdXJzZTIudGltZS5lbmQpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXJ0MSA8IGVuZDIgJiYgZW5kMSA+IHN0YXJ0MikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRm91bmQgb3ZlcmxhcCAtIGdyb3VwIGJ5IHJvb20gKyBkYXlzICsgb3ZlcmxhcHBpbmcgdGltZSB3aW5kb3cKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG92ZXJsYXBTdGFydCA9IE1hdGgubWF4KHN0YXJ0MSwgc3RhcnQyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG92ZXJsYXBFbmQgPSBNYXRoLm1pbihlbmQxLCBlbmQyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRheXNLZXkgPSBzaGFyZWREYXlzLnNvcnQoKS5qb2luKCcnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGdyb3VwS2V5ID0gYCR7cm9vbURhdGEuZGlzcGxheU5hbWV9XyR7ZGF5c0tleX1fJHtvdmVybGFwU3RhcnR9XyR7b3ZlcmxhcEVuZH1gOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghY29uZmxpY3RHcm91cHNbZ3JvdXBLZXldKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmxpY3RHcm91cHNbZ3JvdXBLZXldID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb29tOiByb29tRGF0YS5kaXNwbGF5TmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hhcmVkRGF5czogc2hhcmVkRGF5cywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY291cnNlczogW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG92ZXJsYXBTdGFydDogb3ZlcmxhcFN0YXJ0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdmVybGFwRW5kOiBvdmVybGFwRW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBZGQgY291cnNlcyBpZiBub3QgYWxyZWFkeSBpbiBncm91cAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZ3JvdXAgPSBjb25mbGljdEdyb3Vwc1tncm91cEtleV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWdyb3VwLmNvdXJzZXMuZmluZChjID0+IGMuY3JuID09PSBjb3Vyc2UxLmNybikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncm91cC5jb3Vyc2VzLnB1c2goY291cnNlMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWdyb3VwLmNvdXJzZXMuZmluZChjID0+IGMuY3JuID09PSBjb3Vyc2UyLmNybikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncm91cC5jb3Vyc2VzLnB1c2goY291cnNlMik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gQWRkIGNvbmZsaWN0IGdyb3VwcyB0byByZXN1bHRzCiAgICAgICAgICAgICAgICBPYmplY3QudmFsdWVzKGNvbmZsaWN0R3JvdXBzKS5mb3JFYWNoKGdyb3VwID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25mbGljdHMucHVzaChncm91cCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICByZXR1cm4gY29uZmxpY3RzOwogICAgICAgIH0KCiAgICAgICAgLy8gRGlzcGxheSBjb25mbGljdHMgaW4gZWRpdCBtb2RlICh1c2luZyBzYW1lIHN0eWxlIGFzIFJvb20gQ29uZmxpY3RzIHRhYikKICAgICAgICBmdW5jdGlvbiBkaXNwbGF5RWRpdE1vZGVDb25mbGljdHMoKSB7CiAgICAgICAgICAgIGNvbnN0IGNvbmZsaWN0cyA9IGRldGVjdEVkaXRNb2RlQ29uZmxpY3RzKCk7CiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0Q29uZmxpY3RzQ29udGVudCcpOwoKICAgICAgICAgICAgaWYgKGNvbmZsaWN0cy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSAnPGRpdiBjbGFzcz0ibm8tY29uZmxpY3RzIj7inIUgTm8gY29uZmxpY3RzIGRldGVjdGVkISBBbGwgY291cnNlcyBhcmUgc2NoZWR1bGVkIHdpdGhvdXQgb3ZlcmxhcC48L2Rpdj4nOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsZXQgaHRtbCA9IGA8ZGl2IHN0eWxlPSJtYXJnaW4tYm90dG9tOiAyMHB4OyBwYWRkaW5nOiAxNXB4OyBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmM2NkOyBib3JkZXItbGVmdDogNHB4IHNvbGlkICNmZjZiNmI7IGJvcmRlci1yYWRpdXM6IDZweDsiPgogICAgICAgICAgICAgICAgPHN0cm9uZz7imqDvuI8gRm91bmQgJHtjb25mbGljdHMubGVuZ3RofSBjb25mbGljdCR7Y29uZmxpY3RzLmxlbmd0aCA+IDEgPyAncycgOiAnJ308L3N0cm9uZz4KICAgICAgICAgICAgICAgIDxwIHN0eWxlPSJtYXJnaW4tdG9wOiA4cHg7IGNvbG9yOiAjNWY2MzY4OyBmb250LXNpemU6IDE0cHg7Ij5UaGUgZm9sbG93aW5nIHJvb21zIGhhdmUgbXVsdGlwbGUgY291cnNlcyBzY2hlZHVsZWQgYXQgb3ZlcmxhcHBpbmcgdGltZXM6PC9wPgogICAgICAgICAgICA8L2Rpdj5gOwoKICAgICAgICAgICAgY29uZmxpY3RzLmZvckVhY2goKGNvbmZsaWN0LCBpbmRleCkgPT4gewogICAgICAgICAgICAgICAgLy8gR2VuZXJhdGUgY29uZmxpY3Qgc2lnbmF0dXJlIGZvciBwZXJzaXN0ZW5jZQogICAgICAgICAgICAgICAgY29uc3QgY3JucyA9IGNvbmZsaWN0LmNvdXJzZXMubWFwKGMgPT4gYy5jcm4pLnNvcnQoKS5qb2luKCctJyk7CiAgICAgICAgICAgICAgICBjb25zdCBkYXlzU3RyID0gY29uZmxpY3Quc2hhcmVkRGF5cy5qb2luKCcnKTsKICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVTdHIgPSBjb25mbGljdC5jb3Vyc2VzWzBdLnRpbWUuc3RhcnQ7CiAgICAgICAgICAgICAgICBjb25zdCBjb25mbGljdFNpZyA9IGAke2NvbmZsaWN0LnJvb219XyR7ZGF5c1N0cn1fJHt0aW1lU3RyfV8ke2NybnN9YDsKICAgICAgICAgICAgICAgIGNvbnN0IGlzSWdub3JlZCA9IGVkaXRJZ25vcmVkQ29uZmxpY3RzLmhhcyhjb25mbGljdFNpZyk7CgogICAgICAgICAgICAgICAgaHRtbCArPSBgPGRpdiBjbGFzcz0iY29uZmxpY3QtZ3JvdXAke2lzSWdub3JlZCA/ICcgY29uZmxpY3QtaGlkZGVuJyA6ICcnfSIgaWQ9ImVkaXQtY29uZmxpY3QtJHtpbmRleH0iIGRhdGEtc2lnbmF0dXJlPSIke2NvbmZsaWN0U2lnfSI+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iY29uZmxpY3QtaWdub3JlLWJ0biIgb25jbGljaz0idG9nZ2xlRWRpdElnbm9yZUNvbmZsaWN0KCcke2NvbmZsaWN0U2lnfScpIj4KICAgICAgICAgICAgICAgICAgICAgICAgJHtpc0lnbm9yZWQgPyAn4oa2IFNob3cnIDogJ+KclSBJZ25vcmUnfQogICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbmZsaWN0LWhlYWRlciI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPvCfk40gJHtjb25mbGljdC5yb29tfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImNvbmZsaWN0LXNldmVyaXR5Ij4ke2NvbmZsaWN0LmNvdXJzZXMubGVuZ3RofSBDT1VSU0VTPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAke2lzSWdub3JlZCA/ICc8c3BhbiBzdHlsZT0ibWFyZ2luLWxlZnQ6IDEwcHg7IGZvbnQtc2l6ZTogMTJweDsgY29sb3I6ICM2NjY7Ij4oUHJldmlvdXNseSBJZ25vcmVkKTwvc3Bhbj4nIDogJyd9CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPHAgc3R5bGU9ImNvbG9yOiAjNzIxYzI0OyBmb250LXNpemU6IDEzcHg7IG1hcmdpbjogMTBweCAwOyI+VGhlc2UgY291cnNlcyBhcmUgc2NoZWR1bGVkIGluIHRoZSBzYW1lIHJvb20gYXQgb3ZlcmxhcHBpbmcgdGltZXMgb24gPHN0cm9uZz4ke2NvbmZsaWN0LnNoYXJlZERheXMubWFwKGQgPT4gKHsnTSc6J01vbmRheScsJ1QnOidUdWVzZGF5JywnVyc6J1dlZG5lc2RheScsJ1InOidUaHVyc2RheScsJ0YnOidGcmlkYXknfVtkXSkpLmpvaW4oJywgJyl9PC9zdHJvbmc+PC9wPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbmZsaWN0LWNvdXJzZXMiPmA7CgogICAgICAgICAgICAgICAgY29uZmxpY3QuY291cnNlcy5mb3JFYWNoKGNvdXJzZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF5c0V4cGFuZGVkID0gZXhwYW5kRGF5cyhjb3Vyc2UuZGF5cyk7CiAgICAgICAgICAgICAgICAgICAgaHRtbCArPSBgPGRpdiBjbGFzcz0iY29uZmxpY3QtY291cnNlLWl0ZW0iPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb25mbGljdC1jb3Vyc2UtaGVhZGVyIj4ke2NvdXJzZS5jb3Vyc2VfbnVtYmVyfSAtICR7Y291cnNlLnRpdGxlfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb25mbGljdC1jb3Vyc2UtZGV0YWlscyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Ryb25nPkNSTjo8L3N0cm9uZz4gJHtjb3Vyc2UuY3JufSB8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Ryb25nPkluc3RydWN0b3I6PC9zdHJvbmc+ICR7Y291cnNlLmluc3RydWN0b3J9PGJyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN0cm9uZz5UaW1lOjwvc3Ryb25nPiAke2NvdXJzZS50aW1lLnJhd30gfAogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN0cm9uZz5EYXlzOjwvc3Ryb25nPiAke2RheXNFeHBhbmRlZH0KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGh0bWwgKz0gYDwvZGl2PjwvZGl2PmA7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gQWRkIHJlc2V0IGJ1dHRvbiBpZiB0aGVyZSBhcmUgaWdub3JlZCBjb25mbGljdHMKICAgICAgICAgICAgaWYgKGVkaXRJZ25vcmVkQ29uZmxpY3RzLnNpemUgPiAwKSB7CiAgICAgICAgICAgICAgICBodG1sICs9IGA8ZGl2IHN0eWxlPSJtYXJnaW4tdG9wOiAyMHB4OyB0ZXh0LWFsaWduOiBjZW50ZXI7Ij4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJlZGl0LWFjdGlvbi1idG4gYnRuLXNlY29uZGFyeSIgb25jbGljaz0icmVzZXRFZGl0SWdub3JlZENvbmZsaWN0cygpIj4KICAgICAgICAgICAgICAgICAgICAgICAg4oa2IFJlc2V0IEFsbCBJZ25vcmVkIENvbmZsaWN0cyAoJHtlZGl0SWdub3JlZENvbmZsaWN0cy5zaXplfSkKICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSBodG1sOwogICAgICAgIH0KCiAgICAgICAgLy8gVG9nZ2xlIGlnbm9yZSBmb3IgZWRpdCBtb2RlIGNvbmZsaWN0cwogICAgICAgIGZ1bmN0aW9uIHRvZ2dsZUVkaXRJZ25vcmVDb25mbGljdChzaWduYXR1cmUpIHsKICAgICAgICAgICAgaWYgKGVkaXRJZ25vcmVkQ29uZmxpY3RzLmhhcyhzaWduYXR1cmUpKSB7CiAgICAgICAgICAgICAgICBlZGl0SWdub3JlZENvbmZsaWN0cy5kZWxldGUoc2lnbmF0dXJlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGVkaXRJZ25vcmVkQ29uZmxpY3RzLmFkZChzaWduYXR1cmUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdlZGl0SWdub3JlZENvbmZsaWN0cycsIEpTT04uc3RyaW5naWZ5KFsuLi5lZGl0SWdub3JlZENvbmZsaWN0c10pKTsKICAgICAgICAgICAgZGlzcGxheUVkaXRNb2RlQ29uZmxpY3RzKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBSZXNldCBpZ25vcmVkIGNvbmZsaWN0cyBpbiBlZGl0IG1vZGUKICAgICAgICBmdW5jdGlvbiByZXNldEVkaXRJZ25vcmVkQ29uZmxpY3RzKCkgewogICAgICAgICAgICBpZiAoIWNvbmZpcm0oJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byByZXNldCBhbGwgaWdub3JlZCBjb25mbGljdHM/IFRoZXkgd2lsbCBhbGwgYmUgc2hvd24gYWdhaW4uJykpIHJldHVybjsKICAgICAgICAgICAgZWRpdElnbm9yZWRDb25mbGljdHMuY2xlYXIoKTsKICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2VkaXRJZ25vcmVkQ29uZmxpY3RzJyk7CiAgICAgICAgICAgIGRpc3BsYXlFZGl0TW9kZUNvbmZsaWN0cygpOwogICAgICAgIH0KCiAgICAgICAgLy8gT3BlbiBtb2RhbCB0byBhZGQgbmV3IGNvdXJzZQogICAgICAgIGZ1bmN0aW9uIG9wZW5BZGRDb3Vyc2VNb2RhbCgpIHsKICAgICAgICAgICAgY3VycmVudEVkaXRDUk4gPSBudWxsOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdE1vZGFsVGl0bGUnKS50ZXh0Q29udGVudCA9ICdBZGQgTmV3IENvdXJzZSc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0Q291cnNlRm9ybScpLnJlc2V0KCk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZWxldGVDb3Vyc2VCdG4nKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHVwbGljYXRlQ291cnNlQnRuJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCiAgICAgICAgICAgIC8vIFNldCBkZWZhdWx0IENSTgogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdENSTklucHV0JykudmFsdWUgPSAnWFhYWFgnOwoKICAgICAgICAgICAgLy8gU2V0IGRlZmF1bHQgc3ViamVjdCBjb2RlIGZyb20gZXhpc3RpbmcgY291cnNlcwogICAgICAgICAgICBjb25zdCBkZWZhdWx0U3ViamVjdCA9IGVkaXRlZENvdXJzZXMubGVuZ3RoID4gMCA/IGVkaXRlZENvdXJzZXNbMF0uc3ViamVjdCA6ICcnOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdFN1YmplY3QnKS52YWx1ZSA9IGRlZmF1bHRTdWJqZWN0OwoKICAgICAgICAgICAgLy8gU2V0IGRlZmF1bHQgc2VjdGlvbgogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdFNlY3Rpb24nKS52YWx1ZSA9ICcxMCc7CgogICAgICAgICAgICAvLyBTZXQgZGVmYXVsdCBjcmVkaXRzCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0Q3JlZGl0cycpLnZhbHVlID0gJzMnOwoKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRNb2RhbCcpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgIH0KCiAgICAgICAgLy8gT3BlbiBtb2RhbCB0byBlZGl0IGV4aXN0aW5nIGNvdXJzZQogICAgICAgIGZ1bmN0aW9uIG9wZW5FZGl0Q291cnNlTW9kYWwoY291cnNlKSB7CiAgICAgICAgICAgIGN1cnJlbnRFZGl0Q1JOID0gY291cnNlLmNybjsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRNb2RhbFRpdGxlJykudGV4dENvbnRlbnQgPSAnRWRpdCBDb3Vyc2UnOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGVsZXRlQ291cnNlQnRuJykuc3R5bGUuZGlzcGxheSA9ICdpbmxpbmUtYmxvY2snOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHVwbGljYXRlQ291cnNlQnRuJykuc3R5bGUuZGlzcGxheSA9ICdpbmxpbmUtYmxvY2snOwoKICAgICAgICAgICAgLy8gUG9wdWxhdGUgZm9ybQogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdENSTicpLnZhbHVlID0gY291cnNlLmNybjsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ29yaWdpbmFsQ1JOJykudmFsdWUgPSBjb3Vyc2UuY3JuOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdFN1YmplY3QnKS52YWx1ZSA9IGNvdXJzZS5zdWJqZWN0IHx8ICcnOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdENvdXJzZU51bScpLnZhbHVlID0gY291cnNlLmNvdXJzZV9udW0gfHwgJyc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0U2VjdGlvbicpLnZhbHVlID0gY291cnNlLnNlY3Rpb24gfHwgJyc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0Q1JOSW5wdXQnKS52YWx1ZSA9IGNvdXJzZS5jcm4gfHwgJyc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0VGl0bGUnKS52YWx1ZSA9IGNvdXJzZS50aXRsZSB8fCAnJzsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRDcmVkaXRzJykudmFsdWUgPSBjb3Vyc2UuY3JlZGl0cyB8fCAnJzsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRJbnN0cnVjdG9yJykudmFsdWUgPSBjb3Vyc2UuaW5zdHJ1Y3RvciB8fCAnJzsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRTdGFydFRpbWUnKS52YWx1ZSA9IGNvdXJzZS50aW1lLnN0YXJ0IHx8ICcnOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdEVuZFRpbWUnKS52YWx1ZSA9IGNvdXJzZS50aW1lLmVuZCB8fCAnJzsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRCdWlsZGluZycpLnZhbHVlID0gY291cnNlLmJ1aWxkaW5nIHx8ICcnOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdFJvb20nKS52YWx1ZSA9IGNvdXJzZS5yb29tIHx8ICcnOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdERhdGVzJykudmFsdWUgPSBjb3Vyc2UuZGF0ZXMgfHwgJyc7CgogICAgICAgICAgICAvLyBTZXQgZGF5cwogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dFtuYW1lPSJlZGl0RGF5Il0nKS5mb3JFYWNoKGNiID0+IGNiLmNoZWNrZWQgPSBmYWxzZSk7CiAgICAgICAgICAgIGlmIChjb3Vyc2UuZGF5cykgewogICAgICAgICAgICAgICAgY291cnNlLmRheXMuc3BsaXQoJycpLmZvckVhY2goZGF5ID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGVja2JveCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYGlucHV0W25hbWU9ImVkaXREYXkiXVt2YWx1ZT0iJHtkYXl9Il1gKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY2hlY2tib3gpIGNoZWNrYm94LmNoZWNrZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0TW9kYWwnKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICB9CgogICAgICAgIC8vIENsb3NlIGVkaXQgbW9kYWwKICAgICAgICBmdW5jdGlvbiBjbG9zZUVkaXRNb2RhbCgpIHsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRNb2RhbCcpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkYXlzRXJyb3InKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGltZUVycm9yJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICB9CgogICAgICAgIC8vIFNhdmUgY291cnNlIGVkaXQKICAgICAgICBmdW5jdGlvbiBzYXZlQ291cnNlRWRpdChldmVudCkgewogICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgLy8gVmFsaWRhdGUgZGF5cwogICAgICAgICAgICBjb25zdCBzZWxlY3RlZERheXMgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0W25hbWU9ImVkaXREYXkiXTpjaGVja2VkJykpCiAgICAgICAgICAgICAgICAubWFwKGNiID0+IGNiLnZhbHVlKS5qb2luKCcnKTsKICAgICAgICAgICAgaWYgKCFzZWxlY3RlZERheXMpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkYXlzRXJyb3InKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkYXlzRXJyb3InKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBWYWxpZGF0ZSB0aW1lcwogICAgICAgICAgICBjb25zdCBzdGFydFRpbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdFN0YXJ0VGltZScpLnZhbHVlOwogICAgICAgICAgICBjb25zdCBlbmRUaW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRFbmRUaW1lJykudmFsdWU7CiAgICAgICAgICAgIGlmICh0aW1lVG9NaW51dGVzKHN0YXJ0VGltZSkgPj0gdGltZVRvTWludXRlcyhlbmRUaW1lKSkgewogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RpbWVFcnJvcicpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RpbWVFcnJvcicpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEdldCBmb3JtIGRhdGEKICAgICAgICAgICAgY29uc3QgbmV3Q1JOID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRDUk5JbnB1dCcpLnZhbHVlOwogICAgICAgICAgICBjb25zdCBvcmlnaW5hbENSTiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcmlnaW5hbENSTicpLnZhbHVlOwoKICAgICAgICAgICAgY29uc3QgY291cnNlRGF0YSA9IHsKICAgICAgICAgICAgICAgIGNybjogbmV3Q1JOLAogICAgICAgICAgICAgICAgc3ViamVjdDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRTdWJqZWN0JykudmFsdWUsCiAgICAgICAgICAgICAgICBjb3Vyc2VfbnVtOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdENvdXJzZU51bScpLnZhbHVlLAogICAgICAgICAgICAgICAgc2VjdGlvbjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRTZWN0aW9uJykudmFsdWUsCiAgICAgICAgICAgICAgICB0aXRsZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRUaXRsZScpLnZhbHVlLAogICAgICAgICAgICAgICAgY3JlZGl0czogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRDcmVkaXRzJykudmFsdWUsCiAgICAgICAgICAgICAgICBpbnN0cnVjdG9yOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdEluc3RydWN0b3InKS52YWx1ZSwKICAgICAgICAgICAgICAgIGRheXM6IHNlbGVjdGVkRGF5cywKICAgICAgICAgICAgICAgIHRpbWU6IHsKICAgICAgICAgICAgICAgICAgICBzdGFydDogc3RhcnRUaW1lLAogICAgICAgICAgICAgICAgICAgIGVuZDogZW5kVGltZSwKICAgICAgICAgICAgICAgICAgICByYXc6IGAke3N0YXJ0VGltZX0gLSAke2VuZFRpbWV9YAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGJ1aWxkaW5nOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdEJ1aWxkaW5nJykudmFsdWUgfHwgJ05vdCBzcGVjaWZpZWQnLAogICAgICAgICAgICAgICAgcm9vbTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXRSb29tJykudmFsdWUgfHwgJ05vdCBzcGVjaWZpZWQnLAogICAgICAgICAgICAgICAgZGF0ZXM6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0RGF0ZXMnKS52YWx1ZSB8fCAnMDEvMTIvMjYgLSAwNC8yNy8yNicsCiAgICAgICAgICAgICAgICBjb3Vyc2VfbnVtYmVyOiBgJHtkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdFN1YmplY3QnKS52YWx1ZX0gJHtkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdENvdXJzZU51bScpLnZhbHVlfWAsCiAgICAgICAgICAgICAgICBzdGF0dXM6ICdPUEVOJwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgLy8gVXBkYXRlIG9yIGFkZCBjb3Vyc2UKICAgICAgICAgICAgaWYgKG9yaWdpbmFsQ1JOKSB7CiAgICAgICAgICAgICAgICAvLyBFZGl0aW5nIGV4aXN0aW5nIGNvdXJzZQogICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBlZGl0ZWRDb3Vyc2VzLmZpbmRJbmRleChjID0+IGMuY3JuID09PSBvcmlnaW5hbENSTik7CiAgICAgICAgICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgZWRpdGVkQ291cnNlc1tpbmRleF0gPSBjb3Vyc2VEYXRhOwogICAgICAgICAgICAgICAgICAgIGVkaXRlZENSTnMuYWRkKG5ld0NSTik7CiAgICAgICAgICAgICAgICAgICAgaWYgKG9yaWdpbmFsQ1JOICE9PSBuZXdDUk4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgZWRpdGVkQ1JOcy5kZWxldGUob3JpZ2luYWxDUk4pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEFkZGluZyBuZXcgY291cnNlCiAgICAgICAgICAgICAgICBlZGl0ZWRDb3Vyc2VzLnB1c2goY291cnNlRGF0YSk7CiAgICAgICAgICAgICAgICBlZGl0ZWRDUk5zLmFkZChuZXdDUk4pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBlZGl0Q291bnQrKzsKICAgICAgICAgICAgdXBkYXRlRWRpdENvdW50KCk7CiAgICAgICAgICAgIHBvcHVsYXRlRWRpdEluc3RydWN0b3JGaWx0ZXIoKTsKICAgICAgICAgICAgcG9wdWxhdGVFZGl0Um9vbUZpbHRlcigpOwogICAgICAgICAgICByZW5kZXJFZGl0Q2FsZW5kYXIoKTsKICAgICAgICAgICAgZGlzcGxheUVkaXRNb2RlQ29uZmxpY3RzKCk7CiAgICAgICAgICAgIHBvcHVsYXRlSW5zdHJ1Y3RvckRhdGFsaXN0KCk7CiAgICAgICAgICAgIGNsb3NlRWRpdE1vZGFsKCk7CgogICAgICAgICAgICBzaG93VG9hc3QoJ+KchSBDb3Vyc2Ugc2F2ZWQgc3VjY2Vzc2Z1bGx5IScsICdzdWNjZXNzJyk7CiAgICAgICAgfQoKICAgICAgICAvLyBEZWxldGUgY291cnNlCiAgICAgICAgZnVuY3Rpb24gZGVsZXRlQ291cnNlKCkgewogICAgICAgICAgICBpZiAoIWNvbmZpcm0oJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWxldGUgdGhpcyBjb3Vyc2U/IFRoaXMgY2Fubm90IGJlIHVuZG9uZS4nKSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCBjcm4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdENSTklucHV0JykudmFsdWU7CiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gZWRpdGVkQ291cnNlcy5maW5kSW5kZXgoYyA9PiBjLmNybiA9PT0gY3JuKTsKCiAgICAgICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICAgICAgICAgIGVkaXRlZENvdXJzZXMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICAgICAgICAgIGVkaXRlZENSTnMuZGVsZXRlKGNybik7CiAgICAgICAgICAgICAgICBlZGl0Q291bnQrKzsKICAgICAgICAgICAgICAgIHVwZGF0ZUVkaXRDb3VudCgpOwogICAgICAgICAgICAgICAgcG9wdWxhdGVFZGl0SW5zdHJ1Y3RvckZpbHRlcigpOwogICAgICAgICAgICAgICAgcG9wdWxhdGVFZGl0Um9vbUZpbHRlcigpOwogICAgICAgICAgICAgICAgcmVuZGVyRWRpdENhbGVuZGFyKCk7CiAgICAgICAgICAgICAgICBkaXNwbGF5RWRpdE1vZGVDb25mbGljdHMoKTsKICAgICAgICAgICAgICAgIGNsb3NlRWRpdE1vZGFsKCk7CiAgICAgICAgICAgICAgICBzaG93VG9hc3QoJ/Cfl5HvuI8gQ291cnNlIGRlbGV0ZWQnLCAnaW5mbycpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBEdXBsaWNhdGUgY291cnNlCiAgICAgICAgZnVuY3Rpb24gZHVwbGljYXRlQ291cnNlKCkgewogICAgICAgICAgICBjb25zdCBvcmlnaW5hbENSTiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0Q1JOSW5wdXQnKS52YWx1ZTsKICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWxDb3Vyc2UgPSBlZGl0ZWRDb3Vyc2VzLmZpbmQoYyA9PiBjLmNybiA9PT0gb3JpZ2luYWxDUk4pOwoKICAgICAgICAgICAgaWYgKCFvcmlnaW5hbENvdXJzZSkgcmV0dXJuOwoKICAgICAgICAgICAgLy8gR2VuZXJhdGUgbmV3IENSTiBhbmQgaW5jcmVtZW50IHNlY3Rpb24KICAgICAgICAgICAgY29uc3QgbWF4Q1JOID0gTWF0aC5tYXgoLi4uZWRpdGVkQ291cnNlcy5tYXAoYyA9PiBwYXJzZUludChjLmNybikgfHwgMCkpOwogICAgICAgICAgICBjb25zdCBuZXdDUk4gPSAobWF4Q1JOICsgMSkudG9TdHJpbmcoKTsKICAgICAgICAgICAgY29uc3Qgc2VjdGlvbk51bSA9IHBhcnNlSW50KG9yaWdpbmFsQ291cnNlLnNlY3Rpb24pIHx8IDEwOwogICAgICAgICAgICBjb25zdCBuZXdTZWN0aW9uID0gKHNlY3Rpb25OdW0gKyAxMCkudG9TdHJpbmcoKTsKCiAgICAgICAgICAgIGNvbnN0IGR1cGxpY2F0ZWRDb3Vyc2UgPSB7CiAgICAgICAgICAgICAgICAuLi5vcmlnaW5hbENvdXJzZSwKICAgICAgICAgICAgICAgIGNybjogbmV3Q1JOLAogICAgICAgICAgICAgICAgc2VjdGlvbjogbmV3U2VjdGlvbiwKICAgICAgICAgICAgICAgIGNvdXJzZV9udW1iZXI6IGAke29yaWdpbmFsQ291cnNlLnN1YmplY3R9ICR7b3JpZ2luYWxDb3Vyc2UuY291cnNlX251bX1gCiAgICAgICAgICAgIH07CgogICAgICAgICAgICBlZGl0ZWRDb3Vyc2VzLnB1c2goZHVwbGljYXRlZENvdXJzZSk7CiAgICAgICAgICAgIGVkaXRlZENSTnMuYWRkKG5ld0NSTik7CiAgICAgICAgICAgIGVkaXRDb3VudCsrOwogICAgICAgICAgICB1cGRhdGVFZGl0Q291bnQoKTsKICAgICAgICAgICAgcG9wdWxhdGVFZGl0SW5zdHJ1Y3RvckZpbHRlcigpOwogICAgICAgICAgICBwb3B1bGF0ZUVkaXRSb29tRmlsdGVyKCk7CiAgICAgICAgICAgIHJlbmRlckVkaXRDYWxlbmRhcigpOwogICAgICAgICAgICBkaXNwbGF5RWRpdE1vZGVDb25mbGljdHMoKTsKICAgICAgICAgICAgY2xvc2VFZGl0TW9kYWwoKTsKCiAgICAgICAgICAgIHNob3dUb2FzdCgn8J+TiyBDb3Vyc2UgZHVwbGljYXRlZCBzdWNjZXNzZnVsbHkhJywgJ3N1Y2Nlc3MnKTsKICAgICAgICB9CgogICAgICAgIC8vIFVwZGF0ZSBlZGl0IGNvdW50IGRpc3BsYXkKICAgICAgICBmdW5jdGlvbiB1cGRhdGVFZGl0Q291bnQoKSB7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0Q291bnQnKS50ZXh0Q29udGVudCA9IGVkaXRlZENSTnMuc2l6ZTsKICAgICAgICB9CgogICAgICAgIC8vIEV4cG9ydCB0byBDU1YKICAgICAgICBmdW5jdGlvbiBleHBvcnRUb0NTVigpIHsKICAgICAgICAgICAgLy8gU29ydCBieSBpbnN0cnVjdG9yLCB0aGVuIGJ5IGNvdXJzZV9udW1iZXIKICAgICAgICAgICAgY29uc3Qgc29ydGVkQ291cnNlcyA9IFsuLi5lZGl0ZWRDb3Vyc2VzXS5zb3J0KChhLCBiKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0cnVjdG9yQ29tcGFyZSA9IChhLmluc3RydWN0b3IgfHwgJycpLmxvY2FsZUNvbXBhcmUoYi5pbnN0cnVjdG9yIHx8ICcnKTsKICAgICAgICAgICAgICAgIGlmIChpbnN0cnVjdG9yQ29tcGFyZSAhPT0gMCkgcmV0dXJuIGluc3RydWN0b3JDb21wYXJlOwogICAgICAgICAgICAgICAgcmV0dXJuIChhLmNvdXJzZV9udW1iZXIgfHwgJycpLmxvY2FsZUNvbXBhcmUoYi5jb3Vyc2VfbnVtYmVyIHx8ICcnKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjb25zdCBoZWFkZXJzID0gWydDUk4nLCAnU3ViamVjdCcsICdDb3Vyc2VOdW0nLCAnU2VjdGlvbicsICdUaXRsZScsICdDcmVkaXRzJywgJ0luc3RydWN0b3InLCAnRGF5cycsICdTdGFydFRpbWUnLCAnRW5kVGltZScsICdCdWlsZGluZycsICdSb29tJywgJ0RhdGVzJ107CiAgICAgICAgICAgIGNvbnN0IHJvd3MgPSBzb3J0ZWRDb3Vyc2VzLm1hcChjID0+IFsKICAgICAgICAgICAgICAgIGMuY3JuLAogICAgICAgICAgICAgICAgYy5zdWJqZWN0LAogICAgICAgICAgICAgICAgYy5jb3Vyc2VfbnVtLAogICAgICAgICAgICAgICAgYy5zZWN0aW9uLAogICAgICAgICAgICAgICAgYy50aXRsZSwKICAgICAgICAgICAgICAgIGMuY3JlZGl0cywKICAgICAgICAgICAgICAgIGMuaW5zdHJ1Y3RvciwKICAgICAgICAgICAgICAgIGMuZGF5cywKICAgICAgICAgICAgICAgIGMudGltZS5zdGFydCwKICAgICAgICAgICAgICAgIGMudGltZS5lbmQsCiAgICAgICAgICAgICAgICBjLmJ1aWxkaW5nLAogICAgICAgICAgICAgICAgYy5yb29tLAogICAgICAgICAgICAgICAgYy5kYXRlcwogICAgICAgICAgICBdKTsKCiAgICAgICAgICAgIGNvbnN0IGNzdkNvbnRlbnQgPSBbCiAgICAgICAgICAgICAgICBoZWFkZXJzLmpvaW4oJywnKSwKICAgICAgICAgICAgICAgIC4uLnJvd3MubWFwKHJvdyA9PiByb3cubWFwKGNlbGwgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNlbGxTdHIgPSAoY2VsbCB8fCAnJykudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgICAgICAvLyBFc2NhcGUgcXVvdGVzIGFuZCB3cmFwIGluIHF1b3RlcyBpZiBjb250YWlucyBjb21tYSBvciBxdW90ZQogICAgICAgICAgICAgICAgICAgIGlmIChjZWxsU3RyLmluY2x1ZGVzKCcsJykgfHwgY2VsbFN0ci5pbmNsdWRlcygnIicpIHx8IGNlbGxTdHIuaW5jbHVkZXMoJ1xuJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGAiJHtjZWxsU3RyLnJlcGxhY2UoLyIvZywgJyIiJyl9ImA7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBjZWxsU3RyOwogICAgICAgICAgICAgICAgfSkuam9pbignLCcpKQogICAgICAgICAgICBdLmpvaW4oJ1xuJyk7CgogICAgICAgICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2NzdkNvbnRlbnRdLCB7IHR5cGU6ICd0ZXh0L2NzdicgfSk7CiAgICAgICAgICAgIGNvbnN0IHVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7CiAgICAgICAgICAgIGNvbnN0IGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICAgICAgICAgIGEuaHJlZiA9IHVybDsKICAgICAgICAgICAgYS5kb3dubG9hZCA9IGBzY2hlZHVsZV8ke25ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zbGljZSgwLDEwKX0uY3N2YDsKICAgICAgICAgICAgYS5jbGljaygpOwogICAgICAgICAgICBVUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7CgogICAgICAgICAgICBzaG93VG9hc3QoJ/Cfk6UgQ1NWIGV4cG9ydGVkIHN1Y2Nlc3NmdWxseSEnLCAnc3VjY2VzcycpOwogICAgICAgIH0KCiAgICAgICAgLy8gSGFuZGxlIENTViBpbXBvcnQKICAgICAgICBmdW5jdGlvbiBoYW5kbGVDU1ZJbXBvcnQoZXZlbnQpIHsKICAgICAgICAgICAgY29uc3QgZmlsZSA9IGV2ZW50LnRhcmdldC5maWxlc1swXTsKICAgICAgICAgICAgaWYgKCFmaWxlKSByZXR1cm47CgogICAgICAgICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgY29uc3QgY3N2ID0gZS50YXJnZXQucmVzdWx0OwogICAgICAgICAgICAgICAgY29uc3QgbGluZXMgPSBjc3Yuc3BsaXQoJ1xuJykuZmlsdGVyKGxpbmUgPT4gbGluZS50cmltKCkpOwoKICAgICAgICAgICAgICAgIGlmIChsaW5lcy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgICAgICBzaG93VG9hc3QoJ+KdjCBDU1YgZmlsZSBpcyBlbXB0eScsICdlcnJvcicpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb25zdCBoZWFkZXJzID0gbGluZXNbMF0uc3BsaXQoJywnKS5tYXAoaCA9PiBoLnRyaW0oKS5yZXBsYWNlKC8iL2csICcnKSk7CgogICAgICAgICAgICAgICAgY29uc3QgaW1wb3J0ZWQgPSBbXTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgbGluZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZXMgPSBwYXJzZUNTVkxpbmUobGluZXNbaV0pOwoKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgUm93ICR7aX06IHBhcnNlZCAke3ZhbHVlcy5sZW5ndGh9IGNvbHVtbnNgLCB2YWx1ZXMpOwoKICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWVzLmxlbmd0aCA8IDYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBTa2lwcGluZyByb3cgJHtpfTogb25seSAke3ZhbHVlcy5sZW5ndGh9IGNvbHVtbnMgKG5lZWQgYXQgbGVhc3QgNilgKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBQYXJzZSB0aGUgY291cnNlIGRhdGEgd2l0aCBwcm9wZXIgdmFsaWRhdGlvbgogICAgICAgICAgICAgICAgICAgIC8vIENTViBmb3JtYXQ6IENSTiwgU3ViamVjdCwgQ291cnNlTnVtLCBTZWN0aW9uLCBUaXRsZSwgQ3JlZGl0cywgSW5zdHJ1Y3RvciwgRGF5cywgU3RhcnRUaW1lLCBFbmRUaW1lLCBCdWlsZGluZywgUm9vbSwgRGF0ZXMKICAgICAgICAgICAgICAgICAgICBjb25zdCBjcm4gPSB2YWx1ZXNbMF0/LnRyaW0oKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdWJqZWN0ID0gdmFsdWVzWzFdPy50cmltKCkgfHwgJ0dFT0cnOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvdXJzZV9udW0gPSB2YWx1ZXNbMl0/LnRyaW0oKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWN0aW9uID0gdmFsdWVzWzNdPy50cmltKCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGl0bGUgPSB2YWx1ZXNbNF0/LnRyaW0oKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjcmVkaXRzID0gdmFsdWVzWzVdPy50cmltKCkgfHwgJzAuMDAnOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGluc3RydWN0b3IgPSB2YWx1ZXNbNl0/LnRyaW0oKSB8fCAnVEJBJzsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXlzID0gdmFsdWVzWzddPy50cmltKCkgfHwgJ01XJzsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGFydFRpbWUgPSB2YWx1ZXNbOF0/LnRyaW0oKSB8fCAnMDk6MDBBTSc7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZW5kVGltZSA9IHZhbHVlc1s5XT8udHJpbSgpIHx8ICcxMDowMEFNJzsKICAgICAgICAgICAgICAgICAgICBjb25zdCBidWlsZGluZyA9IHZhbHVlc1sxMF0/LnRyaW0oKSB8fCAnTm90IHNwZWNpZmllZCc7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgcm9vbSA9IHZhbHVlc1sxMV0/LnRyaW0oKSB8fCAnTm90IHNwZWNpZmllZCc7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0ZXMgPSB2YWx1ZXNbMTJdPy50cmltKCkgfHwgJzAxLzEyLzI2IC0gMDQvMjcvMjYnOwoKICAgICAgICAgICAgICAgICAgICBpZiAoIWNybiB8fCAhdGl0bGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBTa2lwcGluZyByb3cgJHtpfTogbWlzc2luZyByZXF1aXJlZCBmaWVsZHMgLSBDUk49JHtjcm59LCBUaXRsZT0ke3RpdGxlfWApOwogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIFZhbGlkYXRlIHRpbWUgZm9ybWF0CiAgICAgICAgICAgICAgICAgICAgaWYgKCFzdGFydFRpbWUubWF0Y2goL1xkezEsMn06XGR7Mn1bQVBdTS8pIHx8ICFlbmRUaW1lLm1hdGNoKC9cZHsxLDJ9OlxkezJ9W0FQXU0vKSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYFNraXBwaW5nIHJvdyAke2l9OiBpbnZhbGlkIHRpbWUgZm9ybWF0IC0gU3RhcnQ9JHtzdGFydFRpbWV9LCBFbmQ9JHtlbmRUaW1lfWApOwogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIFNraXAgY291cnNlcyB3aXRob3V0IHNjaGVkdWxlZCBtZWV0aW5nIHRpbWVzIChlLmcuLCBpbmRlcGVuZGVudCBzdHVkeSwgcmVzZWFyY2gpCiAgICAgICAgICAgICAgICAgICAgaWYgKCFkYXlzIHx8ICFkYXlzLm1hdGNoKC9eW01UV1JGXSskLykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBTa2lwcGluZyByb3cgJHtpfTogbm8gc2NoZWR1bGVkIG1lZXRpbmcgZGF5cyAtIERheXM9JHtkYXlzfSAobGlrZWx5IGluZGVwZW5kZW50IHN0dWR5L3Jlc2VhcmNoKWApOwogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBjb3Vyc2Ugb2JqZWN0IG1hdGNoaW5nIEVYQUNUIHNjcmFwZXIgZm9ybWF0CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY291cnNlID0gewogICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICdPUEVOJywKICAgICAgICAgICAgICAgICAgICAgICAgY3JuOiBjcm4sCiAgICAgICAgICAgICAgICAgICAgICAgIHN1YmplY3Q6IHN1YmplY3QsCiAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZV9udW06IGNvdXJzZV9udW0sCiAgICAgICAgICAgICAgICAgICAgICAgIHNlY3Rpb246IHNlY3Rpb24sCiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiB0aXRsZSwKICAgICAgICAgICAgICAgICAgICAgICAgY3JlZGl0czogY3JlZGl0cywKICAgICAgICAgICAgICAgICAgICAgICAgaW5zdHJ1Y3RvcjogaW5zdHJ1Y3RvciwKICAgICAgICAgICAgICAgICAgICAgICAgZGF5czogZGF5cywKICAgICAgICAgICAgICAgICAgICAgICAgdGltZTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IHN0YXJ0VGltZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZDogZW5kVGltZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhdzogYCR7c3RhcnRUaW1lfSAtICR7ZW5kVGltZX1gCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGVzOiBkYXRlcywKICAgICAgICAgICAgICAgICAgICAgICAgYnVpbGRpbmc6IGJ1aWxkaW5nLAogICAgICAgICAgICAgICAgICAgICAgICByb29tOiByb29tLAogICAgICAgICAgICAgICAgICAgICAgICBjb3Vyc2VfbnVtYmVyOiBgJHtzdWJqZWN0fSAke2NvdXJzZV9udW19YAogICAgICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgICAgIC8vIERlYnVnIGxvZyBmb3IgcHJvYmxlbWF0aWMgY291cnNlCiAgICAgICAgICAgICAgICAgICAgaWYgKGNybiA9PT0gJzQzNzg5JykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnPT09IERFQlVHIENSTiA0Mzc4OSBJTVBPUlQgPT09Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdSYXcgQ1NWIHZhbHVlczonLCB2YWx1ZXMpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnU3RhcnRUaW1lIGZyb20gQ1NWIChpbmRleCA4KTonLCB2YWx1ZXNbOF0pOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRW5kVGltZSBmcm9tIENTViAoaW5kZXggOSk6JywgdmFsdWVzWzldKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1BhcnNlZCBzdGFydFRpbWU6Jywgc3RhcnRUaW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1BhcnNlZCBlbmRUaW1lOicsIGVuZFRpbWUpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRnVsbCBjb3Vyc2Ugb2JqZWN0OicsIEpTT04uc3RyaW5naWZ5KGNvdXJzZSwgbnVsbCwgMikpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygndGltZVRvTWludXRlcyhzdGFydFRpbWUpOicsIHRpbWVUb01pbnV0ZXMoc3RhcnRUaW1lKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCd0aW1lVG9NaW51dGVzKGVuZFRpbWUpOicsIHRpbWVUb01pbnV0ZXMoZW5kVGltZSkpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaW1wb3J0ZWQucHVzaChjb3Vyc2UpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChpbXBvcnRlZC5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgICAgICBzaG93VG9hc3QoJ+KdjCBObyB2YWxpZCBjb3Vyc2VzIGZvdW5kIGluIENTVicsICdlcnJvcicpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoY29uZmlybShgSW1wb3J0ICR7aW1wb3J0ZWQubGVuZ3RofSBjb3Vyc2VzPyBUaGlzIHdpbGwgUkVQTEFDRSBhbGwgY3VycmVudCBjb3Vyc2VzIGluIGVkaXQgbW9kZS5gKSkgewogICAgICAgICAgICAgICAgICAgIC8vIFNldCBmbGFnIHRvIHByZXZlbnQgbXVsdGlwbGUgcmVuZGVycyBkdXJpbmcgaW1wb3J0CiAgICAgICAgICAgICAgICAgICAgaXNJbXBvcnRpbmcgPSB0cnVlOwoKICAgICAgICAgICAgICAgICAgICAvLyBSRVBMQUNFIGFsbCBjb3Vyc2VzIHdpdGggaW1wb3J0ZWQgZGF0YQogICAgICAgICAgICAgICAgICAgIGVkaXRlZENvdXJzZXMgPSBpbXBvcnRlZDsKICAgICAgICAgICAgICAgICAgICBlZGl0ZWRDUk5zLmNsZWFyKCk7CiAgICAgICAgICAgICAgICAgICAgaW1wb3J0ZWQuZm9yRWFjaChjb3Vyc2UgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBlZGl0ZWRDUk5zLmFkZChjb3Vyc2UuY3JuKTsKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgZWRpdENvdW50ID0gaW1wb3J0ZWQubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIGlzSW1wb3J0aW5nID0gZmFsc2U7CgogICAgICAgICAgICAgICAgICAgIC8vIEZvcmNlIHJlZnJlc2ggYnkgc3dpdGNoaW5nIHRhYnMgYXdheSBhbmQgYmFjawogICAgICAgICAgICAgICAgICAgIHN3aXRjaFRhYigncm9vbS1jb25mbGljdHMnKTsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoVGFiKCdlZGl0LXNjaGVkdWxlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNob3dUb2FzdChgSW1wb3J0ZWQgJHtpbXBvcnRlZC5sZW5ndGh9IGNvdXJzZXMgc3VjY2Vzc2Z1bGx5IWAsICdzdWNjZXNzJyk7CiAgICAgICAgICAgICAgICAgICAgfSwgMTAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgcmVhZGVyLnJlYWRBc1RleHQoZmlsZSk7CiAgICAgICAgICAgIGV2ZW50LnRhcmdldC52YWx1ZSA9ICcnOyAvLyBSZXNldCBmaWxlIGlucHV0CiAgICAgICAgfQoKICAgICAgICAvLyBQYXJzZSBDU1YgbGluZSBoYW5kbGluZyBxdW90ZXMgYW5kIGNvbW1hcwogICAgICAgIGZ1bmN0aW9uIHBhcnNlQ1NWTGluZShsaW5lKSB7CiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IFtdOwogICAgICAgICAgICBsZXQgY3VycmVudCA9ICcnOwogICAgICAgICAgICBsZXQgaW5RdW90ZXMgPSBmYWxzZTsKCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGluZS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgY29uc3QgY2hhciA9IGxpbmVbaV07CiAgICAgICAgICAgICAgICBjb25zdCBuZXh0Q2hhciA9IGxpbmVbaSArIDFdOwoKICAgICAgICAgICAgICAgIGlmIChjaGFyID09PSAnIicgJiYgaW5RdW90ZXMgJiYgbmV4dENoYXIgPT09ICciJykgewogICAgICAgICAgICAgICAgICAgIGN1cnJlbnQgKz0gJyInOwogICAgICAgICAgICAgICAgICAgIGkrKzsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY2hhciA9PT0gJyInKSB7CiAgICAgICAgICAgICAgICAgICAgaW5RdW90ZXMgPSAhaW5RdW90ZXM7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNoYXIgPT09ICcsJyAmJiAhaW5RdW90ZXMpIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChjdXJyZW50LnRyaW0oKSk7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudCA9ICcnOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50ICs9IGNoYXI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVzdWx0LnB1c2goY3VycmVudC50cmltKCkpOwogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KCiAgICAgICAgLy8gRG93bmxvYWQgbW9kaWZpZWQgSlNPTgogICAgICAgIGZ1bmN0aW9uIGRvd25sb2FkTW9kaWZpZWRKU09OKCkgewogICAgICAgICAgICBjb25zdCBqc29uID0gSlNPTi5zdHJpbmdpZnkoZWRpdGVkQ291cnNlcywgbnVsbCwgMik7CiAgICAgICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbanNvbl0sIHsgdHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nIH0pOwogICAgICAgICAgICBjb25zdCB1cmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpOwogICAgICAgICAgICBjb25zdCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICAgICAgICBhLmhyZWYgPSB1cmw7CiAgICAgICAgICAgIGEuZG93bmxvYWQgPSBgZ3d1X2NvdXJzZV9jYWxlbmRhcl9lZGl0ZWRfJHtuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc2xpY2UoMCwxMCl9Lmpzb25gOwogICAgICAgICAgICBhLmNsaWNrKCk7CiAgICAgICAgICAgIFVSTC5yZXZva2VPYmplY3RVUkwodXJsKTsKCiAgICAgICAgICAgIHNob3dUb2FzdCgn8J+SviBKU09OIHNhdmVkIHN1Y2Nlc3NmdWxseSEnLCAnc3VjY2VzcycpOwogICAgICAgIH0KCiAgICAgICAgLy8gRXhwb3J0IGVkaXRlZCBjYWxlbmRhciB1c2luZyBlbWJlZGRlZCB0ZW1wbGF0ZSAoYmFzZTY0IGVuY29kZWQpCiAgICAgICAgZnVuY3Rpb24gZXhwb3J0RWRpdGVkQ2FsZW5kYXIoKSB7CiAgICAgICAgICAgIC8vIFByb21wdCBmb3IgZmlsZW5hbWUKICAgICAgICAgICAgY29uc3QgZGVmYXVsdE5hbWUgPSBgZWRpdGVkX2NhbGVuZGFyXyR7bmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNsaWNlKDAsMTApfS5odG1sYDsKICAgICAgICAgICAgY29uc3QgZmlsZW5hbWUgPSBwcm9tcHQoJ0VudGVyIGZpbGVuYW1lIGZvciB0aGUgZXhwb3J0ZWQgY2FsZW5kYXI6JywgZGVmYXVsdE5hbWUpOwogICAgICAgICAgICBpZiAoIWZpbGVuYW1lKSByZXR1cm47CgogICAgICAgICAgICBjb25zdCBmaW5hbEZpbGVuYW1lID0gZmlsZW5hbWUuZW5kc1dpdGgoJy5odG1sJykgPyBmaWxlbmFtZSA6IGZpbGVuYW1lICsgJy5odG1sJzsKCiAgICAgICAgICAgIC8vIERlY29kZSB0aGUgYmFzZTY0IHRlbXBsYXRlICh3aXRoIHByb3BlciBVVEYtOCBoYW5kbGluZykKICAgICAgICAgICAgY29uc3QgdGVtcGxhdGUgPSBkZWNvZGVVUklDb21wb25lbnQoZXNjYXBlKGF0b2IoRVhQT1JUX1RFTVBMQVRFX0I2NCkpKTsKCiAgICAgICAgICAgIC8vIFJlcGxhY2UgcGxhY2Vob2xkZXIgd2l0aCBlZGl0ZWQgY291cnNlcwogICAgICAgICAgICBjb25zdCBleHBvcnRIVE1MID0gdGVtcGxhdGUucmVwbGFjZSgKICAgICAgICAgICAgICAgICdfX0NPVVJTRVNfREFUQV9QTEFDRUhPTERFUl9fJywKICAgICAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KGVkaXRlZENvdXJzZXMpCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAvLyBEb3dubG9hZCB0aGUgZmlsZQogICAgICAgICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2V4cG9ydEhUTUxdLCB7IHR5cGU6ICd0ZXh0L2h0bWwnIH0pOwogICAgICAgICAgICBjb25zdCB1cmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpOwogICAgICAgICAgICBjb25zdCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICAgICAgICBhLmhyZWYgPSB1cmw7CiAgICAgICAgICAgIGEuZG93bmxvYWQgPSBmaW5hbEZpbGVuYW1lOwogICAgICAgICAgICBhLmNsaWNrKCk7CiAgICAgICAgICAgIFVSTC5yZXZva2VPYmplY3RVUkwodXJsKTsKCiAgICAgICAgICAgIHNob3dUb2FzdChg8J+ThCBDYWxlbmRhciBleHBvcnRlZCBhcyAke2ZpbmFsRmlsZW5hbWV9YCwgJ3N1Y2Nlc3MnKTsKICAgICAgICB9CgogICAgICAgIC8vIEhlbHBlciBmdW5jdGlvbiB0byBkb3dubG9hZCBhIGZpbGUKICAgICAgICBmdW5jdGlvbiBkb3dubG9hZEZpbGUoY29udGVudCwgZmlsZW5hbWUsIG1pbWVUeXBlKSB7CiAgICAgICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbY29udGVudF0sIHsgdHlwZTogbWltZVR5cGUgfSk7CiAgICAgICAgICAgIGNvbnN0IHVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7CiAgICAgICAgICAgIGNvbnN0IGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICAgICAgICAgIGEuaHJlZiA9IHVybDsKICAgICAgICAgICAgYS5kb3dubG9hZCA9IGZpbGVuYW1lOwogICAgICAgICAgICBhLmNsaWNrKCk7CiAgICAgICAgICAgIFVSTC5yZXZva2VPYmplY3RVUkwodXJsKTsKICAgICAgICB9CgogICAgICAgIC8vIEV4cG9ydCBzY2hlZHVsZSAtIGRvd25sb2FkcyBIVE1MLCBDU1YsIGFuZCBKU09OCiAgICAgICAgZnVuY3Rpb24gZXhwb3J0U2NoZWR1bGUoKSB7CiAgICAgICAgICAgIC8vIFByb21wdCBmb3IgYmFzZSBmaWxlbmFtZQogICAgICAgICAgICBjb25zdCBkZWZhdWx0TmFtZSA9IGBzY2hlZHVsZV8ke25ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zbGljZSgwLDEwKX1gOwogICAgICAgICAgICBjb25zdCBiYXNlTmFtZSA9IHByb21wdCgnRW50ZXIgYmFzZSBmaWxlbmFtZSAod2lsbCBjcmVhdGUgLmh0bWwsIC5jc3YsIGFuZCAuanNvbiBmaWxlcyk6JywgZGVmYXVsdE5hbWUpOwogICAgICAgICAgICBpZiAoIWJhc2VOYW1lKSByZXR1cm47CgogICAgICAgICAgICAvLyAxLiBFeHBvcnQgSFRNTCBjYWxlbmRhcgogICAgICAgICAgICBjb25zdCB0ZW1wbGF0ZSA9IGRlY29kZVVSSUNvbXBvbmVudChlc2NhcGUoYXRvYihFWFBPUlRfVEVNUExBVEVfQjY0KSkpOwogICAgICAgICAgICBjb25zdCBleHBvcnRIVE1MID0gdGVtcGxhdGUucmVwbGFjZSgKICAgICAgICAgICAgICAgICdfX0NPVVJTRVNfREFUQV9QTEFDRUhPTERFUl9fJywKICAgICAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KGVkaXRlZENvdXJzZXMpCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGRvd25sb2FkRmlsZShleHBvcnRIVE1MLCBiYXNlTmFtZSArICcuaHRtbCcsICd0ZXh0L2h0bWwnKTsKCiAgICAgICAgICAgIC8vIDIuIEV4cG9ydCBDU1YKICAgICAgICAgICAgY29uc3Qgc29ydGVkQ291cnNlcyA9IFsuLi5lZGl0ZWRDb3Vyc2VzXS5zb3J0KChhLCBiKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0cnVjdG9yQ29tcGFyZSA9IChhLmluc3RydWN0b3IgfHwgJycpLmxvY2FsZUNvbXBhcmUoYi5pbnN0cnVjdG9yIHx8ICcnKTsKICAgICAgICAgICAgICAgIGlmIChpbnN0cnVjdG9yQ29tcGFyZSAhPT0gMCkgcmV0dXJuIGluc3RydWN0b3JDb21wYXJlOwogICAgICAgICAgICAgICAgcmV0dXJuIChhLmNvdXJzZV9udW1iZXIgfHwgJycpLmxvY2FsZUNvbXBhcmUoYi5jb3Vyc2VfbnVtYmVyIHx8ICcnKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNvbnN0IGhlYWRlcnMgPSBbJ0NSTicsICdTdWJqZWN0JywgJ0NvdXJzZU51bScsICdTZWN0aW9uJywgJ1RpdGxlJywgJ0NyZWRpdHMnLCAnSW5zdHJ1Y3RvcicsICdEYXlzJywgJ1N0YXJ0VGltZScsICdFbmRUaW1lJywgJ0J1aWxkaW5nJywgJ1Jvb20nLCAnRGF0ZXMnXTsKICAgICAgICAgICAgY29uc3Qgcm93cyA9IHNvcnRlZENvdXJzZXMubWFwKGMgPT4gWwogICAgICAgICAgICAgICAgYy5jcm4sIGMuc3ViamVjdCwgYy5jb3Vyc2VfbnVtLCBjLnNlY3Rpb24sIGMudGl0bGUsIGMuY3JlZGl0cywKICAgICAgICAgICAgICAgIGMuaW5zdHJ1Y3RvciwgYy5kYXlzLCBjLnRpbWUuc3RhcnQsIGMudGltZS5lbmQsIGMuYnVpbGRpbmcsIGMucm9vbSwgYy5kYXRlcwogICAgICAgICAgICBdKTsKICAgICAgICAgICAgY29uc3QgY3N2Q29udGVudCA9IFsKICAgICAgICAgICAgICAgIGhlYWRlcnMuam9pbignLCcpLAogICAgICAgICAgICAgICAgLi4ucm93cy5tYXAocm93ID0+IHJvdy5tYXAoY2VsbCA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2VsbFN0ciA9IChjZWxsIHx8ICcnKS50b1N0cmluZygpOwogICAgICAgICAgICAgICAgICAgIGlmIChjZWxsU3RyLmluY2x1ZGVzKCcsJykgfHwgY2VsbFN0ci5pbmNsdWRlcygnIicpIHx8IGNlbGxTdHIuaW5jbHVkZXMoJ1xuJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGAiJHtjZWxsU3RyLnJlcGxhY2UoLyIvZywgJyIiJyl9ImA7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBjZWxsU3RyOwogICAgICAgICAgICAgICAgfSkuam9pbignLCcpKQogICAgICAgICAgICBdLmpvaW4oJ1xuJyk7CiAgICAgICAgICAgIGRvd25sb2FkRmlsZShjc3ZDb250ZW50LCBiYXNlTmFtZSArICcuY3N2JywgJ3RleHQvY3N2Jyk7CgogICAgICAgICAgICAvLyAzLiBFeHBvcnQgSlNPTgogICAgICAgICAgICBjb25zdCBqc29uID0gSlNPTi5zdHJpbmdpZnkoZWRpdGVkQ291cnNlcywgbnVsbCwgMik7CiAgICAgICAgICAgIGRvd25sb2FkRmlsZShqc29uLCBiYXNlTmFtZSArICcuanNvbicsICdhcHBsaWNhdGlvbi9qc29uJyk7CgogICAgICAgICAgICBzaG93VG9hc3QoYPCfk6YgRXhwb3J0ZWQ6ICR7YmFzZU5hbWV9Lmh0bWwsIC5jc3YsIC5qc29uYCwgJ3N1Y2Nlc3MnKTsKICAgICAgICB9CgogICAgICAgIC8vIFNob3cgdG9hc3Qgbm90aWZpY2F0aW9uCiAgICAgICAgZnVuY3Rpb24gc2hvd1RvYXN0KG1lc3NhZ2UsIHR5cGUpIHsKICAgICAgICAgICAgY29uc3QgdG9hc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgdG9hc3Quc3R5bGUuY3NzVGV4dCA9IGAKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBmaXhlZDsKICAgICAgICAgICAgICAgIHRvcDogMjBweDsKICAgICAgICAgICAgICAgIHJpZ2h0OiAyMHB4OwogICAgICAgICAgICAgICAgcGFkZGluZzogMTVweCAyNXB4OwogICAgICAgICAgICAgICAgYmFja2dyb3VuZDogJHt0eXBlID09PSAnc3VjY2VzcycgPyAnIzM0YTg1MycgOiB0eXBlID09PSAnZXJyb3InID8gJyNlYTQzMzUnIDogJyM0Mjg1ZjQnfTsKICAgICAgICAgICAgICAgIGNvbG9yOiB3aGl0ZTsKICAgICAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDhweDsKICAgICAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgNHB4IDEycHggcmdiYSgwLDAsMCwwLjMpOwogICAgICAgICAgICAgICAgei1pbmRleDogMTAwMDA7CiAgICAgICAgICAgICAgICBmb250LXdlaWdodDogNjAwOwogICAgICAgICAgICAgICAgYW5pbWF0aW9uOiBzbGlkZUluIDAuM3MgZWFzZTsKICAgICAgICAgICAgYDsKICAgICAgICAgICAgdG9hc3QudGV4dENvbnRlbnQgPSBtZXNzYWdlOwogICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRvYXN0KTsKCiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgdG9hc3Quc3R5bGUuYW5pbWF0aW9uID0gJ3NsaWRlT3V0IDAuM3MgZWFzZSc7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRvYXN0LnJlbW92ZSgpLCAzMDApOwogICAgICAgICAgICB9LCAzMDAwKTsKICAgICAgICB9CgogICAgICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgICAgICAvLyBFTkQgRURJVCBNT0RFIEZVTkNUSU9OUwogICAgICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiAgICAgICAgLy8gSW5pdGlhbGl6ZQogICAgICAgIGdlbmVyYXRlSW5zdHJ1Y3RvckNvbG9ycygpOwogICAgICAgIGRldGVjdFJvb21Db25mbGljdHMoKTsKICAgICAgICBjcmVhdGVUaW1lU2xvdHMoKTsKICAgICAgICByZW5kZXJDb3Vyc2VzKCk7CiAgICAgICAgcG9wdWxhdGVJbnN0cnVjdG9yTGlzdCgpOwogICAgICAgIHVwZGF0ZUluc3RydWN0b3JMZWdlbmQoKTsKICAgIDwvc2NyaXB0PgogICAgPC9kaXY+IDwhLS0gZW5kIG1haW4tY29udGVudCAtLT4KCiAgICA8IS0tIFJlYWQgdGhlIERvY3Mgc3R5bGUgZm9vdGVyIC0tPgogICAgPGZvb3RlciBjbGFzcz0icnRkLWZvb3RlciI+CiAgICAgICAgPGRpdiBjbGFzcz0icnRkLWZvb3Rlci1jb250ZW50Ij4KICAgICAgICAgICAgPGRpdiBjbGFzcz0icnRkLWZvb3Rlci1sZWZ0Ij4KICAgICAgICAgICAgICAgIDxzdHJvbmc+R1dVIENvdXJzZSBDYWxlbmRhciBTY3JhcGVyPC9zdHJvbmc+PGJyPgogICAgICAgICAgICAgICAgSW50ZXJhY3RpdmUgY291cnNlIHNjaGVkdWxlIHZpZXdlciBmb3IgR2VvcmdlIFdhc2hpbmd0b24gVW5pdmVyc2l0eQogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0icnRkLWZvb3Rlci1saW5rcyI+CiAgICAgICAgICAgICAgICA8YSBocmVmPSJodHRwczovL2dpdGh1Yi5jb20vbW1hbm4xMTIzL0dXVV9Db3Vyc2VfQ2FsZW5kYXIiIHRhcmdldD0iX2JsYW5rIiBjbGFzcz0icnRkLWZvb3Rlci1saW5rIj4KICAgICAgICAgICAgICAgICAgICA8c3ZnIGNsYXNzPSJnaXRodWItaWNvbiIgdmlld0JveD0iMCAwIDE2IDE2IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICAgICAgICAgICAgICAgICAgICAgICA8cGF0aCBmaWxsPSJjdXJyZW50Q29sb3IiIGQ9Ik04IDBDMy41OCAwIDAgMy41OCAwIDhjMCAzLjU0IDIuMjkgNi41MyA1LjQ3IDcuNTkuNC4wNy41NS0uMTcuNTUtLjM4IDAtLjE5LS4wMS0uODItLjAxLTEuNDktMi4wMS4zNy0yLjUzLS40OS0yLjY5LS45NC0uMDktLjIzLS40OC0uOTQtLjgyLTEuMTMtLjI4LS4xNS0uNjgtLjUyLS4wMS0uNTMuNjMtLjAxIDEuMDguNTggMS4yMy44Mi43MiAxLjIxIDEuODcuODcgMi4zMy42Ni4wNy0uNTIuMjgtLjg3LjUxLTEuMDctMS43OC0uMi0zLjY0LS44OS0zLjY0LTMuOTUgMC0uODcuMzEtMS41OS44Mi0yLjE1LS4wOC0uMi0uMzYtMS4wMi4wOC0yLjEyIDAgMCAuNjctLjIxIDIuMi44Mi42NC0uMTggMS4zMi0uMjcgMi0uMjcuNjggMCAxLjM2LjA5IDIgLjI3IDEuNTMtMS4wNCAyLjItLjgyIDIuMi0uODIuNDQgMS4xLjE2IDEuOTIuMDggMi4xMi41MS41Ni44MiAxLjI3LjgyIDIuMTUgMCAzLjA3LTEuODcgMy43NS0zLjY1IDMuOTUuMjkuMjUuNTQuNzMuNTQgMS40OCAwIDEuMDctLjAxIDEuOTMtLjAxIDIuMiAwIC4yMS4xNS40Ni41NS4zOEE4LjAxMyA4LjAxMyAwIDAwMTYgOGMwLTQuNDItMy41OC04LTgtOHoiLz4KICAgICAgICAgICAgICAgICAgICA8L3N2Zz4KICAgICAgICAgICAgICAgICAgICBWaWV3IG9uIEdpdEh1YgogICAgICAgICAgICAgICAgPC9hPgogICAgICAgICAgICAgICAgPGEgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL21tYW5uMTEyMy9HV1VfQ291cnNlX0NhbGVuZGFyL2lzc3VlcyIgdGFyZ2V0PSJfYmxhbmsiIGNsYXNzPSJydGQtZm9vdGVyLWxpbmsiPgogICAgICAgICAgICAgICAgICAgIDxzdmcgY2xhc3M9ImdpdGh1Yi1pY29uIiB2aWV3Qm94PSIwIDAgMTYgMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxwYXRoIGZpbGw9ImN1cnJlbnRDb2xvciIgZD0iTTggMS41YTYuNSA2LjUgMCAxMDAgMTMgNi41IDYuNSAwIDAwMC0xM3pNMCA4YTggOCAwIDExMTYgMEE4IDggMCAwMTAgOHptOSAzYTEgMSAwIDExLTIgMCAxIDEgMCAwMTIgMHpNNi45MiA2LjA4NWMuMDgxLS4xNi4xOS0uMjk5LjM0LS4zOTguMTQ1LS4wOTcuMzcxLS4xODcuNzQtLjE4Ny4yOCAwIC41NTMuMDg3LjczOC4yMjVBLjYxMy42MTMgMCAwMTkgNi4yNWMwIC4xNzctLjA0LjI2NC0uMDc3LjMxOGEuOTU2Ljk1NiAwIDAxLS4yNzcuMjQ1Yy0uMDc2LjA1MS0uMTU4LjEtLjI1OC4xNjFsLS4wMDcuMDA0YTcuNzI4IDcuNzI4IDAgMDAtLjMxMy4xOTUgMi40MTYgMi40MTYgMCAwMC0uNjkyLjY2MS43NS43NSAwIDAwMS4yNDguODMyLjk1Ni45NTYgMCAwMS4yNzYtLjI0NSA2LjMgNi4zIDAgMDEuMjYtLjE2bC4wMDYtLjAwNGMuMDkzLS4wNTcuMjA0LS4xMjMuMzEzLS4xOTUuMjIyLS4xNDkuNDg3LS4zNTUuNjkyLS42NjIuMjE0LS4zMi4zMjktLjcwMi4zMjktMS4xNSAwLS43Ni0uMzYtMS4zNDgtLjg2My0xLjcyNUEyLjc2IDIuNzYgMCAwMDggNGMtLjYzMSAwLTEuMTU1LjE2LTEuNTcyLjQzOC0uNDEzLjI3Ni0uNjguNjM4LS44NDkuOTc3YS43NS43NSAwIDAwMS4zNDIuNjd6Ii8+CiAgICAgICAgICAgICAgICAgICAgPC9zdmc+CiAgICAgICAgICAgICAgICAgICAgUmVwb3J0IElzc3VlCiAgICAgICAgICAgICAgICA8L2E+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9InJ0ZC1mb290ZXItYXR0cmlidXRpb24iPgogICAgICAgICAgICBDcmVkaXQ6IE1pY2hhZWwgTWFubiwgRGVwdCBvZiBHZW9ncmFwaHkgJiBFbnZpcm9ubWVudDxicj4KICAgICAgICAgICAgU2NyYXBlZCBvbiBKYW51YXJ5IDIwLCAyMDI2IGF0IDAyOjA5IFBNIHwgQnVpbHQgd2l0aCBQeXRob24gJiBCZWF1dGlmdWxTb3VwCiAgICAgICAgPC9kaXY+CiAgICA8L2Zvb3Rlcj4KPC9ib2R5Pgo8L2h0bWw+";
        const courses = [{"status": "WAITLIST", "crn": "35306", "subject": "GEOG", "course_num": "1000", "section": "10", "title": "Migrants in the City", "credits": "3.00", "instructor": "Chacko, E", "days": "MW", "time": {"start": "11:10AM", "end": "12:25PM", "raw": "11:10AM - 12:25PM"}, "dates": "08/25/25 - 12/08/25", "building": "COR", "room": "207", "course_number": "GEOG 1000"}, {"status": "WAITLIST", "crn": "30862", "subject": "GEOG", "course_num": "1001", "section": "10", "title": "Introduction to Human Geography", "credits": "3.00", "instructor": "Luthra, A", "days": "MW", "time": {"start": "02:20PM", "end": "03:35PM", "raw": "02:20PM - 03:35PM"}, "dates": "08/25/25 - 12/08/25", "building": "1957 E", "room": "B12", "course_number": "GEOG 1001"}, {"status": "OPEN", "crn": "30122", "subject": "GEOG", "course_num": "1002", "section": "10", "title": "Introduction to Physical Geography", "credits": "4.00", "instructor": "Shiklomanov, N", "days": "MW", "time": {"start": "11:10AM", "end": "12:25PM", "raw": "11:10AM - 12:25PM"}, "dates": "08/25/25 - 12/08/25", "building": "COR", "room": "101A", "course_number": "GEOG 1002"}, {"status": "OPEN", "crn": "31324", "subject": "GEOG", "course_num": "1003", "section": "10", "title": "Society and Environment", "credits": "3.00", "instructor": "Kansanga, M", "days": "MW", "time": {"start": "11:10AM", "end": "12:25PM", "raw": "11:10AM - 12:25PM"}, "dates": "08/25/25 - 12/08/25", "building": "1957 E", "room": "B12", "course_number": "GEOG 1003"}, {"status": "OPEN", "crn": "38398", "subject": "GEOG", "course_num": "1003", "section": "11", "title": "Society and Environment", "credits": "3.00", "instructor": "McClure, P", "days": "TR", "time": {"start": "03:45PM", "end": "05:00PM", "raw": "03:45PM - 05:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "MPA", "room": "B07", "course_number": "GEOG 1003"}, {"status": "OPEN", "crn": "35931", "subject": "GEOG", "course_num": "2000", "section": "10", "title": "Migrants and the City", "credits": "3.00", "instructor": "Chacko, E", "days": "W", "time": {"start": "05:10PM", "end": "07:00PM", "raw": "05:10PM - 07:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "PHIL", "room": "416", "course_number": "GEOG 2000"}, {"status": "OPEN", "crn": "31583", "subject": "GEOG", "course_num": "2104", "section": "10", "title": "Introduction to Cartography and GIS", "credits": "3.00", "instructor": "Lesko, J", "days": "TR", "time": {"start": "03:45PM", "end": "04:35PM", "raw": "03:45PM - 04:35PM"}, "dates": "08/25/25 - 12/08/25", "building": "PHIL", "room": "B156", "course_number": "GEOG 2104"}, {"status": "OPEN", "crn": "32412", "subject": "GEOG", "course_num": "2120", "section": "10", "title": "World Regional Geography", "credits": "3.00", "instructor": "Price, M", "days": "MW", "time": {"start": "02:20PM", "end": "03:35PM", "raw": "02:20PM - 03:35PM"}, "dates": "08/25/25 - 12/08/25", "building": "1957 E", "room": "113", "course_number": "GEOG 2120"}, {"status": "WAITLIST", "crn": "33874", "subject": "GEOG", "course_num": "2127", "section": "10", "title": "Population Geography", "credits": "3.00", "instructor": "Gardner, T", "days": "R", "time": {"start": "06:10PM", "end": "08:00PM", "raw": "06:10PM - 08:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "1776 G", "room": "C-118", "course_number": "GEOG 2127"}, {"status": "WAITLIST", "crn": "34175", "subject": "GEOG", "course_num": "2129W", "section": "10", "title": "Biogeography", "credits": "3.00", "instructor": "Honzak, M", "days": "MW", "time": {"start": "12:45PM", "end": "02:00PM", "raw": "12:45PM - 02:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "1957 E", "room": "212", "course_number": "GEOG 2129W"}, {"status": "OPEN", "crn": "31546", "subject": "GEOG", "course_num": "2134", "section": "10", "title": "Energy Resources", "credits": "3.00", "instructor": "Sklar, S", "days": "M", "time": {"start": "05:10PM", "end": "07:00PM", "raw": "05:10PM - 07:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "TOMP", "room": "302", "course_number": "GEOG 2134"}, {"status": "WAITLIST", "crn": "34474", "subject": "GEOG", "course_num": "2136", "section": "10", "title": "Water Resources", "credits": "3.00", "instructor": "Engstrom, R", "days": "TR", "time": {"start": "12:45PM", "end": "02:00PM", "raw": "12:45PM - 02:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "PHIL", "room": "416", "course_number": "GEOG 2136"}, {"status": "OPEN", "crn": "35034", "subject": "GEOG", "course_num": "2140", "section": "10", "title": "Cities and Societies", "credits": "3.00", "instructor": "Hart, C", "days": "T", "time": {"start": "07:10PM", "end": "09:00PM", "raw": "07:10PM - 09:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "MON", "room": "351", "course_number": "GEOG 2140"}, {"status": "OPEN", "crn": "35132", "subject": "GEOG", "course_num": "2147", "section": "10", "title": "Military Geography", "credits": "3.00", "instructor": "Collins, M", "days": "R", "time": {"start": "07:10PM", "end": "09:00PM", "raw": "07:10PM - 09:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "ROME", "room": "202", "course_number": "GEOG 2147"}, {"status": "OPEN", "crn": "38322", "subject": "GEOG", "course_num": "2148", "section": "10", "title": "Economic Geography", "credits": "3.00", "instructor": "Atia, M", "days": "TR", "time": {"start": "12:45PM", "end": "02:00PM", "raw": "12:45PM - 02:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "1776 G", "room": "C-110", "course_number": "GEOG 2148"}, {"status": "WAITLIST", "crn": "37039", "subject": "GEOG", "course_num": "2196", "section": "10", "title": "Field Methods in Geography", "credits": "3.00", "instructor": "Keeley, M", "days": "W", "time": {"start": "12:45PM", "end": "03:15PM", "raw": "12:45PM - 03:15PM"}, "dates": "08/25/25 - 12/08/25", "building": "1776 G", "room": "C-118", "course_number": "GEOG 2196"}, {"status": "WAITLIST", "crn": "33392", "subject": "GEOG", "course_num": "3105", "section": "10", "title": "Techniques of Spatial Analysis", "credits": "3.00", "instructor": "Hurley, B", "days": "M", "time": {"start": "02:20PM", "end": "04:10PM", "raw": "02:20PM - 04:10PM"}, "dates": "08/25/25 - 12/08/25", "building": "SAMS", "room": "109", "course_number": "GEOG 3105"}, {"status": "WAITLIST", "crn": "31875", "subject": "GEOG", "course_num": "3106", "section": "10", "title": "Intermediate Geographic Information Systems", "credits": "3.00", "instructor": "Hurley, B", "days": "M", "time": {"start": "10:30AM", "end": "12:20PM", "raw": "10:30AM - 12:20PM"}, "dates": "08/25/25 - 12/08/25", "building": "SAMS", "room": "109", "course_number": "GEOG 3106"}, {"status": "OPEN", "crn": "34753", "subject": "GEOG", "course_num": "3106", "section": "80", "title": "Intermediate Geographic Information Systems", "credits": "3.00", "instructor": "Mann, M", "days": "R", "time": {"start": "07:10PM", "end": "09:00PM", "raw": "07:10PM - 09:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "SAMS", "room": "109", "course_number": "GEOG 3106"}, {"status": "WAITLIST", "crn": "33393", "subject": "GEOG", "course_num": "3107", "section": "80", "title": "Introduction to Remote Sensing", "credits": "3.00", "instructor": "Engstrom, R", "days": "R", "time": {"start": "05:10PM", "end": "07:00PM", "raw": "05:10PM - 07:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "SAMS", "room": "109", "course_number": "GEOG 3107"}, {"status": "WAITLIST", "crn": "35663", "subject": "GEOG", "course_num": "3108", "section": "10", "title": "Weather and Climate", "credits": "3.00", "instructor": "Shiklomanov, N", "days": "TR", "time": {"start": "11:10AM", "end": "12:25PM", "raw": "11:10AM - 12:25PM"}, "dates": "08/25/25 - 12/08/25", "building": "MON", "room": "115", "course_number": "GEOG 3108"}, {"status": "OPEN", "crn": "33875", "subject": "GEOG", "course_num": "3128", "section": "10", "title": "Geomorphology and Natural Hazards", "credits": "3.00", "instructor": "Streletskiy, D", "days": "MW", "time": {"start": "12:45PM", "end": "02:00PM", "raw": "12:45PM - 02:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "PHIL", "room": "109", "course_number": "GEOG 3128"}, {"status": "OPEN", "crn": "38399", "subject": "GEOG", "course_num": "3133", "section": "80", "title": "Social-Ecological Systems", "credits": "3.00", "instructor": "McClure, P", "days": "M", "time": {"start": "05:10PM", "end": "07:00PM", "raw": "05:10PM - 07:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "TOMP", "room": "204", "course_number": "GEOG 3133"}, {"status": "OPEN", "crn": "34875", "subject": "GEOG", "course_num": "3145", "section": "10", "title": "Cultural Geography", "credits": "3.00", "instructor": "Cullen, D", "days": "TR", "time": {"start": "11:10AM", "end": "12:25PM", "raw": "11:10AM - 12:25PM"}, "dates": "08/25/25 - 12/08/25", "building": "PHIL", "room": "111", "course_number": "GEOG 3145"}, {"status": "WAITLIST", "crn": "35133", "subject": "GEOG", "course_num": "3146", "section": "10", "title": "Political Geography", "credits": "3.00", "instructor": "Cullen, D", "days": "TR", "time": {"start": "02:20PM", "end": "03:35PM", "raw": "02:20PM - 03:35PM"}, "dates": "08/25/25 - 12/08/25", "building": "TOMP", "room": "107", "course_number": "GEOG 3146"}, {"status": "WAITLIST", "crn": "37029", "subject": "GEOG", "course_num": "3154", "section": "10", "title": "Geography of the Middle East and North Africa", "credits": "3.00", "instructor": "Atia, M", "days": "TR", "time": {"start": "09:35AM", "end": "10:50AM", "raw": "09:35AM - 10:50AM"}, "dates": "08/25/25 - 12/08/25", "building": "BELL", "room": "106", "course_number": "GEOG 3154"}, {"status": "OPEN", "crn": "38401", "subject": "GEOG", "course_num": "3194", "section": "82", "title": "Climate Change & Public Health", "credits": "3.00", "instructor": "McClure, P", "days": "T", "time": {"start": "05:10PM", "end": "07:00PM", "raw": "05:10PM - 07:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "MON", "room": "253", "course_number": "GEOG 3194"}, {"status": "OPEN", "crn": "34134", "subject": "GEOG", "course_num": "3195", "section": "81", "title": "Polictical Ecology", "credits": "3.00", "instructor": "Luthra, A", "days": "W", "time": {"start": "05:10PM", "end": "07:00PM", "raw": "05:10PM - 07:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "TOMP", "room": "301", "course_number": "GEOG 3195"}, {"status": "WAITLIST", "crn": "34010", "subject": "GEOG", "course_num": "3195", "section": "82", "title": "Land Use/Urban Transportation", "credits": "3.00", "instructor": "Malouff, J", "days": "W", "time": {"start": "05:10PM", "end": "07:00PM", "raw": "05:10PM - 07:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "GELM", "room": "641", "course_number": "GEOG 3195"}, {"status": "WAITLIST", "crn": "34135", "subject": "GEOG", "course_num": "3197", "section": "80", "title": "Geography Russia &ItsNeighbors", "credits": "3.00", "instructor": "Streletskiy, D", "days": "W", "time": {"start": "05:10PM", "end": "07:00PM", "raw": "05:10PM - 07:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "FNGR", "room": "207", "course_number": "GEOG 3197"}, {"status": "OPEN", "crn": "38121", "subject": "GEOG", "course_num": "3198", "section": "80", "title": "Climate & Social Change", "credits": "3.00", "instructor": "Odell, S", "days": "R", "time": {"start": "05:10PM", "end": "07:00PM", "raw": "05:10PM - 07:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "ROME", "room": "206", "course_number": "GEOG 3198"}, {"status": "OPEN", "crn": "38122", "subject": "GEOG", "course_num": "3275", "section": "10", "title": "Sustainable Food Systems", "credits": "3.00", "instructor": "Kansanga, M", "days": "M", "time": {"start": "05:10PM", "end": "07:00PM", "raw": "05:10PM - 07:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "MON", "room": "351", "course_number": "GEOG 3275"}, {"status": "OPEN", "crn": "35131", "subject": "GEOG", "course_num": "3810", "section": "10", "title": "Planning Cities", "credits": "3.00", "instructor": "Fisher, S", "days": "M", "time": {"start": "07:10PM", "end": "09:00PM", "raw": "07:10PM - 09:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "1957 E", "room": "B14", "course_number": "GEOG 3810"}, {"status": "WAITLIST", "crn": "35666", "subject": "GEOG", "course_num": "4195W", "section": "10", "title": "Proseminar in Geographic Thought", "credits": "3.00", "instructor": "Rain, D", "days": "MW", "time": {"start": "03:45PM", "end": "05:00PM", "raw": "03:45PM - 05:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "SMTH", "room": "115", "course_number": "GEOG 4195W"}, {"status": "WAITLIST", "crn": "34643", "subject": "GEOG", "course_num": "4308", "section": "80", "title": "Programming for Geospatial Applications I", "credits": "3.00", "instructor": "Mann, M", "days": "T", "time": {"start": "05:10PM", "end": "07:00PM", "raw": "05:10PM - 07:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "SAMS", "room": "109", "course_number": "GEOG 4308"}, {"status": "WAITLIST", "crn": "34108", "subject": "GEOG", "course_num": "4309", "section": "80", "title": "GIS for Emergency Management", "credits": "3.00", "instructor": "Mumford, K", "days": "T", "time": {"start": "07:10PM", "end": "09:00PM", "raw": "07:10PM - 09:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "SAMS", "room": "109", "course_number": "GEOG 4309"}, {"status": "WAITLIST", "crn": "38285", "subject": "GEOG", "course_num": "4310", "section": "80", "title": "Geovisualization and Cartography", "credits": "3.00", "instructor": "O'Brien, M", "days": "W", "time": {"start": "07:10PM", "end": "09:00PM", "raw": "07:10PM - 09:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "SAMS", "room": "109", "course_number": "GEOG 4310"}, {"status": "OPEN", "crn": "33027", "subject": "GEOG", "course_num": "6201", "section": "10", "title": "Geographic Thought", "credits": "3.00", "instructor": "Cullen, D", "days": "T", "time": {"start": "05:10PM", "end": "07:00PM", "raw": "05:10PM - 07:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "DUQUES", "room": "259", "course_number": "GEOG 6201"}, {"status": "OPEN", "crn": "38400", "subject": "GEOG", "course_num": "6233", "section": "80", "title": "Social-Ecological Systems", "credits": "3.00", "instructor": "McClure, P", "days": "M", "time": {"start": "05:10PM", "end": "07:00PM", "raw": "05:10PM - 07:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "TOMP", "room": "204", "course_number": "GEOG 6233"}, {"status": "OPEN", "crn": "34136", "subject": "GEOG", "course_num": "6265", "section": "80", "title": "Geography Russia &ItsNeighbors", "credits": "3.00", "instructor": "Streletskiy, D", "days": "W", "time": {"start": "05:10PM", "end": "07:00PM", "raw": "05:10PM - 07:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "FNGR", "room": "207", "course_number": "GEOG 6265"}, {"status": "OPEN", "crn": "35035", "subject": "GEOG", "course_num": "6292", "section": "10", "title": "Qualitative Methods in Geography", "credits": "3.00", "instructor": "Price, M", "days": "W", "time": {"start": "05:10PM", "end": "07:00PM", "raw": "05:10PM - 07:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "ROME", "room": "204", "course_number": "GEOG 6292"}, {"status": "CLOSED", "crn": "37482", "subject": "GEOG", "course_num": "6293", "section": "81", "title": "Polictical Ecology", "credits": "3.00", "instructor": "Luthra, A", "days": "W", "time": {"start": "05:10PM", "end": "07:00PM", "raw": "05:10PM - 07:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "TOMP", "room": "301", "course_number": "GEOG 6293"}, {"status": "OPEN", "crn": "38402", "subject": "GEOG", "course_num": "6293", "section": "82", "title": "Climate Change & Public Health", "credits": "3.00", "instructor": "McClure, P", "days": "T", "time": {"start": "05:10PM", "end": "07:00PM", "raw": "05:10PM - 07:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "MON", "room": "253", "course_number": "GEOG 6293"}, {"status": "WAITLIST", "crn": "33394", "subject": "GEOG", "course_num": "6303", "section": "80", "title": "Introduction to Remote Sensing", "credits": "3.00", "instructor": "Engstrom, R", "days": "R", "time": {"start": "05:10PM", "end": "07:00PM", "raw": "05:10PM - 07:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "SAMS", "room": "109", "course_number": "GEOG 6303"}, {"status": "WAITLIST", "crn": "31978", "subject": "GEOG", "course_num": "6304", "section": "80", "title": "Geographic Information Systems I", "credits": "3.00", "instructor": "Koenig, K", "days": "W", "time": {"start": "05:10PM", "end": "07:00PM", "raw": "05:10PM - 07:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "BELL", "room": "204", "course_number": "GEOG 6304"}, {"status": "WAITLIST", "crn": "31979", "subject": "GEOG", "course_num": "6305", "section": "10", "title": "Geospatial Statistics", "credits": "3.00", "instructor": "Hurley, B", "days": "M", "time": {"start": "05:10PM", "end": "07:00PM", "raw": "05:10PM - 07:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "SAMS", "room": "109", "course_number": "GEOG 6305"}, {"status": "WAITLIST", "crn": "34657", "subject": "GEOG", "course_num": "6306", "section": "80", "title": "Geographic Information Systems II", "credits": "3.00", "instructor": "Mann, M", "days": "R", "time": {"start": "07:10PM", "end": "09:00PM", "raw": "07:10PM - 09:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "SAMS", "room": "109", "course_number": "GEOG 6306"}, {"status": "OPEN", "crn": "34644", "subject": "GEOG", "course_num": "6308", "section": "80", "title": "Programming for Geospatial Applications I", "credits": "3.00", "instructor": "Mann, M", "days": "T", "time": {"start": "05:10PM", "end": "07:00PM", "raw": "05:10PM - 07:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "SAMS", "room": "109", "course_number": "GEOG 6308"}, {"status": "OPEN", "crn": "34109", "subject": "GEOG", "course_num": "6309", "section": "80", "title": "GIS for Emergency Management", "credits": "3.00", "instructor": "Mumford, K", "days": "T", "time": {"start": "07:10PM", "end": "09:00PM", "raw": "07:10PM - 09:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "SAMS", "room": "109", "course_number": "GEOG 6309"}, {"status": "OPEN", "crn": "38286", "subject": "GEOG", "course_num": "6310", "section": "80", "title": "Geovisualization and Cartography", "credits": "3.00", "instructor": "O'Brien, M", "days": "W", "time": {"start": "07:10PM", "end": "09:00PM", "raw": "07:10PM - 09:00PM"}, "dates": "08/25/25 - 12/08/25", "building": "SAMS", "room": "109", "course_number": "GEOG 6310"}];
        const dayMap = { 'M': 'monday', 'T': 'tuesday', 'W': 'wednesday', 'R': 'thursday', 'F': 'friday' };
        let instructorColors = {};
        let selectedInstructors = new Set();
        let activeTab = 'all-courses';
        let selectedDay = null;
        let roomConflicts = [];
        let levelFilter = 'all';

        // Edit mode variables
        let editedCourses = JSON.parse(JSON.stringify(courses)); // Deep copy for editing
        let editCount = 0;
        let editedCRNs = new Set();
        let ignoredConflicts = new Set(JSON.parse(localStorage.getItem('ignoredConflicts') || '[]'));
        let editIgnoredConflicts = new Set(JSON.parse(localStorage.getItem('editIgnoredConflicts') || '[]'));
        let currentEditCRN = null;
        let editSelectedInstructors = new Set();
        let editRoomFilter = 'all';
        let editLevelFilter = 'all';
        let isImporting = false; // Flag to prevent multiple renders during import

        // Generate unique color for each instructor using HSL
        function generateInstructorColors() {
            const instructors = [...new Set(courses.map(c => c.instructor))].sort();
            const hueStep = 360 / instructors.length;
            instructors.forEach((instructor, index) => {
                const hue = Math.floor(index * hueStep);
                const saturation = 65 + (index % 3) * 10; // 65%, 75%, or 85%
                const lightness = 50 + (index % 2) * 10;  // 50% or 60%
                instructorColors[instructor] = `hsl(${hue}, ${saturation}%, ${lightness}%)`;
            });
        }

        function getInstructorColor(instructor) {
            return instructorColors[instructor] || '#667eea';
        }

        // Tab switching
        function switchTab(tabName) {
            activeTab = tabName;

            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                if (btn.getAttribute('data-tab') === tabName) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });

            // Update tab content visibility
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'none';
            });
            document.getElementById(tabName + '-tab').style.display = 'block';

            // Show/hide main calendar filters (hide in edit mode, show otherwise)
            const mainFilters = document.getElementById('mainCalendarFilters');
            if (mainFilters) {
                mainFilters.style.display = tabName === 'edit-schedule' ? 'none' : 'flex';
            }

            // Load tab-specific content
            if (tabName === 'planning-mode') {
                generatePlanningMode();
            } else if (tabName === 'room-conflicts') {
                detectAndDisplayRoomConflicts();
            } else if (tabName === 'edit-schedule') {
                initializeEditMode();
            }
        }

        function timeToMinutes(timeStr) {
            const match = timeStr.match(/(\d{1,2}):(\d{2})([AP]M)/);
            if (!match) {
                console.error('timeToMinutes: Failed to parse time string:', timeStr);
                return 0;
            }
            let hours = parseInt(match[1]);
            const minutes = parseInt(match[2]);
            const period = match[3];
            if (period === 'PM' && hours !== 12) hours += 12;
            if (period === 'AM' && hours === 12) hours = 0;
            const result = hours * 60 + minutes;

            // Debug log for any imported course times
            if (timeStr === '11:00AM' || timeStr === '12:50PM' || timeStr === '09:00AM' || timeStr === '10:50AM') {
                console.log(`timeToMinutes('${timeStr}') = ${result} (hours=${hours}, minutes=${minutes}, period=${period})`);
            }

            return result;
        }

        // Helper function to extract course level and determine if grad/undergrad
        function getCourseLevel(courseNumber) {
            // Extract the numeric part from course_number (e.g., "GEOG 1001" -> 1001)
            const match = courseNumber.match(/\d+/);
            if (!match) return 0;
            const level = parseInt(match[0]);
            return level;
        }

        function isGraduateCourse(courseNumber) {
            const level = getCourseLevel(courseNumber);
            return level >= 6000;
        }

        function createTimeSlots() {
            const timeColumn = document.getElementById('timeColumn');
            const startHour = 9;
            const endHour = 21;
            for (let hour = startHour; hour <= endHour; hour++) {
                const timeSlot = document.createElement('div');
                timeSlot.className = 'time-slot';
                const displayHour = hour > 12 ? hour - 12 : (hour === 0 ? 12 : hour);
                const period = hour >= 12 ? 'PM' : 'AM';
                timeSlot.textContent = `${displayHour}:00 ${period}`;
                timeColumn.appendChild(timeSlot);
            }
            ['monday', 'tuesday', 'wednesday', 'thursday', 'friday'].forEach(day => {
                const dayColumn = document.getElementById(day);
                for (let i = 0; i <= endHour - startHour; i++) {
                    const line = document.createElement('div');
                    line.className = 'hour-line';
                    line.style.top = `${i * 60}px`;
                    dayColumn.appendChild(line);
                }
            });
        }

        function renderCourses() {
            const startHour = 9;
            const pixelsPerMinute = 1;
            document.getElementById('totalCourses').textContent = courses.length;
            const instructors = new Set(courses.map(c => c.instructor));
            document.getElementById('totalInstructors').textContent = instructors.size;
            const coursesByDay = { monday: [], tuesday: [], wednesday: [], thursday: [], friday: [] };
            courses.forEach(course => {
                course.days.split('').forEach(day => {
                    const dayId = dayMap[day];
                    if (dayId) coursesByDay[dayId].push(course);
                });
            });
            Object.keys(coursesByDay).forEach(dayId => {
                const dayColumn = document.getElementById(dayId);
                const coursesForDay = coursesByDay[dayId];
                coursesForDay.sort((a, b) => timeToMinutes(a.time.start) - timeToMinutes(b.time.start));
                const processed = new Set();
                coursesForDay.forEach((course, index) => {
                    if (processed.has(index)) return;
                    const startMinutes = timeToMinutes(course.time.start);
                    const endMinutes = timeToMinutes(course.time.end);
                    const duration = endMinutes - startMinutes;
                    const topPosition = (startMinutes - (startHour * 60)) * pixelsPerMinute;
                    const height = duration * pixelsPerMinute;
                    const overlapping = [];
                    for (let i = index + 1; i < coursesForDay.length; i++) {
                        if (processed.has(i)) continue;
                        const other = coursesForDay[i];
                        const otherStart = timeToMinutes(other.time.start);
                        const otherEnd = timeToMinutes(other.time.end);
                        if (startMinutes < otherEnd && endMinutes > otherStart) {
                            overlapping.push({course: other, index: i});
                        }
                    }
                    const totalOverlapping = overlapping.length + 1;
                    const widthPercent = 100 / totalOverlapping;
                    renderCourseBlock(course, dayColumn, topPosition, height, 0, widthPercent);
                    processed.add(index);
                    overlapping.forEach((item, i) => {
                        const otherStartMinutes = timeToMinutes(item.course.time.start);
                        const otherEndMinutes = timeToMinutes(item.course.time.end);
                        const otherDuration = otherEndMinutes - otherStartMinutes;
                        const otherTopPosition = (otherStartMinutes - (startHour * 60)) * pixelsPerMinute;
                        const otherHeight = otherDuration * pixelsPerMinute;
                        renderCourseBlock(item.course, dayColumn, otherTopPosition, otherHeight, i + 1, widthPercent);
                        processed.add(item.index);
                    });
                });
            });
        }

        function renderCourseBlock(course, dayColumn, topPosition, height, column, widthPercent) {
            const courseBlock = document.createElement('div');
            courseBlock.className = 'course-block';
            courseBlock.style.top = `${topPosition}px`;
            courseBlock.style.height = `${height}px`;
            courseBlock.style.left = `${column * widthPercent}%`;
            courseBlock.style.width = `calc(${widthPercent}% - 4px)`;

            // Use instructor-specific color
            const instructorColor = getInstructorColor(course.instructor);
            courseBlock.style.background = instructorColor;

            // Check if this course has a room conflict (and it's not ignored)
            const courseConflict = roomConflicts.find(conflict =>
                conflict.courses.some(c => c.crn === course.crn)
            );
            if (courseConflict) {
                // Generate the conflict signature to check if it's ignored
                const crns = courseConflict.courses.map(c => c.crn).sort().join('-');
                const conflictSig = `${courseConflict.room}_${courseConflict.courses[0].days}_${courseConflict.courses[0].time.start}_${crns}`;
                if (!ignoredConflicts.has(conflictSig)) {
                    courseBlock.classList.add('conflict-indicator');
                }
            }

            courseBlock.innerHTML = `
                <div class="course-number">${course.course_number}</div>
                <div class="course-name">${course.title}</div>
                <div class="course-time">${course.time.start}</div>
                <div class="tooltip">
                    <div class="tooltip-row"><span class="tooltip-label">Course:</span><span class="tooltip-value">${course.course_number}</span></div>
                    <div class="tooltip-row"><span class="tooltip-label">Instructor:</span><span class="tooltip-value">${course.instructor}</span></div>
                    <div class="tooltip-row"><span class="tooltip-label">Time:</span><span class="tooltip-value">${course.time.raw}</span></div>
                    <div class="tooltip-row"><span class="tooltip-label">Location:</span><span class="tooltip-value">${course.building} ${course.room}</span></div>
                    <div class="tooltip-row"><span class="tooltip-label">CRN:</span><span class="tooltip-value">${course.crn}</span></div>
                </div>
            `;
            courseBlock.onclick = () => showModal(course);
            dayColumn.appendChild(courseBlock);
        }

        function showModal(course) {
            const statusBadge = document.getElementById('statusBadge');
            const statusClass = course.status === 'OPEN' ? 'status-open' : 'status-closed';
            statusBadge.className = 'status-badge ' + statusClass;
            statusBadge.textContent = course.status;
            document.getElementById('modalCourseNumber').textContent = course.course_number;
            document.getElementById('modalCourseName').textContent = course.title;
            document.getElementById('modalCRN').textContent = course.crn;
            document.getElementById('modalInstructor').textContent = course.instructor;
            document.getElementById('modalTime').textContent = course.time.raw;
            document.getElementById('modalDays').textContent = expandDays(course.days);
            document.getElementById('modalBuilding').textContent = course.building;
            document.getElementById('modalRoom').textContent = course.room;
            document.getElementById('modalCredits').textContent = course.credits;
            document.getElementById('modalDates').textContent = course.dates;
            document.getElementById('modal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        function expandDays(days) {
            const dayNames = { 'M': 'Monday', 'T': 'Tuesday', 'W': 'Wednesday', 'R': 'Thursday', 'F': 'Friday' };
            return days.split('').map(d => dayNames[d]).join(', ');
        }

        // Instructor dropdown functions
        function populateInstructorList() {
            const instructors = [...new Set(courses.map(c => c.instructor))].sort();
            const instructorList = document.getElementById('instructorList');
            instructorList.innerHTML = '';

            instructors.forEach(instructor => {
                const item = document.createElement('div');
                item.className = 'instructor-checkbox-item';
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `instructor-${instructor.replace(/\s+/g, '-')}`;
                checkbox.value = instructor;
                checkbox.checked = selectedInstructors.size === 0 || selectedInstructors.has(instructor);
                checkbox.onchange = () => toggleInstructorSelection(instructor);

                const label = document.createElement('label');
                label.setAttribute('for', checkbox.id);
                const colorIndicator = document.createElement('span');
                colorIndicator.className = 'instructor-color-indicator';
                colorIndicator.style.backgroundColor = getInstructorColor(instructor);
                label.appendChild(colorIndicator);
                label.appendChild(document.createTextNode(instructor));

                item.appendChild(checkbox);
                item.appendChild(label);
                instructorList.appendChild(item);
            });
        }

        function toggleInstructorDropdown() {
            const dropdown = document.getElementById('instructorDropdown');
            dropdown.classList.toggle('show');
        }

        function toggleInstructorSelection(instructor) {
            if (selectedInstructors.has(instructor)) {
                selectedInstructors.delete(instructor);
            } else {
                selectedInstructors.add(instructor);
            }
            updateInstructorButtonText();
            applyFilters();
        }

        function selectAllInstructors() {
            selectedInstructors.clear();
            document.querySelectorAll('#instructorList input[type="checkbox"]').forEach(cb => {
                cb.checked = true;
            });
            updateInstructorButtonText();
            applyFilters();
        }

        function clearAllInstructors() {
            selectedInstructors.clear();
            document.querySelectorAll('#instructorList input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
                selectedInstructors.add(cb.value);
            });
            // Start with one instructor selected
            const firstCheckbox = document.querySelector('#instructorList input[type="checkbox"]');
            if (firstCheckbox) {
                firstCheckbox.checked = true;
                selectedInstructors.clear();
                selectedInstructors.add(firstCheckbox.value);
            }
            updateInstructorButtonText();
            applyFilters();
        }

        function updateInstructorButtonText() {
            const btnText = document.getElementById('instructorBtnText');
            if (selectedInstructors.size === 0) {
                btnText.textContent = 'All Instructors';
            } else if (selectedInstructors.size === 1) {
                btnText.textContent = Array.from(selectedInstructors)[0];
            } else {
                btnText.textContent = `${selectedInstructors.size} Instructors`;
            }
        }

        // Level filter dropdown functions
        function toggleLevelDropdown() {
            const dropdown = document.getElementById('levelDropdown');
            dropdown.classList.toggle('show');
        }

        function setLevelFilter(level) {
            levelFilter = level;
            const btnText = document.getElementById('levelBtnText');
            if (level === 'all') {
                btnText.textContent = 'All Levels';
            } else if (level === 'undergrad') {
                btnText.textContent = 'Undergrad';
            } else if (level === 'grad') {
                btnText.textContent = 'Grad';
            }
            document.getElementById('levelDropdown').classList.remove('show');
            applyFilters();
        }

        function applyFilters() {
            clearCalendar();
            const filteredCourses = courses.filter(course => {
                const instructorMatch = selectedInstructors.size === 0 || selectedInstructors.has(course.instructor);

                // Apply level filter
                let levelMatch = true;
                if (levelFilter === 'undergrad') {
                    levelMatch = !isGraduateCourse(course.course_number);
                } else if (levelFilter === 'grad') {
                    levelMatch = isGraduateCourse(course.course_number);
                }

                return instructorMatch && levelMatch;
            });
            renderCoursesFiltered(filteredCourses);
            updateFilterStatus();
            updateInstructorLegend();

            // If class list is active, regenerate it with the filtered instructors
            if (activeTab === 'planning-mode') {
                generatePlanningMode();
            }
        }

        function clearCalendar() {
            ['monday', 'tuesday', 'wednesday', 'thursday', 'friday'].forEach(day => {
                const dayColumn = document.getElementById(day);
                // Remove only course blocks, keep hour lines
                dayColumn.querySelectorAll('.course-block').forEach(block => block.remove());
            });
        }

        function renderCoursesFiltered(coursesToRender) {
            const startHour = 9;
            const pixelsPerMinute = 1;
            const coursesByDay = { monday: [], tuesday: [], wednesday: [], thursday: [], friday: [] };

            coursesToRender.forEach(course => {
                course.days.split('').forEach(day => {
                    const dayId = dayMap[day];
                    if (dayId) coursesByDay[dayId].push(course);
                });
            });

            Object.keys(coursesByDay).forEach(dayId => {
                const dayColumn = document.getElementById(dayId);
                const coursesForDay = coursesByDay[dayId];
                coursesForDay.sort((a, b) => timeToMinutes(a.time.start) - timeToMinutes(b.time.start));
                const processed = new Set();

                coursesForDay.forEach((course, index) => {
                    if (processed.has(index)) return;
                    const startMinutes = timeToMinutes(course.time.start);
                    const endMinutes = timeToMinutes(course.time.end);
                    const duration = endMinutes - startMinutes;
                    const topPosition = (startMinutes - (startHour * 60)) * pixelsPerMinute;
                    const height = duration * pixelsPerMinute;
                    const overlapping = [];

                    for (let i = index + 1; i < coursesForDay.length; i++) {
                        if (processed.has(i)) continue;
                        const other = coursesForDay[i];
                        const otherStart = timeToMinutes(other.time.start);
                        const otherEnd = timeToMinutes(other.time.end);
                        if (startMinutes < otherEnd && endMinutes > otherStart) {
                            overlapping.push({course: other, index: i});
                        }
                    }

                    const totalOverlapping = overlapping.length + 1;
                    const widthPercent = 100 / totalOverlapping;
                    renderCourseBlock(course, dayColumn, topPosition, height, 0, widthPercent);
                    processed.add(index);

                    overlapping.forEach((item, i) => {
                        const otherStartMinutes = timeToMinutes(item.course.time.start);
                        const otherEndMinutes = timeToMinutes(item.course.time.end);
                        const otherDuration = otherEndMinutes - otherStartMinutes;
                        const otherTopPosition = (otherStartMinutes - (startHour * 60)) * pixelsPerMinute;
                        const otherHeight = otherDuration * pixelsPerMinute;
                        renderCourseBlock(item.course, dayColumn, otherTopPosition, otherHeight, i + 1, widthPercent);
                        processed.add(item.index);
                    });
                });
            });
        }

        function updateFilterStatus() {
            const filterStatus = document.getElementById('filterStatus');
            let statusParts = [];

            if (selectedDay) {
                const dayNames = {
                    'monday': 'Monday',
                    'tuesday': 'Tuesday',
                    'wednesday': 'Wednesday',
                    'thursday': 'Thursday',
                    'friday': 'Friday'
                };
                statusParts.push(`${dayNames[selectedDay]} only`);
            } else {
                statusParts.push('all days');
            }

            // Add level filter status
            if (levelFilter === 'undergrad') {
                statusParts.push('undergrad only');
            } else if (levelFilter === 'grad') {
                statusParts.push('grad only');
            } else {
                statusParts.push('all levels');
            }

            if (selectedInstructors.size === 0) {
                statusParts.push('all instructors');
            } else if (selectedInstructors.size === 1) {
                statusParts.push(Array.from(selectedInstructors)[0]);
            } else {
                statusParts.push(`${selectedInstructors.size} instructors`);
            }

            filterStatus.textContent = `Showing: ${statusParts.join(' | ')}`;
        }

        function updateInstructorLegend() {
            const legend = document.getElementById('instructorLegend');
            if (!legend) return;

            const instructorsToShow = selectedInstructors.size === 0
                ? [...new Set(courses.map(c => c.instructor))].sort()
                : Array.from(selectedInstructors).sort();

            let html = '<div class="legend-title">üë• Instructor Color Key</div><div class="legend-grid">';
            instructorsToShow.forEach(instructor => {
                const color = getInstructorColor(instructor);
                html += `<div class="legend-grid-item"><span class="color-box" style="background: ${color}"></span><span>${instructor}</span></div>`;
            });
            html += '</div>';
            legend.innerHTML = html;
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            // Close instructor dropdown
            const dropdown = document.getElementById('instructorDropdown');
            const btn = document.getElementById('instructorDropdownBtn');
            if (dropdown && btn && !dropdown.contains(event.target) && !btn.contains(event.target)) {
                dropdown.classList.remove('show');
            }

            // Close level dropdown
            const levelDropdown = document.getElementById('levelDropdown');
            const levelBtn = document.getElementById('levelDropdownBtn');
            if (levelDropdown && levelBtn && !levelDropdown.contains(event.target) && !levelBtn.contains(event.target)) {
                levelDropdown.classList.remove('show');
            }
        });

        function filterDay(day) {
            selectedDay = day;

            // Hide all day columns
            ['monday', 'tuesday', 'wednesday', 'thursday', 'friday'].forEach(d => {
                const col = document.getElementById(d);
                if (d === day) {
                    col.style.display = 'block';
                } else {
                    col.style.display = 'none';
                }
            });

            // Update active state on headers
            document.querySelectorAll('.day-header[data-day]').forEach(header => {
                if (header.getAttribute('data-day') === day) {
                    header.classList.add('active');
                } else {
                    header.classList.remove('active');
                }
            });

            // Adjust calendar layout for single day view
            const calendarBody = document.querySelector('.calendar-body');
            const calendarHeader = document.querySelector('.calendar-header');
            calendarBody.style.gridTemplateColumns = '80px 1fr';
            calendarHeader.style.gridTemplateColumns = '80px 1fr';

            updateFilterStatus();
        }

        function showAllDays() {
            selectedDay = null;

            // Show all day columns
            ['monday', 'tuesday', 'wednesday', 'thursday', 'friday'].forEach(d => {
                document.getElementById(d).style.display = 'block';
            });

            // Remove active state from all headers
            document.querySelectorAll('.day-header[data-day]').forEach(header => {
                header.classList.remove('active');
            });

            // Restore calendar layout
            const calendarBody = document.querySelector('.calendar-body');
            const calendarHeader = document.querySelector('.calendar-header');
            calendarBody.style.gridTemplateColumns = '80px repeat(5, minmax(180px, 1fr))';
            calendarHeader.style.gridTemplateColumns = '80px repeat(5, minmax(180px, 1fr))';

            updateFilterStatus();
        }

        // Room conflict detection
        function detectRoomConflicts() {
            roomConflicts = [];
            const roomGroups = {};

            // Normalize room key for consistent matching
            function normalizeRoomKey(building, room) {
                // Remove extra spaces, convert to uppercase for consistency
                const normBuilding = building.replace(/\s+/g, ' ').trim().toUpperCase();
                const normRoom = room.replace(/\s+/g, ' ').trim().toUpperCase();
                return `${normBuilding}|${normRoom}`;
            }

            // Group courses by room
            courses.forEach(course => {
                if (course.building === 'Not specified' || course.room === 'Not specified') return;
                const roomKey = normalizeRoomKey(course.building, course.room);
                if (!roomGroups[roomKey]) {
                    roomGroups[roomKey] = {
                        displayName: `${course.building} ${course.room}`,
                        courses: []
                    };
                }
                roomGroups[roomKey].courses.push(course);
            });

            // Check for overlaps within each room
            console.log(`üìã Checking ${Object.keys(roomGroups).length} rooms for conflicts...`);
            Object.keys(roomGroups).forEach(roomKey => {
                const roomData = roomGroups[roomKey];
                const roomCourses = roomData.courses;

                // Log rooms with multiple courses
                if (roomCourses.length >= 2) {
                    console.log(`  Room: ${roomData.displayName} has ${roomCourses.length} courses`);
                    roomCourses.forEach(c => {
                        console.log(`    - ${c.course_number} (${c.instructor}) ${c.days} ${c.time.raw}`);
                    });
                }

                if (roomCourses.length < 2) return;

                const conflicts = [];
                for (let i = 0; i < roomCourses.length; i++) {
                    for (let j = i + 1; j < roomCourses.length; j++) {
                        const course1 = roomCourses[i];
                        const course2 = roomCourses[j];

                        // Check if they share any days
                        const days1 = course1.days.split('');
                        const days2 = course2.days.split('');
                        const sharedDays = days1.filter(d => days2.includes(d));

                        if (sharedDays.length === 0) continue;

                        // Skip cross-listed courses (same title, time, instructor, days)
                        // These are intentionally scheduled together
                        if (course1.title === course2.title &&
                            course1.time.start === course2.time.start &&
                            course1.time.end === course2.time.end &&
                            course1.instructor === course2.instructor &&
                            course1.days === course2.days) {
                            continue;
                        }

                        // Check if times overlap
                        const start1 = timeToMinutes(course1.time.start);
                        const end1 = timeToMinutes(course1.time.end);
                        const start2 = timeToMinutes(course2.time.start);
                        const end2 = timeToMinutes(course2.time.end);

                        if (start1 < end2 && end1 > start2) {
                            // We have a conflict
                            const existingConflict = conflicts.find(c =>
                                c.courses.some(co => co.crn === course1.crn || co.crn === course2.crn)
                            );

                            if (existingConflict) {
                                if (!existingConflict.courses.some(c => c.crn === course1.crn)) {
                                    existingConflict.courses.push(course1);
                                }
                                if (!existingConflict.courses.some(c => c.crn === course2.crn)) {
                                    existingConflict.courses.push(course2);
                                }
                            } else {
                                conflicts.push({
                                    room: roomData.displayName,
                                    courses: [course1, course2],
                                    sharedDays: sharedDays
                                });
                            }
                        }
                    }
                }

                roomConflicts.push(...conflicts);
            });

            // Log detected conflicts for debugging
            console.log(`üîç Room Conflict Detection: Found ${roomConflicts.length} conflict group(s)`);
            roomConflicts.forEach((conflict, index) => {
                console.log(`  Conflict ${index + 1}: ${conflict.room} - ${conflict.courses.length} courses`);
                conflict.courses.forEach(c => {
                    console.log(`    - ${c.course_number} (${c.instructor}) ${c.days} ${c.time.raw}`);
                });
            });

            return roomConflicts;
        }

        function detectAndDisplayRoomConflicts() {
            const conflicts = detectRoomConflicts();
            const container = document.getElementById('conflictsContent');

            // Find courses with unspecified rooms
            const unspecifiedRooms = courses.filter(c =>
                c.room.toLowerCase().includes('not specified') ||
                c.room.toLowerCase().includes('tbd') ||
                c.room.toLowerCase().includes('tba') ||
                c.room.trim() === ''
            );

            let html = '';

            // Display unspecified rooms section
            if (unspecifiedRooms.length > 0) {
                html += `<div style="margin-bottom: 25px; padding: 18px; background-color: #e3f2fd; border-left: 4px solid #2980b9; border-radius: 8px;">
                    <strong>üìã Found ${unspecifiedRooms.length} course${unspecifiedRooms.length > 1 ? 's' : ''} with unspecified rooms</strong>
                    <p style="margin-top: 8px; color: #5f6368; font-size: 14px;">The following courses do not have room assignments:</p>
                </div>`;

                html += `<div style="margin-bottom: 30px; padding: 20px; background-color: #f8f9fa; border-radius: 8px; border-left: 4px solid #2980b9;">
                    <div style="font-size: 16px; font-weight: 700; color: #202124; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <span>üìç Unspecified Rooms</span>
                        <span style="display: inline-block; padding: 3px 10px; background-color: #2980b9; color: white; border-radius: 12px; font-size: 11px; font-weight: 700;">${unspecifiedRooms.length} COURSES</span>
                    </div>
                    <div style="display: grid; gap: 12px;">`;

                unspecifiedRooms.forEach(course => {
                    const daysExpanded = expandDays(course.days);
                    html += `<div style="padding: 12px 15px; background-color: white; border-radius: 6px; border-left: 3px solid #2980b9;">
                        <div style="font-weight: 600; color: #202124; margin-bottom: 5px;">${course.course_number} - ${course.title}</div>
                        <div style="font-size: 13px; color: #5f6368;">
                            <strong>CRN:</strong> ${course.crn} |
                            <strong>Instructor:</strong> ${course.instructor}<br>
                            <strong>Time:</strong> ${course.time.raw} |
                            <strong>Days:</strong> ${daysExpanded} |
                            <strong>Room:</strong> ${course.room}
                        </div>
                    </div>`;
                });

                html += `</div></div>`;
            }

            // Display room conflicts
            if (conflicts.length === 0) {
                if (unspecifiedRooms.length === 0) {
                    html = '<div class="no-conflicts">‚úÖ No room conflicts detected! All courses are scheduled without overlap.</div>';
                } else {
                    html += '<div class="no-conflicts">‚úÖ No room conflicts detected for assigned rooms.</div>';
                }
                container.innerHTML = html;
                return;
            }

            html += `<div style="margin-bottom: 20px; padding: 15px; background-color: #fff3cd; border-left: 4px solid #ff6b6b; border-radius: 6px;">
                <strong>‚ö†Ô∏è Found ${conflicts.length} room conflict${conflicts.length > 1 ? 's' : ''}</strong>
                <p style="margin-top: 8px; color: #5f6368; font-size: 14px;">The following rooms have multiple courses scheduled at overlapping times:</p>
            </div>`;

            conflicts.forEach((conflict, index) => {
                // Generate conflict signature for persistence
                const crns = conflict.courses.map(c => c.crn).sort().join('-');
                const conflictSig = `${conflict.room}_${conflict.courses[0].days}_${conflict.courses[0].time.start}_${crns}`;
                const isIgnored = ignoredConflicts.has(conflictSig);

                html += `<div class="conflict-group${isIgnored ? ' conflict-hidden' : ''}" id="conflict-${index}" data-signature="${conflictSig}">
                    <button class="conflict-ignore-btn" onclick="toggleIgnoreConflict('${conflictSig}', ${index})">
                        ${isIgnored ? '‚Ü∂ Show' : '‚úï Ignore'}
                    </button>
                    <div class="conflict-header">
                        <span>üìç ${conflict.room}</span>
                        <span class="conflict-severity">${conflict.courses.length} COURSES</span>
                        ${isIgnored ? '<span style="margin-left: 10px; font-size: 12px; color: #666;">(Previously Ignored)</span>' : ''}
                    </div>
                    <p style="color: #721c24; font-size: 13px; margin: 10px 0;">These courses are scheduled in the same room at overlapping times:</p>
                    <div class="conflict-courses">`;

                conflict.courses.forEach(course => {
                    const daysExpanded = expandDays(course.days);
                    html += `<div class="conflict-course-item">
                        <div class="conflict-course-header">${course.course_number} - ${course.title}</div>
                        <div class="conflict-course-details">
                            <strong>CRN:</strong> ${course.crn} |
                            <strong>Instructor:</strong> ${course.instructor}<br>
                            <strong>Time:</strong> ${course.time.raw} |
                            <strong>Days:</strong> ${daysExpanded}
                        </div>
                    </div>`;
                });

                html += `</div></div>`;
            });

            // Add reset button if there are ignored conflicts
            if (ignoredConflicts.size > 0) {
                html += `<div style="margin-top: 20px; text-align: center;">
                    <button class="edit-action-btn btn-secondary" onclick="resetIgnoredConflicts()">
                        ‚Ü∂ Reset All Ignored Conflicts (${ignoredConflicts.size})
                    </button>
                </div>`;
            }

            container.innerHTML = html;
        }

        // Toggle ignore conflict (with localStorage persistence)
        function toggleIgnoreConflict(signature, index) {
            const conflictElement = document.getElementById(`conflict-${index}`);
            if (!conflictElement) return;

            if (ignoredConflicts.has(signature)) {
                // Un-ignore
                ignoredConflicts.delete(signature);
                conflictElement.classList.remove('conflict-hidden');
            } else {
                // Ignore
                ignoredConflicts.add(signature);
                conflictElement.classList.add('conflict-hidden');
            }

            // Persist to localStorage
            localStorage.setItem('ignoredConflicts', JSON.stringify([...ignoredConflicts]));

            // Refresh the display to update button and counter
            detectAndDisplayRoomConflicts();

            // Re-render the main calendar to update conflict indicators
            renderCourses();
        }

        // Reset all ignored conflicts
        function resetIgnoredConflicts() {
            if (!confirm('Are you sure you want to reset all ignored conflicts? This will show all conflicts again.')) {
                return;
            }

            ignoredConflicts.clear();
            localStorage.removeItem('ignoredConflicts');
            detectAndDisplayRoomConflicts();
            renderCourses();
            showToast('‚Ü∂ All ignored conflicts have been reset', 'info');
        }

        // Class list - show instructor schedules
        function generatePlanningMode() {
            const container = document.getElementById('planningModeContent');

            // Respect instructor filtering
            const allInstructors = [...new Set(courses.map(c => c.instructor))].sort();
            const instructors = selectedInstructors.size === 0
                ? allInstructors
                : allInstructors.filter(inst => selectedInstructors.has(inst));

            let html = '';

            if (instructors.length === 0) {
                html = '<div class="no-conflicts">üìã No instructors selected. Use the instructor filter above to select instructors to view their schedules.</div>';
                container.innerHTML = html;
                return;
            }

            instructors.forEach(instructor => {
                const instructorCourses = courses.filter(c => c.instructor === instructor);
                const instructorColor = getInstructorColor(instructor);

                html += `<div class="instructor-schedule">
                    <div class="instructor-schedule-header">
                        <span class="instructor-color-indicator" style="background-color: ${instructorColor}; width: 20px; height: 20px;"></span>
                        <span>${instructor} (${instructorCourses.length} course${instructorCourses.length > 1 ? 's' : ''})</span>
                    </div>
                    <div class="instructor-schedule-courses">`;

                instructorCourses.forEach(course => {
                    const daysExpanded = expandDays(course.days);
                    html += `<div class="schedule-course-item" style="border-left-color: ${instructorColor};">
                        <div class="schedule-course-title">${course.course_number} - ${course.title}</div>
                        <div class="schedule-course-details">
                            <strong>CRN:</strong> ${course.crn} |
                            <strong>Time:</strong> ${course.time.raw} |
                            <strong>Days:</strong> ${daysExpanded}<br>
                            <strong>Location:</strong> ${course.building} ${course.room} |
                            <strong>Credits:</strong> ${course.credits}
                        </div>
                    </div>`;
                });

                html += `</div></div>`;
            });

            container.innerHTML = html;
        }

        window.onclick = function(event) {
            if (event.target === document.getElementById('modal')) closeModal();
            if (event.target === document.getElementById('editModal')) closeEditModal();
        }

        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
                closeEditModal();
            }
        });

        // ============================================================================
        // EDIT MODE FUNCTIONS
        // ============================================================================

        // Initialize edit mode
        function initializeEditMode() {
            populateTimePickers();
            populateInstructorDatalist();
            populateEditInstructorFilter();
            populateEditRoomDropdown();
            renderEditCalendar();
            displayEditModeConflicts();
            updateEditCount();
        }

        // Populate instructor checkboxes in edit mode
        function populateEditInstructorFilter() {
            const instructorList = document.getElementById('editInstructorList');
            instructorList.innerHTML = ''; // Clear existing
            const instructors = [...new Set(editedCourses.map(c => c.instructor))].sort();

            // Ensure all instructors have colors
            instructors.forEach(instructor => {
                if (!instructorColors[instructor]) {
                    // Generate a color if missing
                    const hue = Math.floor(Math.random() * 360);
                    instructorColors[instructor] = `hsl(${hue}, 70%, 60%)`;
                }
            });

            instructors.forEach(instructor => {
                const item = document.createElement('div');
                item.className = 'instructor-checkbox-item';

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `edit-instructor-${instructor.replace(/\s+/g, '-')}`;
                checkbox.value = instructor;
                checkbox.checked = editSelectedInstructors.size === 0 || editSelectedInstructors.has(instructor);
                checkbox.onchange = () => toggleEditInstructorSelection(instructor);

                const label = document.createElement('label');
                label.setAttribute('for', checkbox.id);

                const colorIndicator = document.createElement('span');
                colorIndicator.className = 'instructor-color-indicator';
                colorIndicator.style.backgroundColor = getInstructorColor(instructor);

                label.appendChild(colorIndicator);
                label.appendChild(document.createTextNode(instructor));

                item.appendChild(checkbox);
                item.appendChild(label);
                instructorList.appendChild(item);
            });
        }

        // Populate room filter dropdown in edit mode
        // Toggle instructor dropdown in edit mode
        function toggleEditInstructorDropdown() {
            const dropdown = document.getElementById('editInstructorDropdown');
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        }

        // Toggle single instructor selection in edit mode
        function toggleEditInstructorSelection(instructor) {
            if (editSelectedInstructors.has(instructor)) {
                editSelectedInstructors.delete(instructor);
            } else {
                editSelectedInstructors.add(instructor);
            }
            updateEditInstructorButtonText();
            applyEditFilters();
        }

        // Select all instructors in edit mode
        function selectAllEditInstructors() {
            editSelectedInstructors.clear();
            document.querySelectorAll('#editInstructorList input[type="checkbox"]').forEach(cb => {
                cb.checked = true;
            });
            updateEditInstructorButtonText();
            applyEditFilters();
        }

        // Clear all instructors in edit mode
        function clearAllEditInstructors() {
            editSelectedInstructors.clear();
            document.querySelectorAll('#editInstructorList input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
                editSelectedInstructors.add(cb.value);
            });
            // Start with one instructor selected
            const firstCheckbox = document.querySelector('#editInstructorList input[type="checkbox"]');
            if (firstCheckbox) {
                firstCheckbox.checked = true;
                editSelectedInstructors.clear();
                editSelectedInstructors.add(firstCheckbox.value);
            }
            updateEditInstructorButtonText();
            applyEditFilters();
        }

        // Update instructor button text in edit mode
        function updateEditInstructorButtonText() {
            const btnText = document.getElementById('editInstructorBtnText');
            if (editSelectedInstructors.size === 0) {
                btnText.textContent = 'All Instructors';
            } else if (editSelectedInstructors.size === 1) {
                btnText.textContent = Array.from(editSelectedInstructors)[0];
            } else {
                btnText.textContent = `${editSelectedInstructors.size} Instructors`;
            }
        }

        // Edit mode room filter dropdown
        function toggleEditRoomDropdown() {
            const dropdown = document.getElementById('editRoomDropdown');
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        }

        function setEditRoomFilter(room) {
            editRoomFilter = room;
            const btnText = document.getElementById('editRoomBtnText');
            btnText.textContent = room === 'all' ? 'All Rooms' : room;
            document.getElementById('editRoomDropdown').style.display = 'none';
            applyEditFilters();
        }

        function populateEditRoomDropdown() {
            const roomSet = new Set();
            editedCourses.forEach(course => {
                if (course.building !== 'Not specified' && course.room !== 'Not specified') {
                    roomSet.add(`${course.building} ${course.room}`);
                }
            });
            const rooms = ['all', ...Array.from(roomSet).sort()];
            const dropdown = document.getElementById('editRoomList');
            dropdown.innerHTML = '';
            rooms.forEach(room => {
                const item = document.createElement('div');
                item.className = 'instructor-checkbox-item';
                item.onclick = () => setEditRoomFilter(room);
                const label = document.createElement('label');
                label.style.cursor = 'pointer';
                label.textContent = room === 'all' ? 'All Rooms' : room;
                item.appendChild(label);
                dropdown.appendChild(item);
            });
        }

        // Edit mode level filter dropdown
        function toggleEditLevelDropdown() {
            const dropdown = document.getElementById('editLevelDropdown');
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        }

        function setEditLevelFilter(level) {
            editLevelFilter = level;
            const btnText = document.getElementById('editLevelBtnText');
            if (level === 'all') {
                btnText.textContent = 'All Levels';
            } else if (level === 'undergrad') {
                btnText.textContent = 'Undergrad';
            } else if (level === 'grad') {
                btnText.textContent = 'Grad';
            }
            document.getElementById('editLevelDropdown').style.display = 'none';
            applyEditFilters();
        }

        // Apply edit mode filters
        function applyEditFilters() {
            // Skip rendering if we're currently importing data
            if (isImporting) {
                console.log('applyEditFilters: Skipping render during import');
                return;
            }

            // Update status text
            let statusParts = [];

            if (editRoomFilter !== 'all') {
                statusParts.push(`Room: <strong>${editRoomFilter}</strong>`);
            }

            // Add level filter status
            if (editLevelFilter === 'undergrad') {
                statusParts.push('<strong>undergrad only</strong>');
            } else if (editLevelFilter === 'grad') {
                statusParts.push('<strong>grad only</strong>');
            } else {
                statusParts.push('<strong>all levels</strong>');
            }

            if (editSelectedInstructors.size === 0) {
                statusParts.push('<strong>all instructors</strong>');
            } else if (editSelectedInstructors.size === 1) {
                statusParts.push(Array.from(editSelectedInstructors)[0]);
            } else {
                statusParts.push(`<strong>${editSelectedInstructors.size} instructors</strong>`);
            }

            document.getElementById('editFilterStatus').innerHTML = statusParts.join(' | ');

            // Re-render calendar with filters
            renderEditCalendar();
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(event) {
            // Close instructor dropdown
            const editDropdown = document.getElementById('editInstructorDropdown');
            const editDropdownBtn = document.getElementById('editInstructorDropdownBtn');
            if (editDropdown && !editDropdownBtn.contains(event.target) && !editDropdown.contains(event.target)) {
                editDropdown.style.display = 'none';
            }

            // Close room dropdown
            const roomDropdown = document.getElementById('editRoomDropdown');
            const roomBtn = document.getElementById('editRoomDropdownBtn');
            if (roomDropdown && roomBtn && !roomDropdown.contains(event.target) && !roomBtn.contains(event.target)) {
                roomDropdown.style.display = 'none';
            }

            // Close level dropdown
            const levelDropdown = document.getElementById('editLevelDropdown');
            const levelBtn = document.getElementById('editLevelDropdownBtn');
            if (levelDropdown && levelBtn && !levelDropdown.contains(event.target) && !levelBtn.contains(event.target)) {
                levelDropdown.style.display = 'none';
            }
        });

        // Populate time picker dropdowns with 5-minute intervals
        function populateTimePickers() {
            const startSelect = document.getElementById('editStartTime');
            const endSelect = document.getElementById('editEndTime');

            if (startSelect.options.length > 0) return; // Already populated

            const times = [];
            for (let hour = 9; hour <= 21; hour++) {
                for (let min = 0; min < 60; min += 5) {
                    const period = hour >= 12 ? 'PM' : 'AM';
                    const displayHour = hour > 12 ? hour - 12 : (hour === 0 ? 12 : hour);
                    const timeStr = `${displayHour.toString().padStart(2, '0')}:${min.toString().padStart(2, '0')}${period}`;
                    times.push(timeStr);
                }
            }

            times.forEach(time => {
                startSelect.add(new Option(time, time));
                endSelect.add(new Option(time, time));
            });
        }

        // Populate instructor datalist
        function populateInstructorDatalist() {
            const datalist = document.getElementById('instructorList');
            const instructors = [...new Set(editedCourses.map(c => c.instructor))].sort();
            datalist.innerHTML = '';
            instructors.forEach(instructor => {
                const option = document.createElement('option');
                option.value = instructor;
                datalist.appendChild(option);
            });
        }


        // Render edit calendar with overlap detection
        function renderEditCalendar() {
            const editTimeColumn = document.getElementById('editTimeColumn');
            const startHour = 9;
            const pixelsPerMinute = 1;

            // Create time slots
            editTimeColumn.innerHTML = '';
            for (let hour = 9; hour <= 21; hour++) {
                const timeSlot = document.createElement('div');
                timeSlot.className = 'time-slot';
                const period = hour >= 12 ? 'PM' : 'AM';
                const displayHour = hour > 12 ? hour - 12 : hour;
                timeSlot.textContent = `${displayHour}:00 ${period}`;
                editTimeColumn.appendChild(timeSlot);
            }

            // Clear day columns
            ['monday', 'tuesday', 'wednesday', 'thursday', 'friday'].forEach(day => {
                document.getElementById(`edit-${day}`).innerHTML = '';
            });

            // Group courses by day with filters applied
            const coursesByDay = { monday: [], tuesday: [], wednesday: [], thursday: [], friday: [] };
            editedCourses.forEach(course => {
                if (!course.days || !course.time) return;

                // Apply instructor filter
                const instructorMatch = editSelectedInstructors.size === 0 || editSelectedInstructors.has(course.instructor);
                if (!instructorMatch) return;

                // Apply room filter
                const courseRoom = `${course.building} ${course.room}`;
                if (editRoomFilter !== 'all' && courseRoom !== editRoomFilter) return;

                // Apply level filter
                if (editLevelFilter === 'undergrad' && isGraduateCourse(course.course_number)) return;
                if (editLevelFilter === 'grad' && !isGraduateCourse(course.course_number)) return;

                course.days.split('').forEach(dayLetter => {
                    const dayName = dayMap[dayLetter];
                    if (dayName) coursesByDay[dayName].push(course);
                });
            });

            // Render courses with overlap detection
            Object.keys(coursesByDay).forEach(dayName => {
                const dayColumn = document.getElementById(`edit-${dayName}`);
                const coursesForDay = coursesByDay[dayName];

                // Debug: Log all courses for Tuesday to see what's being grouped
                if (dayName === 'tuesday') {
                    console.log('=== DEBUG TUESDAY COURSES (BEFORE SORT) ===');
                    console.log('Total courses on Tuesday:', coursesForDay.length);
                    coursesForDay.forEach((c, idx) => {
                        const mins = timeToMinutes(c.time.start);
                        console.log(`[${idx}] CRN ${c.crn}: ${c.time.start} - ${c.time.end} (start=${mins} mins) | ${c.course_number} ${c.title}`);
                    });
                }

                // Sort by start time
                coursesForDay.sort((a, b) => timeToMinutes(a.time.start) - timeToMinutes(b.time.start));

                // Debug: Log after sorting
                if (dayName === 'tuesday') {
                    console.log('=== DEBUG TUESDAY COURSES (AFTER SORT) ===');
                    coursesForDay.forEach((c, idx) => {
                        const mins = timeToMinutes(c.time.start);
                        console.log(`[${idx}] CRN ${c.crn}: ${c.time.start} - ${c.time.end} (start=${mins} mins) | ${c.course_number} ${c.title}`);
                    });
                }

                const processed = new Set();

                coursesForDay.forEach((course, index) => {
                    if (processed.has(index)) return;

                    const startMinutes = timeToMinutes(course.time.start);
                    const endMinutes = timeToMinutes(course.time.end);
                    const duration = endMinutes - startMinutes;
                    const topPosition = (startMinutes - (startHour * 60)) * pixelsPerMinute;
                    const height = duration * pixelsPerMinute;

                    // Debug log for ALL courses on Tuesday to see positioning
                    if (dayName === 'tuesday') {
                        console.log(`=== RENDER CRN ${course.crn} ===`);
                        console.log('  time.start:', course.time.start, '‚Üí', startMinutes, 'minutes');
                        console.log('  time.end:', course.time.end, '‚Üí', endMinutes, 'minutes');
                        console.log('  duration:', duration, 'minutes');
                        console.log('  topPosition:', topPosition, 'px');
                        console.log('  height:', height, 'px');
                    }

                    // Find overlapping courses
                    const overlapping = [];
                    for (let i = index + 1; i < coursesForDay.length; i++) {
                        if (processed.has(i)) continue;
                        const other = coursesForDay[i];
                        const otherStart = timeToMinutes(other.time.start);
                        const otherEnd = timeToMinutes(other.time.end);
                        if (startMinutes < otherEnd && endMinutes > otherStart) {
                            overlapping.push({course: other, index: i});
                        }
                    }

                    // Calculate widths and positions
                    const totalOverlapping = overlapping.length + 1;
                    const widthPercent = 100 / totalOverlapping;

                    // Render main course
                    renderEditCourseBlock(course, dayColumn, topPosition, height, 0, widthPercent);
                    processed.add(index);

                    // Render overlapping courses
                    overlapping.forEach((item, i) => {
                        const otherStartMinutes = timeToMinutes(item.course.time.start);
                        const otherEndMinutes = timeToMinutes(item.course.time.end);
                        const otherDuration = otherEndMinutes - otherStartMinutes;
                        const otherTopPosition = (otherStartMinutes - (startHour * 60)) * pixelsPerMinute;
                        const otherHeight = otherDuration * pixelsPerMinute;
                        renderEditCourseBlock(item.course, dayColumn, otherTopPosition, otherHeight, i + 1, widthPercent);
                        processed.add(item.index);
                    });
                });
            });
        }

        // Render editable course block with overlap support
        function renderEditCourseBlock(course, dayColumn, topPosition, height, column, widthPercent) {
            const block = document.createElement('div');
            block.className = 'course-block';

            // Debug Tuesday renders
            if (dayColumn.id === 'edit-tuesday' && course.time.start === '11:00AM') {
                console.log(`  ‚Üí renderEditCourseBlock CRN ${course.crn}: top=${topPosition}px, left=${(column * widthPercent).toFixed(1)}%, width=${widthPercent.toFixed(1)}%, column=${column}`);
            }

            // Mark edited courses
            if (editedCRNs.has(course.crn)) {
                block.classList.add('edited');
            }

            // Position and size
            block.style.top = `${topPosition}px`;
            block.style.height = `${height}px`;
            block.style.left = `${column * widthPercent}%`;
            block.style.width = `calc(${widthPercent}% - 4px)`;

            // Use instructor-specific color
            block.style.background = getInstructorColor(course.instructor);

            block.innerHTML = `
                <div class="course-number">${course.course_number}</div>
                <div class="course-name">${course.title}</div>
                <div class="course-time">${course.time.start}</div>
                <div class="tooltip">
                    <div class="tooltip-row"><span class="tooltip-label">Course:</span><span class="tooltip-value">${course.course_number}</span></div>
                    <div class="tooltip-row"><span class="tooltip-label">Title:</span><span class="tooltip-value">${course.title}</span></div>
                    <div class="tooltip-row"><span class="tooltip-label">Instructor:</span><span class="tooltip-value">${course.instructor}</span></div>
                    <div class="tooltip-row"><span class="tooltip-label">Time:</span><span class="tooltip-value">${course.time.raw}</span></div>
                    <div class="tooltip-row"><span class="tooltip-label">Room:</span><span class="tooltip-value">${course.building} ${course.room}</span></div>
                    <div class="tooltip-row"><span class="tooltip-label">CRN:</span><span class="tooltip-value">${course.crn}</span></div>
                    <div class="tooltip-row"><span class="tooltip-label">Credits:</span><span class="tooltip-value">${course.credits}</span></div>
                    ${editedCRNs.has(course.crn) ? '<div class="tooltip-row" style="color: #fbbc04; font-weight: 700;">‚ö†Ô∏è Modified</div>' : ''}
                    <div class="tooltip-row" style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #555; font-style: italic; color: #aaa;">Click to edit</div>
                </div>
            `;

            block.onclick = () => openEditCourseModal(course);

            dayColumn.appendChild(block);
        }

        // Detect conflicts in edited courses (separate conflicts by specific time/day)
        function detectEditModeConflicts() {
            const conflicts = [];
            const roomGroups = {};

            // Normalize room key for consistent matching
            function normalizeRoomKey(building, room) {
                const normBuilding = building.replace(/\s+/g, ' ').trim().toUpperCase();
                const normRoom = room.replace(/\s+/g, ' ').trim().toUpperCase();
                return `${normBuilding}|${normRoom}`;
            }

            // Group edited courses by room
            editedCourses.forEach(course => {
                if (course.building === 'Not specified' || course.room === 'Not specified') return;
                const roomKey = normalizeRoomKey(course.building, course.room);
                if (!roomGroups[roomKey]) {
                    roomGroups[roomKey] = {
                        displayName: `${course.building} ${course.room}`,
                        courses: []
                    };
                }
                roomGroups[roomKey].courses.push(course);
            });

            // Check for overlaps within each room and group by day/time window
            Object.keys(roomGroups).forEach(roomKey => {
                const roomData = roomGroups[roomKey];
                const roomCourses = roomData.courses;

                if (roomCourses.length < 2) return;

                const conflictGroups = {};

                // Find all pairs with overlaps
                for (let i = 0; i < roomCourses.length; i++) {
                    for (let j = i + 1; j < roomCourses.length; j++) {
                        const course1 = roomCourses[i];
                        const course2 = roomCourses[j];

                        // Check if they share any days
                        const days1 = course1.days.split('');
                        const days2 = course2.days.split('');
                        const sharedDays = days1.filter(d => days2.includes(d));

                        if (sharedDays.length === 0) continue;

                        // Skip cross-listed courses (same title, time, instructor, days)
                        // These are intentionally scheduled together
                        if (course1.title === course2.title &&
                            course1.time.start === course2.time.start &&
                            course1.time.end === course2.time.end &&
                            course1.instructor === course2.instructor &&
                            course1.days === course2.days) {
                            continue;
                        }

                        // Check if times overlap
                        const start1 = timeToMinutes(course1.time.start);
                        const end1 = timeToMinutes(course1.time.end);
                        const start2 = timeToMinutes(course2.time.start);
                        const end2 = timeToMinutes(course2.time.end);

                        if (start1 < end2 && end1 > start2) {
                            // Found overlap - group by room + days + overlapping time window
                            const overlapStart = Math.max(start1, start2);
                            const overlapEnd = Math.min(end1, end2);
                            const daysKey = sharedDays.sort().join('');
                            const groupKey = `${roomData.displayName}_${daysKey}_${overlapStart}_${overlapEnd}`;

                            if (!conflictGroups[groupKey]) {
                                conflictGroups[groupKey] = {
                                    room: roomData.displayName,
                                    sharedDays: sharedDays,
                                    courses: [],
                                    overlapStart: overlapStart,
                                    overlapEnd: overlapEnd
                                };
                            }

                            // Add courses if not already in group
                            const group = conflictGroups[groupKey];
                            if (!group.courses.find(c => c.crn === course1.crn)) {
                                group.courses.push(course1);
                            }
                            if (!group.courses.find(c => c.crn === course2.crn)) {
                                group.courses.push(course2);
                            }
                        }
                    }
                }

                // Add conflict groups to results
                Object.values(conflictGroups).forEach(group => {
                    conflicts.push(group);
                });
            });

            return conflicts;
        }

        // Display conflicts in edit mode (using same style as Room Conflicts tab)
        function displayEditModeConflicts() {
            const conflicts = detectEditModeConflicts();
            const container = document.getElementById('editConflictsContent');

            if (conflicts.length === 0) {
                container.innerHTML = '<div class="no-conflicts">‚úÖ No conflicts detected! All courses are scheduled without overlap.</div>';
                return;
            }

            let html = `<div style="margin-bottom: 20px; padding: 15px; background-color: #fff3cd; border-left: 4px solid #ff6b6b; border-radius: 6px;">
                <strong>‚ö†Ô∏è Found ${conflicts.length} conflict${conflicts.length > 1 ? 's' : ''}</strong>
                <p style="margin-top: 8px; color: #5f6368; font-size: 14px;">The following rooms have multiple courses scheduled at overlapping times:</p>
            </div>`;

            conflicts.forEach((conflict, index) => {
                // Generate conflict signature for persistence
                const crns = conflict.courses.map(c => c.crn).sort().join('-');
                const daysStr = conflict.sharedDays.join('');
                const timeStr = conflict.courses[0].time.start;
                const conflictSig = `${conflict.room}_${daysStr}_${timeStr}_${crns}`;
                const isIgnored = editIgnoredConflicts.has(conflictSig);

                html += `<div class="conflict-group${isIgnored ? ' conflict-hidden' : ''}" id="edit-conflict-${index}" data-signature="${conflictSig}">
                    <button class="conflict-ignore-btn" onclick="toggleEditIgnoreConflict('${conflictSig}')">
                        ${isIgnored ? '‚Ü∂ Show' : '‚úï Ignore'}
                    </button>
                    <div class="conflict-header">
                        <span>üìç ${conflict.room}</span>
                        <span class="conflict-severity">${conflict.courses.length} COURSES</span>
                        ${isIgnored ? '<span style="margin-left: 10px; font-size: 12px; color: #666;">(Previously Ignored)</span>' : ''}
                    </div>
                    <p style="color: #721c24; font-size: 13px; margin: 10px 0;">These courses are scheduled in the same room at overlapping times on <strong>${conflict.sharedDays.map(d => ({'M':'Monday','T':'Tuesday','W':'Wednesday','R':'Thursday','F':'Friday'}[d])).join(', ')}</strong></p>
                    <div class="conflict-courses">`;

                conflict.courses.forEach(course => {
                    const daysExpanded = expandDays(course.days);
                    html += `<div class="conflict-course-item">
                        <div class="conflict-course-header">${course.course_number} - ${course.title}</div>
                        <div class="conflict-course-details">
                            <strong>CRN:</strong> ${course.crn} |
                            <strong>Instructor:</strong> ${course.instructor}<br>
                            <strong>Time:</strong> ${course.time.raw} |
                            <strong>Days:</strong> ${daysExpanded}
                        </div>
                    </div>`;
                });

                html += `</div></div>`;
            });

            // Add reset button if there are ignored conflicts
            if (editIgnoredConflicts.size > 0) {
                html += `<div style="margin-top: 20px; text-align: center;">
                    <button class="edit-action-btn btn-secondary" onclick="resetEditIgnoredConflicts()">
                        ‚Ü∂ Reset All Ignored Conflicts (${editIgnoredConflicts.size})
                    </button>
                </div>`;
            }

            container.innerHTML = html;
        }

        // Toggle ignore for edit mode conflicts
        function toggleEditIgnoreConflict(signature) {
            if (editIgnoredConflicts.has(signature)) {
                editIgnoredConflicts.delete(signature);
            } else {
                editIgnoredConflicts.add(signature);
            }
            localStorage.setItem('editIgnoredConflicts', JSON.stringify([...editIgnoredConflicts]));
            displayEditModeConflicts();
        }

        // Reset ignored conflicts in edit mode
        function resetEditIgnoredConflicts() {
            if (!confirm('Are you sure you want to reset all ignored conflicts? They will all be shown again.')) return;
            editIgnoredConflicts.clear();
            localStorage.removeItem('editIgnoredConflicts');
            displayEditModeConflicts();
        }

        // Open modal to add new course
        function openAddCourseModal() {
            currentEditCRN = null;
            document.getElementById('editModalTitle').textContent = 'Add New Course';
            document.getElementById('editCourseForm').reset();
            document.getElementById('deleteCourseBtn').style.display = 'none';
            document.getElementById('duplicateCourseBtn').style.display = 'none';

            // Set default CRN
            document.getElementById('editCRNInput').value = 'XXXXX';

            // Set default subject code from existing courses
            const defaultSubject = editedCourses.length > 0 ? editedCourses[0].subject : '';
            document.getElementById('editSubject').value = defaultSubject;

            // Set default section
            document.getElementById('editSection').value = '10';

            // Set default credits
            document.getElementById('editCredits').value = '3';

            document.getElementById('editModal').style.display = 'block';
        }

        // Open modal to edit existing course
        function openEditCourseModal(course) {
            currentEditCRN = course.crn;
            document.getElementById('editModalTitle').textContent = 'Edit Course';
            document.getElementById('deleteCourseBtn').style.display = 'inline-block';
            document.getElementById('duplicateCourseBtn').style.display = 'inline-block';

            // Populate form
            document.getElementById('editCRN').value = course.crn;
            document.getElementById('originalCRN').value = course.crn;
            document.getElementById('editSubject').value = course.subject || '';
            document.getElementById('editCourseNum').value = course.course_num || '';
            document.getElementById('editSection').value = course.section || '';
            document.getElementById('editCRNInput').value = course.crn || '';
            document.getElementById('editTitle').value = course.title || '';
            document.getElementById('editCredits').value = course.credits || '';
            document.getElementById('editInstructor').value = course.instructor || '';
            document.getElementById('editStartTime').value = course.time.start || '';
            document.getElementById('editEndTime').value = course.time.end || '';
            document.getElementById('editBuilding').value = course.building || '';
            document.getElementById('editRoom').value = course.room || '';
            document.getElementById('editDates').value = course.dates || '';

            // Set days
            document.querySelectorAll('input[name="editDay"]').forEach(cb => cb.checked = false);
            if (course.days) {
                course.days.split('').forEach(day => {
                    const checkbox = document.querySelector(`input[name="editDay"][value="${day}"]`);
                    if (checkbox) checkbox.checked = true;
                });
            }

            document.getElementById('editModal').style.display = 'block';
        }

        // Close edit modal
        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            document.getElementById('daysError').style.display = 'none';
            document.getElementById('timeError').style.display = 'none';
        }

        // Save course edit
        function saveCourseEdit(event) {
            event.preventDefault();

            // Validate days
            const selectedDays = Array.from(document.querySelectorAll('input[name="editDay"]:checked'))
                .map(cb => cb.value).join('');
            if (!selectedDays) {
                document.getElementById('daysError').style.display = 'block';
                return;
            } else {
                document.getElementById('daysError').style.display = 'none';
            }

            // Validate times
            const startTime = document.getElementById('editStartTime').value;
            const endTime = document.getElementById('editEndTime').value;
            if (timeToMinutes(startTime) >= timeToMinutes(endTime)) {
                document.getElementById('timeError').style.display = 'block';
                return;
            } else {
                document.getElementById('timeError').style.display = 'none';
            }

            // Get form data
            const newCRN = document.getElementById('editCRNInput').value;
            const originalCRN = document.getElementById('originalCRN').value;

            const courseData = {
                crn: newCRN,
                subject: document.getElementById('editSubject').value,
                course_num: document.getElementById('editCourseNum').value,
                section: document.getElementById('editSection').value,
                title: document.getElementById('editTitle').value,
                credits: document.getElementById('editCredits').value,
                instructor: document.getElementById('editInstructor').value,
                days: selectedDays,
                time: {
                    start: startTime,
                    end: endTime,
                    raw: `${startTime} - ${endTime}`
                },
                building: document.getElementById('editBuilding').value || 'Not specified',
                room: document.getElementById('editRoom').value || 'Not specified',
                dates: document.getElementById('editDates').value || '01/12/26 - 04/27/26',
                course_number: `${document.getElementById('editSubject').value} ${document.getElementById('editCourseNum').value}`,
                status: 'OPEN'
            };

            // Update or add course
            if (originalCRN) {
                // Editing existing course
                const index = editedCourses.findIndex(c => c.crn === originalCRN);
                if (index !== -1) {
                    editedCourses[index] = courseData;
                    editedCRNs.add(newCRN);
                    if (originalCRN !== newCRN) {
                        editedCRNs.delete(originalCRN);
                    }
                }
            } else {
                // Adding new course
                editedCourses.push(courseData);
                editedCRNs.add(newCRN);
            }

            editCount++;
            updateEditCount();
            populateEditInstructorFilter();
            populateEditRoomFilter();
            renderEditCalendar();
            displayEditModeConflicts();
            populateInstructorDatalist();
            closeEditModal();

            showToast('‚úÖ Course saved successfully!', 'success');
        }

        // Delete course
        function deleteCourse() {
            if (!confirm('Are you sure you want to delete this course? This cannot be undone.')) {
                return;
            }

            const crn = document.getElementById('editCRNInput').value;
            const index = editedCourses.findIndex(c => c.crn === crn);

            if (index !== -1) {
                editedCourses.splice(index, 1);
                editedCRNs.delete(crn);
                editCount++;
                updateEditCount();
                populateEditInstructorFilter();
                populateEditRoomFilter();
                renderEditCalendar();
                displayEditModeConflicts();
                closeEditModal();
                showToast('üóëÔ∏è Course deleted', 'info');
            }
        }

        // Duplicate course
        function duplicateCourse() {
            const originalCRN = document.getElementById('editCRNInput').value;
            const originalCourse = editedCourses.find(c => c.crn === originalCRN);

            if (!originalCourse) return;

            // Generate new CRN and increment section
            const maxCRN = Math.max(...editedCourses.map(c => parseInt(c.crn) || 0));
            const newCRN = (maxCRN + 1).toString();
            const sectionNum = parseInt(originalCourse.section) || 10;
            const newSection = (sectionNum + 10).toString();

            const duplicatedCourse = {
                ...originalCourse,
                crn: newCRN,
                section: newSection,
                course_number: `${originalCourse.subject} ${originalCourse.course_num}`
            };

            editedCourses.push(duplicatedCourse);
            editedCRNs.add(newCRN);
            editCount++;
            updateEditCount();
            populateEditInstructorFilter();
            populateEditRoomFilter();
            renderEditCalendar();
            displayEditModeConflicts();
            closeEditModal();

            showToast('üìã Course duplicated successfully!', 'success');
        }

        // Update edit count display
        function updateEditCount() {
            document.getElementById('editCount').textContent = editedCRNs.size;
        }

        // Export to CSV
        function exportToCSV() {
            // Sort by instructor, then by course_number
            const sortedCourses = [...editedCourses].sort((a, b) => {
                const instructorCompare = (a.instructor || '').localeCompare(b.instructor || '');
                if (instructorCompare !== 0) return instructorCompare;
                return (a.course_number || '').localeCompare(b.course_number || '');
            });

            const headers = ['CRN', 'Subject', 'CourseNum', 'Section', 'Title', 'Credits', 'Instructor', 'Days', 'StartTime', 'EndTime', 'Building', 'Room', 'Dates'];
            const rows = sortedCourses.map(c => [
                c.crn,
                c.subject,
                c.course_num,
                c.section,
                c.title,
                c.credits,
                c.instructor,
                c.days,
                c.time.start,
                c.time.end,
                c.building,
                c.room,
                c.dates
            ]);

            const csvContent = [
                headers.join(','),
                ...rows.map(row => row.map(cell => {
                    const cellStr = (cell || '').toString();
                    // Escape quotes and wrap in quotes if contains comma or quote
                    if (cellStr.includes(',') || cellStr.includes('"') || cellStr.includes('\n')) {
                        return `"${cellStr.replace(/"/g, '""')}"`;
                    }
                    return cellStr;
                }).join(','))
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `schedule_${new Date().toISOString().slice(0,10)}.csv`;
            a.click();
            URL.revokeObjectURL(url);

            showToast('üì• CSV exported successfully!', 'success');
        }

        // Handle CSV import
        function handleCSVImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const csv = e.target.result;
                const lines = csv.split('\n').filter(line => line.trim());

                if (lines.length === 0) {
                    showToast('‚ùå CSV file is empty', 'error');
                    return;
                }

                const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));

                const imported = [];
                for (let i = 1; i < lines.length; i++) {
                    const values = parseCSVLine(lines[i]);

                    console.log(`Row ${i}: parsed ${values.length} columns`, values);

                    if (values.length < 6) {
                        console.warn(`Skipping row ${i}: only ${values.length} columns (need at least 6)`);
                        continue;
                    }

                    // Parse the course data with proper validation
                    // CSV format: CRN, Subject, CourseNum, Section, Title, Credits, Instructor, Days, StartTime, EndTime, Building, Room, Dates
                    const crn = values[0]?.trim();
                    const subject = values[1]?.trim() || 'GEOG';
                    const course_num = values[2]?.trim();
                    const section = values[3]?.trim();
                    const title = values[4]?.trim();
                    const credits = values[5]?.trim() || '0.00';
                    const instructor = values[6]?.trim() || 'TBA';
                    const days = values[7]?.trim() || 'MW';
                    const startTime = values[8]?.trim() || '09:00AM';
                    const endTime = values[9]?.trim() || '10:00AM';
                    const building = values[10]?.trim() || 'Not specified';
                    const room = values[11]?.trim() || 'Not specified';
                    const dates = values[12]?.trim() || '01/12/26 - 04/27/26';

                    if (!crn || !title) {
                        console.warn(`Skipping row ${i}: missing required fields - CRN=${crn}, Title=${title}`);
                        continue;
                    }

                    // Validate time format
                    if (!startTime.match(/\d{1,2}:\d{2}[AP]M/) || !endTime.match(/\d{1,2}:\d{2}[AP]M/)) {
                        console.warn(`Skipping row ${i}: invalid time format - Start=${startTime}, End=${endTime}`);
                        continue;
                    }

                    // Skip courses without scheduled meeting times (e.g., independent study, research)
                    if (!days || !days.match(/^[MTWRF]+$/)) {
                        console.warn(`Skipping row ${i}: no scheduled meeting days - Days=${days} (likely independent study/research)`);
                        continue;
                    }

                    // Create course object matching EXACT scraper format
                    const course = {
                        status: 'OPEN',
                        crn: crn,
                        subject: subject,
                        course_num: course_num,
                        section: section,
                        title: title,
                        credits: credits,
                        instructor: instructor,
                        days: days,
                        time: {
                            start: startTime,
                            end: endTime,
                            raw: `${startTime} - ${endTime}`
                        },
                        dates: dates,
                        building: building,
                        room: room,
                        course_number: `${subject} ${course_num}`
                    };

                    // Debug log for problematic course
                    if (crn === '43789') {
                        console.log('=== DEBUG CRN 43789 IMPORT ===');
                        console.log('Raw CSV values:', values);
                        console.log('StartTime from CSV (index 8):', values[8]);
                        console.log('EndTime from CSV (index 9):', values[9]);
                        console.log('Parsed startTime:', startTime);
                        console.log('Parsed endTime:', endTime);
                        console.log('Full course object:', JSON.stringify(course, null, 2));
                        console.log('timeToMinutes(startTime):', timeToMinutes(startTime));
                        console.log('timeToMinutes(endTime):', timeToMinutes(endTime));
                    }

                    imported.push(course);
                }

                if (imported.length === 0) {
                    showToast('‚ùå No valid courses found in CSV', 'error');
                    return;
                }

                if (confirm(`Import ${imported.length} courses? This will REPLACE all current courses in edit mode.`)) {
                    // Set flag to prevent multiple renders during import
                    isImporting = true;

                    // REPLACE all courses with imported data
                    editedCourses = imported;
                    editedCRNs.clear();
                    imported.forEach(course => {
                        editedCRNs.add(course.crn);
                    });

                    editCount = imported.length;
                    isImporting = false;

                    // Force refresh by switching tabs away and back
                    switchTab('room-conflicts');
                    setTimeout(() => {
                        switchTab('edit-schedule');
                        showToast(`Imported ${imported.length} courses successfully!`, 'success');
                    }, 100);
                }
            };
            reader.readAsText(file);
            event.target.value = ''; // Reset file input
        }

        // Parse CSV line handling quotes and commas
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;

            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                const nextChar = line[i + 1];

                if (char === '"' && inQuotes && nextChar === '"') {
                    current += '"';
                    i++;
                } else if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current.trim());
            return result;
        }

        // Download modified JSON
        function downloadModifiedJSON() {
            const json = JSON.stringify(editedCourses, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `gwu_course_calendar_edited_${new Date().toISOString().slice(0,10)}.json`;
            a.click();
            URL.revokeObjectURL(url);

            showToast('üíæ JSON saved successfully!', 'success');
        }

        // Export edited calendar using embedded template (base64 encoded)
        function exportEditedCalendar() {
            // Prompt for filename
            const defaultName = `edited_calendar_${new Date().toISOString().slice(0,10)}.html`;
            const filename = prompt('Enter filename for the exported calendar:', defaultName);
            if (!filename) return;

            const finalFilename = filename.endsWith('.html') ? filename : filename + '.html';

            // Decode the base64 template (with proper UTF-8 handling)
            const template = decodeURIComponent(escape(atob(EXPORT_TEMPLATE_B64)));

            // Replace placeholder with edited courses
            const exportHTML = template.replace(
                '__COURSES_DATA_PLACEHOLDER__',
                JSON.stringify(editedCourses)
            );

            // Download the file
            const blob = new Blob([exportHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = finalFilename;
            a.click();
            URL.revokeObjectURL(url);

            showToast(`üìÑ Calendar exported as ${finalFilename}`, 'success');
        }

        // Helper function to download a file
        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Export schedule - downloads HTML, CSV, and JSON
        function exportSchedule() {
            // Prompt for base filename
            const defaultName = `schedule_${new Date().toISOString().slice(0,10)}`;
            const baseName = prompt('Enter base filename (will create .html, .csv, and .json files):', defaultName);
            if (!baseName) return;

            // 1. Export HTML calendar
            const template = decodeURIComponent(escape(atob(EXPORT_TEMPLATE_B64)));
            const exportHTML = template.replace(
                '__COURSES_DATA_PLACEHOLDER__',
                JSON.stringify(editedCourses)
            );
            downloadFile(exportHTML, baseName + '.html', 'text/html');

            // 2. Export CSV
            const sortedCourses = [...editedCourses].sort((a, b) => {
                const instructorCompare = (a.instructor || '').localeCompare(b.instructor || '');
                if (instructorCompare !== 0) return instructorCompare;
                return (a.course_number || '').localeCompare(b.course_number || '');
            });
            const headers = ['CRN', 'Subject', 'CourseNum', 'Section', 'Title', 'Credits', 'Instructor', 'Days', 'StartTime', 'EndTime', 'Building', 'Room', 'Dates'];
            const rows = sortedCourses.map(c => [
                c.crn, c.subject, c.course_num, c.section, c.title, c.credits,
                c.instructor, c.days, c.time.start, c.time.end, c.building, c.room, c.dates
            ]);
            const csvContent = [
                headers.join(','),
                ...rows.map(row => row.map(cell => {
                    const cellStr = (cell || '').toString();
                    if (cellStr.includes(',') || cellStr.includes('"') || cellStr.includes('\n')) {
                        return `"${cellStr.replace(/"/g, '""')}"`;
                    }
                    return cellStr;
                }).join(','))
            ].join('\n');
            downloadFile(csvContent, baseName + '.csv', 'text/csv');

            // 3. Export JSON
            const json = JSON.stringify(editedCourses, null, 2);
            downloadFile(json, baseName + '.json', 'application/json');

            showToast(`üì¶ Exported: ${baseName}.html, .csv, .json`, 'success');
        }

        // Show toast notification
        function showToast(message, type) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 25px;
                background: ${type === 'success' ? '#34a853' : type === 'error' ? '#ea4335' : '#4285f4'};
                color: white;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 10000;
                font-weight: 600;
                animation: slideIn 0.3s ease;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // ============================================================================
        // END EDIT MODE FUNCTIONS
        // ============================================================================

        // Initialize
        generateInstructorColors();
        detectRoomConflicts();
        createTimeSlots();
        renderCourses();
        populateInstructorList();
        updateInstructorLegend();
    </script>
    </div> <!-- end main-content -->

    <!-- Read the Docs style footer -->
    <footer class="rtd-footer">
        <div class="rtd-footer-content">
            <div class="rtd-footer-left">
                <strong>GWU Course Calendar Scraper</strong><br>
                Interactive course schedule viewer for George Washington University
            </div>
            <div class="rtd-footer-links">
                <a href="https://github.com/mmann1123/GWU_Course_Calendar" target="_blank" class="rtd-footer-link">
                    <svg class="github-icon" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
                        <path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                    </svg>
                    View on GitHub
                </a>
                <a href="https://github.com/mmann1123/GWU_Course_Calendar/issues" target="_blank" class="rtd-footer-link">
                    <svg class="github-icon" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
                        <path fill="currentColor" d="M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm9 3a1 1 0 11-2 0 1 1 0 012 0zM6.92 6.085c.081-.16.19-.299.34-.398.145-.097.371-.187.74-.187.28 0 .553.087.738.225A.613.613 0 019 6.25c0 .177-.04.264-.077.318a.956.956 0 01-.277.245c-.076.051-.158.1-.258.161l-.007.004a7.728 7.728 0 00-.313.195 2.416 2.416 0 00-.692.661.75.75 0 001.248.832.956.956 0 01.276-.245 6.3 6.3 0 01.26-.16l.006-.004c.093-.057.204-.123.313-.195.222-.149.487-.355.692-.662.214-.32.329-.702.329-1.15 0-.76-.36-1.348-.863-1.725A2.76 2.76 0 008 4c-.631 0-1.155.16-1.572.438-.413.276-.68.638-.849.977a.75.75 0 001.342.67z"/>
                    </svg>
                    Report Issue
                </a>
            </div>
        </div>
        <div class="rtd-footer-attribution">
            Credit: Michael Mann, Dept of Geography & Environment<br>
            Scraped on January 20, 2026 at 02:09 PM | Built with Python & BeautifulSoup
        </div>
    </footer>
</body>
</html>